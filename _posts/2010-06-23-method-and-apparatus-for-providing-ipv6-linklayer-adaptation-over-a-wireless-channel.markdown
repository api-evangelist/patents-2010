---

title: Method and apparatus for providing IPv6 link-layer adaptation over a wireless channel
abstract: A method and apparatus for providing IPv6 link-layer adaptation over a wireless channel are provided. The apparatus is configured to transmit and receive 6LoWPAN frames over a signaling channel of a wireless telecommunication system to provide IPv6 link-layer adaptation over the channel.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08923182&OS=08923182&RS=08923182
owner: Arm Finland Oy
number: 08923182
owner_city: Oulu
owner_country: FI
publication_date: 20100623
---
In modern communication and computer networks data exchange between programs and computers is a vital element. Different programs computers and processors exchange data without human intervention. This kind of communication is usually called machine to machine M2M communications. Different networks and protocols are used in different environments. On the Internet the Transmission Control Protocol TCP and Internet Protocol IP are basic protocols used in communication. TCP takes care of assembling and disassembling the data to be transmitted in packets and reliability. IP handles framing and addressing so that packets are delivered to the correct destination. Above TCP IP different application protocols may be used such as client server protocols for example.

An example of a network technology where M2M communication is widely applied is a low power wireless network such as an IEEE 802.15.4 based embedded and sensor network. These networks are very energy efficient and the chip technology is cheap. For this reason the technology is making its way to embedded devices very quickly for automation measurement tracking and control for example. The use of these networks in buildings and other environments has increased in recent years.

Devices belonging to an embedded network may need to communicate with a server in the Internet for example. For this reason the devices are equipped with means for communicating over the Internet. Cellular systems such the GSM Global System for Communication mobile phone system are widely used for machine to machine communications for applications such as remote machine monitoring automatic meter infrastructures and asset management. In M2M systems the devices may include a cellular system modem for communicating with a backend M2M service of some kind. An example of a modem is a GPRS General packet radio service modem. Although some M2M applications may use SMS Short Message Service for communication this is a very limited solution. The majority of applications needs IP connectivity and thus uses IP Internet Protocol over GPRS. Respective connections are used in other types of cellular systems such as systems based on CDMA Code division multiple access or Third Generation 3G systems such as UMTS Universal Mobile Telecommunications System or LTE Long Term Evolution .

The present and still widely used Internet Protocol IPv4 has the drawback of having a limited address space as it uses 32 bits for addresses. Machine to machine applications often involve the monitoring of very large numbers of devices which must be cheap and usually run off of battery power. In order to deal with the large number of nodes IPv6 Internet Protocol version 6 is clearly needed for its superior addressing scheme. In IPv6 128 bits are used for addresses.

Today s solution for enabling GSM devices with IP using GPRS is causing major problems in the M2M industry and for telecom operators. GPRS is complex reserves continuous resources from the GSM network is too expensive and requires too much power from M2M devices of low power wireless networks. Although the IP data carried over GPRS could be somewhat compressed and made more efficient this does not fix the majority of problems associated with GPRS.

According to an aspect of the present invention there is provided an apparatus comprising a processor a memory including computer program code configured to with the processor cause the apparatus at least to perform transmitting and receiving 6LoWPAN frames over a signaling channel of a wireless telecommunication system to provide IPv6 link layer adaptation over the channel.

According to another aspect of the present invention there is provided an apparatus comprising a processor a memory including computer program code configured to with the processor cause the apparatus at least to perform transmit and receive 6LoWPAN frames determine the address of the sender of a received 6LoWPAN frame determine a category for a received 6LoWPAN frame on the basis of the sender address and forward frames of different categories to different routers.

According to another aspect of the present invention there is provided a subscriber identity module configured to be inserted into a mobile unit of cellular system and comprising a processor a memory including computer program code configured to with the processor cause the subscriber identity module at least to perform control transmission and reception of 6LoWPAN frames over a signaling channel of a wireless telecommunication system to provide IPv6 link layer adaptation over the channel.

According to another aspect of the present invention there is provided a method comprising transmitting and receiving 6LoWPAN frames over a signaling channel of a wireless telecommunication system to provide IPv6 link layer adaptation over the channel.

The following embodiments are exemplary. Although the specification may refer to an one or some embodiment s in several locations this does not necessarily mean that each such reference is to the same embodiment s or that the feature only applies to a single embodiment. Single features of different embodiments may also be combined to provide other embodiments.

A GSM based network comprises a mobile switching center MSC . The MSC is responsible for switching paging user equipment location registration handover management collection of subscriber billing information frequency allocation management and many other services of a cellular network. A network may have one or more MSC depending on the size of the network.

The network further comprises a home location register HLR which contains a permanent subscriber register i.e. the following information for instance an international mobile subscriber identity IMSI a mobile subscriber ISDN number MSISDN an authentication key and when the radio system supports GPRS a packet data protocol PDP address.

A visitor location register VLR of the network contains roaming information on user equipment in the area of the mobile services switching centre . The visitor location register contains almost the same information as the home location register but in the visitor location register the information is kept only temporarily.

The network elements shown in are functional entities whose physical implementation may vary. Usually the mobile services switching centre and the visitor location register form one physical device and the home location register may form a second physical device. However the physical realization of the elements is not relevant regarding the embodiments of the invention.

The elements of the network are interconnected. In an embodiment the connections are realized using GSM Mobile Application Part MAP which works as a general bus between the network components.

The machine to machine communicating device is connected to the MSC of the cellular network typically via a base station or an eNodeB not shown in the figure . In an embodiment there may be a base station controller BSC or a radio network controller RNC between a base station and the MSC. However the connection between the device and the networks is controlled by the MSC.

In an embodiment the device is a separate M2M device communicating with the Internet. In an embodiment the device may serve as a router for a sensor network consisting of nodes and links between the nodes.

The sensor network may be a low power wireless network according to the standard IEEE 802.15.4 where IEEE stands for Institute of Electrical and Electronics Engineers. In an embodiment the network is an IPv6 sensor network. This means that the radio interfaces between the nodes utilize IPv6. In an embodiment the communication is realized according to Internet standard IETF RFC 4944 where IETF RFC stands for Internet Engineering Task Force Request for Comments. IETF RFC 4944 may be referred as 6LoWPAN IPv6 over Low power Wireless Personal Area Networks .

In an embodiment the radio interfaces may be realized using IEEE 802.15.4 with ZigBee Bluetooth or Bluetooth Ultra Low Power ULP Low Power Wireless Local Area Network proprietary low power radio cellular radio system or any other system suitable for low power transmission. More than one radio interface may be used within a low power wireless network and the interfaces may be incompatible with each other.

If the device acts as a router for the low power wireless network the device may utilize different radio interface when communicating with the wireless network and when communicating with the cellular network .

In an embodiment the M2M communication utilizing IPv6 between the device and the Internet is realized using signaling channels of the cellular network the device is connected to.

In the example embodiment of where the device is connected to a GSM based network the M2M communication utilizing IPv6 is realized using Unstructured Supplementary Service Data USSD . The IPv6 connection may be realized by transmitting and receiving Unstructured Service Supplementary Data service messages comprising IETF RFC 4944 frames. The IETF RFC 4944 or 6LoWPAN frames included in the USSD service messages carry the IPv6 protocol between the device and the Internet. The proposed solution has many benefits over the prior art solution of realizing IP over GPRS. For example the latency of the USSD service is much lower compared to GPRS or SMS setup times. In addition 6LoWPAN over USSD is much simpler to implement than a full IP stack over GPRS. Furthermore the power consumption is lower due to faster use of USSD and longer sleep times for devices. The cellular radio range of USSD is also better than that of GPRS.

In an embodiment the device transmitting IPv6 over USSD includes a small subset of the GSM standard for USSD signaling a 6LoWPAN over USSD link layer adaptation and a 6LoWPAN protocol stack.

USSD is a service normally used for sending short text based messages which may be operator defined. Typical uses for USSD messages relate to prepaid subscribers and call forwarding.

In GSM based systems USSD utilizes GSM signaling channels for data transfer. If a mobile unit is idle mode the SDCCH stand alone dedicated control channel is used for data transfer. When a mobile unit having an active connection with the network such as a call FACCH fast associated control channel is used for data transfer.

The USSD service offers a half duplex connection between a mobile unit and an application in the network. An USSD session can be initiated by either a mobile unit or a network application and only one session can be open at a time. USSD is session based instant no buffering and reliable. USSD can also be routed back to the home network HLR of the mobile unit using the service. This allows for the same services to be provided even while the mobile units are roaming.

In the cellular network backend USSD applications are handled by an entity called the USSD Gateway . The gateway may also be called a USSD Service Center. Normally USSD applications are terminated at an entity connected directly to the USSD Gateway.

In an embodiment the backend architecture is much more flexible compared to above. In the example of one or more IPv6 Routers act as USSD Applications for the 6LoWPAN over USSD service. The IPv6 routers are configured to route the traffic to other IPv6 servers located anywhere in the Internet . Each IPv6 Router is configured to communicate with the USSD Gateway using a protocol supported by the USSD Gateway such as SMPP Short Message Peer to Peer or CIMD Computer Interface to Message Distribution for example.

In the following an embodiment is studied in connection with . illustrates an example of a protocol stack from the device to the IPv6 Router . illustrates how a 6LoWPAN frame may be carried in the payload USSD String of a USSD message.

The stack of device comprises a GSM communication layer in full or as a subset supporting USSD. On top of the GSM layer is support for USSD the 6LoWPAN adaptation layer IPv6 and finally UDP User Datagram Protocol utilized in Internet communication. It should be noted that other transports such as TCP and any application protocol could be used as well.

The MSC the VLR the HLR and the USSD Gateway communicate using MAP. In the example of the USSD Gateway and the IPv6 Router communicate using CIMD.

As stated above USSD is a half duplex signaling channel normally used for sending text messages from a mobile unit to an operator application or vice versa. A USSD session can be initiated by either the mobile unit or the network application and only one session can be open at a time.

As illustrates a USSD frame may comprise a USSD header 6LoWPAN header a UDP header and UDP payload USSD string . A USSD header consists of a Data Coding Scheme DCS possible Service Code SC for mobile initiated USSD and possible Network Equipment Indicator NEI for network initiated USSD. The USSD payload USSD String is normally used for carrying 7 bit ASCII text. The size of a USSD String may vary from 133 to 160 octets depending on the message.

In an embodiment 6LoWPAN is used to carry IPv6 natively over USSD. The LoWPAN adaptation layer is placed directly in the USSD String. In GSM based networks the USSD String is sent using a Data Coding Scheme DCS with 8 bit coding bit3 0 bit2 1 . Thus the default DCS setting for both mobile and network initiated USSD is 11110101 0xF5. Some GSM networks or GSM modems however only allow a DCS code of 0xF0 default 7 bit coding . In such cases Base64 encoding may be used to carry binary data in the USSD String.

When a mobile unit initiates USSD it must indicate a USSD service class in the initial request in the form SC ATTRIBUTE where SC is an integer identifying the USSD application to route the message to and ATTRIBUTE is an optional value to pass to the USSD application at which the message is directed. In an embodiment of the invention a given SC value is used to identify the 6LoWPAN over USSD service. The ATTRIBUTE value is not used. Advantageously the given SC value is from the HLR SC space of the mobile unit. In an embodiment the 6LoWPAN over USSD backend is hosted at the home network of the MS. In GSM terminology the home network is denoted as HPLMN Home Public Land Mobile Network . A non limiting example of a given SC value is 123 .

Returning to the USSD header carries any needed USSD information such as the DCS and SC. This header has variable length thus the size of the payload varies depending on the message type. The USSD header is immediately followed by a 6LoWPAN header . The first byte of the header indicates the type of LoWPAN frame. In an embodiment the first byte may indicate two types Empty and More Data. These types will be explained below. The LoWPAN header compresses IPv6 and in the entire IPv6 header is compressed away. If there would be IPv6 fields they would immediately follow the LoWPAN header . Next follows the UDP header follows and finally the payload USSD String . It should be noted that UDP is used here only as an example. Other protocols may be used as well.

When the device acts as a 6LoWPAN over USSD host the addressing for the host is achieved using IPv6 auto configuration which builds the 128 bit IPv6 address from the 64 bit prefix advertised usually less than 64 bits plus padding by the IPv6 router and the interface identifier of the host device . In an embodiment the interface identifier of the host device is formed from the 15 digit MSISDN of the GSM SIM card of the host device . This is achieved by encoding the 15 MSISDN digits as 4 bit packed unsigned integers 4 15 60 bits plus 4 bits of 0 padding to make 64 bits. Before auto configuration the host device may optionally send a Router Solicitation RS message to the IPv6 Router resulting in a Router Advertisement RA back containing the 64 bit prefix. This step is however unnecessary for hosts and may be skipped if they don t need to know their own IPv6 address as 6LoWPAN compression elides the prefix information in the packets in any case.

Each decimal digit converted to 4 bit binary value concatenated with 4 bit 0 padding into a 64 bit binary value.

When the device acts as a 6LoWPAN over USSD router handling an IPv6 network behind it the addressing is achieved in a similar way as that for a host. The device acting as a router first autoconfigures its own GSM interface using RS RA Router Solicitation Router Advertisement and then builds its address from the MSISDN. In addition The device acting as a router must acquire its own 64 bit prefix es to advertise on its local interfaces. This is achieved by using e.g. DHCPv6 Dynamic Host Configuration Protocol for IPv6 to request one or more prefixes from the IPv6 Router . The device acting as a router then uses these assigned prefixes with its own local interfaces and performs normal IPv6 routing between networks. In this configuration the router can not compress the address field prefix of IPv6 forwarded packets but can normally compress its own outgoing packets.

As USSD allows only one session for an MS at a time and the session is half duplex there is a need for controlling the flow control to enable the transmission of IPv6 packets in both directions. In an embodiment the flow control is realized without any additional overhead. As a solution the concepts of a More Data indicator and timeouts are introduced. The More Data indicator tells the corresponding end point that the sender has messages in transmission queue i.e. more packets are waiting to be sent and that the end point should send a return message immediately with an empty payload if there is no data waiting on that side . This allows multiple IPv6 packets to be sent quickly in series. The More Data indication is achieved using a DCS code 0x05 instead of the default 0xF5. In some GSM networks DCS codes may be limited. For that reason in another embodiment of the invention More Data indication is realized using a different 6LoWPAN header dispatch value first byte in the header of from the default. If an empty packet must be returned due to the More Data indication this is done by placing a single byte 0x0 in the frame which corresponds to a special code in 6LoWPAN and is ignored USSD does not allow totally empty messages .

For efficient flow control a timeout is defined. The timeout defines the time to wait before sending an empty frame if the More Data indicator is not sent or to wait before terminating a session if no new data has been sent for that time. In an embodiment the realization of this USSD link layer adaptation may require some error codes which are encoded as special 6LoWPAN dispatch values. Other IPv6 errors are sent normally as standard ICMPv6 error messages.

USSD traffic can be initiated either by a mobile unit or by the network. For the purpose of the embodiments of the invention both mobile initiated and network initiated traffic are treated equally although there may be small implementation differences.

The mobile unit proceeds to immediately send a second IPv6 message in a Continue Request message without the More Data flag. The IPv6 Router then waits up to TIMEOUT for an IPv6 message to send back to the mobile unit. In the example an IPv6 message arrives during the TIMEOUT and is sent back in a Response message . Finally the mobile unit waits for up to TIMEOUT 416 seconds before sending a Release indicator to the network.

In an embodiment flow control is achieved for 6LoWPAN over USSD by keeping a simple state machine at both the USSD end points for each active session. shows the state machine of the mobile unit used to handle mobile initiated USSD sessions. The state machine of an IPv6 Router is similar.

The mobile unit starts in an IDLE state . When the mobile unit has an IPv6 packet to send it enters the SEND REQUEST state where it sets the More Data flag if it has more IPv6 packets waiting in its queue .

The mobile unit then enters the OUTGOING IDLE state while waiting for a Response or TIMEOUT. On receiving an incoming response the mobile unit moves to the PROCESS RESPONSE state where it sends the incoming message if valid to the IPv6 stack. Next the mobile unit returns to the OUTGOING IDLE state. From there the mobile unit may send another outgoing IPv6 packet the TIMEOUT may occur from no activity or the session may be released by the network .

In an embodiment fragmentation is needed as the minimum transmission unit that IPv6 requires is 1280 bytes and USSD has only a maximum of 160 byte payloads. This is achieved using the 6LoWPAN fragmentation header which splits the larger IPv6 packet into fragments and reassembles them on the other side of the USSD link.

It can be assumed that the number of M2M devices will increase in the future. The predicted huge number of M2M devices will generate large amounts of traffic. Normally a single USSD application would need to deal with all the USSD traffic for its Service Code and thus become a possible bottleneck. In an embodiment of the invention segmentation of the traffic may be performed and better performance obtained through routing. This is achieved using MSISDN filtering at the USSD Gateway to segment the MSISDN number space into blocks each one assigned to a different IPv6 Router . For example the MSISDN number spaces of different operators may be divided into different blocks. Thus the USSD Gateway or other network element receiving a USSD frame determines the MSISDN of the sender and on the basis of the MSIDSN categorizes the frame into a given category. The frame may be sent to a router serving the category. The USSD Gateway may be configured to perform the segmentation automatically for mobile initiated USSD traffic.

In an embodiment IPv6 routers may be connected directly to the USSD Gateway for each MSISDN block. The 6LoWPAN over USSD state machine may implemented in the IPv6 Router although this may also be realized in the USSD Gateway. When outgoing 6LoWPAN frames reach the IPv6 router they are expanded. The IPv6 source address has the prefix of that IPv6 router. Thus responses to that message are automatically routed back through the same IPv6 router.

The 6LoWPAN stack on the SIM card uses the GSM transceiver through its normal interface. Access to the stack is provided via Socket application programming interface API like calls from an Application Processor either multiplexed on the normal SIM card interface or using one of the free pins of the SIM card such as a universal asynchronous receiver transmitter UART or Inter Integrated Circuit IC . This embodiment is a total breakthrough in M2M as it allows extremely simple and cheap M2M modems and including the 6LoWPAN over USSD functionality in the SIM card allows easy inclusion of the technique to existing GSM modems by just changing the SIM card.

The apparatus refers to a portable computing device. Such computing devices include wireless mobile communication devices operating with or without a subscriber identification module SIM including but not limited to the following types of devices mobile phone smartphone personal digital assistant PDA handset. A wireless connection may be implemented with a wireless transceiver operating according to the GSM Global System for Mobile Communications WCDMA Wideband Code Division Multiple Access WLAN Wireless Local Area Network or Bluetooth standard or any other suitable standard non standard wireless communication means.

The apparatus of may be configured to receive a 6LoWPAN frame from another network element such as a HLR . The apparatus may be configured to determine the sender of the frame and determine a category for received 6LoWPAN frame on the basis of the sender address. The apparatus may be further configured to forward frames of different categories to different routers.

The apparatuses of A and B may be implemented as an electronic digital computer which may comprise a working memory RAM a central processing unit CPU and a system clock. The CPU may comprise a set of registers an arithmetic logic unit and a control unit. The control unit is controlled by a sequence of program instructions transferred to the CPU from the RAM. The control unit may contain a number of microinstructions for basic operations. The implementation of microinstructions may vary depending on the CPU design. The program instructions may be coded by a programming language which may be a high level programming language such as C Java etc. or a low level programming language such as a machine language or an assembler. The electronic digital computer may also have an operating system which may provide system services to a computer program written with the program instructions.

An embodiment provides a computer program embodied on a distribution medium comprising program instructions which when loaded into an apparatus provide the apparatus with the 6LoWPAN over USSD stack described above.

The computer program may be in source code form object code form or in some intermediate form and it may be stored in some sort of carrier which may be any entity or device capable of carrying the program. Such carriers include a record medium computer memory read only memory and software distribution package for example. Depending on the processing power needed the computer program may be executed in a single electronic digital computer or it may be distributed amongst a number of computers.

It will be obvious to a person skilled in the art that as technology advances the inventive concept can be implemented in various ways. The invention and its embodiments are not limited to the examples described above but may vary within the scope of the claims.

