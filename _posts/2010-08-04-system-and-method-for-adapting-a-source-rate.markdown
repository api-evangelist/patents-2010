---

title: System and method for adapting a source rate
abstract: A system and method for adapting a source rate are provided. A method for operations at a communications device, where the communications device is a sender of information packets over a packet stream, includes determining a source rate of the packet stream, and marking information packets of the packet stream, where the information packets are marked with a first marking pattern if the source rate is equal to a minimum source rate, or the information packets are marked with a second marking pattern if the source rate is greater than the minimum source rate. The first marking pattern has a period of M information packets, where M is a positive integer value greater than or equal to two, and the second marking pattern has a period of M information packets. The method also includes transmitting the marked information packets over the packet stream to a receiver.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08427949&OS=08427949&RS=08427949
owner: Future Wei Technologies, Inc.
number: 08427949
owner_city: Plano
owner_country: US
publication_date: 20100804
---
This application claims the benefit of U.S. Provisional Application No. 61 232 387 filed on Aug. 7 2009 entitled Method and Apparatus for Adapting a Source Rate Based on Explicit Congestion Notification in a Wireless Communications System which application is hereby incorporated herein by reference.

The present invention relates generally to a system and method for wireless communications and more particularly to a system and method for adapting a source rate.

For voice application there are certain hours during a business day when the voice traffic load is much heavier than the average. In order to handle the peak voice traffic load without additional radio spectrum some network operators would like to introduce coder decoder CODEC adaptation based on the load condition at the radio access network RAN so that when experiencing congestion during the peak hours an enhanced Node B eNB which is also known as the base station base terminal station controller and so forth can indicate to a User Equipment UE which is also known as mobile station terminal subscriber and so on to select a more radio resource friendly CODEC rate for voice over Internet Protocol VoIP applications. Thus more voice calls may be admitted during the peak hours with the trade off of slight degradation in voice quality.

In its technical specification Request for Comments RFC 3168 titled The Addition of Explicit Congestion Notification ECN to IP the Internet Engineering Task Force IETF has specified two bits in the Internet Protocol IP header of an IP packet for providing explicit congestion notification ECN . These two ECN bits can be used to indicate four codepoints as shown in the Table 1 below.

The ECN Capable Transport ECT codepoints 01 and 10 which are also known as ECT 0 and ECT 1 respectively are set by the data sender to indicate that the end points of the transport protocol are ECN capable. The phrase the ECT codepoint in this invention refers to either of the two ECT codepoints. Any intermediate network node such as a router treats the ECT 0 and ECT 1 codepoints as equivalent. Senders are free to use either the ECT 0 or the ECT 1 codepoint to indicate ECT on a packet by packet basis. The Not ECT codepoint 00 indicates a packet that is not using ECN. The CE codepoint 11 is set by an intermediate node to indicate congestion to the endpoints.

In RFC 3168 the IETF has further specified two bits in the Transmission Control Protocol TCP header namely ECN Echo ECE and Congestion Window Reduced CWR to perform the handshakes for negotiating the usage of ECN between the endpoints during the setup of a TCP connection to determine if they are both ECN capable. The ECE bit is further used by the data receiver to inform the data sender that a CE marked packet has been receiver. The CWR bit is further used by the data sender to inform the data receiver that the congestion window has been reduced.

These and other problems are generally solved or circumvented and technical advantages are generally achieved by preferred embodiments of the present invention which provide a system and method for adapting a source rate

In accordance with a preferred embodiment of the present invention a method for operations at a communications device is provided. The communications device is a sender of information packets over a packet stream. The method includes determining a source rate of the packet stream marking information packets of the packet stream and wherein transmitting the marked information packets over the packet stream to a receiver. The information packets are marked with a first marking pattern if the source rate is equal to a minimum source rate or the information packets are marked with a second marking pattern if the source rate is greater than the minimum source rate. The first marking pattern has a period of M information packets where M is a positive integer value greater than or equal to two and the second marking pattern has a period of M information packets.

In accordance with another preferred embodiment of the present invention a method for operations at a communications controller is provided. The method includes receiving information packets from a packet stream determining congestion conditions at the communications controller determining a marking pattern for the packet stream and determining if the marking pattern is equal to a rate reduction allowed marking pattern. The rate reduction allowed marking pattern has a period of M information packets where M is a positive integer value greater than or equal to two. The method also includes if the communications controller is not experiencing congestion transmitting the information packets over the packet stream to the receiver and if the communications controller is experiencing congestion and the marking pattern is not equal to the rate reduction allowed marking pattern transmitting the information packets over the packet stream to a receiver. The method further includes if the communications controller is experiencing congestion and the marking pattern is equal to the rate reduction allowed marking pattern marking at least one packet stream marked with the rate reduction allowed marking pattern with a rate reduction requested marking pattern and transmitting information packets of the at least one packet stream marked with the rate reduction requested marking pattern to the at least one packet stream s receiver.

In accordance with another preferred embodiment of the present invention a method for operations at a communications device is provided. The communications device is a receiver of information packets over a packet stream. The method includes receiving information packets from a packet stream determining a source rate of the packet stream from the received information packets and determining a marking pattern of the packet stream. The marking pattern has a period of M information packets where M is a positive integer value greater than or equal to two. The method also includes transmitting a signal to a source of the information packets. The signal is based on the marking pattern of the packet stream and the source rate of the packet stream.

An advantage of an embodiment is that eNBs know when their UEs are already using a minimum CODEC rate. Knowledge of which UEs may be capable of further decreasing their CODEC rates may help to reduce overhead when the eNB attempts to reduce bandwidth consumption.

A further advantage of an embodiment is that UEs may be able to increase their CODEC rate through the use of several mechanisms to request an increase in CODEC rate when channel conditions improve or the number of users decreases. Increasing the CODEC rate may allow for an improvement in the quality of the user experience when communications system conditions permit.

The foregoing has outlined rather broadly the features and technical advantages of the present invention in order that the detailed description of the embodiments that follow may be better understood. Additional features and advantages of the embodiments will be described hereinafter which form the subject of the claims of the invention. It should be appreciated by those skilled in the art that the conception and specific embodiments disclosed may be readily utilized as a basis for modifying or designing other structures or processes for carrying out the same purposes of the present invention. It should also be realized by those skilled in the art that such equivalent constructions do not depart from the spirit and scope of the invention as set forth in the appended claims.

The making and using of the presently preferred embodiments are discussed in detail below. It should be appreciated however that the present invention provides many applicable inventive concepts that can be embodied in a wide variety of specific contexts. The specific embodiments discussed are merely illustrative of specific ways to make and use the invention and do not limit the scope of the invention.

The present invention will be described with respect to preferred embodiments in a specific context namely a 3GPP LTE compliant communications system. The invention may also be applied however to other communications systems such as those that are 3GPP LTE Advance WiMAX and so forth compliant.

Other network components involved in the connection include an eNB a mobility management entity MME serving gateway SGW packet data network gateway PGW a policy control and charging rules function PCRF and an application function AF .

As discussed previously eNB may be used to provide transportation of data and signaling to UE . In general eNB may be responsible for controlling incoming and outgoing transmissions to and from UE . MME SGW PGW may be separate entities but may also be implemented as a single unit depending on communications system architecture. MME may be used to initiate paging and authenticating of UE as well as maintaining location information of UE . SGW may be used to route and forward user data usually in the form of packets for UE . SGW may also be used as a mobility anchor during handovers. PGW may be used to provide UE connectivity to external packet data networks. PGW may serve as a point of entry and exit of traffic to and from UE . PCRF may be used to detect service flow enforce charging function and so forth in communications system . AF may be used to provide dynamic policy or charging control.

eNB MME SGW PGW PCRF and AF shown in may be associated with UE . To maintain simplicity network components serving similar function to those shown in but associated with far end device but are not shown.

In step sender starts to send TCP data packets marked with ECT in the IP headers. In step an intermediate node along the data path experiences congestion. Intermediate node which is congested receives a new TCP data packet with the IP header marked with ECT from sender shown as step thus it changes the ECT mark in the received packet to the CE or also known as ECN CE mark and sends it further to receiver to indicate that congestion has been experienced along this data path shown as step . In step receiver sends back a TCP ACK packet with ECE 1 in the TCP header to acknowledge the reception of the TCP data packet and to indicate that congestion has been experienced along this data path.

In step sender reacts to the explicit congestion notification received as if a TCP data packet has been dropped by performing certain congestion control procedures including reducing a congestion window size. In step sender sends the next TCP data packet to receiver with CWR 1 in the TCP header to indicate that sender has reduced the congestion window CWND size. In step receiver sends back a TCP ACK with ECE 0 in the TCP header unless the congestion persists.

A real time application such as VoIP usually uses real time protocol RTP over user datagram protocol UDP over IP instead of using TCP over IP. Thus in order to use ECN for congestion control over an RTP based application a new handshake mechanism for usage negotiation and congestion feedback is needed. The third generation partnership project 3GPP has received contributions for CODEC adaptation for VoIP based on the two ECN bits in the IP header.

In step eNB that serves UE detects congestion on its DL. In step eNB receives more VoIP packet marked with ECT and targeted for UE from peer . Steps and may also occur in reverse order. eNB changes the ECT mark in the VoIP packet to the CE mark to indicate the congestion at the radio access network shown as step . In step after receiving the VoIP packet with the CE mark in the IP header an IP layer of UE passes the congestion indication to an application layer e.g. via socket application programming interface API for further response. In step UE sends an RTCP ECN feedback message to peer to inform the congestion experienced on the DL.

In step as a response to the RTCP ECN feedback message received CODEC of peer generates new VoIP packets at a lower CODEC rate resulting in a smaller payload size for each new VoIP packet. In step peer sends the new VoIP packets with a smaller payload size. In step eNB detects the change of DL VoIP payload size. In step eNB sends a scheduling message e.g. via the packet data control channel PDCCH to UE to grant the DL either semi persistent scheduling SPS or non SPS assignment with a smaller radio resource. In step eNB sends the new VoIP packet to UE using a smaller radio resource thereby alleviating the congestion on the DL.

In step eNB that serves UE detects congestion on its UL. In step eNB receives more VoIP packet marked with ECT and targeted for peer from UE . Steps and may also occur in reverse order. eNB changes the ECT mark in the VoIP packet to the CE mark to indicate the congestion at the radio access network shown as step . In step after receiving the VoIP packet with the CE mark in the IP header an IP layer of peer passes the congestion indication to an application layer for further response. In step peer sends an RTCP ECN feedback message to UE to inform the congestion experienced on the UL.

In step as a response to the RTCP ECN feedback message received CODEC of UE generates new VoIP packets at lower CODEC rate resulting in a smaller payload size for each new VoIP packet. In step UE sends a new VoIP packet with a smaller payload size or a buffer status report to indicate so. In step eNB detects the change of UL VoIP payload size either via the received VoIP packet or the buffer status report from UE . In step eNB sends a scheduling message to UE to grant the UL either semi persistent scheduling SPS or non SPS assignment with a smaller radio resource. In step UE sends more VoIP packet to eNB using a smaller radio resource thereby alleviating the congestion on the UL. In step eNB sends the new VoIP packets to peer .

The prior art techniques provide an end to end scheme for DL and UL congestion control using ECN bits over an RTP stream similar to schemes for TCP connections proposed in the IETF. However enhancements to the prior art techniques discussed above may be possible.

As an example when a congested source eNB needs to forward a pending CE marked packet data convergence protocol PDCP service data unit SDU a form of IP packet to a target eNB due to a handoff the source eNB may pass on the CE mark which the source eNB sets to the target eNB. The target eNB may faithfully send the CE marked PDCP SDU to a UE even if the target eNB is not itself congested.

Since the target eNB may not be able to tell who marked the IP packet with the CE mark nor what an original ECT mark was the target eNB can only forward the IP packet unchanged. Therefore the UE after the handoff reports the CE event by sending an RTCP ECN feedback message to the sender thereby downgrading the CODEC rate e.g. voice quality unnecessarily when the target eNB is not congested and incurring an unnecessary RTCP ECN feedback message overhead. Since a handoff is perceived as one way to offload a congested eNB it may be important to avoid undesirable consequences such as described above.

According to an embodiment a source eNB memorizes the originally received ECT mark on an RTP packet that is target for a UE before changing the ECT mark to the CE mark due to congestion control at least when the handoff preparation has been initiated for the UE. The eNB changes the CE mark back to the memorized original ECT mark when forwarding a pending CE marked PDCP SDU to the target eNB due to the handoff.

As another example a claimed benefit of ECN based CODEC rate adaptation may be that the eNB can carry out congestion control in a dedicated manner i.e. reducing the CODEC rate for one or a few selected RTP streams at a time instead of using a flooding approach by broadcasting congestion information to all UEs that are served by the eNB and are running VoIP applications for example and having all of the UEs respond in unison.

The dedicated approach requires that the eNB knows that the selected RTP stream s will definitely respond to the CE mark. However a selected RTP stream may not respond to the CE mark because that the CODEC rate has already reached a limit for rate reduction e.g. there is no frame redundancy frame aggregation limit is reached and a lowest supported CODEC rate that has been negotiated at call setup is already being used.

The prior art techniques discussed previously may not include a mechanism to inform the eNB that the CODEC rate has reached the limit for rate reduction. Since the eNB may be application agnostic taking a trial and error approach to select a RTP stream for congestion control at the eNB may result in a mis calculation which may cause prolonged delay in admitting or denying a new connection a VoIP call for example due to a long round trip feedback delay or a larger headroom in a reserved radio resource may be needed for running an admission control algorithm.

Instead of detecting and responding to a single IP packet with or without the CE mark or Not ECT mark etc. multiple IP packets and corresponding patterns of CE Not ECT ECT marks may be used to detect and respond to network congestion. A pattern spread over multiple IP packets may be described as having a period that is equal to the number of IP packets. For example if a pattern is spread over M IP packets where M is a positive integer value greater than or equal to two then the pattern may be said to have a period of M. As an example groups of two IP packets may be used to detect an occurrence of a particular condition. Alternatively instead of detecting an exact sequence of CE Not ECT ECT marks in two or more IP packets a distribution of CE Not ECT ECT marks over a number of IP packets may be used to detect an occurrence of a particular condition.

As an example an alternating sequence of IP packets marked with ECT marks i.e. either 01 or 10 and Not ECT mark i.e. 00 may be used to indicate that a sender of the IP packets has reached a minimum rate in its set of supported CODEC rates that have been negotiated. Alternatively a 50 50 distribution of ECT marks and Not ECT mark over a number of IP packets may also indicate that a sender of the IP packets has reached a minimum rate in its set of supported CODEC rates. A detailed discussion of particular patterns and or distributions is presented below.

The embodiments describe various techniques for improving CODEC rate adaptation using ECN bits through the use of marking patterns of the ECN bits of multiple packets. At least one of the marking patterns comprises at least two different types of ECN marks. In order to preserve the benefits of having two different ECT codepoints such as verifying an end to end path or detecting a cheating receiver a sender may still be able to randomly use ECT 0 and ECT 1 codepoints that are considered to be a single type of ECN mark i.e. the ECT mark for the purposes of using ECN marking patterns in subsequent descriptions and illustrations.

Therefore there may be a total of three different ECN marks possible with the two ECN bits namely a Not ECT mark an ECT mark and a CE mark that may be used to form marking patterns. Extensions may be possible to form additional marking patterns if the two ECT codepoints are considered to be two different ECN marks.

According to an embodiment a sender indicates to the eNB whether a source rate on an RTP stream is at the lowest supported source rate that has been negotiated or not by using different packet by packet marking patterns on the ECN bits of a plurality of consecutive RTP packets that the sender sends to a receiver. Such an indication provides the eNB with the information of which RTP streams may respond to a request for further rate reduction and which may not. Thus when experiencing congestion the eNB may select one or more RTP streams for subjecting to rate reduction only from those RTP streams that may respond to the request for rate reduction. As a result the eNB may more precisely estimate the effects of the saving on the radio resource for the RTP streams that are selected for rate reduction thereby minimizing the number of RTP streams that need to be selected for subjecting to rate reduction thereof quality degradation and or minimizing the headroom of the reserved radio resource for running the admission control algorithm.

The sender may determine whether there is still room for further reducing the source rate on an RTP stream by comparing the current source rate with the lowest source rate within a set of supported source rates that are negotiated between the sender and the receiver of the RTP stream during the call setup. The source may be an audio CODEC a video CODEC or other type of real time application. The sender may further consider the frame redundancy and the frame aggregation formats of the RTP packet payload when determining whether there is still room for further reducing the source rate on an RTP stream.

When receiving a request for reducing the source rate the sender may for an example respond first by reducing the frame redundancy then by reducing the CODEC rate when the frame redundancy is 1 meaning that there is no frame redundancy then by increasing the frame aggregation when the CODEC rate is at the lowest supported CODEC rate that has been negotiated. In the discussion presented below the CODEC rate may be presented as an only factor in the source rate to illustrate various novel techniques without limiting the scope or the spirit of the embodiments.

According to an embodiment when the sender CODEC rate is not at the lowest supported rate negotiated for a particular RTP stream the sender marks the two ECN bits in the IP header of every RTP packet of the RTP stream that it sends with the ECT mark by choosing randomly between the ECT 0 and the ECT 1 codepoints. This particular packet by packet marking pattern on the two ECN bits of a plurality of consecutive RTP packets may be referred to as the rate reduction allowed pattern.

However when the sender CODEC rate is at the lowest supported rate that has been negotiated the sender marks the two ECN bits in the 1st 3rd . . . 2N 1 th RTP packets with the Not ECT codepoint 00 and marks the two ECN bits in the 2nd 4th . . . 2N th RTP packets with one of the two ECT codepoints 01 and 10 randomly where N is an odd number. In other words odd numbered RTP packets may be marked the Not ECT codepoint 00 and the even numbered RTP packets may be randomly marked with one of the two ECT codepoints 01 and 10 . Visually the packet by packet alternating marking pattern between the Not ECT mark and the ECT mark may have the appearance 

The packet by packet alternating marking pattern between the Not ECT mark and the ECT mark may be referred to as the rate reduction prohibited pattern. At a receiver or eNB the rate reduction prohibited pattern may have the appearance of alternating Not ECT and ECT marks or alternating Not ECT and CE marks since the ECT markings may be changed to CE by an intermediate node.

It should be understood that other pre designated alternating marking patterns among different types of ECN marks and or with different ratio between different types of ECN marks are also possible without departing from the spirit and scope of the embodiments. Furthermore although the discussion discloses that a first type of ECN mark of a marking pattern occurs prior to a second type of ECN mark of the marking pattern an order of the ECN marks may be reversed. As an example with the rate reduction prohibited pattern discussed above the discussion discloses that the Not ECT codepoint occurs prior to the ECT codepoint. However an equivalent marking pattern may be the ECT codepoint occurring prior to the Not ECT codepoint. Therefore the discussion of a specific embodiment of a marking pattern should not be construed as being limiting to either the scope or the spirit of the embodiments.

Referring to the sender generates a new RTP packet of an RTP stream block . The sender may then perform a check to determine if the source rate of the RTP packet is at the lowest source rate within a set of supported source rates that have been negotiated between the sender and a receiver during the call setup or not block . If the source rate of the RTP packet is not at the lowest source rate within the set of supported source rates negotiated the sender may mark the RTP packet with the ECT mark e.g. by choosing randomly between the ECT 0 and the ECT 1 codepoints block .

If the source rate of the RTP packet is at the lowest source rate within the set of supported source rates negotiated the sender may further determine if a previous RTP packet of the RTP stream is sent with the ECT mark or not block . If the previous RTP packet of the RTP stream is not sent with the ECT mark the sender may mark the RTP packet with the ECT mark block . If the previous RTP packet of the RTP stream is sent with the ECT mark the sender may mark the RTP packet with the Not ECT mark block . The sender may then send the RTP packet block .

It is understood that it is also possible to synchronize the Not ECT mark and the ECT mark with the odd and even sequence numbers of the RTP packets respectively when the sender needs to send out RTP packets with the rate reduction prohibited pattern. In this case the question to be asked and answered in block is if the RTP sequence number of the RTP packet is odd or even for example. If the RTP sequence number is odd then the sender may mark the RTP packet with the Not ECT mark while if the RTP sequence number is even then the sender may mark the RTP packet with one of the two ECT marks.

According to another embodiment the eNB may react to an RTP packet received on an RTP stream based on the two ECN bits on the currently received RTP packet and the marking pattern observed on the two ECN bits on a plurality of currently and previously received RTP packets. Generally speaking an eNB passes an RTP packet on without modifying the ECN bits if the eNB receives the RTP packet with the Not ECT mark or the CE mark. Using the previously discussed example of the rate reduction allowed pattern and the rate reduction prohibited pattern that the sender may send out if the eNB receives an RTP packet of an RTP stream with the ECT mark and the marking pattern on the ECN bits on the plurality of currently and previously received RTP packets of the RTP stream matches the rate reduction allowed pattern the eNB may consider the RTP stream in question as a rate reduction allowed stream.

Therefore when the eNB detects a congested condition at the radio access network the eNB may consider the rate reduction allowed RTP stream as a candidate for reducing the source rate in its selection algorithm in response to the congested condition. Alternatively if the eNB receives an RTP packet of an RTP stream with the ECT mark and the marking pattern on the ECN bits on the plurality of currently and previously received RTP packets of the RTP stream matches the rate reduction prohibited pattern the eNB may consider the RTP stream as a rate reduction prohibited stream and may not consider it as a candidate for reducing the source rate when experiencing congestion as the eNB knows that the sender will not be able to respond to a request for further reducing the source rate.

To an eNB an alternating marking pattern that switches between the Not ECT mark and the CE mark may also be a rate reduction prohibited pattern since an intermediate network node upstream along the path may change the ECT mark to the CE mark due to its own congested condition.

Referring to the eNB receives a new RTP packet on a particular RTP stream block . The eNB may determine if the RTP packet is received with the ECT mark or not block . If the RTP packet is not received with the ECT mark the eNB may send the RTP packet on towards its destination block . If the RTP packet is received with the ECT mark the eNB further determines if the current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the all ECT marking pattern i.e. the rate reduction allowed pattern or not where M is an integer number block .

If the current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the all ECT marking pattern the eNB sends the RTP packet on towards its destination block . If the current RTP packet and previous M 1 RTP packets received on the same RTP stream are received with the all ECT marking pattern the eNB considers the RTP stream as a rate reduction allowed stream block .

The eNB may further determine if the radio access network experiences a congested condition or not block . If the radio access network does not experience a congested condition the eNB sends the RTP packet on towards its destination block . If the radio access network experiences a congested condition the eNB selects one or more RTP streams from all rate reduction allowed streams for reducing the source rate block .

The eNB may then determine if the RTP stream is selected for reducing the source rate or not block . If the RTP stream is not selected for reducing the source rate the eNB sends the RTP packet on towards its destination block . If the RTP stream is selected for reducing the source rate the eNB changes the ECT mark on the two ECN bits on the RTP packet to the CE mark block . Additionally the eNB may store the originally received ECT mark of the RTP packet including which exact codepoint either the ECT 0 and the ECT 1 is received in preparation for a possible handoff as described earlier. Then the eNB sends the RTP packet on towards its destination block .

According to yet another embodiment a receiver of an RTP stream may react to an RTP packet received on the RTP stream based on the two ECN bits in the IP header of the currently received RTP packet the marking pattern observed on the ECN bits on the plurality of currently and previously received RTP packets the information of the current source rate in the RTP header of the currently received RTP packet and the information of a set of supported source rates that has been negotiated between the sender and the receiver during the call setup. For example by comparing the information of the current source rate and the set of supported source rates that has been negotiated if the receiver determines that the current source rate is already at the lowest supported source rate that has been negotiated the receiver does not need to send a feedback message to indicate the congestion to the sender as the receiver knows that the sender will not be able to respond to a request for further reducing the source rate.

Referring to the receiver of a particular RTP stream receives a new RTP packet on the RTP stream block . The receiver may determine if the current source rate of the RTP stream is at the lowest supported source rate that has been negotiated or not by comparing the information of the current source rate in the RTP header of the currently received RTP packet and the information of the set of supported source rates negotiated for the RTP stream block . If the current source rate of the RTP stream is at the lowest supported source rate that has been negotiated the receiver does not need to send a congestion feedback message to the sender. If the current source rate of the RTP stream is not at the lowest supported source rate that has been negotiated the receiver may further determine if the current RTP packet and previous M 1 RTP packets all M consecutive packets in total received on the same RTP stream are marked with the all CE marking pattern or not where M is an integer number block .

If current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not marked with the all CE marking pattern the receiver does not need to send a feedback to the sender. If current RTP packet and previous M 1 RTP packets received on the same RTP stream are marked with the all CE marking pattern the receiver sends a feedback message such as a real time control protocol RTCP ECN Feedback message to the sender to report the congested condition experienced on the path in order to trigger the sender to reduce the source rate block . With the use of the rate reduction prohibited pattern the receiver does not send a feedback message to report the congested condition when a single RTP packet marked with the CE mark is received since an intermediate node may have replaced an ECT mark with a CE mark.

Therefore based on the techniques described above when the sender receives a feedback message with an indication of congestion experienced and or with a request for reducing the source rate the sender should have room for further reducing its source rate on the RTP stream. Thus the sender should generate new RTP packets on the RTP stream at a lower source rate than before which results in a smaller payload size on each new RTP packet. When the eNB receives the new RTP packets with a smaller payload size a smaller radio resource may be assigned by the eNB for transmitting the new RTP packets over the radio link thus helping to alleviate the congested condition experienced at the radio access network and or making more radio resource available for admitting additional real time services such as VoIP calls.

According to yet another embodiment a method is provided for increasing the source rate of an RTP stream from the lowest supported source rate when the eNB detects that the radio access network is not congested. As described previously when a sender of an RTP stream is at the lowest supported source rate that has been negotiated the sender may send out RTP packets with the ECN bits alternating between the Not ECT mark and the ECT mark which is referred to as the rate reduction prohibited pattern.

To further enhance the techniques described above the alternating marking pattern between the Not ECT mark and the ECT mark is referred to as the rate reduction prohibited and rate up allowed pattern which is also referred to as a first pattern. When an eNB observes the particular marking pattern i.e. the rate reduction prohibited and rate up allowed pattern on the plurality of currently and previously received RTP packets on an RTP stream the eNB considers the RTP stream as a rate up allowed stream and also a rate reduction prohibited stream.

Then if the eNB detects an un congested condition at the radio access network the eNB may select one or more RTP streams for increasing the source rate from all rate up allowed RTP streams. The eNB may send the received RTP packets of an RTP stream that is selected for increasing the source rate without changing the ECN bits on the RTP packets to indicate a request for increasing the source rate.

The eNB may further change the ECT mark on every other received RTP packets of a rate up allowed RTP stream that is not selected for increasing the source rate to the CE mark to indicate a request for keeping the current source rate on the un selected rate up allowed RTP stream. Another eNB located downstream along the path may consider the alternating marking pattern between the Not ECT mark and the CE mark as a rate reduction prohibited and rate up prohibited pattern which is also know as a fourth pattern and indicates that at least one upstream node wishes to keep the source rate on the RTP stream at the lowest supported source rate that has been negotiated.

Therefore when an eNB observes the rate reduction prohibited and rate up prohibited marking pattern on the plurality of currently and previously received RTP packets on an RTP stream the eNB may send the received RTP packets of the RTP stream without changing the ECN bits on the RTP packets.

Referring to the eNB receives a new RTP packet on a particular RTP stream block . The eNB may determine if the RTP packet is received with the ECT mark or not block . If the RTP packet is not received with the ECT mark the eNB may send the RTP packet towards its destination block . If the RTP packet is received with the ECT mark the eNB may further determine if the current RTP and a previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the all ECT marking pattern which is the rate reduction allowed pattern and is also know as the second pattern where M is an integer number block .

If the current RTP and a previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the all ECT marking pattern the eNB may consider the RTP stream as a rate reduction allowed stream block . The eNB may further determine if a congested condition is experienced at the radio access network or not block . If a congested condition is not experienced at the radio access network the eNB sends the RTP packet towards its destination block . If a congested condition is experienced at the radio access network in response to the congested condition the eNB selects one or more RTP streams from all rate reduction allowed RTP streams for reducing the source rate block .

Then the eNB may further determine if the RTP stream is selected for reducing the source rate or not block . If the RTP stream is not selected for reducing the source rate the eNB sends the RTP packet towards its destination block . If the RTP stream is selected for reducing the source rate the eNB changes the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block .

If the eNB determined in block that the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the all ECT marking pattern the eNB may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the first pattern block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the first pattern the eNB sends the RTP packet towards its destination block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the first pattern the eNB may consider the RTP stream as a rate up allowed stream block .

Then the eNB may further determine if a congested condition is experienced at the radio access network or not block . If a congested condition is experienced at the radio access network the eNB changes the ECT mark on the received RTP packet to the CE mark block before sending the RTP packet towards its destination block . If a congested condition is not experienced at the radio access network the eNB selects one or more RTP streams from all rate up allowed RTP stream for increasing the source rate block .

Then the eNB may determine if the RTP stream is selected for increasing the source rate or not block . If the RTP stream is selected for increasing the source rate the eNB sends the RTP packet towards its destination block . If the RTP stream is not selected for increasing the source rate the eNB changes the ECT mark on the received RTP packet to the CE mark block before sending the RTP packet towards its destination block .

If the receiver observes the alternating marking pattern between the Not ECT mark and the CE mark which is referred to as the rate reduction prohibited and rate up prohibited pattern or the fourth pattern on the plurality of currently and previously received RTP packets on an RTP stream the receiver may consider that at least one upstream node along the path of the RTP stream wishes to keep the source rate at the lowest supported source rate that has been negotiated. Therefore the receiver does not need to send a congestion feedback message to the sender in response to the CE mark received on the every other RTP packets.

If the receiver observes the alternating marking pattern between the Not ECT mark and the ECT mark which is referred as the rate reduction prohibited and rate up allowed pattern and is also known as the first pattern on the plurality of currently and previously received RTP packets on an RTP stream the receiver may consider that all upstream eNBs along the path of the RTP stream wish to increase the source rate and there is no congestion at any other intermediate node along the path. Therefore the receiver may send a rate up switch signal to the sender to indicate a request for increasing the source rate.

The rate up switch signal may be a modified RTCP Receiver Report RR message as described in IETF RFC 3168 or a new RTCP ECN Feedback message. For a VoIP application using an Adaptive Multi Rate AMR or AMR Wideband AMR WB CODEC the receiver can also simply use the Codec Mode Request CMR field in the RTP payload header of the VoIP packet that is sent over the reverse direction to indicate a request for increasing the CODEC rate by setting the CMR field to the specific mode index corresponding to a desirable CODEC rate.

In order to avoid a source rate ping pong a slow start approach for rate up switch may be used i.e. only allow source rate increases to occur in single source rate steps except for the initial CODEC mode ICM .

Referring to the receiver of a RTP stream receives a new RTP packet on the RTP stream block . The receiver may determine if the current source rate of the RTP stream is at the lowest supported source rate that has been negotiated during the call setup or not by comparing the information of the current source rate in the RTP header of the currently received RTP packet and the information of the set of supported source rates negotiated for the RTP stream block .

If the current source rate of the RTP stream is at the lowest supported source rate negotiated the receiver may further determine if the current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the first pattern or not block . If the current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the first pattern the receiver may send a rate up switch signal to the sender to request for increasing the source rate block . According to an embodiment the rate up switch signal may be in the form of a modified RTCP RR message a new RTCP ECN feedback message the CMR field in the RTP payload header of an AMR or AMR WB Codec based VoIP packet that is sent in the reverse direction or so on.

If the current RTP packet and previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the first pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block . For example for an AMR or AMR WB CODEC based VoIP application the receiver may send an in band signal to piggy back a rate kept signal by setting the CMR field to a mode index corresponding to the current rate in the RTP payload header of a VoIP packet that is sent over the reverse direction without incurring additional signaling overhead.

If the receiver determines in block that the current source rate of the RTP stream is not at the lowest supported source rate that has been negotiated the receiver may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all ECT marking pattern or not block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all ECT marking pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the all ECT marking pattern the receiver further determines if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all CE marking pattern which is the rate reduction requested pattern and which is also known as a third pattern block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the all CE marking pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all CE marking pattern the receiver may send an RTCP ECN Feedback message to the sender to report the congestion and to request for reducing the source rate block .

Therefore based on the techniques described above when the sender receives a rate up switch signal from the receiver which requests for increasing the source rate the sender should have room for increasing the source rate therefore it should generate new RTP packets on the RTP stream at a higher source rate than before which results in a larger RTP payload size thereby possibly requiring a larger radio resource for transmitting the RTP packet over a radio link. Since the signaling of the rate up switch is based on a clear permission and request from the eNB the ping pong effect is unlikely. After performing a first rate up switch from the lowest supported source rate that has been negotiated the sender regains the ability for further reducing the source rate on the RTP stream. Therefore the sender resumes the all ECT marking pattern on the RTP packets it sends out on the RTP stream.

According to yet another embodiment a method is provided for further increasing the source rate of an RTP stream from an intermediate source rate when the eNB detects that the radio access network is not congested. A fifth pattern is introduced in addition to the first four patterns that have been discussed previously. According to an embodiment the sender still sends out RTP packets only with either the first or the second marking pattern to indicate if the RTP stream is at the lowest supported source rate that has been negotiated during the call setup or not. When an eNB observes the second marking pattern which is the all ECT marking pattern and is both the rate reduction allowed and rate up allowed pattern on a RTP stream if the eNB neither selects the RTP stream for increasing the source rate in response to an un congested condition nor does the eNB select the RTP stream for reducing the source rate in response to a congested condition the eNB may change the ECT mark on every other RTP packet received on this RTP stream to the CE mark to indicate a request for keeping the current intermediate source rate.

The alternating marking pattern between the CE mark and the ECT mark is known as the fifth pattern which is a rate reduction allowed and rate up prohibited pattern. The fifth pattern may be used to indicate that at least one upstream node such as an upstream eNB wishes not to increase the source rate while any downstream node such as an downstream eNB may further request for a reduction in the source rate due to congestion experienced by changing the ECT mark on the remaining every other RTP packet to the CE mark which effectively changes the fifth marking pattern on the RTP stream into the all CE marking pattern that is the rate reduction requested pattern also known as the third pattern .

Table 2 lists various marking patterns of length two M 2 at different entities involved in packet transmission.

Referring to the eNB receives a new RTP packet on a particular RTP stream block . The eNB may determine if the RTP packet is received with the ECT mark or not block . If the RTP packet is not received with the ECT mark the eNB sends the RTP packet towards its destination block . If the RTP packet is received with the ECT mark the eNB may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all ECT marking pattern which is the rate reduction allowed and rate up allowed pattern and is also known as the second pattern where M is an integer number block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the all ECT marking pattern the eNB may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the first pattern or not block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the first pattern the eNB further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the fifth pattern or not block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the fifth pattern the eNB may send the RTP packet towards its destination block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the fifth pattern the eNB may consider the RTP stream as a rate up prohibited stream and a rate reduction allowed stream block . Then the eNB may further determine if a congested condition is experienced at the radio access network or not block .

If a congested condition is not experienced at the radio access network the eNB may send the RTP packet towards its destination block . If a congested condition is experienced at the radio access network in response to the congested condition the eNB may select one or more RTP streams from all rate reduction allowed RTP streams for reducing the source rate block . Then the eNB may further determine if the RTP stream s is selected for reducing the source rate or not block .

If the RTP stream s is selected for reducing the source rate the eNB changes the ECT mark on the received RTP packet to the CE mark block before sending the RTP packet towards its destination block . If the RTP stream s is not selected for reducing the source rate the eNB may further determine if the previous RTP packet received on the particular RTP stream is sent with the CE mark or not block .

If the previous RTP packet received on the particular RTP stream is sent with the CE mark the eNB may send the RTP packet towards its destination block . If the previous RTP packet received on the particular RTP stream is not sent with the CE mark the eNB changes the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block .

If the eNB determines in block that the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the first pattern the eNB may consider the RTP stream as a rate reduction prohibited and a rate up allowed stream block . Then the eNB may further determine if a congested condition is experienced at the radio access network or not block .

If a congested condition is experienced at the radio access network the eNB may change the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block . If a congested condition is not experienced at the radio access network in response to the un congested condition the eNB may select one or more RTP streams from all rate up allowed RTP streams for increasing the source rate block . Then the eNB may further determine if the RTP stream s is selected for increasing the source rate or not block .

If the RTP stream s is selected for increasing the source rate the eNB may send the RTP packet towards its destination block . If the RTP stream s is not selected for increasing the source rate the eNB may further determine if the previous RTP packet received on the particular RTP stream is sent with the CE mark or not block . If the previous RTP packet received on the particular RTP stream is sent with the CE mark the eNB may send the RTP packet towards its destination block . If the previous RTP packet received on the particular RTP stream is not sent with the CE mark the eNB may change the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block .

If the eNB determines in block that the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the all ECT marking pattern the eNB may consider the RTP stream as a rate reduction allowed and a rate up allowed stream block . Then the eNB may further determine if a congested condition is experienced at the radio access network or not block . If a congested condition is experienced at the radio access network in response to the congested condition the eNB may select one or more RTP streams from all rate reduction allowed RTP streams for reducing the source rate block .

Then the eNB may further determine if the RTP stream is selected for reducing the source rate or not block . If the RTP stream is selected for reducing the source rate the eNB may change the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block . If the RTP stream is not selected for reducing the source rate the eNB may further determine if the previous RTP packet received on the RTP stream is sent with the CE mark or not block .

If the previous RTP packet received on the RTP stream is sent with the CE mark the eNB may send the RTP packet towards its destination block . If the previous RTP packet received on the RTP stream is not sent with the CE mark the eNB may change the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block .

If the eNB determines in block that an un congested condition is experienced at the radio access network in response to the un congested condition the eNB may select one or more RTP streams from all rate up allowed RTP streams for increasing the source rate block . Then the eNB may further determine if the RTP stream is selected for increasing the source rate or not block .

If the RTP stream is selected for increasing the source rate the eNB may send the RTP packet towards its destination block . If the RTP stream is not selected for increasing the source rate the eNB may further determine if the previous RTP packet received on the particular RTP stream is sent with the CE mark or not block . If the previous RTP packet received on the particular RTP stream is sent with the CE mark the eNB may send the RTP packet towards its destination block . If the previous RTP packet received on the particular RTP stream is not sent with the CE mark the eNB may change the ECT mark on the received RTP packet to the CE mark block prior to sending the RTP packet towards its destination block .

The receiver s response to an all CE marking pattern is the same as described previously. In addition if the receiver observes the alternating marking pattern between the CE mark and the ECT mark i.e. the fifth pattern on the plurality of currently and previously received RTP packets on an RTP stream the receiver may consider that at least one upstream node along the path of the RTP stream wishes to keep the source rate at the current source rate which is not the lowest supported source rate that has been negotiated. Therefore the receiver does not need to send a congestion feedback message to the sender in response to the CE mark received on the every other RTP packets.

If the receiver observes the all ECT marking pattern i.e. the second pattern on the plurality of currently and previously received RTP packets on an RTP stream the receiver may consider that all upstream eNBs along the path of the RTP stream wish to increase the source rate and there is no congestion at any other intermediate node along the path. From the information about the source rate that is in the RTP header of the received RTP packet the receiver may determine if the current source rate is at the highest supported source rate that has been negotiated or not. If not the receiver may send a rate up switch signal to the sender to indicate a request for increasing the source rate. As discussed previously the rate up switch signal may be a modified RTCP RR message a new RTCP ECN Feedback message an in band signaling such as the CMR field in the RTP payload header of an AMR or AMR WB Codec based VoIP packet that is sent in the reverse direction or so on.

Referring to the receiver of a particular RTP stream receives a new RTP packet on the RTP stream block . The receiver may determine if a current source rate of the RTP stream is at the lowest supported source rate that has been negotiated or not by comparing the information of the current source rate in the RTP header of the currently received RTP packet and the information of the set of supported source rates negotiated during the call setup for the RTP stream block . If a current source rate of the RTP stream is at the lowest supported source rate negotiated the receiver may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the first pattern or not where M is an integer number block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the first pattern the receiver may send a rate up switch signal to the sender to request for increasing the source rate block . According to an embodiment the rate up switch signal may be in the form of a modified RTCP RR message a new RTCP ECN feedback message an in band signaling such as the CMR field in the RTP payload header of an AMR or AMR WB Codec based VoIP packet that is sent in the reverse direction or so on as described previously.

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the first pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block . For example for an AMR or AMR WB CODEC based VoIP application the receiver may send such a rate kept signal via an in band signaling by setting the CMR field to the mode index corresponding to the current rate in the RTP payload header of the VoIP packet that is sent over the reverse direction without incurring additional signaling overhead.

If the receiver determines in block that the current source rate of the RTP stream is not at the lowest supported source rate that has been negotiated the receiver may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the second pattern or not block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the second pattern the receiver may further determine if the current source rate of the RTP stream is at the highest supported source rate that has been negotiated or not block .

If the current source rate of the RTP stream is not at the highest supported source rate negotiated the receiver may send a rate up switch signal to the sender to request for increasing the source rate block . If the current source rate of the RTP stream is at the highest negotiated source rate the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block .

If the receiver determines in block that the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the second pattern the receiver may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the fifth pattern or not block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are received with the fifth pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the RTP stream are not received with the fifth pattern the receiver may further determine if the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the third pattern or not block .

If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are not received with the third pattern the receiver may optionally send a rate kept signal to the sender to request for keeping the current source rate block . If the current RTP packet and the previous M 1 RTP packets a total of M consecutive packets received on the same RTP stream are received with the third pattern the receiver sends an RTCP ECN Feedback message to the sender to report the congestion and to request for reducing the source rate block .

Therefore based on the embodiments described above when the sender receives a rate up switch signal from the receiver which requests for increasing the source rate from either the lowest supported source rate or an intermediate source rate the sender should have room for increasing the source rate. The sender should therefore generate new RTP packets on the RTP stream at a higher source rate than before which results in a larger RTP payload size thereby possibly requiring a larger radio resource for transmitting the RTP packet over the radio link. However since the signaling of the rate up switch is based on the clear permission and request from the eNB the ping pong effect is unlikely.

The sender marks the RTP packets of an RTP stream with a particular pattern in sequence e.g. based on RTP sequence numbers. However the RTP packets may be delivered to the eNB or to the receiver out of order. Since the receiver is equipped with full protocol stack the receiver may be able to sort the received RTP packets and place the RTP packets in sequence before determining the marking pattern received.

The eNB may be built with capabilities to fully understand each header of IP UDP and RTP including the options and extensions fields in the headers packets in order to fetch the RTP sequence number in the RTP header of the RTP packet for sorting. However the additional processing of the IP UDP and RTP packets may increase both the delay in forwarding the RTP packet and the complexity at the eNB.

According to yet another embodiment an alternative method for dealing with out of order delivery of RTP packets at the eNB is provided. In general if the value of M is set sufficiently large e.g. 8 10 12 14 16 or larger where M is an integer number and preferably an even number the eNB may use the statistical 1 1 ratio between the two different types of ECN marks of M consecutively received RTP packets as the criteria for determining the marking pattern.

As an example if a ratio of the ECT mark to the Not ECT mark and the ratio of the ECT mark to the CE mark are both much higher than 1 1 it is considered that the all ECT marking pattern i.e. the second pattern is received. While if a ratio of the CE mark to the Not ECT mark and the ratio of the CE mark to the ECT mark are both much higher than 1 1 it is considered that the all CE marking pattern i.e. the third pattern is received. Similarly if a ratio of the Not ECT mark to the ECT mark is roughly 1 1 and there is no significant presence of the CE mark it may be considered that the first marking pattern is received while if a ratio of the Not ECT mark to the CE mark is roughly 1 1 and there is no significant presence of the ECT mark it is considered that the fourth marking pattern is received and if a ratio of the ECT mark to the CE mark is roughly 1 1 and there is no significant presence of the Not ECT mark it is considered that the fifth marking pattern is received.

At an eNB if the eNB wishes to switch a rate up allowed pattern ECT ECT to a rate kept pattern CE ECT the eNB may mark every other RTP packet received with the CE mark out of the RTP packet sequence as the RTP packets may arrive out of order. However the statistical 1 1 ratio may be maintained after treating the IP fragmentation which is discussed below. Therefore when the receiver receives the rate kept pattern the receiver cannot expect to receive the CE ECT pattern in the exact order. Instead the receiver should also use the ratio of 1 1 between the CE and ECT marks to recognize the rate kept pattern. With the rate reduction requested pattern CE CE no problems with out of order delivery occurs at either the eNB or the receiver while with the rate reduction allowed and rate up allowed pattern ECT ECT no problems with out of order delivery occurs at the receiver.

When only considering the embodiments that allow for rate increases from a lowest supported source rate without regard for those that further allow rate increases from an intermediate rate a receiver may be able to determine the marking pattern by checking with the exact marking patterns after the receiver sorts out its received RTP packets based on the RTP sequence number. However if the embodiments that allow for rate increases from an intermediate rate are considered the eNB may mark the received RTP packets with the fifth pattern out of the RTP sequence if the eNB does not sort the received RTP packets since the eNB may not be able to fetch the RTP sequence number in the RTP header of the RTP packet in order to avoid a delay that may be caused. Therefore even though a receiver may be able to sort the received RTP packets in a sequence the receiver may not be able to expect to observe a fifth pattern in the received RTP packets in the exact order of the RTP sequence number. Thus the receiver may also use a ratio between the ECT mark and the CE mark to check for the fifth pattern. In general the receiver has no problem for checking for the other four patterns based on the exact marking pattern.

An IP datagram may be fragmented by an intermediate node if the size of the IP datagram is greater than a Maximum Transmission Unit MTU that the node can handle. Although an unlikely issue for audio packets which tend to be small for larger video packets fragmentation may become an issue. Some video standard allows fragmentation at the RTP layer to avoid IP fragmentation such as IETF RFC 3984 for H.264 video standard. In general IP Fragmentation is not an issue for the receiver as the receiver is equipped with full protocol stack and it reassembles the IP datagram which contains a single RTP packet before determining the marking pattern. For the eNB a simple solution is to disable IP fragmentation from the sender e.g. set DF field 1 in the IP header via socket API thus no network node can fragment the IP datagram. However if the size of the IP datagram a packet is greater than a MTU that an intermediate network node is capable of processing the packet may be dropped by that node.

According to yet another embodiment an alternative method for dealing with IP fragmentation of RTP packets that are received at the eNB is described as follows The eNB considers all IP packets received and having the same value for four fields identification source destination and protocol in the IP header as a single packet. Meaning that the eNB counts all of the IP packets as a single packet when counting a ratio of the Not ECT marks and the ECT CE marks so as to maintain the roughly 1 1 ratio for recognizing the rate reduction prohibited pattern. Additionally the eNB changes them all the IP packets considered as a single packet when changing the ECT mark to the CE mark and vice versa i.e. the eNB doesn t change marks in the middle of fragments so as to not confuse a downstream eNB or the receiver.

Furthermore the eNB changes the ECT mark to the CE mark only if the IP packet is not fragmented or if it is a fragmented IP packet the value of identification field in the IP header must be encountered for the first time within a time window with the same source destination and protocol values. And if having previously within a time window sent a fragmented IP packet with the CE mark the eNB continues to send any fragmented IP packets of the same identification source destination and protocol values with the CE mark even if the eNB wishes to request for increasing the source rate on the RTP stream. Therefore the eNB may have to wait for a new RTP packet to signal such a request. By doing so the eNB doesn t need to reassemble the fragmented IP datagram.

According to yet another embodiment a method is provided for enabling a nonce mechanism in the new marking patterns. According to an embodiment a sender may randomly generates an ECT codepoint ECT x where x 0 or 1 for every other RTP packet. If the ECT Not ECT marking pattern i.e. the first pattern is sent the remaining every other RTP packet is marked with Not ECT. If ECT ECT marking pattern i.e. the second pattern is sent the remaining every other RTP packet is marked the same way as its previous RTP packet. Also the odd numbered RTP packets may be required to follow the even numbered ones or vice versa to simplify the receiver algorithm. The sender computes the nonce sum NS values by skipping the Not ECT marks or the repeated ECT marks and the receiver does the same therefore knowing packet order helps to simplify the receiver.

Once the sender reaches the highest supported CODEC rate that has been negotiated during the call setup the sender may continue to mark the RTP packets with the all ECT marking pattern i.e. rate reduction allowed and rate up allowed pattern. Frame redundancy and aggregation parameters may be set according to other statistics such as frame error rate jitter in the RTCP Receiver Report message and so forth. Since the eNB is agnostic at the highest supported CODEC rate that has been negotiated at the application layer the eNB may still request for more rate up switches by not changing any ECT marks. However since the receiver knows the highest supported CODEC rate of the sender the receiver does not signal any rate up switches.

According to an alternative embodiment that allows rate increases only from the lowest supported rate the first four patterns may be re defined without using the Not ECT mark. Specific the first pattern is changed to a pattern that alternates between the CE mark and the ECT mark and is used to indicate a rate reduction prohibited and rate up allowed stream. The second pattern is changed to an all ECT marking pattern and is used to indicate a rate reduction allowed and rate up prohibited stream. The third pattern is changed to an all CE marking pattern and is used to indicate a rate reduction requested stream with the RTP header of the received RTP packet indicating that the current source rate is not at the lowest supported source rate that has been negotiated. The fourth pattern is changed to an all CE marking pattern as well and is used to indicate a rate reduction prohibited and rate up prohibited stream with the RTP header of the received RTP packet indicating that the current source rate is at the lowest supported source rate that has been negotiated.

The sender still only sends out RTP packets with either the first or the second pattern. The eNB or an intermediate node may change the pattern to the third or the fourth pattern. The receiver can distinguish the third and fourth pattern by determine if the current source rate is at the lowest supported source rate or not. The eNB may not be able to distinguish between the third and fourth patterns however the inability to distinguish between the third and fourth patterns does not prevent the eNB from selecting the right streams for reducing the source rate in response to a congested condition or for increasing the source rate in response to an un congested condition however the eNB may only do so from the lowest supported source rate that has been negotiated.

Due to a lack of the fifth pattern the alternative embodiment does not allow for rate increases from an intermediate rate. However because there is no Not ECT mark in each of the four marking patterns it may be easier to differentiate these four marking patterns from the ECN probing pattern as described in IETF RFC 3168. It is also possible to consider ECT 0 codepoint and ECT 1 codepoint as two different types of ECN marks in order to regain the fifth pattern for allowing rate increases from an intermediate rate without using the Not ECT mark. However the differentiation of ECT 0 and ECT 1 codepoints will take away the ability from the sender to randomly send the ECT 0 or ECT 1 codepoints thereby losing some of the benefits of having two ECT codepoints such as verifying an end to end path and catching a cheating receiver by using the nonce mechanism etc.

Table 3 lists various marking patterns of length two M 2 at different entities involved in packet transmission wherein there is no Not ECT mark in each of the marking patterns.

After detecting a CE ECT pattern i.e. a rate reduction prohibited and rate up allowed pattern in a RTP stream a congested eNB may exclude the RTP stream from further rate reductions and changes any ECT marks to CE. While an uncongested eNB may include the RTP stream in a rate up selection pool and run a stream selection algorithm. If the uncongested eNB selected the RTP stream for a rate up the uncongested eNB doesn t change any ECN marks or else changes only ECT marks to CE. At a receiver after detecting a CE ECT pattern in a RTP stream the receiver may signal a rate up switch using RTCP explicit CMR or implicit CMR for example.

After detecting a ECT ECT pattern i.e. a rate reduction allowed and rate up prohibited pattern in a RTP stream a congested eNB may include the RTP stream in a congestion control selection pool and run a selection algorithm. If the RTP stream is selected for congestion control the congested eNB may change ECT marks to CE while an uncongested eNB may not change any marks. After detecting a rate reduction allowed and rate up prohibited pattern the receiver may not send any signal to the sender.

Since a rate reduction requested pattern is an all CE pattern and an eNB may not change any CE marks in general the eNB will forward the RTP packets with a CE mark without changing it. After detecting a CE CE pattern a receiver may further determine if the source rate is already at the lowest supported rate that has been negotiated. If the source rate is already at the lowest supported rate receiver determines that the CE CE pattern represents a rate reduction prohibited and rate up prohibited pattern and may not send any signal to the sender or else the receiver determines that the CE CE pattern represents a rate reduction requested pattern and may send RTCP ECN feedback to report the congestion.

Application processor may be used to implement embodiments of the congestion control mechanism discussed herein. As an example application processor may be used to implement packet marking of a packet stream if UE is operating as a sender of an RTP stream. Additionally application processor may be used to process received packets including marking pattern detection packet ordering packet reassembly and so on as well as sending a signal to a source of the received packets to request a decrease or an increase in a source rate of a CODEC used to encode data contained in the received packets. Application processor may also implement a protocol stack used in communications.

Sender operations may begin with the sender performing a check to determine if a CODEC source rate of a first packet stream e.g. an RTP packet stream is at a minimum agreed upon CODEC source rate block . If packets in the first packet stream contain data encoded at a CODEC source rate that is at the minimum agreed upon CODEC source rate then the sender may mark the packets in the first packet stream with a first marking pattern block . According to an embodiment the first marking pattern may be referred to as a rate reduction prohibited pattern meaning that the first packet stream is not capable of further reducing its CODEC source rate. As discussed previously the sender may mark the ECN bits of the IP headers of the packets in the first packet stream. However rather than marking each packet in the first packet stream in an identical manner the first marking pattern consists of M consecutive packets marked in a specified way where M is a positive integer value greater than or equal to two. As an example with M 2 the first marking pattern consists of either a Not ECT mark or a CE mark and followed by an ECT mark.

If the packets in the first packet stream contain data encoded at a CODEC source rate that is greater than the minimum agreed upon CODEC source rate then the sender may mark the packets in the first packet stream with a second marking pattern block . According to an embodiment the second marking pattern may be referred to as a rate reduction allowed pattern meaning that the first packet stream is capable of further reducing its CODEC source rate. As an example with M 2 the second marking pattern consists of all ECT marks.

The sender may then transmit the packets of the first packet stream marked with either the first marking pattern or the second marking pattern to their intended destination e.g. the receiver block .

The sender may also receive a signal from a receiver of the first packet stream wherein the signal may be a request for the sender to change the CODEC source rate of the first packet stream block . The sender may then change the CODEC source rate of the packet stream based on the signal block and sender operations may then terminate.

According to an embodiment if the packet stream is already at the minimum negotiated CODEC source rate the receiver never would have sent the signal to the sender to request further rate reduction. Therefore if the sender receives the signal requesting for rate reduction from the receiver about a packet stream the sender is capable of reducing the CODEC source rate of the packet stream. Similar restrictions may be in place for a signal requesting that the sender increases the CODEC source rate of its packet stream.

First eNB operations may begin with the eNB receiving packets from a marked packet stream block . The eNB may also determine its local congestion conditions block . The eNB may examine the packets to determine a marking pattern for the marked packet stream block . According to an embodiment the eNB may examine a value of ECN bits of both the packets that has just arrived as well as previously arrived packets to determine the marking pattern. For example if the marking pattern is spread over M packets where M is a positive integer value then the eNB may examine at least M packets to determine the marking pattern. If out of order packet delivery is a concern then the eNB may examine more than M packets to determine a distribution of different ECN values over the M or more packets to determine the marking pattern. Alternatively the eNB may be capable of re ordering the packets prior to determining the marking pattern.

The eNB may perform a check to determine if the packets are marked with a second marking pattern block . As discussed previously the second marking pattern may be used to indicate that the packet stream may be capable of reducing its CODEC source rate to help alleviate congestion conditions. If the packets are not marked with the second marking pattern then the eNB may go ahead and transmit the packets to their destination block and first eNB operations may then terminate.

If the packets are marked with the second marking pattern then the packet stream may reduce its CODEC source rate to reduce congestion. The eNB may check to determine if it is experiencing congestion block . If the eNB is not experiencing congestion then the eNB may transmit the packets of the packet stream block and first eNB operations may then terminate.

If the eNB is experiencing congestion the eNB may form a group of rate reduction allowed packet streams which may include other packet streams that are also marked with the second marking pattern block . The eNB may then select one or more streams from the group of rate reduction allowed packet streams block and change the marking pattern for packets of the selected stream s to a third marking pattern block . The eNB may then transmit the packets block and first eNB operations may then terminate.

According to an embodiment the third marking pattern may be referred to as a rate reduction requested pattern and may be used to indicate packet streams that may have their CODEC source rates reduced since they are not operating at their minimum CODEC source rates. With M 2 the third marking pattern may consist of all CE marks.

In addition to reducing the CODEC source rate of a packet stream the eNB may be able to increase the CODEC source rate of a packet stream if conditions warrant e.g. the eNB is not experiencing congestion. Second eNB operations may begin with the eNB forming a group of rate up allowed packet streams block . The group of rate up allowed packet streams may be similar to the group of rate reduction allowed packet streams except that the packet streams in the group of rate up allowed packet streams may have their CODEC source rates increased instead of decreased.

The eNB may select one or more packet streams from the group of rate up allowed packet streams block and send the packets from the selected stream s with their marking patterns unchanged to the receiver block . However for members of the group of rate up allowed packet streams that are not selected the eNB may change their marking pattern to the fourth marking pattern block and send their packets to the receiver block . Second eNB operations may then terminate.

According to an embodiment the fourth marking pattern may be referred to as a rate reduction prohibited and rate up prohibited pattern and may be used to indicate packet streams that have their CODEC source rates kept unchanged. With M 2 the fourth marking pattern may consist of alternating Not ECT marks and CE marks.

First receiver operations may begin with the receiver receiving packets from a packet stream originating at the sender block . The receiver may then determine a source rate of the packet stream from the received packets block . The receiver may then determine a marking pattern on the packets block . According to an embodiment the receiver may examine a value of ECN bits of both the packets that has just arrived as well as previously arrived packets to determine the marking pattern. For example if the marking pattern is spread over M packets where M is a positive integer value then the receiver may examine at least M packets to determine the marking pattern. If out of order packet delivery is a concern then the receiver may examine more than M packets to determine a distribution of different ECN values over the M or more packets to determine the marking pattern. Alternatively since the receiver implements a full protocol stack the receiver may be capable of re ordering the packets prior to determining the marking pattern.

The receiver may then send a signal to the sender based on the marking pattern of the packets from the packet stream block . The sending of the signal and a nature of the signal itself may also be based on a CODEC source rate of the data in the packets and a set of supported CODEC source rates that have been negotiated between the sender and the receiver during the call setup.

As an example if the CODEC source rate of the packet stream is at a minimum CODEC source rate in the negotiated set of supported rates and the marking pattern of the packet stream is the first marking pattern i.e. the rate reduction prohibited and the rate up allowed pattern then a signal may be sent to the sender to increase the CODEC source rate of the packet stream. If the CODEC source rate of the packet stream is not at the minimum CODEC source rate in the negotiated set of supported rates and the marking pattern of the packet stream is the third marking pattern i.e. the rate reduction requested pattern then a signal may be sent to the sender to indicate a congestion condition and the CODEC source rate should be reduced. According to an embodiment the signal may be in the form of a RTCP ECN feedback message.

As another example if the CODEC source rate of the packet stream is not at a maximum CODEC source rate in the negotiated set of supported rates and the marking pattern of the packet stream is the second marking pattern which is a rate reduction allowed and rate up allowed pattern under some embodiments as described before then a signal may be sent to the sender to indicate a request to increase the CODEC source rate of the packet stream. First receiver operation may then terminate.

Second receiver operations may be an implementation of block sending a signal to the source of the packet stream. Second receiver operations may begin with determining a marking pattern of the packets in the packet stream block . The receiver may then determine if the CODEC source rate of the packet stream is at the minimum CODEC source rate block . Since the receiver and the sender negotiated the CODEC source rate at initiation of the communications the receiver knows the CODEC source rate plus a set of possible CODEC source rates if any .

If the CODEC source rate is not at the minimum CODEC source rate and if the marking pattern of the packets is the third marking pattern i.e. the rate reduction requested pattern block then the receiver may send a signal to the sender to request a reduction in the CODEC source rate block . Second receiver operations may then terminate. If the CODEC source rate is at the minimum CODEC source rate or if the marking pattern is not the third marking pattern then second receiver operations may then terminate.

Advantageous features of embodiments of the invention may include A method for providing congestion control at a radio access network using an explicit indication of the capacity for further reducing a source rate of an RTP stream from each of a plurality of senders is provided the method comprising determining by a sender whether the source rate of the RTP stream is at the lowest rate within a set of source rates that are negotiated between the sender and a receiver during a call setup sending a plurality of consecutive real time protocol RTP packets of the RTP stream by the sender by marking the explicit congestion notification ECN bits in the Internet Protocol IP headers of the plurality of RTP packets of the RTP stream packet by packet with a first marking pattern when the source rate of the RTP stream is at the lowest rate within the set of negotiated source rates sending a plurality of consecutive RTP packets of an RTP stream by the sender by marking the ECN bits in the IP headers of the plurality of RTP packets of the RTP stream packet by packet with a second marking pattern when the source rate of the RTP stream is not at the lowest rate within the set of negotiated source rates determining whether a congested or un congested condition is experienced at the radio access network by an enhanced Node B eNB receiving the plurality of RTP packets of one or more RTP streams by the eNB from one or more senders determining the marking pattern on the ECN bits observed on the plurality of currently and previously received RTP packets of each RTP stream by the eNB forming a group of rate reduction allowed streams by the eNB comprising of all the RTP streams of which the RTP packets are received with the second marking pattern on the ECN bits packet by packet selecting one or more RTP streams from the group of rate reduction allowed streams by the eNB for reducing the source rate in response to a congested condition experienced at the radio access network sending the RTP packet of the RTP stream that is selected for reducing the source rate by the eNB by changing the ECT mark on the RTP packet to the CE mark such that the plurality of received RTP packets of the selected RTP stream are sent by the eNB with a third marking pattern on the ECN bits packet by packet to indicate the request for reducing the source rate receiving one or more RTP packets of the RTP stream by the receiver sending a signal to the sender by the receiver in response to the ECN bits in the IP header of the received RTP packet on the RTP stream according to the information of the source rate and the marking pattern on the ECN bits observed on the received RTP packets on the RTP stream and changing the source rate of the RTP stream by the sender in response to the signal received from the receiver.

The method could further include wherein sending a signal to the sender by the receiver in response to the ECN bits in the IP header of the received RTP packet of the RTP stream according to the information of the source rate and the marking pattern observed on the received RTP packets on the RTP stream further comprises of determining the marking pattern on the ECN bits observed on the currently and previously received RTP packets of the RTP stream by the receiver determining whether the source rate of the RTP stream of the sender is at the lowest rate within the set of the negotiated source rates by the receiver using the information in the RTP header of the received RTP packet and the information of the set of source rates that are negotiated between the sender and the receiver during the call setup and sending a real time control protocol RTCP ECN Feedback message by the receiver to indicate the congestion experienced when the receiver determines that the third marking pattern on the ECN bits is observed on the received RTP packets of the RTP stream and the source rate of the RTP stream of the sender is not at the lowest rate within the set of the negotiated source rates and wherein changing the source rate of the RTP stream by the sender in response to the signal received from the receiver further comprises of reducing the source rate of the RTP stream by the sender in response to the RTCP ECN Feedback message received from the receiver with the indication of congestion experienced.

The method could further include wherein the first marking pattern alternates between the not ECN Capable Transport not ECT and the ECN Capable Transport ECT marks on a packet by packet basis the second marking pattern consists of all ECT marks and the third marking pattern consists of all Congestion Experienced CE marks wherein an ECT mark can be the ECT 0 codepoint 01 or the ECT 1 codepoint 10 the not ECT mark is the codepoint 00 and the CE mark is the codepoint 11 .

The method could further include wherein the first marking pattern alternates between the CE and the ECT marks on a packet by packet basis the second marking pattern consists of all ECT marks and the third marking pattern consists of all CE marks wherein an ECT mark can be the ECT 0 codepoint 01 or the ECT 1 codepoint 10 the not ECT mark is the codepoint 00 and the CE mark is the codepoint 11 .

The method could further include further comprising forming a group of rate up allowed streams by the eNB comprising of all the RTP streams of which the RTP packets are received with the first marking pattern on the ECN bits packet by packet selecting one or more RTP streams from the group of rate up allowed streams by the eNB for increasing the source rate in response to an un congested condition experienced at the radio access network sending the RTP packet of the RTP stream that is selected for increasing the source rate by the eNB by keeping the ECN bits in the IP header of the RTP packet as they are received to indicate the request for increasing the source rate and sending the RTP packet of the RTP stream of which the RTP packets are received with the first marking pattern but is not selected for increasing the source rate in response to the un congested condition experienced at the radio access network by the eNB by changing the ECT mark on the RTP packet to the CE mark such that the plurality of received RTP packets of the RTP stream are sent by the eNB with a fourth marking pattern on the ECN bits packet by packet to indicate the request for keeping the source rate wherein sending a signal to the sender by the receiver in response to the ECN bits in the IP header of the received RTP packet on the RTP stream according to the information of the source rate and the marking pattern observed on the received RTP packets on the RTP stream further comprises of sending a rate up switch signal to the sender by the receiver to indicate a request for increasing the source rate when the receiver determines that the first marking pattern on the ECN bits is observed on the received RTP packets on the RTP stream and wherein changing the source rate of the RTP stream by the sender in response to the signal sent by the receiver further comprises of increasing the source rate of the RTP stream by the sender in response to the rate up switch signal received from the receiver.

The method could further include wherein the first marking pattern alternates between not ECT and ECT marks on a packet by packet basis the second marking pattern consists of all ECT marks the third marking pattern consists of all CE marks and the fourth marking pattern alternates between the not ECT and the CE marks on a packet by packet basis wherein an ECT mark can be the ECT 0 codepoint 01 or the ECT 1 codepoint 10 the not ECT mark is the codepoint 00 and the CE mark is the codepoint 11 .

The method could further include wherein the first marking pattern alternates between the CE and the ECT markings on a packet by packet basis the second marking pattern consists of all ECT marks both the third and the fourth marking patterns consist of all CE marks wherein an ECT mark can be the ECT 0 codepoint 01 or the ECT 1 codepoint 10 the not ECT mark is the codepoint 00 and the CE mark is the codepoint 11 .

The method could further include further comprising forming the group of rate reduction allowed streams by the eNB by further including all the RTP streams of which the RTP packets are received with a fifth marking pattern on the ECN bits packet by packet before selecting a stream for reducing the source rate forming the group of rate up allowed streams by the eNB by further including all the RTP streams of which the RTP packets are received with the second marking pattern on the ECN bits packet by packet before selecting a stream for increasing the source rate sending the RTP packet of the RTP stream of which the RTP packets are received with the second marking pattern but is neither selected for increasing the source rate in response to an un congested condition experienced at the radio access network nor selected for reducing the source rate in response to a congested condition experienced at the radio access network by the eNB by changing the ECT mark on every other received RTP packet of the RTP stream to the CE mark such that the plurality of received RTP packets of the RTP stream are sent by the eNB with the fifth marking pattern on the ECN bits packet by packet to indicate the request for keeping the source rate and sending the RTP packet of the RTP stream of which the RTP packets are received with the fifth marking pattern but is not selected for reducing the source rate in response to the congested condition experienced at the radio access network by the eNB by keeping the ECN bits in the IP header of the RTP packet as they are received to indicate the request for keeping the source rate wherein sending a signal to the sender by the receiver in response to the ECN bits in the IP header of the received RTP packet on the RTP stream according to the information of the source rate and the marking pattern observed on the received RTP packets on the RTP stream further comprises determining whether the source rate of the RTP stream is at the highest rate within the set of the negotiated source rates by the receiver using the information in the RTP header of the received RTP packet and the information of the set of source rates that are negotiated between the sender and the receiver during the call setup and sending a rate up switch signal to the sender by the receiver to indicate a request for increasing the source rate when the receiver determines that the second marking pattern on the ECN bits is observed on the received RTP packets on the RTP stream and the source rate of the RTP stream of the sender is not at the highest rate within the set of the negotiated source rates and wherein the first marking pattern alternates between the not ECT and the ECT marks on a packet by packet basis the second marking pattern consists of all ECT marks the third marking pattern consists of all CE marks the fourth marking pattern alternates between the not ECT and the CE marks on a packet by packet basis and the fifth marking pattern alternates between the CE and the ECT marks on a packet by packet basis wherein an ECT mark can be the ECT 0 codepoint 01 or the ECT 1 codepoint 10 the not ECT mark is the codepoint 00 and the CE mark is the codepoint 11 .

Although the present invention and its advantages have been described in detail it should be understood that various changes substitutions and alterations can be made herein without departing from the spirit and scope of the invention as defined by the appended claims.

Moreover the scope of the present application is not intended to be limited to the particular embodiments of the process machine manufacture composition of matter means methods and steps described in the specification. As one of ordinary skill in the art will readily appreciate from the disclosure of the present invention processes machines manufacture compositions of matter means methods or steps presently existing or later to be developed that perform substantially the same function or achieve substantially the same result as the corresponding embodiments described herein may be utilized according to the present invention. Accordingly the appended claims are intended to include within their scope such processes machines manufacture compositions of matter means methods or steps.

