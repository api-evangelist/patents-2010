---

title: Power supply unit configured to not control a power supply from reducing the power state to a mirroring unit and storage units during a rebuild operation even when such power reducing state is satisfied
abstract: An information processing apparatus, when a shift condition for shifting a power state of the information processing apparatus to a power-saving state is satisfied, performs control to reduce power supply to a mirroring control unit and a plurality of storage units. Even when the shift condition has been satisfied, in a case that rebuild operation for the plurality of storage units is in progress, the information processing apparatus does not perform control to reduce power supply to the mirroring control unit and the plurality of storage units.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08700935&OS=08700935&RS=08700935
owner: Canon Kabushiki Kaisha
number: 08700935
owner_city: Tokyo
owner_country: JP
publication_date: 20101001
---
The present invention generally relates to information processing and more particularly to an information processing apparatus and a power supply control method for an information processing apparatus.

Japanese Patent Application Laid Open No. 10 255451 discusses a power supply control method for a mirroring system in which a system is protected by simultaneously writing data into a plurality of hard disk drives HDDs . Further Japanese Patent Application Laid Open No. 10 255451 discusses that after writing into the HDDs is completed a power of the HDDs is turned off.

Further the functions of a mirroring control unit of such a type inserted as an addition of option between a system control central processing unit CPU and the HDDs include 1 a mirror function a rebuild function and a patrol function as described below.

The mirror function corresponds to a function for executing simultaneous writing on all HDDs connected in response to a write command from a host. The rebuild function corresponds to a function for copying onto an HDD from a copying source HDD to a copying destination when an HDD has failed. The patrol function corresponds to a function for executing a reading test of the HDDs connected for all regions at a predetermined timing during a normal service.

As described above there are available three functions in which the mirroring system can be implemented i.e. the mirror function the rebuild function and the patrol function . In particular for the rebuild and patrol functions and processing can be executed even when the system control CPU does not operate.

However conventionally even in such a case power is supplied to the system control CPU. In the conventional configuration the above described rebuild and or patrol functions or is required even though their operation s are enabled by supplied power of several watts only to the mirroring control circuit and the HDDs to supply power consumption of several tens of watts to the system control CPU for several tens of minutes to several hours.

If a configuration to suspend the rebuild or the patrol when entering into a sleep mode is employed power saving can be implemented. However in such a configuration in an apparatus with a setting of frequently entering into the sleep mode a significant number of days may be required to secure energization for a length of accumulative time required until operation of the rebuild or the patrol is completed. In this case the system protection by the mirroring system cannot be carried out for that period of time.

The present invention is directed to an information processing apparatus and a control method for an information processing apparatus where the information processing apparatus is configured to supply power to a plurality of storage devices in a case where execution of specific operation is in progress by a mirroring control unit that controls mirroring control to the plurality of storage devices while implementing power saving by stopping power supply to a control unit that executes control of the entire information processing apparatus.

According to an aspect of the present invention an information processing apparatus includes a system control unit configured to execute control of the entire information processing apparatus a plurality of storage units a mirroring control unit configured to control mirroring control for the plurality of storage units a first power supply unit configured to supply power to the system control unit a second power supply unit configured to supply power to the mirroring control unit and the plurality of storage units a power supply control unit configured to control the second power supply unit to reduce power supply to the mirroring control unit and the plurality of storage units when a shift condition for shifting a power state of the information processing apparatus to a power saving state is satisfied wherein even when the shift condition has been satisfied in a case that rebuild operation for the plurality of storage units is in progress by the mirroring control unit the power supply control unit does not control the second power supply unit to reduce power supply to the mirroring control unit and the plurality of storage units.

Further features and aspects of the present invention will become apparent from the following detailed description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the invention will be described in detail below with reference to the drawings.

An information processing apparatus according to an exemplary embodiment of the present invention is a system in which a mirroring unit is inserted between a host and hard disk drives HDDs so that it can be optionally set up. This type of the mirroring unit has features to described below.

 1 While the rebuild is in progress a writing operation from the mirroring unit to an HDD is executed even if an issue of the write command from the host is stopped when the host performs shutdown. To shut off an energization to the HDD while the writing operation to the HDD is in progress creates a possibility of causing failure to the HDD. 2 The mirroring unit may be installed on an apparatus that frequently shifts to a sleep mode or an apparatus in which a length of time during which a power is cut off is long. In such a case since an energization time to the HDD is short a time required for completion of the rebuild processing may not be available sufficiently. For this reason there is a possibility that the system protection operation by the mirroring cannot be executed over a long period of time. 3 If the mirroring unit is installed on the apparatus that shifts frequently to the sleep mode or the apparatus in which a length of time during which the power is cut off is long there is a possibility that the energization time to the HDD is short and a sufficient length of time required for the patrol function to be executed cannot be secured.

Mirroring is a function for executing a simultaneous writing operation to all connected HDDs in response to the write command from the host. Rebuild is a function when an HDD fails for copying from a copying source HDD to a copying destination HDD. Patrol is a function for executing a reading test of the connected HDDs under a normal service for the entire region at a predetermined timing.

In the system control unit a system control central processing unit CPU is used to execute system control. An HDD controller interfaces with an Advanced Technology Attachment ATA signal according to instructions from the system control CPU . A control signal line connects the system control CPU and the HDD controller .

An HDD unit is connected to the system control unit via the ATA signal line . In the HDD unit a mirroring control circuit is connected between the HDD controller and each of an HDD and an HDD . The mirroring control circuit is connected to the HDD via an ATA signal line and is connected to the HDD via an ATA signal line . In this case the HDDs connected to the mirroring control circuit may be three or more. The mirroring control circuit executes access control to a plurality of storage devices in response to instructions from the system control unit .

A power supply unit first power supply unit is used to supply power to the system control unit . The power supply unit when a signal state of a power supply control signal first power supply control signal is high H supplies power to the system control unit . In other words the power supply control signal indicates a power supply state to the system control unit . A power supply unit second power supply unit is used to supply power to the HDD unit . The power supply unit when a signal state of the power supply control signal second power supply control signal is H supplies power to the HDD unit . The power supply unit and the power supply unit are independently off on controlled in response to the power supply control signal and the power supply control signal respectively.

A specific operation in progress signal is a signal in which a signal state becomes H when the mirroring control circuit is currently executing a specific operation including the rebuild operation or the patrol operation. The specific operation is an access operation to the HDDs in which the system control CPU does not involve and is an operation executable even when the system control CPU is in a non operation state. In other words the specific operation in progress signal indicates an execution state of the above described specific operation.

A wired OR circuit generates the power supply control signal as a logical sum of the power supply control signal and the specific operation in progress signal . More specifically the wired OR circuit monitors a power supply state to the system control unit and an execution state of the above described specific operation. Then in at least one case of a case where power is being supplied to the system control unit and a case where execution of the above described specific operation is in progress the wired OR circuit acts to cause the power supply unit to supply power to the HDD unit . The mirroring control circuit is inserted between the HDD controller and the HDDs in an optionally settable mode and controls the mirroring operation. For this reason the system control CPU does not need to change control depending on whether it is executing the mirroring operation.

The system control CPU comprehensively controls accesses to various types of devices that are connected to one another based on a control program stored in the read only memory ROM and comprehensively controls various processing executed inside the controller the system control unit . The random access memory RAM is a system work memory for the system control CPU to operate and is also a memory used to temporarily store the image data. The RAM is constituted of a static RAM SRAM that holds the stored content even after a power is turned off and a dynamic RAM DRAM in which the stored content will be erased after the power is turned off. In the ROM a boot program of the apparatus is stored.

The HDD unit is connected the HDD controller . The system software or the image data can be stored in the HDD and the HDD included in the HDD unit .

An operation unit interface I F is an interface unit for connecting the system bus and the operation unit . The operation unit I F receives from the system bus the image data for displaying on the operation unit outputs it to the operation unit and outputs information input from the operation unit to the system bus .

A network I F is connected to the LAN and the system bus and controls connection to the LAN. An image bus is a transmission line for exchanging the image data and is constituted of a peripheral component interface PCI bus.

A scanner image processing unit executes correction processing and edition on the image data received via the scanner I F from the scanner unit . An image conversion unit includes a decompression unit a compression unit a rotation unit a scaling unit a color space conversion unit a binary to multivalued conversion unit a multivalued to binary conversion unit a moving unit a thinning unit and a combining unit and performs image processing on the image data. The decompression unit decompresses the image data. The printer image processing unit receives and rasterizes the image data from the decompression unit . The printer unit performs print processing of the image data received via the printer I F .

The mirroring operation the rebuild operation and the patrol operation by the mirroring control circuit will be described below if a patrol activation start condition is satisfied referring to and to . is a flowchart illustrating the mirroring operation by the mirroring control circuit . A processing of the flowchart is implemented by the mirroring control circuit by executing the software recorded in the storage unit that is built in the mirroring control circuit .

In step S the mirroring control circuit after activation confirms connection to the HDD and the HDD . Next in step S the mirroring control circuit issues an Identify command to the HDDs confirmed in step S and acquires detailed information capacity model name performance etc. from the HDDs. Next in step S the mirroring control circuit executes transfer mode setting.

Next in step S the mirroring control circuit determines whether the mirroring operation of two HDDs or one HDD is available based on a result of the above described steps S to S. Then if the mirroring control circuit determines that the mirroring operation on two HDDs is available YES in step S then in step S the mirroring control circuit determines execution of the mirroring operation of the two HDDs.

On the other hand if the mirroring control circuit determines that the mirroring operation in the two HDDs is not available NO in step S then in step S the mirroring control circuit determines whether the rebuild condition is satisfied. In this case rebuild condition is satisfied refers to a case where for example one HDD out of two HDDs is replaced with a new HDD.

Then if the mirroring control circuit determines that the rebuild condition is not satisfied NO in step S then in step S the mirroring control circuit determines an operation of one HDD. On the other hand if the mirroring control circuit determines that the rebuild condition is satisfied YES in step S then in step S the mirroring control circuit executes the rebuild operation. Then after the rebuild operation is completed the mirroring control circuit determines the mirroring operation of the two HDDs.

The mirroring control circuit transmits an ATA command from the HDD controller to the determined one or two HDDs. The system control CPU for the HDD controller makes no intervention of any kind to the mirroring control circuit for the purpose of execution of the mirroring operation.

A write command from the system control CPU to the HDD is transmitted to the mirroring control circuit via the HDD controller . In response to this the mirroring control circuit issues simultaneously the write command from the above described system control CPU to the plurality of HDDs being connected.

In addition a read command from the system control CPU to the HDDs is transmitted to the mirroring control circuit via the HDD controller . In response to this the mirroring control circuit issues the read command to any one of the HDDs that are connected.

The mirroring control circuit upon recognizing that one HDD has been replaced the rebuild condition has been satisfied starts the rebuild operation. First in step S the mirroring control circuit sets the specific operation in progress signal to H . Next in step S the mirroring control circuit sets a rebuild address for a front address of the HDD previously connected and determines whether the rebuild address is completed data replication of the entire region of the previously connected HDD is completed . Then if it is determined that the rebuild address is not yet completed NO in step S then the processing proceeds to step S.

In step S the mirroring control circuit replicates data stored at the rebuild address of the previously connected HDD onto a newly connected HDD. Then in step S the mirroring control circuit updates the rebuild address by a unit of replication.

Next in step S the mirroring control circuit determines whether a command from the host the system control unit is received. If it is determined that the command has not been received NO in step S then the processing returns to step S.

On the other hand if it is determined that the command from the host the system control unit has been received in the above described step S YES in step S then in step S the mirroring control circuit suspends data replication rebuild processing . Then in step S the mirroring control circuit processes the command received from the above described host. Then when the processing of the command is completed the mirroring control circuit returns the processing to step S.

On the other hand if the mirroring control circuit determines that the rebuild address is completed in the above described step S YES in step S then the mirroring control circuit sets the specific operation in progress signal to low L and terminates the processing of the flowchart.

The mirroring control circuit is provided with a storage unit e.g. a flash memory that stores HDD address suspended location in which the rebuild has been processed suspended in response to the command or the like from the system control CPU . When the command processing is completed and the rebuild processing is resumed the mirroring control circuit executes rebuild continued from the suspension based on the HDD address in which the rebuild has been processed stored in the above described storage unit.

In relation to the rebuild operation the system control CPU does not need to be concerned therewith from start until completion. In other words the rebuild processing is an access to the HDD in which the system control CPU is not involved and is also processing executable even when the system control CPU is not in the operation state.

When there is no access to the HDDs for a predetermined length of time the patrol function is activated. First in step S the mirroring control circuit sets the specific operation in progress signal to H . Next in step S the mirroring control circuit sets a patrol address to a front address of either one of the HDDs connected and determines whether the patrol address is completed whether readout of data contained in the entire region of the above described HDD is completed . Then if it is determined that the patrol address is not yet completed NO in step S then the processing proceeds to step S.

In step S the mirroring control circuit executes readout processing of data stored at the patrol address of the above described HDD. In step S the mirroring control circuit determines whether data readout in the readout processing is completed. Then if it is determined that the data readout is completed in the above described step S YES in step S then in step S the mirroring control circuit updates the patrol address by a unit of read out address and returns the processing to step S. On the other hand if it is determined that data readout is not completed in the above described step S NO in step S then the mirroring control circuit advances the processing to step S. In step S the mirroring control circuit executes readout processing of data stored at the patrol address of the other HDD. In step S the mirroring control circuit determines whether data has been read out successfully in the readout processing. Then if it is determined that the data has been read out successfully in the above described step S YES in step S then in step S the mirroring control circuit replicates the data read out from the patrol address of the above described other HDD onto the above described HDD to execute data recovery and returns the processing to step S. On the other hand if it is determined that the data has not been read out successfully in the above described step S NO in step S then in step S the mirroring control circuit processes errors of both HDDs executes processing for notifying the system control unit that both HDDs are erred and causing the operation unit to display them . Then in step S the mirroring control circuit sets the specific operation in progress signal to L and terminates the processing of the flowchart.

If the mirroring control circuit determines that the patrol address is completed in the above described step S YES in step S then in step S the mirroring control circuit sets the specific operation in progress signal to L and terminates the processing of the flowchart.

Though not illustrated the mirroring control circuit upon receiving a command or the like from the system control CPU suspends the patrol processing even when the patrol processing is in progress. The mirroring control circuit as described above is provided with a storage unit that stores the suspended HDD address on which the rebuild has been processed suspended location . When the command processing is completed and the rebuild processing is resumed the mirroring control circuit executes rebuild continued from the suspension based on the HDD address on which the rebuild has been processed stored in the above described storage unit.

In relation to the patrol operation too the system control CPU does not need to be concerned therewith from start until completion. In other words the patrol processing is also an access to the HDD in which the system control CPU is not involved and is processing executable even in a state where the system control CPU is not operating.

An operation by the system control CPU will be described below with reference to and . is a flowchart illustrating an operation by the system control CPU . Processing of the flowchart is implemented by the system control CPU by executing the software recorded in the ROM or the HDD or the HDD.

In step S the system control CPU activates the system when a power is turned on and sets the power supply control signal to H and the processing proceeds to step S. Instep S the system control CPU determines whether a sleep request is present whether a sleep condition is satisfied . If it is determined that the sleep request is present YES in step S the processing proceeds to step S.

In step S the system control CPU performs processing of shift condition to the sleep state. In step S the system control CPU stops access to the HDD sets the power supply control signal to L and terminates the processing of the flowchart.

On the other hand if it is determined that the sleep request is absent in the above described step S NO in step S then in step S the system control CPU determines whether a shutdown request is present. If it is determined that the shutdown request is not present NO in step S then the processing returns to step S. On the other hand if it is determined that the shutdown request is present in the above described step S YES in step S the system control CPU advances the processing step S. In step S the system control CPU performs the shutdown processing. In step S the system control CPU stops access to the HDD sets the power supply control signal to L and terminates the processing of the flowchart.

As illustrated in the information processing apparatus according to the first exemplary embodiment is configured so that a power supply system to the system control unit and the HDD unit can be independently off on controlled.

When the system is operating normally H as the power supply control signal is output from the system control unit to the power supply unit and the wired OR circuit . At this time H as the power supply control signal is input and accordingly the power supply unit supplies power power to the system control unit .

At this time H as the power supply control signal is input and accordingly the wired OR circuit outputs the H as the power supply control signal to the power supply unit regardless of the specific operation in progress signal . In other words at this time the H as the power supply control signal is input and accordingly the power supply unit supplies power power to the HDD unit .

In this state when the HDD is replaced with a new HDD due to its failure or the like the mirroring control circuit starts the rebuild operation in accordance with the rebuild condition and simultaneously sets the specific operation in progress signal to H . If for example 80 GB HDD is used about 30 minutes is required to complete rebuild.

If a patrol activation start condition is satisfied the mirroring control circuit starts the patrol operation and sets the specific operation in progress signal to H . The patrol function is to watch an activation start condition every six days of a job for example and the patrol activation start condition includes a setting in which the patrol function starts when a job does not occur for thirty minutes. The patrol function is an important function along with the mirroring for securing reliability of the HDDs. However in an apparatus with a setting of frequent shutdown or sleep such a situation occurs that a time required for the patrol function to be activated is not available or even when activated the apparatus is energized only for a short time and then suspended.

Here an operation when an instruction to shift to shutdown is given by the operator or when the sleep condition is satisfied during the rebuild or patrol operation will be described. The system control unit stops outputting the power supply unit by setting the power supply control signal to L after executing shutdown processing sleep processing so that a power of the system is turned off. However the specific operation in progress signal is set to H during the rebuild or patrol operation. Accordingly the power supply control signal as an output of the wired OR circuit becomes H and the supply of power power to the HDD unit by the power supply unit is continued.

At the time when the rebuild or patrol is completed the specific operation in progress signal shifts to L and the power supply control signal also becomes L . As a result the supply of power power to the HDD unit by the power supply unit is stopped. At this time a power power supply of the entire apparatus is stopped. The system control CPU is mounted in the system control unit . The system control unit is required to control the scanner unit the printer unit the operation unit and the image processing units and as illustrated in and consumes power of several tens of watts. During the shift condition to the shutdown or sleep operations of the scanner unit the printer unit the operation unit the image processing units and and the like become unnecessary. As a result a power supply to the system control unit can be shut off.

However the HDD unit connected to the system control unit is exceptional. The HDD unit while the rebuild operation or the patrol function beyond control of the system control CPU is in progress can complete the operation without shutting off the power. In addition while the rebuild operation or the patrol function is in progress it is possible to shut off the power to the system control unit independently of the HDD unit .

As described above according to the present exemplary embodiment while carrying out power saving by stopping power supply to the system control unit system protection by mirroring can be implemented by performing power supply to the HDD unit while execution of the rebuild or the patrol function is in progress.

Hence even when the rebuild or patrol operation is in progress the system control unit can be shifted to the shutdown or the sleep and power saving can be carried out without causing a failure to the HDD. Further when the system control unit is shifted to the shutdown or the sleep the supply of power to the HDD unit is maintained and as a result of which the system protection by the mirroring can be implemented by completing the rebuild or patrol operation.

In the present exemplary embodiment a rebuild stop command or a patrol stop command from the system control CPU to the mirroring control circuit is prepared. Then the system control CPU issues the above described command to the mirroring control circuit at the time of the shutdown or sleep processing and suspends the rebuild or patrol processing by the mirroring control circuit .

The mirroring control circuit is provided with a storage unit e.g. a flash memory that stores an HDD address on which rebuild or patrol has been processed suspended in response to the command or the like from the system control CPU . Then when the processing of the command is completed and the rebuild or patrol processing is resumed the mirroring control circuit executes the rebuild or patrol operation continued from the suspension based on the HDD address on which the rebuild or patrol has been processed stored in the above described storage unit.

If it is determined that a shutdown request is present YES in step S then in step S the system control CPU executes rebuild patrol stop processing. Then after the rebuild patrol stop processing is completed the processing proceeds to step S. Further if it is determined that the sleep request is present YES in step S then in step S the system control CPU executes the rebuild patrol stop processing. Then after the rebuild patrol stop processing is completed the processing proceeds to step S.

The rebuild patrol stop processing illustrated in steps S and S will be described below. In step S the system control CPU sends a status readout request to the mirroring control circuit and acquires a status of the mirroring control circuit . Then in step S the system control CPU determine whether rebuild is in progress in the mirroring control circuit based on the status acquired in step S. Then if it is determined that the rebuild is in progress in the above described step S YES in step S then in step S the system control CPU sends the rebuild stop command to the mirroring control circuit and terminates the rebuild patrol stop processing.

On the other hand if the system control CPU determines that the rebuild is not in progress in the above described step S NO in step S then in step S the system control CPU determines whether the patrol is in progress in the mirroring control circuit based on the status acquired in step S. Then if it is determined that the patrol is in progress in the above described step S YES in step S then in step S the system control CPU sends the patrol stop command to the mirroring control circuit and terminates the rebuild patrol stop processing. On the other hand if the system control CPU determines that the patrol is not in progress in the above described step S NO in step S the system control CPU directly terminates the rebuild patrol stop processing.

According to the present exemplary embodiment the mirroring control circuit can prevent occurrence of power shutoff to the HDDs and occurrence of failure to the HDDs while the rebuild or patrol is in progress.

The system control CPU while the mirroring control circuit is currently executing rebuild or patrol does not shift to the shutdown or sleep but delays the shutdown or the sleep until the rebuild or the patrol is completed.

If it is determined that a shutdown request is present YES in step S then in step S the system control CPU determines whether rebuild is in progress or patrol is in progress based on a state of the STS signal output from the mirroring control circuit . Then if it is determined that the rebuild or the patrol is in progress the STS signal is H in the above described step S YES in step S then the system control CPU repeats processing in step S until the rebuild or the patrol is completed the STS signal becomes L . On the other hand if the system control CPU determines that the rebuild or the patrol is not in progress the STS signal is L in the above described step S NO in step S then the system control CPU advances the processing to step S.

If it is determined that a sleep request is present YES in step S then in step S the system control CPU determine whether the rebuild or the patrol is in progress based on a state of the STS signal output from the mirroring control circuit . Then if it is determined that the rebuild is in progress or the patrol is in progress the STS signal is H in the above described step S YES in step S then the system control CPU repeats the processing in step S until the rebuild or the patrol is completed the STS signal becomes L . On the other hand if the system control CPU determine that the rebuild or the patrol is not in progress the STS signal is L in the above described step S NO in step S then the system control CPU advances the processing to step S.

According to the present exemplary embodiment the mirroring control circuit can prevent occurrence of power shutoff to the HDDs and occurrence of failure to the HDDs while the rebuild or patrol is in progress.

A timer first time counting unit A is connected to the power supply control unit A. In a mirroring control circuit in a flash memory A can retain information. Further a timer second time counting unit 

The system control CPU according to the present exemplary embodiment performs time designation to the timer A. The timer A notifies the power supply control unit A that the timer A is time designated and the power supply control unit A sets the power supply control signal to low. Accordingly the power supply unit is turned off power supply to the system control unit is stopped .

Further the timer A when the designated time has elapsed notifies accordingly the power supply control unit A and the power supply control unit A sets the power supply control signal to low. Consequently the power supply unit is turned off power supply to the HDD unit is stopped .

The timer A and the power supply control unit A are operated with an all night power source not illustrated . For this reason the timer A and the power supply control unit A can be operated even when the power supply unit and the power supply unit are turned off. If an AC power is turned off power supply to the timer A and the power supply control unit A is also shut off.

A configuration example of an MFP in which a circuit illustrated in is mounted is similar to . In other words since the relation between and is similar to a relation between and descriptions thereof will not be repeated. The mirroring control circuit can receive commands from the system control CPU via the ATA signal line . The mirroring control circuit according to the present exemplary embodiment can receive expanded commands which are vendor uniquely set up in addition to the normal ATA command.

The expanded commands sent from the system control unit are interpreted only within the mirroring control circuit . In other words the expanded commands sent from the system control unit are not notified to the HDDs and via the ATA signal lines and . The expanded commands will be given below.

The rebuild extension time is data designated in seconds and rebuild will be completed after the lapse of a number of seconds designated here. The availability of automatic rebuild is data for setting whether rebuild is to be automatically executed. The availability of verification at the time of rebuild is data for setting whether verification is to be executed at the time of rebuild. The rebuild execution range is data for setting whether rebuild is to be executed for the entire HDD or rebuild is to be executed for only a specific range. The front sector size of region A is data for setting a range which has been set to a rebuild execution range.

The patrol extension time is data designated in seconds and the patrol will be completed after the lapse of a number of seconds designated here. The mirroring control circuit will set the designated patrol extension time for the timer A. The start condition is data indicating the start condition of patrol. The patrol execution range is data for setting whether patrol is to be executed for the entire HDD or patrol is to be executed for only a specific range. The front sector size of region A is data for setting a range which has been set for the patrol execution range.

Though not illustrated also in the present exemplary embodiment the system control CPU can send a request for status readout to the mirroring control circuit and can acquire status information of the mirroring control circuit . In response to the request for status readout from the system control CPU if the rebuild is in progress or the patrol is in progress the mirroring control circuit sends the status information to the system control CPU via the HDD controller . The rebuild operation is similar to that in the first exemplary embodiment. However in the first exemplary embodiment the specific operation in progress signal in is set to H while the rebuild is in progress and becomes L when the rebuild is completed. In contrast to this in the present exemplary embodiment since the specific operation in progress signal line is not provided the rebuild does not operate in the above described manner.

The patrol function is similar to that in the first exemplary embodiment. However in the first exemplary embodiment the specific operation in progress signal in is set to H while the patrol is in progress and becomes L when the patrol is completed. In contrast to this in the present exemplary embodiment since the specific operation in progress signal line is not provided the patrol does not operate in the above described manner.

The mirroring control circuit stores in a flash memory A the HDD address on which the rebuild or patrol has been processed suspended in response to a command or the like from the system control CPU . Then the mirroring control circuit when resuming a next operation executes the rebuild or patrol continued from the suspension based on the HDD address stored in the flash memory A.

When a system is normally operating H as a power supply control signal is output from the power supply control unit and H is input to the power supply unit . Accordingly the power is supplied to the system control unit A. Further the timer A is not set up during a normal operation and H is input to the power supply unit as a power supply control signal from the power supply control unit A and the power supply unit supplies the power to the HDD unit . In this state when the HDD fails and is replaced the mirroring control circuit A starts the rebuild operation in accordance with the rebuild condition. In order to complete the rebuild about 30 minutes is required if an 80 GB HDD is assumed.

An operation when a shift to the sleep is instructed by an operator during the rebuild operation will be described. A number of times that power supply can be turned off on until an HDD breaks down is specified to each HDD and thus turning a power off on too frequently will lead to a shorter lifetime of the HDD. Therefore recently there is mounted a mechanism for energizing the HDD for a half hour or around one hour even after the sleep processing has been executed. If resuming from sleep processing becomes necessary during this period of time resuming from sleep is available without turning a power of the HDD off on and thus a lifetime of the HDD can be elongated. This kind of system is also used in the present exemplary embodiment.

First the system control CPU when determining to shift to the sleep acquires how much longer must we wait before stopping power supply from the power supply unit power shutoff time . In the present exemplary embodiment the power shutoff time is to be set in advance and is to be stored in the ROM . Next the system control CPU sends a time shorter by a power shutoff preparatory time than the power shutoff time as the rebuild extension time or patrol extension time to the mirroring control circuit in response to the expanded command SETUP REBUILD or SETUP PATROL . The Power shutoff preparatory time corresponds to a length of time during which power shutoff preparatory processing is executed by the HDD unit which is set in advance and stored in the ROM . The power shutoff preparatory processing includes suspending the rebuild or patrol saving up to which sector the rebuild or patrol has been executed in the flash memory A solving cache and issuing a standby command or the like and preparing for stopping of power supply.

After that the system control unit sets up a power shutoff time to the timer A. Then the timer A notifies the power supply control unit A that the power shutoff time has been set up for the timer A. The power supply control unit A upon receiving notification that the power shutoff time has been set up from the timer A sets the power supply control signal to L thereby stopping the power supply unit from outputting power. As a result a power of the system control unit is turned off. Further the power supply control unit A does not set the power supply control signal to L keeps it as H after a power shutoff time has been designated to the timer A until the timer A counts the lapse of the power shutoff time. For this reason an output of the power supply unit is continued until the power shutoff time has elapsed and power continues to be supplied to the HDD unit .

In addition the mirroring control circuit which receives the rebuild extension time or patrol extension time saves the rebuild extension time or patrol extension time in the flash memory A and sets up the rebuild extension time or patrol extension time for the timer A. Accordingly the timer A starts time counting of the rebuild extension time or patrol extension time .

The mirroring control circuit when the timer A counts the lapse of the designated time executes the above described power shutoff preparatory processing. After that the power shutoff time has elapsed and the timer A counts the lapse of the designated time. At this time the power supply control unit A sets the power supply control signal to L and power supply from the power supply unit to the HDD unit is stopped. The above described power shutoff preparatory processing has been performed before power shutoff so that failure may not occur in the HDDs HDD and HDD .

If it is determined that a shutdown request is present YES in step S then in step S the system control CPU executes the rebuild patrol extension processing. Then after the rebuild patrol extension processing is completed the processing proceeds to step S. Further if it is determined that asleep request is present YES in step S then instep S the system control CPU executes the rebuild patrol extension processing. Then after the rebuild patrol extension processing is completed the processing proceeds to step S. Then in step S after an access stop to the HDD steps S or S the system control CPU sets the power shutoff time for the timer A and terminates the processing of the flowchart.

The rebuild patrol extension processing illustrated in steps S and S will be described below. In step S the system control CPU sends a request for status readout to the mirroring control circuit and acquires a status of the mirroring control circuit . Then in step S the system control CPU determines whether rebuild is in progress in the mirroring control circuit based on the status acquired in step S. Then if it is determined that the rebuild is in progress in the above described step S YES in step S the system control CPU advances the processing to step S. In step S the system control CPU sends a rebuild extension time to the mirroring control circuit according to the SETUP REBUILD command and terminates the rebuild patrol extension processing. The rebuild extension time is set to be a time shorter by the power shutoff preparatory time than the power shutoff time.

On the other hand if it is determined that the rebuild is not in progress in the above described step S NO in step S the system control CPU advances the processing to step S. In step S the system control CPU determines whether the patrol is in progress. Then if it is determined that the patrol is in progress in the above described step S YES in step S then in step S the system control CPU sends a patrol extension time to the mirroring control circuit in response to the SETUP PATROL command and terminates the rebuild patrol extension processing. The patrol extension time is set to a time shorter by the power shutoff preparatory time than the power shutoff time. On the other hand if determining that the patrol is not in progress in the above described step S NO in step S the system control CPU directly terminates the rebuild patrol extension processing.

In the present exemplary embodiment such a configuration is illustrated that the system control CPU when shifting to the sleep or shutdown sends a rebuild or patrol extension time to the mirroring control circuit and causes the timer A to count time. However the system control CPU may send in advance the rebuild or patrol extension time to the mirroring control circuit to be stored in the flash memory A and may send a command which serves as a trigger for the sleep or shutdown. In this case the mirroring control circuit when acquiring a command which serves as a trigger for the sleep or the like from the system control CPU causes the timer A to start time counting of the above described rebuild or patrol extension time.

In the present exemplary embodiment a configuration has been illustrated in which the system control CPU shifts to the sleep or shutdown sends the rebuild or patrol extension time to the mirroring control circuit and causes the timer A to count time. However the system control CPU may send in advance the rebuild or patrol extension time to the mirroring control circuit to be stored in the flash memory A and may send a command which serves as a trigger for the sleep or shutdown to the mirroring control circuit . In this case the mirroring control circuit when acquiring a command which serves as a trigger for the sleep or the like from the system control CPU causes the timer A to start time counting of the above described rebuild or patrol extension time.

In the present exemplary embodiment sending a time shorter by the power shutoff preparatory time than the power shutoff time as the rebuild or patrol extension time to the mirroring control circuit has been described. However the power shutoff time may be sent as the rebuild or patrol extension time to the mirroring control circuit . In this case in the mirroring control circuit a time shorter by the power shutoff preparatory time than the power shutoff time is set for the timer A. In other words in the mirroring control circuit as long as a time shorter by the power shutoff preparatory time than the power shutoff time is measured any configuration may be used.

In a status of the mirroring control circuit is acquired and the rebuild extension time if the rebuild is in progress or the patrol extension time if the patrol is in progress is sent to the mirroring control circuit . However the status of the mirroring control circuit may not be acquired and both the rebuild extension time and the patrol extension time may be sent to the mirroring control circuit . In this case the mirroring control circuit uses the rebuild extension time if the rebuild is in progress or the patrol extension time if the patrol is in progress.

Further in the present exemplary embodiment the rebuild extension time is sent in response to the SETUP REBUILD command and the patrol extension time is sent in response to the SETUP PATROL command. However one expanded command may be sent as an extension time by eliminating distinction between the rebuild extension time and the patrol extension time. In this case the mirroring control circuit is configured to set the extension time for the timer A and after measurement of the extension time to execute power shutoff preparatory processing.

As described above according to the present exemplary embodiment while carrying out power saving by stopping power supply to the system control unit system protection can be implemented by the mirroring in which power supply to the HDD unit is performed when execution of the rebuild or the patrol function is in progress. Further according to the present exemplary embodiment even when the mirroring control circuit enters into the sleep mode while the rebuild is in progress the rebuild operation can be continued for a length of the rebuild extension time or patrol extension time .

As described above in the exemplary embodiments of the present invention at the time of the rebuild or the patrol operation in the mirroring system it becomes possible to shut down a power of the system control unit independently of the mirroring system. Accordingly at the time of the sleep or shutdown the power can be kept shutdown except the mirroring system that is in the process of operating. Further even when it should be absolutely necessary to shut off the power after a given time due to a power outage or the like it is also possible to suspend the rebuild or the patrol operation within the designated time.

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU a micro processing unit MPU and or the like that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiment s and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiment s . For this purpose the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device e.g. a computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims priority from Japanese Patent Application No. 2009 232508 filed Oct. 6 2009 which is hereby incorporated by reference herein in its entirety.

