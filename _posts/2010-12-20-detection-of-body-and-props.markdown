---

title: Detection of body and props
abstract: A system and method for detecting and tracking targets including body parts and props is described. In one aspect, the disclosed technology acquires one or more depth images, generates one or more classification maps associated with one or more body parts and one or more props, tracks the one or more body parts using a skeletal tracking system, tracks the one or more props using a prop tracking system, and reports metrics regarding the one or more body parts and the one or more props. In some embodiments, feedback may occur between the skeletal tracking system and the prop tracking system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08660303&OS=08660303&RS=08660303
owner: Microsoft Corporation
number: 08660303
owner_city: Redmond
owner_country: US
publication_date: 20101220
---
The present application claims priority to U.S. patent application Ser. No. 12 454 628 entitled Human Body Pose Estimation filed May 20 2009 which claims priority to Provisional Patent Application No. 61 174 878 entitled Human Body Pose Estimation filed May 1 2009. Each of the aforementioned applications is herein incorporated by reference in its entirety.

In a typical computing environment users of a computing application such as a multimedia application or a computer game use an input device to control aspects of the computing application. Common input devices used to control a computing application include a controller keyboard joystick remote mouse or the like. More recently computing applications have begun employing cameras and gesture recognition software to provide a natural user interface. With a natural user interface a user s body parts and movements may be detected interpreted and used to control game characters or other aspects of a computing application.

Technology is described for detecting analyzing and tracking targets including body parts and props. In one embodiment a natural user interface system includes a target detection and tracking system. In one embodiment the target detection and tracking system includes a target proposal system and a target tracking system. The target proposal system identifies one or more candidate body parts and one or more candidate prop locations within a particular field of view. In one example the target proposal system assigns to one or more pixels in a particular depth image a probability of belonging to one or more candidate body parts and or props. Because the target proposal system may produce many false positives the target tracking system is used to reconcile the one or more candidate body parts and or props and output correctly identified body parts and or props.

In one embodiment the disclosed technology acquires one or more depth images generates one or more classification maps associated with one or more body parts and one or more props tracks the one or more body parts using a skeletal tracking system tracks the one or more props using a prop tracking system and reports metrics regarding the one or more body parts and the one or more props. In some embodiments feedback may occur between the skeletal tracking system and the prop tracking system.

In some embodiments the physical movements of one or more game players holding one or more props e.g. gaming props such as a plastic toy sword or guitar are tracked and interpreted as real time user controls that adjust and or control parts of an electronic game. For example a game player holding a real tennis racquet or similar physical object while playing a virtual tennis game may control in real time a virtual racquet in game space.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

Technology is described for detecting analyzing and tracking targets including body parts and props. In one embodiment a natural user interface system includes a target detection and tracking system. In one embodiment the target detection and tracking system includes a target proposal system and a target tracking system. The target proposal system identifies one or more candidate body parts and one or more candidate prop locations within a particular field of view. In one example the target proposal system assigns to one or more pixels in a particular depth image a probability of belonging to one or more candidate body parts and or props. Because the target proposal system may produce many false positives the target tracking system is used to reconcile the one or more candidate body parts and or props and output correctly identified body parts and or props.

As shown in the target detection and tracking system may include a computing environment . The computing environment may include a computer a gaming system or console or the like. In one embodiment the computing environment may include hardware components and or software components such that the computing environment may be used to execute an operating system and applications such as gaming applications non gaming applications or the like. In one embodiment computing system may include a processor such as a standardized processor a specialized processor a microprocessor or the like that may execute instructions stored on a processor readable storage device for performing the processes described herein.

As shown in the target detection and tracking system may further include a capture device . In one embodiment capture device may include a camera that may be used to visually monitor one or more targets including one or more users such as the user . Gestures including poses performed by the one or more users may be captured analyzed and tracked to perform one or more controls or actions for the user interface of an operating system or application.

Through moving his or her body a user may create gestures. A gesture may comprise a motion or pose by a user that may be captured as image data and parsed for meaning. A gesture may be dynamic comprising a motion such as mimicking throwing a ball. A gesture may be a static pose such as holding one s forearms crossed. A gesture may also incorporate props such as swinging a mock sword.

In one embodiment capture device may capture image and audio data relating to one or more users and or objects. For example capture device may be used to capture information relating to partial or full body movements gestures and speech of one or more users. The information captured by capture device may be received by computing environment and or a processing element within capture device and used to render interact with and control aspects of a gaming or other application. In one example capture device captures image and audio data relating to a particular user and computing environment processes the captured information to identify the particular user by executing facial and voice recognition software.

In one embodiment the target detection and tracking system may be connected to an audiovisual device such as a television a monitor a high definition television HDTV or the like that may provide game or application visuals and or audio to a user such as user . For example the computing environment may include a video adapter such as a graphics card and or an audio adapter such as a sound card that may provide audiovisual signals associated with the game application non game application or the like. The audiovisual device may receive the audiovisual signals from the computing environment and may output the game or application visuals and or audio associated with the audiovisual signals to the user . In one embodiment the audiovisual device may be connected to the computing environment via for example an S Video cable a coaxial cable an HDMI cable a DVI cable a VGA cable or the like.

As shown in the application executing on the computing environment may be a boxing game that the user may be playing. The computing environment may use the audiovisual device to provide a visual representation of a boxing opponent to the user . The computing environment may also use the audiovisual device to provide a visual representation of a player avatar that the user may control with his or her movements. For example as shown in the user may throw a punch in physical space to cause the player avatar to throw a punch in game space. In one embodiment the computer environment and the capture device of the target detection and tracking system may be used to recognize and analyze the punch of the user in physical space such that the punch may be interpreted as a game control of the player avatar in game space.

In one embodiment a user s movements may be interpreted as controls that may correspond to actions other than controlling the player avatar . For example a user may use movements to end a game pause a game save a game select a level view high scores communicate with a friend etc. In another embodiment target detection and tracking system interprets a target s movements as operating system and or application controls that are outside the realm of games. For example virtually any controllable aspect of an operating system and or application may be controlled by movements of the target such as the user . In another embodiment the user may use movements to select the game or other application from a main user interface. A full range of motion of the user may be available used and analyzed in any suitable manner to interact with an application or operating system.

As shown in a human target such as the user may hold an object such as racket . In one embodiment the user can hold an object such as a prop when interacting with an application. In such embodiments the movement of both the person and the object may be used to control an application. For example the motion of a player holding racket may be tracked and used for controlling an on screen ball in an application which simulates a tennis game. In another embodiment the motion of a player holding a toy weapon such as a plastic sword may be tracked and used for controlling a corresponding weapon in an electronic combat game. In some embodiments other objects may also be tracked including one or more gloves balls bats clubs guitars microphones sticks pets animals drums and the like. The objects being tracked may closely map to a particular game or application e.g. a real tennis racquet used in a virtual tennis game or may be a more abstract representation e.g. a torch or flash light representing a light saber .

In some embodiments one or more objects being tracked by target detection and tracking system may be active objects. Active objects may include one or more sensors to provide information to target detection and tracking system such as acceleration or orientation information. In contrast passive objects do not provide additional information to the target detection and tracking system . The ability to combine visual tracking information with real time position acceleration and or orientation information from an active object may allow target detection and tracking system to improve its target tracking capability especially when a capture device is capturing high speed movements where motion blur may be an issue e.g. the swinging of a baseball bat . In one embodiment a gaming prop includes an accelerometer a magnetometer and a gyroscope and transmits acceleration magnetic field and orientation information to a target detection and tracking system.

In some embodiments one or more objects being tracked by target detection and tracking system may be passive objects. In one embodiment a passive object may be augmented with one or more markers such as an IR retroreflective marker to improve object detection and tracking. In another embodiment passive and active gaming props may be augmented with one or more IR retroreflective markers.

Suitable examples of a target detection and tracking system and components thereof are found in the following co pending patent applications all of which are herein incorporated by reference U.S. patent application Ser. No. 12 475 094 entitled Environment And Or Target Segmentation filed May 29 2009 U.S. patent application Ser. No. 12 511 850 entitled Auto Generating a Visual Representation filed Jul. 29 2009 U.S. patent application Ser. No. 12 474 655 entitled Gesture Tool filed May 29 2009 U.S. patent application Ser. No. 12 603 437 entitled Pose Tracking Pipeline filed Oct. 21 2009 U.S. patent application Ser. No. 12 475 308 entitled Device for Identifying and Tracking Multiple Humans Over Time filed May 29 2009 U.S. patent application Ser. No. 12 575 388 entitled Human Tracking System filed Oct. 7 2009 U.S. patent application Ser. No. 12 422 661 entitled Gesture Recognizer System Architecture filed Apr. 13 2009 U.S. patent application Ser. No. 12 391 150 entitled Standard Gestures filed Feb. 23 2009 and U.S. patent application Ser. No. 12 474 655 entitled Gesture Tool filed May 29 2009.

As shown in the capture device may include an image camera component . In one embodiment the image camera component may be a depth camera that may capture a depth image of a scene. The depth image may include a two dimensional 2 D pixel area of the captured scene where each pixel in the 2 D pixel area may represent a depth value such as a distance in for example centimeters millimeters or the like of an object in the captured scene from the camera.

As shown in the image camera component may include an IR light component a three dimensional 3 D camera and an RGB camera that may be used to capture the depth image of a capture area. For example in time of flight analysis the IR light component of the capture device may emit an infrared light onto the capture area and may then use sensors to detect the backscattered light from the surface of one or more targets and objects in the capture area using for example the 3 D camera and or the RGB camera . In some embodiment capture device may include an IR CMOS image sensor. In some embodiments pulsed infrared light may be used such that the time between an outgoing light pulse and a corresponding incoming light pulse may be measured and used to determine a physical distance from the capture device to a particular location on the targets or objects in the capture area. Additionally the phase of the outgoing light wave may be compared to the phase of the incoming light wave to determine a phase shift. The phase shift may then be used to determine a physical distance from the capture device to a particular location on the targets or objects.

In one embodiment time of flight analysis may be used to indirectly determine a physical distance from the capture device to a particular location on the targets or objects by analyzing the intensity of the reflected beam of light over time via various techniques including for example shuttered light pulse imaging.

In another example the capture device may use structured light to capture depth information. In such an analysis patterned light i.e. light displayed as a known pattern such as grid pattern or a stripe pattern may be projected onto the capture area via for example the IR light component . Upon striking the surface of one or more targets or objects in the capture area the pattern may become deformed in response. Such a deformation of the pattern may be captured by for example the 3 D camera and or the RGB camera and analyzed to determine a physical distance from the capture device to a particular location on the targets or objects.

In some embodiments two or more different cameras may be incorporated into an integrated capture device. For example a depth camera and a video camera e.g. an RGB video camera may be incorporated into a common capture device. In some embodiments two or more separate capture devices may be cooperatively used. For example a depth camera and a separate video camera may be used. When a video camera is used it may be used to provide target tracking data confirmation data for error correction of target tracking image capture face recognition high precision tracking of fingers or other small features light sensing and or other functions.

In one embodiment the capture device may include two or more physically separated cameras that may view a capture area from different angles to obtain visual stereo data that may be resolved to generate depth information. Depth may also be determined by capturing images using a plurality of detectors that may be monochromatic infrared RGB or any other type of detector and performing a parallax calculation. Other types of depth image sensors can also be used to create a depth image.

As shown in capture device may include a microphone . The microphone may include a transducer or sensor that may receive and convert sound into an electrical signal. In one embodiment the microphone may be used to reduce feedback between the capture device and the computing environment in the target detection and tracking system . Additionally the microphone may be used to receive audio signals that may also be provided by the user to control applications such as game applications non game applications or the like that may be executed by the computing environment .

In one embodiment the capture device may include a processor that may be in operative communication with the image camera component . The processor may include a standardized processor a specialized processor a microprocessor or the like. The processor may execute instructions that may include instructions for storing profiles receiving the depth image determining whether a suitable target may be included in the depth image converting the suitable target into a skeletal representation or model of the target or any other suitable instructions.

It is to be understood that at least some target analysis and tracking operations may be executed by processors contained within one or more capture devices. A capture device may include one or more onboard processing units configured to perform one or more target analysis and or tracking functions. Moreover a capture device may include firmware to facilitate updating such onboard processing logic.

As shown in the capture device may include a memory component that may store the instructions that may be executed by the processor images or frames of images captured by the 3 D camera or RGB camera user profiles or any other suitable information images or the like. In one example the memory component may include random access memory RAM read only memory ROM cache Flash memory a hard disk or any other suitable storage component. As shown in the memory component may be a separate component in communication with the image capture component and the processor . In another embodiment the memory component may be integrated into the processor and or the image capture component . In one embodiment some or all of the components and of the capture device illustrated in are housed in a single housing.

As shown in the capture device may be in communication with the computing environment via a communication link . The communication link may be a wired connection including for example a USB connection a Firewire connection an Ethernet cable connection or the like and or a wireless connection such as a wireless 802.11b g a or n connection. The computing environment may provide a clock to the capture device that may be used to determine when to capture for example a scene via the communication link .

In one embodiment the capture device may provide the depth information and images captured by for example the 3 D camera and or the RGB camera to the computing environment via the communication link . The computing environment may then use the depth information and captured images to for example create a virtual screen adapt the user interface and control an application such as a game or word processor.

As shown in computing environment includes gestures library structure data gesture recognition engine depth image processing and object reporting module and operating system . Depth image processing and object reporting module uses the depth images to track the motion of objects such as the user and other objects. To assist in the tracking of the objects depth image processing and object reporting module uses gestures library structure data and gesture recognition engine .

In one example structure data includes structural information about objects that may be tracked. For example a skeletal model of a human may be stored to help understand movements of the user and recognize body parts. In another example structural information about inanimate objects such as props may also be stored to help recognize those objects and help understand movement.

In one example gestures library may include a collection of gesture filters each comprising information concerning a gesture that may be performed by the skeletal model. A gesture recognition engine may compare the data captured by capture device in the form of the skeletal model and movements associated with it to the gesture filters in the gesture library to identify when a user as represented by the skeletal model has performed one or more gestures. Those gestures may be associated with various controls of an application. Thus the computing environment may use the gesture recognition engine to interpret movements of the skeletal model and to control operating system or an application based on the movements.

In one embodiment depth image processing and object reporting module will report to operating system an identification of each object detected and the position and or orientation of the object for each frame. Operating system will use that information to update the position or movement of an object e.g. an avatar or other images in the display or to perform an action on the provided user interface.

More information about gesture recognizer engine can be found in U.S. patent application Ser. No. 12 422 661 Gesture Recognizer System Architecture filed on Apr. 13 2009 incorporated herein by reference in its entirety. More information about recognizing gestures can be found in U.S. patent application Ser. No. 12 391 150 Standard Gestures filed on Feb. 23 2009 and U.S. patent application Ser. No. 12 474 655 Gesture Tool filed on May 29 2009 both of which are incorporated by reference herein in their entirety. More information about motion detection and tracking can be found in U.S. patent application Ser. No. 12 641 788 Motion Detection Using Depth Images filed on Dec. 18 2009 and U.S. patent application Ser. No. 12 475 308 Device for Identifying and Tracking Multiple Humans over Time both of which are incorporated herein by reference in their entirety.

Referring back to in one embodiment upon receiving the depth image the depth image may be downsampled to a lower processing resolution such that the depth image may be more easily used and or more quickly processed with less computing overhead. Additionally one or more high variance and or noisy depth values may be removed and or smoothed from the depth image and portions of missing and or removed depth information may be filled in and or reconstructed. In one embodiment a depth image such as depth image may be downsampled as used in combination with an image from an RGB camera such as camera or an image captured by any other detector in order to determine the shape and size of a target.

A graphics processing unit GPU and a video encoder video codec coder decoder form a video processing pipeline for high speed and high resolution graphics processing. Data is carried from the graphics processing unit to the video encoder video codec via a bus. The video processing pipeline outputs data to an A V audio video port for transmission to a television or other display. A memory controller is connected to the GPU to facilitate processor access to various types of memory such as but not limited to a RAM Random Access Memory .

The multimedia console includes an I O controller a system management controller an audio processing unit a network interface controller a first USB host controller a second USB controller and a front panel I O subassembly that are preferably implemented on a module . The USB controllers and serve as hosts for peripheral controllers a wireless adapter and an external memory device e.g. flash memory external CD DVD ROM drive removable media etc. . The network interface and or wireless adapter provide access to a network e.g. the Internet home network etc. and may be any of a wide variety of various wired or wireless adapter components including an Ethernet card a modem a Bluetooth module a cable modem and the like.

System memory is provided to store application data that is loaded during the boot process. A media drive is provided and may comprise a DVD CD drive hard drive or other removable media drive etc. The media drive may be internal or external to the multimedia console . Application data may be accessed via the media drive for execution playback etc. by the multimedia console . The media drive is connected to the I O controller via a bus such as a Serial ATA bus or other high speed connection e.g. IEEE 1394 .

The system management controller provides a variety of service functions related to assuring availability of the multimedia console . The audio processing unit and an audio codec form a corresponding audio processing pipeline with high fidelity and stereo processing. Audio data is carried between the audio processing unit and the audio codec via a communication link. The audio processing pipeline outputs data to the A V port for reproduction by an external audio player or device having audio capabilities.

The front panel I O subassembly supports the functionality of the power button and the eject button as well as any LEDs light emitting diodes or other indicators exposed on the outer surface of the multimedia console . A system power supply module provides power to the components of the multimedia console . A fan cools the circuitry within the multimedia console .

The CPU GPU memory controller and various other components within the multimedia console are interconnected via one or more buses including serial and parallel buses a memory bus a peripheral bus and a processor or local bus using any of a variety of bus architectures. By way of example such architectures can include a Peripheral Component Interconnects PCI bus PCI Express bus etc.

When the multimedia console is powered ON application data may be loaded from the system memory into memory and or caches and executed on the CPU . The application may present a graphical user interface that provides a consistent user experience when navigating to different media types available on the multimedia console . In operation applications and or other media contained within the media drive may be launched or played from the media drive to provide additional functionalities to the multimedia console .

The multimedia console may be operated as a standalone system by simply connecting the system to a television or other display. In this standalone mode the multimedia console allows one or more users to interact with the system watch movies or listen to music. However with the integration of broadband connectivity made available through the network interface or the wireless adapter the multimedia console may further be operated as a participant in a larger network community.

When the multimedia console is powered ON a set amount of hardware resources are reserved for system use by the multimedia console operating system. These resources may include a reservation of memory e.g. 16 MB CPU and GPU cycles e.g. 5 networking bandwidth e.g. 8 kbs etc. Because these resources are reserved at system boot time the reserved resources do not exist from the application s view.

In particular the memory reservation preferably is large enough to contain the launch kernel concurrent system applications and drivers. The CPU reservation is preferably constant such that if the reserved CPU usage is not used by the system applications an idle thread will consume any unused cycles.

With regard to the GPU reservation lightweight messages generated by the system applications e.g. popups are displayed by using a GPU interrupt to schedule code to render popup into an overlay. The amount of memory required for an overlay depends on the overlay area size and the overlay preferably scales with screen resolution. Where a full user interface is used by the concurrent system application it is preferable to use a resolution independent of application resolution. A scaler may be used to set this resolution such that the need to change frequency and cause a TV resynch is eliminated.

After the multimedia console boots and system resources are reserved concurrent system applications execute to provide system functionalities. The system functionalities are encapsulated in a set of system applications that execute within the reserved system resources described above. The operating system kernel identifies threads that are system application threads versus gaming application threads. The system applications are preferably scheduled to run on the CPU at predetermined times and intervals in order to provide a consistent system resource view to the application. The scheduling is to minimize cache disruption for the gaming application running on the console.

When a concurrent system application requires audio audio processing is scheduled asynchronously to the gaming application due to time sensitivity. A multimedia console application manager controls the gaming application audio level e.g. mute attenuate when system applications are active.

Input devices e.g. controllers and are shared by gaming applications and system applications. The input devices are not reserved resources but are to be switched between system applications and the gaming application such that each will have a focus of the device. The application manager preferably controls the switching of input stream without knowledge the gaming application s knowledge and a driver maintains state information regarding focus switches. In some embodiments the capture device of may be an additional input device to multimedia console .

In the computing system comprises a computer which typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer and includes both volatile and nonvolatile media removable and non removable media. The system memory includes computer storage media in the form of volatile and or nonvolatile memory such as read only memory ROM and random access memory RAM . A basic input output system BIOS containing the basic routines that help to transfer information between elements within computer such as during start up is typically stored in ROM . RAM typically contains data and or program modules that are immediately accessible to and or presently being operated on by processing unit . By way of example and not limitation illustrates operating system application programs other program modules and program data .

The computer may also include other removable non removable volatile nonvolatile computer storage media. By way of example illustrates a hard disk drive that reads from or writes to non removable nonvolatile magnetic media a magnetic disk drive that reads from or writes to a removable nonvolatile magnetic disk and an optical disk drive that reads from or writes to a removable nonvolatile optical disk such as a CD ROM or other optical media. Other removable non removable volatile nonvolatile computer storage media that can be used in the exemplary operating environment include but are not limited to magnetic tape cassettes flash memory cards digital versatile disks digital video tape solid state RAM solid state ROM and the like. The hard disk drive is typically connected to the system bus through a non removable memory interface such as interface and magnetic disk drive and optical disk drive are typically connected to the system bus by a removable memory interface such as interface .

The drives and their associated computer storage media discussed above and illustrated in provide storage of computer readable instructions data structures program modules and other data for the computer . In for example hard disk drive is illustrated as storing operating system application programs other program modules and program data . Note that these components can either be the same as or different from operating system application programs other program modules and program data . Operating system application programs other program modules and program data are given different numbers here to illustrate that at a minimum they are different copies. A user may enter commands and information into the computer through input devices such as a keyboard and pointing device commonly referred to as a mouse trackball or touch pad. Other input devices not shown may include a microphone joystick game pad satellite dish scanner or the like. These and other input devices are often connected to the processing unit through a user input interface that is coupled to the system bus but may be connected by other interface and bus structures such as a parallel port game port or a universal serial bus USB . The cameras and capture device of may define additional input devices for the computer . A monitor or other type of display device is also connected to the system bus via an interface such as a video interface . In addition to the monitor computers may also include other peripheral output devices such as speakers and printer which may be connected through a output peripheral interface .

The computer may operate in a networked environment using logical connections to one or more remote computers such as a remote computer . The remote computer may be a personal computer a server a router a network PC a peer device or other common network node and typically includes many or all of the elements described above relative to the computer although only a memory storage device has been illustrated in . The logical connections depicted in include a local area network LAN and a wide area network WAN but may also include other networks. Such networking environments are commonplace in offices enterprise wide computer networks intranets and the Internet.

When used in a LAN networking environment the computer is connected to the LAN through a network interface or adapter . When used in a WAN networking environment the computer typically includes a modem or other means for establishing communications over the WAN such as the Internet. The modem which may be internal or external may be connected to the system bus via the user input interface or other appropriate mechanism. In a networked environment program modules depicted relative to the computer or portions thereof may be stored in the remote memory storage device. By way of example and not limitation illustrates remote application programs as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.

In one embodiment computing system may be configured to represent each target with a model. As described in more detail below information derived from such a model can be compared to information obtained from a capture device such as a depth camera so that the fundamental proportions or shape of the model as well as its current pose can be adjusted to more accurately represent the modeled target. The model may be represented by one or more polygonal meshes by a set of mathematical primitives and or via other suitable machine representations of the modeled target.

The process of may be performed by one or more computing devices. Each step in the process of may be performed by the same or different computing devices as those used in other steps and each step need not necessarily be performed by a single computing device. In one embodiment the process of is performed by a computing environment such as computing environment in .

In step one or more depth images are acquired from a source such as capture device in . In some embodiments the source may be a depth camera configured to obtain depth information about the target via a suitable technique such as time of flight analysis structured light analysis stereo vision analysis or other suitable techniques. In one embodiment an acquired depth image may include a plurality of observed pixels where each observed pixel has one or more observed depth values including depth information of the target as viewed from the source. The acquired depth image may optionally be represented as a pixel matrix that includes for each pixel address a depth value indicating a world space depth from the plane of the depth camera or another suitable reference plane to a surface at that pixel address. In one embodiment the acquired depth image may be downsampled into a lower resolution image. In another embodiment the acquired depth image may be filtered to remove and or sooth one or more high variance and or noisy depth values. Such high variance and or noisy depth values in the acquired depth image may result from a number of different sources such as random and or systematic errors occurring during the image capturing process defects and or aberrations resulting from the capture device etc.

In step the one or more acquired depth images may be processed to distinguish foreground targets that are to be tracked from non target objects or other background elements. As used herein the term background is used to describe anything in an image that is not part of the one or more targets to be tracked. The background may include elements that are in front of i.e. closer to the depth camera than the one or more targets to be tracked. Distinguishing foreground elements that are to be tracked from background elements that may be ignored may increase tracking efficiency and or simplify downstream processing.

In one embodiment each data point e.g. pixel of the acquired depth image may be assigned a segmentation value or index that identifies that particular data point as belonging to a foreground element or to a non target background element. Segmentation values may represent a discrete index value or a fuzzy index value indicating a probability that a pixel belongs to a particular target and or background element. In one example different segmentation values may be assigned to each of the one or more targets included within the foreground image. For example pixels corresponding to a first game player can be assigned a player index equal to one pixels corresponding to a second player can be assigned a player index equal to two and pixels that do not correspond to a target player can be assigned a background index equal to zero. In another embodiment pixels or other data points assigned a background index can be removed from consideration in one or more subsequent processing steps. In some embodiments the process step of distinguishing foreground pixels from background pixels is omitted.

In step foreground pixel assignment is performed. Foreground pixel assignment includes analyzing one or more foreground pixels to determine which of the one or more targets including body parts and props is likely to be associated with the one or more foreground pixels. A variety of different foreground pixel assignment techniques can be used to assess which of the one or more targets or a machine representation of the one or more targets a particular pixel is likely to belong. In one embodiment both depth information and color information are used in determining which probabilities to assign to a particular foreground pixel or group of pixels.

In one embodiment machine learning can be used to assign each foreground pixel a target index and or target probability distribution. The machine learning approach analyzes a foreground object using information learned from analyzing a prior trained collection of known poses e.g. a training set of segmented images . In one example a stateless approach can be used to assign each foreground pixel a target index or distribution without any prior context i.e. knowledge of a prior frame is not needed . In some embodiments the machine learning approach to foreground pixel assignment may utilize one or more decision trees to analyze each foreground pixel of interest in an acquired depth image. Such analysis can determine a best guess of the target assignment for that pixel and the confidence that the best guess is correct.

In some embodiments the best guess may include a probability distribution over two or more possible targets and the confidence may be represented by the relative probabilities of the different possible targets. At each node of a decision tree an observed depth value comparison between two pixels is made and depending on the result of the comparison a subsequent depth value comparison between two pixels is made at the child node of the decision tree. The result of such comparisons at each node determines the pixels that are to be compared at the next node. The terminal nodes of each decision tree results in a target classification and associated confidence in the classification.

In some embodiments subsequent decision trees may be used to iteratively refine the best guess of the one or more target assignments for each pixel and the confidence that the best guess is correct. For example once the pixels have been classified with the first classifier tree based on neighboring depth values a refining classification may be performed to classify each pixel by using a second decision tree that looks at the previous classified pixels and or depth values. A third pass may also be used to further refine the classification of the current pixel by looking at the previous classified pixels and or depth values. It is to be understood that virtually any number of iterations may be performed with fewer iterations resulting in less computational expense and more iterations potentially offering more accurate classifications and or confidences.

In some embodiments the decision trees may be constructed during a training mode in which a sample of known models in known poses e.g. a training set of segmented images are analyzed to determine the questions i.e. tests that can be asked at each node of the decision trees in order to produce accurate pixel classifications.

In one embodiment foreground pixel assignment is stateless meaning that the pixel assignments are made without reference to prior states or prior image frames . One example of a stateless process for assigning probabilities that a particular pixel or group of pixels represents one or more objects is the Exemplar process. The Exemplar process uses a machine learning approach that takes a depth image and classifies each pixel by assigning to each pixel a probability distribution over the one or more objects to which it could correspond. For example a given pixel which is in fact a tennis racquet may be assigned a 70 chance that it belongs to a tennis racquet a 20 chance that it belongs to a ping pong paddle and a 10 chance that it belongs to a right arm. The Exemplar process may input millions of pre classified training samples e.g. segmented images learn the relationships between sets of pixels within the pre classified training samples and generate a segmented image based on a particular depth image. In one example the Exemplar process may produce a classification map in which pixels are classified with a probability of belonging to a particular object such as a body part or prop. The Exemplar process is further described in U.S. patent application Ser. No. 12 454 628 entitled Human Body Pose Estimation which application is herein incorporated by reference in its entirety.

In another embodiment the Exemplar process and centroid generation are used for generating probabilities as to the proper identification of particular objects such as body parts and or props. Centroids may have an associated probability that a captured object is correctly identified as a given object such as a hand face or prop. In one embodiment centroids are generated for a user s head shoulders elbows wrists and hands. The Exemplar process and centroid generation are further described in U.S. patent application Ser. No. 12 825 657 entitled Skeletal Joint Recognition and Tracking System and in U.S. patent application Ser. No. 12 770 394 entitled Multiple Centroid Condensation of Probability Distribution Clouds. Each of the aforementioned applications is herein incorporated by reference in its entirety.

In step one or more classification maps are generated. As shown in step may receive input from steps and . In one embodiment a first classification map is generated corresponding with body part targets and a second classification map is generated corresponding with prop targets. In another embodiment a unified classification map is generated covering a plurality of targets the plurality of targets includes both body part targets and prop targets. In one example of an approach for generating a unified classification map a training set provided to a machine learning technique for implementing step comprises segmented images including one or more body parts and one or more props. In one example each pixel in a segmented image is identified as either a body part an object or background.

In a classification map is generated from a depth image for body part targets. In one embodiment the classification map of step may be generated using the probability assignments of step whereby foreground pixels are assigned probabilities of belonging to one or more body part targets. In step body parts may be identified from the classification map generated in step . In one embodiment a particular body part is identified if a probability assigned to one or more pixels is greater than 90 that the one or more pixels represent the particular body part. In step the identified body parts are removed from the depth image or a derivative of the depth image . In some embodiments the background may also be removed. In step object recognition is performed on the depth image with the identified body parts removed to identify one or more props. In one embodiment the Exemplar process may be used to perform object recognition. Other suitable object recognition techniques may also be used. In step a classification map for the one or more props is generated based on the results of step . One benefit of performing step using a training set without props followed by an object recognition process is that the object recognition process of step may be more efficient at detecting objects compared with performing step using a training set including props.

In a classification map is generated from a depth image for prop targets. Prop targets may include active props and or passive props. In one embodiment the classification map of step may be generated using the probability assignments of step whereby foreground pixels are assigned probabilities of belonging to one or more prop targets. In step props may be identified from the classification map generated in step . In one embodiment a particular prop is identified if a probability assigned to one or more pixels is greater than 90 that the one or more pixels represent the particular prop. In step the identified props are removed from the depth image or a derivative of the depth image . In some embodiments the background may also be removed. In one embodiment the pixels associated with one or more removed props are assigned a don t care value. The don t care value may be used by subsequent processing steps to ignore the depth information associated with the removed pixels. This information may be helpful to subsequent classification steps because the removed pixels may have been associated with one or more props that may have been in front of body parts i.e. the body parts being recognized or classified in a subsequent processing step may have been occluded by one or more props . In step object recognition is performed on the depth image with the identified props removed to identify one or more body parts. In one embodiment the Exemplar process may be used to perform object recognition. In one example steps and may be used with a new training set including segmented images of body parts. Other suitable object recognition techniques may also be used. In step a classification map for the one or more body parts is generated based on the results of step .

Referring back to in step model resolution and tracking is performed. In one embodiment model resolution and tracking includes model fitting skeletal tracking and prop tracking . In one embodiment model resolution and tracking may receive one or more classification maps the one or more classification maps based on one or more raw depth images from step foreground background information from step and foreground pixel probability assignments from step .

In one embodiment model fitting is used to fit one or more possible computer models onto one or more acquired images and or one or more classification maps. The one or more computer models may comprise machine representations of a modeled target e.g. machine representations of a body part or prop . In some embodiments model fitting involving line plane or more complex geometries may be applied to track an object in three dimensional space. In some examples a model may include one or more data structures that represent a target as a three dimensional model comprising rigid and or deformable shapes or body parts. Each target e.g. a human and or prop or portion of a target may be characterized as a mathematical primitive examples of which include but are not limited to spheres anisotropically scaled spheres cylinders anisotropic cylinders smooth cylinders boxes beveled boxes prisms and the like. In some examples a target may be modeled using a parameterized three dimensional model. In some examples a model may include negative spaces i.e. a space where nothing should be . In one example a steering wheel containing empty spaces is modeled with a three dimensional model including negative spaces associated with the empty spaces. In another example a space at the end of a baseball bat is modeled using a negative space.

In one embodiment during model fitting a human target is modeled as a skeleton including a plurality of skeletal points each skeletal point having a three dimensional location in world space. The various skeletal points may correspond to actual joints of a human target terminal ends of a human target s extremities and or points without a direct anatomical link to the human target. Each skeletal point has at least three degrees of freedom e.g. world space x y z . In one example a skeleton with 31 skeletal points can be defined by 93 values.

In some embodiments various model fitting approaches may use depth information background information prop information body part information and or prior trained anatomical and kinetic information to map the one or more computer models onto an acquired image. For example body part information may be used to find one or more candidate locations for one or more skeletal bones. Subsequently a plurality of plausible skeletons may be assembled to include skeletal bones at different combinations of the one or more candidate locations. The various plausible skeletons may then be scored and the scored proposals can be combined into a final estimate. In one embodiment model fitting includes two components a body part proposer which extracts candidate locations from foreground pixel assignment for each body part independently e.g. finding candidate centroids for each body part and a skeleton generator which combines these candidates into complete skeletons.

Referring back to in one embodiment the process for detecting and tracking one or more targets may be implemented by a target proposal system and a target tracking system. The target proposal system may implement steps and in order to identify one or more candidate targets. The one or more candidate targets may be identified within one or more classification maps. The target tracking system may implement steps and in order to reconcile one or more candidate targets and report correctly identified targets. In one example the skeletal tracking system consumes the one or more candidate targets that are assigned as candidate body parts and the prop tracking system consumes the one or more candidate targets that are assigned as candidate props. In another example the skeletal tracking system consumes a first classification map associated with one or more candidate body parts and prop tracking system consumes a second classification map associated with one or more candidate props.

Referring back to in one embodiment the skeletal tracking system works by connecting the one or more body part proposals or candidates in various ways to produce a large number of partial or whole skeletal hypotheses. In order to reduce computational complexity certain parts of a skeleton such as the head and shoulders might be resolved first followed by others such as the arms . These skeletal hypotheses are then scored in various ways and the scores and other information are used to select the best hypotheses and reconcile where the correct body parts actually are. Similarly prop tracking system considers the one or more prop proposals or candidates generates prop hypotheses scores the generated prop hypotheses and selects the best hypothesis in order to determine the correct prop. In one embodiment the position and or orientation of one or more previous high scoring hypotheses from previous images is used to help score the generated hypotheses in step . For example a previous determination of the position and orientation of a tennis racquet in a previous image may be used to score the position and orientation of the tennis racquet in a current image.

In one embodiment feedback may occur between the skeletal tracking system and the prop tracking system . In one example the skeletal tracking system receives prop tracking information from prop tracking system . The prop tracking information includes position and orientation information regarding one or more props. The prop tracking information is taken into account when scoring generated skeletal hypotheses. For example a scored hypothesis may be rewarded if the position of a particular object e.g. a tennis racquet or baseball bat is in proximity with a particular body part e.g. a hand or arm . The position may be either a 3 D location in a three dimensional space or a 2 D location in a two dimensional space. Similarly the score given to a particular hypothesis may be lowered or penalized if a particular object is not within a threshold distance of a particular body part typically associated with the particular object. In some embodiments the reward or penalty given to a particular cost function e.g. the score given to a particular body part hypothesis may be linear or non linear.

In another example the prop tracking system receives skeletal tracking information from skeletal tracking system . The skeletal tracking information includes position and orientation information regarding one or more body parts. The skeletal tracking information is taken into account when scoring generated prop hypotheses. For example a scored hypothesis may be rewarded if the position of a particular body part e.g. a head is in proximity with a particular prop e.g. a hat . The position may be either a 3 D location in a three dimensional space or a 2 D location in a two dimensional space. Similarly the score given to a particular hypothesis may be lowered or penalized if a particular body part is not within a threshold distance of a particular prop typically associated with the particular body part. In some embodiments the reward or penalty given to a particular cost function e.g. the score given to a particular prop hypothesis may be linear or non linear. Feedback data regarding a user s body may be particularly helpful in reacquiring an object in situations where tracking objects is difficult e.g. when an object quickly enters and leaves a field of view or moves at a high speed relative to the ability of a capture device to capture the motion of the object . For example in the case of a game player swinging a baseball bat if tracking of the bat is lost then the handle of the baseball bat may be reacquired by considering the location of the game player s hands. In some embodiments prop tracking is performed in parallel with skeletal tracking .

In step the determination of the correctly identified targets from step is reported and available for use by other applications. Reporting can be performed in any suitable manner. In one example an application programming interface API may be used to report the one or more selected targets. For example such an API may be configured to communicate the positions velocities accelerations confidences in positions velocities and or accelerations and or other information related to the one or more selected targets.

In one embodiment one or more training images of a training set may be retrofitted with 3 D models of a particular object or prop. The 3 D models may include one or more data structures that represent a particular target as a three dimensional shape. In another embodiment one or more training images of a training set may be rendered using 3 D models of a particular object or prop.

In three training images and have been retrofitted with 3 D models of various props. Segmented image has been retrofitted with a tennis racquet. Segmented image has been retrofitted with a sword. In this case because the object is inter penetrating the user s body the retrofitted segmented image may be discarded from the training set. Segmented image has been retrofitted with a baseball bat. Retrofitting an existing training set of human poses with props and or auto generating a new training set including props based on an existing training set of human poses may be less expensive than creating a new motion captured training set involving human poses and props. In some embodiments the objects or props in a training image are not touching or being held by a human subject. For example a ball being passed between two game players will be in mid air and not in direct contact with either player.

As there is a trade off between the number of body parts and objects that can be detected simultaneously in some embodiments the number of body part targets may be limited. For example rather than searching for 32 different body parts the body part targets may include only the head neck left and right shoulders left and right upper torso and upper and lower arms and hands. In some embodiments one or more prop targets may include multiple parts. For example a tennis racquet may be composed of a racquet handle and a racquet head.

Once a detection and tracking system such as detection and tracking system of has been trained with a training set including segmented body parts and props classification maps including classifications for both body part targets and prop targets may be generated. In an original depth image of a human wearing a glove is used to generate a segmented image including both predicted body parts and props. As shown in the segmented image of the glove in the user s right hand is classified as a target along with a plurality of body part targets e.g. left and right shoulders . In an original depth image of a user holding a baseball bat is used to generate a segmented image where the baseball bat is classified as a target.

In one embodiment multiple props may be classified along with multiple body parts. In a depth image of a user holding a baseball bat and throwing a soccer ball into the air is used to generate a segmented image where both the baseball bat and soccer ball are classified as targets. In one embodiment color and or pattern information received from a capture device may be used to help further distinguish targets that are similar in shape and size. In one example a basketball and a soccer ball may be distinguished based on color information. In another example a soccer ball pattern comprising alternating black pentagons and white hexagons may be used to help distinguish a soccer ball from other objects of similar shape and size.

In one embodiment the detection and or tracking of a user picking up choosing or introducing into a field of view a particular prop may trigger an application to select a particular application mode. In one example a game player picking up a soccer ball will cause a sports application to select a game mode associated with the soccer ball. In another example a particular game may allow a game player to select and use three different objects e.g. a gun a baseball bat and a chainsaw based on which of the one or more associated props are being held by the game player. In one embodiment a game player may use introduce one or more props in the middle of a game session.

The disclosed technology is operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems environments and or configurations that may be suitable for use with the technology include but are not limited to personal computers server computers hand held or laptop devices multiprocessor systems microprocessor based systems set top boxes programmable consumer electronics network PCs minicomputers mainframe computers distributed computing environments that include any of the above systems or devices and the like.

The disclosed technology may be described in the general context of computer executable instructions such as program modules being executed by a computer. Generally software and program modules as described herein include routines programs objects components data structures and other types of structures that perform particular tasks or implement particular abstract data types. Hardware or combinations of hardware and software may be substituted for software modules as described herein.

The disclosed technology may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices.

For purposes of this document reference in the specification to an embodiment one embodiment some embodiments or another embodiment are used to described different embodiments and do not necessarily refer to the same embodiment.

For purposes of this document a connection can be a direct connection or an indirect connection e.g. via another part .

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

