---

title: Relaxation for structured queries
abstract: A structured query may specify attribute values for attributes. An estimate of the number of items that will match the structured query if it is applied to a structured database is determined. If the estimated number of items is below a threshold, the structured query may be relaxed to form new candidate structured queries. The number of candidate queries may be determined based on a desired running time. Each of the candidate structured queries may be determined by changing one or more attribute values of the attributes of the structured query. Estimates of the number of items each of the candidate structured queries will match is determined, and the candidate structured query that has the highest matching estimation is used to query the database. The matching results may be output.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09158813&OS=09158813&RS=09158813
owner: MICROSOFT TECHNOLOGY LICENSING, LLC
number: 09158813
owner_city: Redmond
owner_country: US
publication_date: 20100609
---
A number of applications on the Internet access structured data through keyword queries. Structured data may include data that is stored in a structured form e.g. tuples within repositories such as databases relational object XML etc. delimited files or other structured repositories. Structured data tuples often include attributes with each attribute taking on one of a set of possible attribute values. Typically structured queries over structured data are evaluated in a strict fashion i.e. the query specified attributes and corresponding attribute values are matched exactly with the attributes and corresponding attributes of the structured data. Consider for example the following structured query submitted by a user to an online merchant 

In this structured query the user is interested in finding silver colored LCD televisions that are made by Sony and have a size of 42 inches. Although this structured query is relatively well specified if it is evaluated strictly very few or no results may be returned to the user. For example there may be no silver colored televisions that are 42 inches in size or the only Sony LCD televisions may be 43 inches or other sizes other than 42 inches. Thus it may be beneficial to relax the structured query provided by the user by changing one or more of the attribute values so that the user may receive a predetermined minimum number of results. However determining which attribute values to relax is difficult because a user may become dissatisfied if returned results are too different than the original structured query and there is only a finite amount of time during which relaxed attribute values may be considered before the user expects to receive results.

A structured query may be received that specifies attribute values for one or more attributes. An estimate of the number of items that will match the structured query if it is applied to a structured database is determined. The estimate may be made using previously generated histograms of attribute values for each of the attributes in the structured database. If the estimated number of items is below a threshold number of items the structured query may be relaxed to form multiple new candidate structured queries. The number of candidate queries generated may be proportional to a maximum running time e.g. the number of candidate queries generated may be limited to fit within a maximum running time . Each of the candidate structured queries may be determined by changing one or more attribute values of the attributes of the structured query. Estimations of the number of items each of the candidate structured queries will match is determined and the candidate structured query that has the highest matching estimation is used to query the structured database. The matching results may then be presented to a user who provided the structured query.

In an implementation a query is received by a computing device e.g. through a network. The query includes one or more terms. A first structured query is determined based on the terms of the received query by the computing device. A structured query includes one or more attribute values and each attribute value is associated with an attribute. An estimated number of items that match the first structured query is determined by the computing device. It is determined if the estimated number of items is below the threshold number of items. If the estimated number of items is below the threshold number of items a second structured query is determined from the first structured query the plurality of items that match the second structured query is determined and indicators of each of the determined items are provided by the computing device.

Implementations may include some or all of the following features. If the estimated number of items is above or equal to the threshold number of items a plurality of items that match the first structured query is determined and indicators of each of the determined plurality of items are provided by the computing device through the network. Determining the second structured query from the first structured query by the computing device may include determining a plurality of candidate structured queries from the first structured query for each candidate structured query of the plurality of candidate structured queries estimating a number of items that match the candidate structured query and determining the candidate structured query with the highest estimated number of items as the second structured query.

In an implementation a threshold distance may be determined. For each candidate structured query of the first structured query a maximum distance between the candidate structured query and the first structured query may be determined. The candidate structured query with the highest estimated number of items as the second structured query may be determined. The determined maximum distance of the determined candidate structured query may be less than the threshold distance.

In an implementation determining a candidate structured query from the first structured query may include selecting an attribute of the first structured query changing the attribute value corresponding to the selected attribute determining an estimated number of items that match the first structured query with the changed attribute determining if the estimated number of items that match the first structured query with the changed attribute is above the threshold number of items and if so determining the first structured query with the changed attribute as a candidate structured query. A maximum time duration may be received and the number of determined candidate structured queries may be proportional to the maximum time duration. The items may be consumer products. The structured query may be received through a form of a webpage.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the detailed description. This summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

In some implementations the client device may include a desktop personal computer PC workstation laptop personal digital assistant PDA cell phone or any WAP enabled device or any other computing device capable of interfacing directly or indirectly with the network . The client device may be implemented using one or more computing devices such as the computing system described with respect to . The client device may run an HTTP client e.g. a browsing program such as MICROSOFT INTERNET EXPLORER or other browser or a WAP enabled browser in the case of a cell phone PDA or other wireless device or the like allowing a user of the client device to access process and view information and pages available to it from the provider .

In some implementations the provider may receive queries and may provide indicators of one or more items that are responsive to the query. The items may be a variety of products and or services e.g. consumer products and may include books consumer electronics restaurant listings and airplane schedules for example. The provider may be a search engine or may be a merchant or other type of provider. The provider may be implemented using one or more computing devices such as the computing system described with respect to .

The provider may have access to structured data . The structured data may include one or more structured data tuples organized into one or more sets or tables corresponding to a variety of categories. Each structured data tuple may correspond to an item and may include one or more attributes corresponding to features of the item that the structured data tuple purports to represent. Each attribute may have one or more attribute values. The structured data may be implemented as a database and or a collection of tables or as XML data for example. Any of a variety of known data structures may be used for the structured data .

For example the provider may be an online retailer and may maintain their inventory as structured data . A schema specific to the structured data may be used to generate webpages catalogs reports etc. based on the structured data because of the well defined attributes of the structured data tuples in the structured data . Examples of businesses or merchants that may use structured data may include travel websites movie websites and libraries.

In some implementations the provider may receive structured queries and may provide identifiers of one or more items from the structured data in response to the structured queries. A structured query may be a query that uses the schema of the structured data and may specify one or more attributes and one or more attribute values. For example a structured query for green shoes may be Category shoes Color green . The specified attributes are Category and Color and the corresponding attribute values are shoes and green . The provider may determine items matching the attribute and attribute value combinations defined by the structured query in the structured data and return indicators of the matching items. In some implementations the indicators may be URLs uniform resource locators .

Because users typically do not know or are not aware of the schema used by the provider a user of a client device may provide a structured query using a form or other user interface element that enforces the schema of the structured data . Continuing the example described above the user may use a browser to access a webpage associated with the provider . The webpage may include a form that has a drop down box for example for one or more attributes of the structured data . The user may select shoes from a drop down box of available categories and may select green from a drop down box of available colors. The user may submit the form and a corresponding structured query may be generated based on the user selections.

However because of the popularity of search engines users have become accustomed to providing free form queries rather than using structured queries. A free form query often includes multiple terms. For example a user looking to purchase a 42 inch Samsung television would simply enter the query 42 inch Samsung Television rather than a structured query such as Category Television Brand Samsung Size 42 inch .

To facilitate searches on structured data using terms of a free form or keyword query the provider may further include a structured query generator . The structured query generator may generate one or more possible structured queries from the terms of a received query. In some implementations the structured query generator may generate a structured query by mapping the terms of the query to attribute values of attributes of a table of the structured data . Other methods for generating a structured query may be used. An example system for generating structured queries from free form or keyword query terms is found in U.S. patent application Ser. No. 12 694 294 titled Annotating Queries Over Structured Data the contents of which are hereby incorporated in their entirety.

In some implementations the provider may receive a query from a client device and provide it to the structured query generator to generate a structured query from the terms of the query. The query may be received from the client device through a user interface implemented using a webpage for example.

In some implementations the provider may further include a structured query relaxer . The structured query relaxer may relax a structured query by substituting one or more of the attribute values of attributes of the structured query with alternative attribute values. Because a user may not be fully aware of the schema used by the structured data and the particular attribute values of the attributes associated with the items in the structured data a user may provide a structured query that may not match many items in the structured data . By relaxing one or more of the attribute values of the structured query more items in the structured data may be found that match the structured query and the user may have a more positive search experience.

As illustrated Table 1 includes seven items with attribute values corresponding to the attributes Brand Model Type and Size . A user may generate a structured query such as Brand Samsung Type Plasma Size . Based on the items in Table 1 the structured query provided by the user does not match any of the items in the structured data . Accordingly the provider may provide no indicators of matching items to the user.

However rather than provide no indicators of items the structured query relaxer may relax the structured query by changing an attribute value of an attribute with an alternate attribute value. For example the structured query relaxer may replace the attribute value Plasma of the attribute Type with the attribute value LCD to generate the relaxed structured query Brand Samsung Type Plasma Size 46 . Indicators of the items that match the relaxed structured query may then be provided to the user.

The statistics generator may generate structured data statistics from the structured data . In some implementations the structured data statistics may include a histogram of the attribute values for each attribute in the structured data . For example the histogram for the attribute Brand from Table 1 may be Samsung 2 Sony 4 and Sharp 1. As will be described further the structured data statistics may be used to determine an estimated number of items that may be matched by the provider for a given structured data query.

In some implementations the statistics generator may further determine dependencies among the attributes in the structured data . For example referring to Table 1 the attributes Brand and Model may be dependent on one another because only items of the brand Sony are of the model Bravia. Thus when determining which attribute to relax the dependent attributes may be relaxed simultaneously since they are dependent on one another. The dependencies among the attributes may be stored by the statistics generator with the structured data statistics .

In some implementations the structured data statistics may further include popularity information such as click information that describes the popularity of previously received structured queries. The popularity information may be used to select alternative attribute values when relaxing a structured query by considering attribute values that have been frequently received or that have resulted in a high click through rate. The statistics generator may generate the popularity information from a query log associated with the provider for example.

The results estimator may determine an estimated number of items in the structured data that are likely to match a structured query using the structured data statistics . Because determining the number of items from the structured data may be computationally expensive an estimated number of matching items may be determined by the results estimator to decide if a structured query may be relaxed and to select among candidate structured queries for the relaxation of the structured query.

In some implementations the results estimator may determine the estimated number of matches for a structured query by calculating the product of the histogram values of the attribute values for attributes associated with the structured query from the structured data statistics . In an implementation where the attributes are independent the estimate number of matches may be determined using Equation 1 where vrepresents an attribute value of the attribute ain the structured query q and 0 1 1 

The distance generator may determine a distance between a structured query and a relaxed version of the structured query. In an implementation the distance generator may determine a distance between a structured query q to an item dfrom the structured data using a distance function denoted as r d q . The distance determined by the distance generator may be used as a check against a proposed relaxed structured query and may represent the distance between the original structured query q the item dthat matches the relaxed version of q. A high calculated distance may indicate that a relaxed structured query is matching items that are dissimilar to the original structured query and a low calculated distance may indicate that the relaxed structured query is matching items that are similar to the original structured query. Because a user may abandon their search if matching items are dissimilar to their original query the structured query relaxer may favor relaxed structured queries having a low determined distance.

In some implementations the distance function used by the distance generator may have two parts. The first part of the distance function may be structured query dependent while the second part of the distance function may be based on the overall popularity of the item d. For example the distance function may use the popularity information from the structured data statistics to determine the popularity of an item. In addition the distance generator may determine a distance between attribute values v and w of an attribute a using a distance function denoted as s v w .

The particular distance functions used by the distance generator may vary depending on the characteristics of the structured data and the structured data statistics . Any of a variety of known monotonic distance and or scoring functions may be used. A distance function r is monotonic if for any structured query q aq aq . . . aq for any two items d a i a i . . . a i and d a j a j . . . a j where s q i s q j s q i s q j . . . s q i s q j it holds that r d q r d q .

The candidate structured query generator may determine some number of candidate relaxed structured queries based on a received structured query. In some implementations the candidate structured query generator may determine the number of candidate structured queries to generate by retrieving a maximum time and determining the number of candidate structured queries based on the retrieved maximum time. The maximum time may be set by a user or an administrator and may represent the maximum amount of time that a user may wait for a response to their structured query. Users of search engines or other websites are accustomed to quick responses to queries and will refresh or resubmit their query if no response is received within a short period of time. Therefore to avoid the user resubmitting and or abandoning their search the candidate structured query generator may be limited to a number of candidate relaxed structured queries where the number may be determined for example by dividing the maximum time by the expected amount of time it takes to determine and evaluate a candidate structured query.

For example an administrator may have determined the maximum time to be 0.5 seconds. The candidate structured query generator may determine and evaluate a candidate structured query in 0.01 seconds. Therefore the candidate structured query generator may determine candidate structured queries i.e. 0.5 0.01 .

The candidate structured query generator may determine a candidate relaxed structured query by changing at least one attribute value corresponding to an attribute of the received structured query. In some implementations the candidate structured query generator may determine a candidate structured query by selecting an attribute of the received structured query and changing the attribute value corresponding to the selected attribute. The amount that the candidate structured query generator changes an attribute value is referred to as the step size. The larger the step size the larger the amount of change that may be made to the attribute value. The step size used by the candidate structured query generator may be set by a user or an administrator. Where one or more of the attributes are dependent on other attributes the candidate structured query generator may change the attribute values of the dependent attributes at the same time.

The candidate structured query generator may determine an estimated number of items that match the structured query with the changed attribute value. The candidate structured query generator may determine the estimated number of items using the results estimator for example. If the estimated number of matching items is greater than a threshold number of items then the structured query with the changed attribute value may be determined as a candidate structured query.

In some implementations the candidate structured query generator may select which attribute of the structured query to change the corresponding attribute value using what is referred to as a greedy heuristic. In the greedy heuristic in a first iteration the candidate structured query generator may select the attribute which is the most constraining i.e. whose changing may result in the greatest number of matching results . The least constraining attribute may be determined using the histograms in the structured data statistics . In subsequent iterations the greedy heuristic may select and change different attributes. The amount that the greedy heuristic changes the attribute values may be determined based on the step size set by the user or the administrator.

In some implementations the candidate structured query generator may select which attribute of the structured query to change the corresponding attribute value using what is referred to as a dynamic programming heuristic. In the dynamic programming heuristic multiple attributes may be changed at each iteration. The candidate structured query generator may select the combination of attributes which is the most constraining.

The structured query relaxer may select a structured query from the set of candidate structured queries determined by the candidate structured query generator as the relaxed structured query and determine items from the structured data that match the relaxed structured query. The structured query relaxer may then provide indicators of the matching items to the user who submitted the original structured query. The indicators may be links such as URLs in an implementation.

In some implementations the structured query relaxer may select the structured query from the set of candidate structured queries that has the greatest number estimated matching items. For example the structured query relaxer may have the results estimator estimate the number of items that match each of the candidate structured queries and the structured query relaxer may select the candidate structured query that has the greatest number of estimated matching items as the relaxed structured query.

In some implementations the structured query relaxer may select the structured query from the set of candidate structured queries that has the smallest calculated distance from the original structured query. For example the structured query relaxer may have the distance generator determine the distance between the original structured query and each of the candidate structured queries using the distance function. As described above the distance function may be a measure of the distance between the original structured query and an item that matches the relaxed structured query. The structured query relaxer may then select the candidate structured query that has the smallest calculated distance as the relaxed structured query.

A query is received at . In some implementations the query may be received by the structured query generator of the provider from a user at a client device . The query may be a free form query and may comprise one or more terms. In order to fulfill the received query from structured data a structured query may be determined from the terms of the received query.

A first structured query is determined from the received query at . The first structured query may be determined from the received query by the structured query generator of the provider . The first structured query may include one or more attribute values and each attribute value may be associated with an attribute.

An estimated number of items that match the first structured query is determined at . The estimated number of items may be determined by the results estimator of the structured query relaxer . In some implementations the estimated number of items may be determined by the results estimator using the structured data statistics . For example the results estimator may determine the estimated number of items using histograms associated with each attribute of the first structured query in the structured data statistics .

A determination is made as to whether the estimated number of items that match the first structured query is below a threshold at . In some implementations the determination may be made by the structured query relaxer of the provider . The threshold may represent the minimum number of indicators of items that the provider may return to a user in response to receiving a structured query. If the estimated number of items that match the first structured query is below the threshold then the method may continue at otherwise the method may continue at .

A second structured query is determined at . The second structured query may be determined by the structured query relaxer of the provider . In some implementations the second structured query may be determined by changing one or more attribute values of one or more attributes of the first structured query. For example the structured query relaxer may generate a set of candidate structured queries estimate the number of matching items for each of the candidate structured queries and select the candidate structured query with the highest estimated matching items as the second structured query. The number of candidate structured queries generated may be proportional to a maximum time. In some implementations the candidate structured queries may be determined using a greedy or a dynamic programming heuristic.

A plurality of items that match the second structured query are determined at . The matching items may be determined by the provider from the structured data . The matching items may each have associated attributes with attribute values that match the attributes and attribute values of the second structured query.

Indicators of each of the items are provided at . The indicators may be provided by the provider to a user who submitted the first structured query. In some implementations the indicators may be links such as URLs to each of the items in the structured data . In addition pictures or other descriptions of the items may be provided to the user for display e.g. adjacent to the indicators.

If the estimated number of items is above i.e. not below the threshold at a plurality of items that match the first structured query are determined at . The matching items may be determined by the provider from the structured data . Indicators of each of the items are provided at . The indicators may be provided by the provider to the user who submitted the first structured query.

A maximum time is received at . The maximum time may be received by the structured query relaxer of the provider . In some implementations the maximum time may be set by a user or an administrator and may be a maximum time that the structured query relaxer may consider candidate structured queries for the relaxed structured query. Because users expect a response in a short amount of time the structured query relaxer may be limited to considering candidate structured queries to a period corresponding to or determined based on the maximum time.

A plurality of candidate structured queries is determined at . The plurality of candidate structured queries may be determined by the candidate structured query generator of the structured query relaxer . In some implementations the number of candidate structured queries that is generated is proportional to the received maximum time and the amount of time used to determine and consider a candidate structured query. For example if the received maximum time is one second and the amount of time needed to determine and consider a candidate structured query is 0.2 seconds then the candidate structured query generator may determine five candidate structured queries i.e. 1 0.2 5 .

In some implementations the candidate structured queries may be generated by the candidate structured query generator by changing an attribute value of an attribute of the received structured query. In some implementations the candidate structured query generator may select the attribute to change that may result in the greatest number of matching items based on the number of items in the structured data that include the selected attribute. In other implementations the candidate structured query generator may randomly select an attribute to change. Other methods of selecting an attribute may be used.

A number of matching items is estimated for each candidate structured query at . The number of matching items for each candidate structured query may be estimated for each candidate structured query by the results estimator of the structured query relaxer using the structured data statistics for example.

A distance between each candidate structured query and the original received structured query is determined at . The distance may be determined by the distance generator . The distance may represent an estimated distance between the original query and an item that is responsive to the candidate structured query. Any distance function or technique may be used.

The candidate structured query with the smallest determined distance is determined at . The candidate structured query with the smallest distance may be determined by the structured query relaxer of the provider . The candidate structured query with the smallest distance is the candidate structured query that is the most similar to the original structured query and will therefore match items in the structured data that are the most similar to the items that would have matched the original structured query. Therefore the structured query relaxer may use the candidate structured query with the smallest distance as the relaxed structured query.

Numerous other general purpose or special purpose computing system environments or configurations may be used. Examples of well known computing systems environments and or configurations that may be suitable for use include but are not limited to personal computers server computers handheld or laptop devices multiprocessor systems microprocessor based systems network PCs minicomputers mainframe computers embedded systems distributed computing environments that include any of the above systems or devices and the like.

Computer executable instructions such as program modules being executed by a computer may be used. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Distributed computing environments may be used where tasks are performed by remote processing devices that are linked through a communications network or other data transmission medium. In a distributed computing environment program modules and other data may be located in both local and remote computer storage media including memory storage devices.

With reference to an exemplary system for implementing aspects described herein includes a computing device such as computing system . In its most basic configuration computing system typically includes at least one processing unit and memory . Depending on the exact configuration and type of computing device memory may be volatile such as random access memory RAM non volatile such as read only memory ROM flash memory etc. or some combination of the two. This most basic configuration is illustrated in by dashed line .

Computing system may have additional features functionality. For example computing system may include additional storage removable and or non removable including but not limited to magnetic or optical disks or tape. Such additional storage is illustrated in by removable storage and non removable storage .

Computing system typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computing system and includes both volatile and non volatile media removable and non removable media.

Computer storage media include volatile and non volatile and removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Memory removable storage and non removable storage are all examples of computer storage media. Computer storage media include but are not limited to RAM ROM electrically erasable program read only memory EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by computing system . Any such computer storage media may be part of computing system .

Computing system may contain communications connection s that allow the device to communicate with other devices. Computing system may also have input device s such as a keyboard mouse pen voice input device touch input device etc. Output device s such as a display speakers printer etc. may also be included. All these devices are well known in the art and need not be discussed at length here.

It should be understood that the various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the presently disclosed subject matter or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium where when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the presently disclosed subject matter.

Although exemplary implementations may refer to utilizing aspects of the presently disclosed subject matter in the context of one or more stand alone computer systems the subject matter is not so limited but rather may be implemented in connection with any computing environment such as a network or distributed computing environment. Still further aspects of the presently disclosed subject matter may be implemented in or across a plurality of processing chips or devices and storage may similarly be effected across a plurality of devices. Such devices might include personal computers network servers and handheld devices for example.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

