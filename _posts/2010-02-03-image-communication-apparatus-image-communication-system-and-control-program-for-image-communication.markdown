---

title: Image communication apparatus, image communication system, and control program for image communication
abstract: An image communication apparatus that includes an image-data receiving unit that receives image data, a storing unit that stores therein the image data received by the image-data receiving unit, and an output unit that outputs the image data stored in the storing unit, the image communication apparatus includes a scanning unit that scans the image data output by the output unit; a difference extracting unit that extracts a difference between the image data scanned by the scanning unit and the image data stored in the storing unit; a difference determining unit that determines whether the difference extracted by the difference extracting unit satisfies a predetermined condition based on condition information obtained together with the image data; and a control unit that controls so that a message is transmitted to a transmission source of the image data based on a result determined by the difference determining unit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08427679&OS=08427679&RS=08427679
owner: Ricoh Company, Limited
number: 08427679
owner_city: Tokyo
owner_country: JP
publication_date: 20100203
---
The present application claims priority to and incorporates by reference the entire contents of Japanese Patent Application No. 2009 023606 filed in Japan on Feb. 4 2009 and Japanese Patent Application No. 2009 284529 filed in Japan on Dec. 15 2009.

The present invention relates to an image communication apparatus an image communication system and a control program and particularly relates to a control of notifying of a printed result of image data received via a network communication.

An image communication apparatus such as a facsimile FAX machine has a receipt acknowledgment notifying function for a transmitter checking whether transmitted image data is normally received when the image data is transmitted from a transmitting side apparatus to a receiving side apparatus. With the receipt acknowledgment notifying function the receiving side apparatus notifies the transmitting side apparatus of receipt acknowledgment information including that the image data transmitted from the transmitting side apparatus has normally reached the receiving side apparatus and the transmission has been interrupted during the reception see Japanese Patent Application Laid open No. 2000 151957 and Japanese Patent Application Laid open No. 2000 174973 .

Even in the conventional image communication apparatus a transmitter can check whether image data has normally reached the receiving side apparatus. However the receipt acknowledgment notifying function in the conventional image communication apparatus only notifies a transmitting side terminal of whether the receiving side apparatus has normally received the image data. Therefore in the image communication apparatus the transmitter cannot check the quality of the image data printed by the receiving side apparatus.

It is an object of the present invention to at least partially solve the problems in the conventional technology.

According to an aspect of the present invention there is provided an image communication apparatus that includes an image data receiving unit that receives image data a storing unit that stores therein the image data received by the image data receiving unit and an output unit that outputs the image data stored in the storing unit the image communication apparatus including a scanning unit that scans the image data output by the output unit a difference extracting unit that extracts a difference between the image data scanned by the scanning unit and the image data stored in the storing unit a difference determining unit that determines whether the difference extracted by the difference extracting unit satisfies a predetermined condition based on condition information obtained together with the image data and a control unit that controls so that a message is transmitted to a transmission source of the image data based on a result determined by the difference determining unit.

According to another aspect of the present invention there is provided an image communication system that transmits and receives image data via a network the image communication system including an image data input unit through which image data to be transmitted and received is input a condition information obtaining unit that obtains condition information on a difference condition for determining a difference between image data obtained by scanning an image output based on the image data and the image data in an apparatus that receives the image data in accordance with an operation by a user an image data transmitting unit that transmits obtained image data and the condition information an image data receiving unit that receives transmitted image data a storing unit that stores therein the image data received by the image data receiving unit an output unit that outputs the image data stored in the storing unit a scanning unit that scans the image data output by the output unit a difference extracting unit that extracts a difference between the image data scanned by the scanning unit and the image data stored in the storing unit a difference determining unit that determines whether the difference extracted by the difference extracting unit satisfies a predetermined condition based on the condition information obtained together with the image data and a control unit that controls so that a message is transmitted to a transmission source of the image data based on a result determined by the difference determining unit.

According to still another aspect of the present invention there is provided a control program for causing an information processing apparatus to operate as an image communication apparatus that receives image data via a network the control program causing the information processing apparatus to execute receiving image data storing received image data outputting stored image data scanning output image data that is output at the outputting extracting a difference between scanned image data and the stored image data determining whether extracted difference satisfies a predetermined condition based on condition information obtained together with the image data and transmitting a message to a transmission source of the image data based on determined result that is determined at the determining.

The above and other objects features advantages and technical and industrial significance of this invention will be better understood by reading the following detailed description of presently preferred embodiments of the invention when considered in connection with the accompanying drawings.

Exemplary embodiments according to the present invention are explained in detail below with reference to the accompanying drawings. In the specification and the drawings components having substantially the same functional configuration will be given the same reference numerals and overlapping explanation is omitted.

In the embodiments explanation is given for an MFP in which functions of respective devices such as a printer a copier a FAX machine and a scanner are integrated in one housing as an example of an image communication apparatus however any image communication apparatus having an image communication function can be employed. Moreover in the embodiments explanation is given for a case where an internet protocol IP FAX function of connecting to a partner device by using a session initiation protocol SIP server is used as the image communication function of the image communication apparatus although the image communication function is not limited thereto.

Moreover in the MFP the MFP or the MFP an original scanner an original scanner controller a print controller a print engine a discharge scanner a discharge scanner controller a hard disk HD an HD controller a liquid crystal display LCD display controller an LCD a local area network LAN controller a LAN interface LAN I F are connected with each other via a PCI bus .

Furthermore in the MFP the MFP or the MFP a key input controller a hardware key a touch panel controller a touch panel are connected with each other via an X bus internal bus .

Moreover in the MFP the MFP or the MFP the CPU bus the PCI bus and the X bus are connected with each other via the bus controller or the PCI bridge .

The CPU executes and processes a control processing program or an operating system OS stored in the flash ROM . The main memory includes a dynamic random access memory DRAM and is used as a work area for the CPU or the like.

The flash ROM is a ROM in which data is not erased even if the power is turned off and which is electrically rewritable. In the flash ROM various programs for starting up a system and realizing functions of the MFP at the time of power on are written in advance. Moreover the flash ROM stores therein data such as switches and parameters to be referred to when executing computer programs.

The clock includes a crystal oscillator and a divider circuit and generates a clock for controlling operation timing of the CPU and the bus controller . The bus controller controls data transfer between the CPU bus and the X bus .

The PCI bridge performs data transfer between the PCI bus and the CPU by using the cache memory . The cache memory includes a DRAM and is used by the PCI bridge .

The original scanner scans an image on a sheet by a color charge coupled device CCD line sensor with a one dimensionally arrayed light emitting diode LED array as a light source and converts each analog image signal of red R green G and blue B output from the color CCD line sensor into digital image data by an analog digital A D conversion. The original scanner controller controls an original scanning operation by the original scanner and performs compression encoding processing conforming to Joint Photographic Experts Group JPEG by converting RGB digital image data input from the original scanner into a color difference component Cb Cr and a luminance component Y . In the present embodiment the original scanner is used however it is not limited thereto so long as the device can scan an image on a sheet. For example an image on a sheet can be scanned by a camera instead of the original scanner .

The print controller controls the operation of the print engine . The print engine prints a color image or a monochrome image on a sheet by using toner of cyan magenta yellow and black.

The discharge scanner scans an image on a sheet and converts a scanned analog image signal into digital image data in the similar manner to the original scanner . The discharge scanner controller controls an original scanning operation by the discharge scanner . Details of the discharge scanner are described later.

The HD stores therein image data input from the original scanner image data received through communication and the like. The HD controller functions as an interface with the HD to perform high speed data transfer with the HD .

The LCD display controller performs a digital analog D A conversion on character data graphic data and the like and performs control for displaying these data on the LCD .

The LAN controller executes a communication protocol for example conforming to Institute of Electrical and Electronics Engineers IEEE 802.3 standard and controls communication with other devices connected to the Ethernet registered trademark via the LAN I F .

The key input controller performs conversion of serial data input from the hardware key into parallel data. The touch panel controller detects a part on the touch panel with which an object such as a finger comes into contact and obtains position information thereof. The touch panel is superimposed on the LCD to be in close contact therewith.

An image scanning unit scans an image on an original by using the original scanner and obtains RGB digital image data. Moreover the image scanning unit converts the RGB digital image data into data on the color difference component Cb Cr and the luminance component Y by the original scanner controller to perform JPEG compression encoding .

An image transmitting unit performs a call connection using the SIP defined in Request for Comments RFC 3261 and the IP FAX protocol defined in ITU T recommendation T.38 to transmit JPEG encoded image data by the image scanning unit to another terminal. For example the image transmitting unit functions as an image data transmitting unit.

A display control unit controls display processing for various screens and the like on the LCD . Specifically the display control unit controls display of a menu screen for specifying various functions display of a screen for inputting a transmission destination for IP FAX transmission and the like.

An operating unit controls various operation processing based on key data input from the hardware key and coordinate data input from the touch panel .

An image receiving unit performs an incoming call connection using the SIP and the IP FAX protocol defined in ITU T Recommendation T.38 to receive JPEG image data from another IP FAX machine. For example the image receiving unit functions as an image data receiving unit.

An image storing unit stores the JPEG image data received by the image receiving unit in the HD . For example the image storing unit functions as a storing unit.

A character extracting unit extracts a character from image data in accordance with an algorithm to be described later. For example the character extracting unit functions as a character extracting unit.

A print color converting unit performs expansion decoding processing conforming to JPEG on the JPEG image data stored in the HD to convert image data separated into the color difference component Cb Cr and the luminance component Y into RGB image data and convert the RGB image data into print image data of yellow Y magenta M cyan C and black K . Moreover the print color converting unit stores the RGB image data converted from the JPEG image data in the main memory so that the character extracting unit and an L a b color converting unit can use the RGB image data.

The L a b color converting unit first converts the RGB image data from RGB into CIE XYZ by Equation 1 . Equation 1 is defined in International Radio Consultative Committee CCIR . 0.4124 0.3576 0.1805 100 0.2126 0.7152 0.0722 100 0.0193 0.1192 0.9505 100 1 

Next the L a b color converting unit converts CIE XYZ into L a b by Equations 2 to 7 where Xn 95.045 Yn 100.000 and Zn 108.892. Here Xn Yn and Zn are values under a D65 light source. When 0.008856 1 3 2 When 0.008856 7.787 16 116 When 0.008856 1 3 3 When 0.008856 7.787 16 116 When 0.008856 1 3 4 When 0.008856 7.787 16 116 When 0.008856 116 1 3 16 5 When 0.008856 903.29 500 6 200 7 

A print output unit prints YMCK image data on the sheet by using the print engine . For example the print output unit functions as an output unit.

A color difference extracting unit obtains a difference color difference between two colors in accordance with an algorithm to be described later. For example the color difference extracting unit functions as a difference extracting unit.

A color difference determining unit compares the color difference obtained by the color difference extracting unit with a predetermined condition to make a determination. The predetermined condition indicates a value of a color difference E94 CIE1994 allowable as a difference condition. In the present embodiment the value of E94 to be the difference condition is transmitted together with image data by the IP FAX. For example the color difference determining unit functions as a difference determining unit.

An image scanning unit scans an image printed on the sheet by using the discharge scanner obtains RGB digital image data and stores the RGB digital image data in the main memory so that the L a b color converting unit can use the RGB digital image data. Moreover the image scanning unit converts the RGB digital image data into data on the color difference component Cb Cr and the luminance component Y and stores only image data on the luminance component Y in the main memory so that the character extracting unit can use the image data on the luminance component Y . For example the image scanning unit functions as a scanning unit.

A message transmitting unit transmits a message to another terminal by using the SIP instant message.

A configuration information storing unit stores information to be a color difference condition for determining whether the color obtained by printing received color image data is different from a color of an image on an original and the like in the flash ROM . The information to be the difference condition is transmitted together with image data by the IP FAX and is obtained by the image receiving unit together with the image data. The obtaining of the difference condition is described in detail later.

Next the flow of the operation in which the MFP present in the location B shown in communicates with the MFP present in the location A shown in with a protocol defined in ITU T Recommendation T.38 is explained with reference to a sequence diagram shown .

First the MFP transmits an INVITE message including a FAX number of the MFP to the SIP server Step S .

Then the SIP server refers to a correspondence table of a FAX number and an IP address that are already registered Step S and transmits the INVITE message to the MFP Step S .

The MFP that receives the INVITE message transmits a 2000K response indicating a success to the SIP server Step S . The SIP server that receives the 200OK response transmits the 200OK response to the MFP Step S .

The MFP that receives the 200OK response transmits an ACK message to the MFP to establish a session Step S .

Then the MFP transmits image data to the MFP by executing a protocol defined in ITU T Recommendation T.38 Step S . When the image data transmission is completed the MFP transmits a BYE message to the MFP Step S . Then the MFP transmits the 200OK response to the MFP and the session ends Step S .

Next the operation when the MFP shown in transmits color image data to the MFP shown in is explained with reference to a flowchart shown .

When a transmitter sets a color original on the original scanner and inputs a character string that should be subjected to a color difference determination the operating unit obtains an input specified character string Step S . Then the transmitter inputs a FAX number of the MFP and presses a start key. Then the image scanning unit controls the original scanner controller to scan an original image by the original scanner thereby obtaining RGB digital image data Step S .

Next the image scanning unit converts the scanned RGB digital image data into data on the color difference component Cb Cr and the luminance component Y to perform the JPEG encoding Step S . Then the image scanning unit converts the generated data on the luminance component Y into binary data to generate the binary data. The display control unit reduces the generated binary data image and displays it on the LCD Step S .

When the transmitter checks the binary data displayed on the LCD the transmitter specifies the position at which the character string input at Step S is displayed. Whereby the operating unit obtains the coordinate information hereinafter specified character string coordinate information on the position at which the specified character string is displayed Step S . The transmitter specifies the position at which the character string is displayed by touching the touch panel as the operating unit or the like. The area of the binary data to be displayed on the LCD can move by scrolling.

When the operating unit obtains the specified character string coordinate information the display control unit displays a color specifying screen Step S . illustrates an example of a GUI of the color specifying screen displayed at Step S. As shown in the GUI of the color specifying screen according to the present embodiment includes a color selecting section and an allowable value specifying section .

The color selecting section is a section for a transmitter specifying a color group for which a difference between a color of an image on an original output on the receiving side in the IP FAX and a color on the transmission source should be determined. As shown in in the present embodiment all of hues are classified into hue ranges with red blue green and yellow as representing colors i.e. four groups. A user specifies a color hereinafter specified color for which a difference should be determined on the receiving side by touching each color displayed on the color selecting section . A color to be selected from the colors shown in is not limited to one and a plurality of colors can be selected.

The allowable value specifying section is a section for a transmitter specifying a value of E94 indicating a range to be allowed when determining a difference in color on the receiving side in the IP FAX i.e. a range in which a color of an image on an original is determined to be reproduced. Specifically the value specified in the allowable value specifying section is used as a predetermined condition referred to by the color difference determining unit .

A transmitter can specify a numerical value by selecting a predetermined numerical value in addition to directly inputting an arbitrary numerical value in the allowable value specifying section . An example of such form is shown in . As shown in in the allowable value specifying section according to the present embodiment numerical values 1.2 6.5 and 10 are preset. A transmitter can easily specify an allowable value by selecting a preset numerical value. The value of E94 indicates that the larger value has a larger color difference.

The preset values 1.2 6.5 and 10 are reference values used for comparing colors in the paint industry. For example the value 1.2 is a value indicating a difference of the degree that most people can recognize the difference with the naked eye when comparing different colors side by side.

The value 6.5 is a value indicating a difference of the degree that different colors can be recognized as the same color sensuously when the different colors are observed at different locations. The value 10 is a value in which the allowable range in which different colors are determined to be the same color is further expanded.

When a transmitter inputs the specified color and the allowable value on the screen shown in the operating unit obtains information on the specified color and the allowable value Step S . When the operating unit obtains the information on the specified color and the allowable value the image transmitting unit transmits JPEG encoded image data to the MFP together with the hue group number the allowable value of the color difference E94 the specified character string and the coordinate information by the communication procedure shown in Step S and the processing ends.

At Step S the image transmitting unit transmits the hue group number the allowable value of the color difference E94 the specified character string and the coordinate information while including them in the NSS command of a protocol defined in ITU T Recommendation T.38. An example of the NSS command is shown in . As shown in the NSS command includes an ITU T member code a maker code the hue group number the allowable value of the color difference E94 the specified character string and the coordinate information.

The NSS command is a command defined in ITU T Recommendation T.30 that is referred to by ITU T Recommendation T.38. Therefore ITU T Recommendation T.38 is specified such that a High level Data Link Control procedure HDLC frame such as the NSS defined in ITU T Recommendation T.30 is contained in an Internet Facsimile Protocol IFP packet and the IFP packet is further contained in a User Datagram Protocol UDP packet or a TCP packet to be transmitted. illustrates a data structure in the case of the TCP packet.

The hue group number is information on an ID indicating the specified color obtained at Step S. Specifically the hue group number is used as information for specifying the hue range. The allowable value of the color difference E94 is a value of the allowable value information obtained at Step S. The specified character string is information on the character string obtained at Step S. The coordinate information is information obtained at Step S.

As shown in the information to be transmitted by the image transmitting unit includes the hue group number the allowable value of the color difference E94 the specified character string and the coordinate information so that a color of an image on an original output on the receiving side of image data can be determined. In other words the hue group number the allowable value of the color difference E94 the specified character string and the coordinate information are used as condition information indicating a predetermined condition for determining a difference of an image in the MFP on the receiving side of the image.

Next the operation of the MFP when receiving color image data transmitted from the MFP is explained with reference to a flowchart shown in .

In the MFP when the image receiving unit receives JPEG image data transmitted from the MFP the image storing unit stores the received JPEG image data in the HD Step S . The MFP also receives the NSS command shown in at Step S.

Next the print color converting unit performs the expansion decoding processing conforming to JPEG on the JPEG image data stored in the HD to convert the image data separated into the color difference component Cb Cr and the luminance component Y into RGB image data and further convert RGB into YMCK print image data. At this time the print color converting unit stores the image data on the luminance component Y obtained by the JPEG expansion and the RGB image data converted from the color difference component Cb Cr and the luminance component Y in the main memory so that the character extracting unit can use the image data on the luminance component Y and the L a b color converting unit can use the RGB image data Step S .

Then the print output unit prints the image data converted into YMCK on the sheet by using the print engine Step S .

Next when the sheet on which the image is printed passes the discharge port the image scanning unit scans the image printed on the sheet by using the discharge scanner obtains RGB digital image data and stores the RGB digital image data in the main memory so that the L a b color converting unit can use the RGB digital image data Step S .

Moreover the image scanning unit converts the RGB image data into data on the color difference component Cb Cr and the luminance component Y and stores only the image data on the luminance component Y in the main memory so that the character extracting unit can use the image data on the luminance component Y Step S .

Next the character extracting unit compares the stored luminance component Y i.e. the image data on the luminance component Y generated by the image scanning unit scanning the image printed on the sheet by using the discharge scanner with a predetermined luminance value stored in the flash ROM in advance as a threshold level and converts the image data on the luminance component Y into a binary image in which image data equal to or more than the threshold level is processed as a white pixel bit value is 0 and image data less than the threshold level is processed as a black pixel bit value is 1 . Then a character image is extracted from the binary image and character recognition is performed on this character image Step S . At Step S the character extracting unit refers to the coordinate information shown in and extracts the character image from the position indicated by the coordinate information to perform the character recognition. The extraction of the character image and the character recognition are performed by using a method described for example in Toshiba Review 1997 VOL. 52 NO. 2.

An example of the binary image is shown in . In characters other than NEWS are expressed as . . . . In the present embodiment an example is explained for the case where the part NEWS shown in is specified by the coordinate information. In the binary image shown in first each of the characters N E W and S is recognized by the character recognition.

Next the character extracting unit compares the character string of the specified character string shown in with the character string recognized from the image data on the luminance component Y stored by the image scanning unit Step S .

Then when both of the character strings do not match with each other No at Step S the message transmitting unit transmits a message indicating that the color of the print image cannot be compared with a color of an image on an original to the MFP as a transmission source terminal Step S and the processing ends. At this time the message transmitting unit transmits the message to the MFP by using the SIP instant message.

When both of the character strings match with each other Yes at Step S the system control proceeds to the processing for color converting RGB image data corresponding to the binary character image that is character recognized into L a b . For making a condition determination to be described later easy a method of color converting RGB image data into L a b is employed in the present embodiment.

The character extracting unit first sends image data on a character image area rectangle of N binarized from the image data on the luminance component Y stored by the print color converting unit and image data corresponding to this rectangular area from the RGB image data stored by the print color converting unit to the L a b color converting unit . The L a b color converting unit converts RGB data on each pixel corresponding to a black pixel bit value is 1 in binary pixels in this area into L a b by Equations 1 to 7 described above. When the color of a pixel in the character N is red a of the pixel is a large positive value b is a small positive or negative value and L is a value around 40 to 60. Then the L a b color converting unit calculates the average of each of L a and b for the pixels converted into L a b Step S . At this time a pixel having a value that significantly deviates from the average can be eliminated.

Then it is determined whether a combination of the respective averages of L a and b is included in the hue group specified by the hue group number shown in Step S . For this determination the character extracting unit includes table information indicating a correspondence relationship between the hue group number and the hue range range of each value of L a and b corresponding to the hue group.

When the color of the pixel in the target character is not included in the specified hue group No at Step S that is when the color of the pixel is out of the specified hue range the character extracting unit recognizes that the determination of the color difference is not needed and the processing ends.

In the similar manner the character extracting unit sends the image data on the character image area rectangle of N binarized from the image data on the luminance component Y stored by the image scanning unit and the image data corresponding to this rectangular area from the RGB image data stored by the image scanning unit to the L a b color converting unit . In the similar manner the L a b color converting unit converts RGB data on each pixel corresponding to a black pixel bit value is 1 in the binary pixels into L a b and calculates the average of each of L a and b for the pixels Step S .

Next the system control proceeds to processing for obtaining the color difference that is information indicating a difference in color from the two L a b values. In the present embodiment E94 CIE1994 is used as the color difference. The color difference extracting unit performs a calculation for obtaining E94 by Equations 8 and 9 with the two L a b values as L1 a1 b1 and L2 a2 b2 Step S . square root over 12 2 12 2 12 2 8 94 square root over 12 2 2 2 9 

Next the color difference determining unit compares the value of the obtained color difference E94 with the allowable value of the color difference E94 shown in i.e. the allowable value hereinafter difference condition included in the NSS command received at Step S Step S .

Then when the obtained color difference E94 is larger than the value of the difference condition No at Step S the message transmitting unit transmits a message indicating that the color of the print image printed on the sheet is different from the color of the image on the original to the MFP as a transmission source terminal Step S . At this time the message transmitting unit transmits the message to the MFP by using the SIP instant message.

When the obtained color difference E94 is smaller than the value of the difference condition Yes at Step S the JPEG image data received and stored in the HD is deleted Step S . The stored JPEG image data is deleted when the obtained color difference E94 is smaller than the value of the difference condition and is not deleted when the obtained color difference E94 is larger than the value of the difference condition so that the JPEG image data can be kept if a printed image is not one that a transmitter intends. The JPEG image data is kept so that when color toner is insufficient the stored JPEG image data can be reprinted after supplying the color toner and the processing for comparing the color of the print image with the color of the image on the original can be repeated.

As explained above with the MFP according to the present embodiment when a difference between received image data and a printed image of the image data is equal to or more than a predetermined value information indicating the difference above is transmitted to a transmission source terminal so that a transmitter of the image data can check the print quality.

In the above explanation explanation is given for the example of scanning an image printed on the sheet by the discharge scanner however the discharged sheet can be scanned also by the original scanner . Whereby the present invention can be performed without providing the discharge scanner at the discharge port.

In the above explanation the color difference E94 is calculated by comparing colors of pixels constituting a character. However when pixels around the character are white pixels the average of colors of pixels included in an area including the white pixels can be calculated and the color difference can be calculated by comparing the colors in this whole area. The flow of processing in this case is explained below.

When the L a b color converting unit calculates the average of each of L a and b the L a b color converting unit converts also RGB data on each pixel corresponding to a white pixel bit value is 0 in binary pixels of a character image area rectangle into L a b . When the color of a pixel in the character N is red a of the pixel is a large positive value b is a small positive or negative value and L is a value around 40 to 60. Moreover when the color of other pixels in the rectangular area is white a and b of the pixels are small positive or negative values and L is a value close to 100 the range of L is 0 black to 100 white . When a pixel that does not constitute the character in the rectangular area is such that a and b are small positive or negative values and L is a value close to 100 the L a b color converting unit determines that the color of this pixel is white. Then when it is determined that all of the pixels that do not constitute the character in the rectangular area are white the L a b color converting unit calculates the average of each of a and b for all of the pixels in the rectangular area. The L a b color converting unit calculates the average of L while eliminating the value close to 100 that is determined as white. Then the color difference extracting unit obtains the color difference E94 by using the averages of L a and b .

Moreover in the above explanation at Step S or Step S shown in the message transmitting unit transmits a message to the MFP by using the SIP instant message as an example. Alternatively the similar message can be transmitted to an e mail address of a transmitter. This can be realized by including the e mail address of the transmitter in the NSS command that the image transmitting unit transmits at Step S shown in .

Furthermore in the above explanation as shown in a transmitter directly specifies the value of E94 as an example. Alternatively the MFP on the receiving side can determine the value of E94 based on information transmitted together with an image.

For example when an image is transmitted or received between the MFPs of the same model manufactured by the same maker the design difference in color between a scanned image and a printed image is considered to be small. Therefore when the MFP that receives an image refers to information on the maker code shown in if the maker code is one that indicates the same maker as the own MFP the value with a small allowable range e.g. 1.2 described above is used as the value of E94. This for example corresponds to the case of transmitting an image from the MFP to the MFP with the above configuration.

On the other hand when an image is transmitted or received between the MFPs from different makers the design difference in color between a scanned image and a printed image is considered to be large. Therefore when the MFP that receives an image refers to information on the maker code shown in if the maker code is one that indicates a maker different from the own MFP the value with a large allowable range e.g. 6.5 or 10 described above is used as the value of E94. This for example corresponds to the case of transmitting an image from the MFP to the MFP with the above configuration.

With the example as described above for example even a transmitter who is unfamiliar with an expertise such as E94 can appropriately determine a color on the receiving side.

Moreover in the above explanation the operating unit obtains information on a specified character string at Step S shown in and the information on the specified character string is included in information transmitted by the image transmitting unit at Step S as shown in as an example. Whereby in the MFP on the receiving side the character extracting unit compares the received specified character string with the character string that is recognized from the image data on the luminance component Y stored by the image scanning unit .

Furthermore information on the specified character string can be eliminated from the information shown in by eliminating the processing at Step S. In this case the character extracting unit binarizes the image data on the luminance component Y stored by the print color converting unit and performs the character string recognition in the similar manner to Step S in accordance with the coordinate information shown in . Then at Step S the character extracting unit compares the character string recognized from the image data on the luminance component Y stored by the print color converting unit with the character string recognized from the image data on the luminance component Y stored by the image scanning unit . With this processing also the effect similar to the above can be obtained.

In a second embodiment in the comparison of character strings at Step S shown in explanation is given for the case where even when the character strings do not match with each other this mismatch is allowed and the color difference is determined. Components that are given the same reference numerals as in the first embodiment indicate the same or similar units as those in the first embodiment and explanation thereof is omitted.

The operation form and the configuration of the MFP according to the present embodiment are almost the same as those explained in the first embodiment. In the present embodiment processing in the MFP that transmits an image and processing in the MFP that receives an image are different from the first embodiment.

First the processing in the MFP that transmits an image in the present embodiment is explained. The processing in the case where the MFP transmits an image in the present embodiment is almost the same as the processing explained with reference to however information obtained at Step S is different. At Step S according to the present embodiment the operating unit obtains information of the condition for proceeding to the determination of the color difference i.e. Step S at Step S shown in in addition to the above described specified character string. An example of a screen when a transmitter inputs the information that the MFP obtains at Step S is shown in .

In the similar manner to the first embodiment the specified character string input section is a section for a transmitter inputting a character string to be specified. Similarly to the case of an example in the first embodiment a character string NEWS is input to the specified character string input section .

The allowable number of different characters input section is a section for a transmitter specifying the number of different characters or a percentage of the number of different characters to be allowed in the determination at Step S shown in . The number of different characters is the number of characters that are determined to be different characters as a result of the character comparison at Step S. The application of the information input to the allowable number of different characters input section is explained later.

The allowable number of continuous different characters input section is a section for specifying the allowable number of the number of different characters allowed in the determination at Step S shown in when the different characters are continuous. The application of the information input to the allowable number of continuous different characters input section is explained later.

The similar character allowable level specifying section is a section for determining that a different character having a similar form is not counted as a different character i.e. determining an allowance of a similar character which is indicated by four levels of 0 1 2 and 3 . 0 indicates that a similar character is not allowed. 1 indicates that a character is not counted as a different character if the form of the character is extremely similar.

 2 indicates that a character having a similar form is not counted as a different character although the similarity is lower than the degree of 1 . 3 indicates that a character is not counted as a different character if the form thereof has even a small similarity. The application of the information input to the similar character allowable level specifying section is explained later.

When information is input on the screen shown in the operating unit obtains allowable number of different characters information allowable number of continuous different characters information and information on the allowable level of a similar character at Step S shown in . Such information is obtained so that the NSS command transmitted by the image transmitting unit in the present embodiment at Step S shown in includes information as shown in in addition to the information shown in .

Next the processing in the MFP that receives an image is explained. The processing when the MFP according to the present embodiment receives an image is almost the same as the processing explained in except for the processing at Step S. The processing at Step S according to the present embodiment is explained with reference to . is a flowchart illustrating the processing corresponding to Step S in the first embodiment according to the present embodiment. As shown in in the similar manner to Step S in the first embodiment first the character extracting unit compares the character string of the specified character string shown in with the character string recognized from the image data on the luminance component Y stored by the image scanning unit Step S . The character extracting unit in the present embodiment stores therein information on a table as shown in .

In the table shown in similar characters for respective characters are stored while being classified into the first group the second group and the third group depending on the similarity. For example in a case of a Chinese character a character corresponding to a similarity 1 is an alphabet E a Chinese character and the like a character corresponding to a similarity 2 is alphabets B and F a Chinese character and the like and a character corresponding to a similarity 3 is an alphabet A a number 8 a Chinese character and the like.

At Step S the character extracting unit refers to the table shown in according to a similar character allowable level shown in and compares character strings while taking an allowed similar character as the same character.

When there is no different character No at Step S the character extracting unit determines that characters match Step S and the processing at Step S ends. When there is a different character Yes at Step S the character extracting unit determines whether the number of different characters is larger than the allowable number of continuous different characters shown in Step S .

When the number of different characters is larger the allowable number of continuous different characters Yes at Step S the character extracting unit determines that the character strings do not match Step S and the processing at Step S ends. When the number of different characters is equal to or smaller the allowable number of continuous different characters No at Step S the character extracting unit determines whether the number of different characters is larger than the allowable number of different characters shown in Step S .

At Step S when the allowable number of different characters is specified by the number of characters the character extracting unit compares the specified number of characters with the extracted number of different characters. On the other hand when the allowable number of different characters is specified by a percentage the character extracting unit applies the specified percentage to the total number of characters recognized at Step S and calculates the allowable number of different characters.

When the number of different characters is larger than the allowable number of different characters Yes at Step S the character extracting unit determines that the character strings do not match Step S and the processing at Step S ends. When the number of different characters is equal to or smaller than the allowable number of different characters No at Step S the character extracting unit determines that the characters match Step S and the processing at Step S ends.

As explained above upon receiving an image the MFP in the present embodiment does not take a perfect match of characters as a condition in the character comparison processing performed as the processing for determining whether to determine the color difference but performs the determination of the color difference in the similar manner to the case of the perfect match if the number of different characters is within the allowable range. Whereby when a false recognition of a character occurs in the character recognition the color difference determination is prevented from being canceled.

Moreover in the present embodiment as explained in a transmitter specifies the allowable number of different characters the allowable number of continuous different characters the similar character allowable level and the like in the MFP on the transmitting side of an image. Whereby the above embodiment can be realized without registering information in advance in the MFP on the receiving side of an image.

Furthermore in the present embodiment in the similar manner to the first embodiment the information on the specified character string can be eliminated from the information shown in by eliminating the processing at Step S. In this case the character extracting unit binarizes the image data on the luminance component Y stored by the print color converting unit and performs the character string recognition in the similar manner to Step S according to the coordinate information shown in . Then at Step S the character extracting unit compares the character string recognized from the image data on the luminance component Y stored by the print color converting unit with the character string recognized from the image data on the luminance component Y stored by the image scanning unit . Even with this processing the effect similar to the above can be obtained.

Moreover in the present embodiment explanation is given for the case where a color image is received at Step S however the present embodiment can be applied to the case of receiving a binary image i.e. a monochrome image. In this case the processing at Steps S to S shown in becomes processing corresponding to a binary image. Moreover it is possible to determine whether an image is correctly printed by the processing up to Step S without performing the processing at Step S.

The case of receiving a monochrome image at Step S is explained with reference to the drawings. In this case the condition information for the image comparison is only the allowable number of different characters. An example of information included in the NSS command in this case is shown in . is a diagram illustrating an example of a monochrome image received at Step S. When the MFP receives an image as shown in the MFP first performs a tilt correction and a layout analysis on the received image and divides the image into blocks as indicated by dotted lines in .

As shown in an example is given for the case where the image is divided into a block A that includes a type character a block B that includes a handwriting character and a block C that includes others e.g. drawings . O in the block A represents an abstraction of a character. In the tilt correction and the block division various known methods can be employed and detailed explanation thereof is omitted.

Next the print output unit prints the monochrome image on the sheet by using the print engine corresponding to Step S and the image scanning unit scans the image printed on the sheet by using the discharge scanner corresponding to Step S . In the printing by the print engine as shown in the image is printed with a vertical line drawn thereon as an example.

In this case a character extracting unit recognizes characters in the first line in the block A as this material relates to a function of a parent product. in Japanese corresponding to Step S . Next a character difference determining unit compares the character string extracted from the received binary image data with the character string extracted from the binary image data scanned from the sheet by an image scanning unit for each of the block A and the block B corresponding to Step S .

In different characters in the block A as a result of the comparison are represented by surrounding them by a frame. In this case five characters are different. In the block B there is no different character. Next the character difference determining unit determines whether the number of different characters is equal to or lower than the allowable number of different characters shown in corresponding to Step S . When the allowable number of different characters is three because the number of different characters is larger than the allowable number of different characters the message transmitting unit transmits a message indicating that there is a problem in quality of the print image printed on the sheet to the MFP as a transmission source terminal corresponding to Step S .

In a third embodiment a difference between a received image and a printed image is determined when there is a missing portion or a stain in the image printed on the sheet .

First the processing in the MFP that transmits a color image in the present embodiment is explained. is a functional configuration diagram when the MFP according to the third embodiment functions as a transmitter. As shown in the MFP according to the present embodiment mainly includes the image scanning unit an image transmitting unit a display control unit the operating unit and the message receiving unit . The function and the configuration of the image scanning unit the operating unit and the message receiving unit are similar to those of the MFP in the first embodiment.

When a transmitter sets an original on the original scanner and selects a button for specifying an allowable level of a shape difference of an image displayed on the LCD the display control unit in the present embodiment displays an allowable level specifying screen of the shape difference of the image.

A transmitter can specify the allowable level by selecting the preset numerical value. When the transmitter selects the allowable level the operating unit obtains information on the allowable level. Then when the transmitter specifies a transmission destination and presses a start button the image transmitting unit transmits JPEG encoded image data to the MFP by the communication procedure shown in together with the allowable level of the shape difference of the image and the processing ends. The image transmitting unit transmits the allowable level of the shape difference of the image while including it in the NSS command. is an explanatory diagram illustrating an example of the NSS command according to the third embodiment. As shown in the specified allowable level of the shape difference of the image is set in the last 1 byte field of the NSS command.

Next explanation is given for the case where the MFP according to the present embodiment functions as a receiver. is a block diagram illustrating a functional configuration of the MFP according to the third embodiment. As shown in the MFP according to the present embodiment mainly includes the image receiving unit the image storing unit a region of interest ROI image generating unit an image difference determining unit the print color converting unit the print output unit the image scanning unit the configuration information storing unit and the message transmitting unit . The function and the configuration of the image receiving unit the image storing unit the print color converting unit the print output unit the image scanning unit the configuration information storing unit and the message transmitting unit are similar to those of the MFP in the first embodiment.

The ROI image generating unit generates a ROI REGION OF INTEREST candidate image from RGB image data for one page and further generates a ROI image from the ROI candidate image.

The ROI image is an image indicating a region of interest including a defective portion and the ROI candidate image is an image that is generated at a stage prior to the ROI image and indicates an area to be a candidate for a region of interest. In the present embodiment a missing defect and a stain defect are detected by using the ROI image and the ROI candidate image. Moreover in the present embodiment a method described in Japanese Patent Application Laid open No. 2005 205748 is used for generating the ROI image and the ROI candidate image.

The ROI image and the ROI candidate image are generated by the ROI image generating unit by the following manner. With RGB image data converted from the JPEG image data received from the MFP as a reference image the RGB image data is converted into YMCK image data to be printed on the sheet and RGB image data obtained by scanning the sheet is used as an inspection image.

The ROI image generating unit divides each of the reference image and the inspection image into an R component a G component and a B component and neighborhood minimum value selection difference processing is performed to generate a neighborhood minimum value selection difference image for each component. Then the RGB components of the neighborhood minimum value selection difference images are synthesized which is subjected to MAX processing to generate the ROI candidate image.

Then the ROI image generating unit generates the ROI image by performing dynamic binarization processing line thickening processing and labeling processing on the generated ROI candidate image. The dynamic binarization processing is processing for binarizing the entire screen by obtaining a threshold for each block after dividing the image into a plurality of rectangular areas blocks with a predetermined size.

A method described in Japanese Patent Application Laid open No. 2005 205748 paragraphs 0040 0049 is used for details of the neighborhood minimum value selection difference processing and the labeling processing.

The image difference determining unit detects the missing defect and the stain defect of an image by using the ROI image and the ROI candidate image. Specifically the image difference determining unit detects the missing defect and the stain defect by determining whether a difference between image data received from the MFP and image data obtained by scanning an image printed on the sheet by the image scanning unit is within the range of the allowable level of the shape difference of the image received from the MFP by using the ROI image and the ROI candidate image. In the present embodiment a method described in Japanese Patent Application Laid open No. 2005 205748 paragraphs 0050 0058 is used for the detection of the missing defect and the stain defect by using the ROI image and the ROI candidate image. However the method is not limited thereto and the detection of the missing defect and the stain defect can be performed by any method.

Next explanation is given for the operation by the MFP in the present embodiment configured as above when receiving color image data transmitted from the MFP . are flowcharts illustrating a procedure of processing for a defect determination of color image data after receiving the color image data. is an explanatory diagram illustrating a flow of processing up to the defect determination of color image data mainly from the viewpoint of an image to be generated.

In the present embodiment the missing defect and the stain defect of image data are detected. In the MFP when the image receiving unit receives JPEG image data transmitted from the MFP the image storing unit stores the received JPEG image data in the HD Step S . The MFP also receives the NSS command shown in at Step S.

Next the print color converting unit performs the expansion decoding processing conforming to JPEG on the JPEG image data stored in the HD to convert the image data separated into the color difference component Cb Cr and the luminance component Y into RGB image data and convert the RGB image data into print image data of yellow Y magenta M cyan C and black K Step S . At this time the print color converting unit stores the generated RGB image data in the main memory as the reference image data.

Next the ROI image generating unit performs the neighborhood minimum value selection difference processing and the MAX processing on this RGB image data to generate the ROI candidate image Step S . Then the ROI image generating unit performs the dynamic binarization processing the line thickening processing and the labeling processing on this ROI candidate image to generate the ROI image Step S .

Next the print output unit prints the image data converted into YMCK on the sheet by using the print engine Step S .

Next when the sheet on which the image data is printed passes the discharge port the image scanning unit scans the image printed on the sheet by using the discharge scanner to obtain RGB image data Step S . Then this RGB image data is used as the inspection image data.

Next the missing defect determination is explained. Upon scanning the RGB image data as the inspection image data the image difference determining unit performs the difference processing on the RGB image data as the inspection image data from the RGB image data as the reference image for each of the RGB components of the RGB image data synthesizes the RGB components and performs the MAX processing to generate a missing candidate image Step S . The difference processing is performed in a saturation mode and when the result of the difference is negative minus it is clipped to zero.

Next the image difference determining unit performs MIN processing with the missing candidate image and the ROI candidate image to generate a neighborhood minimum value missing image Step S .

Next the image difference determining unit performs AND processing on the neighborhood minimum value missing image and the ROI image to generate a missing inspection image Step S .

Next the image difference determining unit calculates an average density and a labeling area value of a ROI minimum rectangular area or a minimum rectangular area circumscribing the ROI for each label in the missing inspection image. When they are larger than a predetermined setting value the label is determined as the missing defect Step S . Then the image difference determining unit calculates a ratio of the number of labels determined as the missing defect to the number of all of the labels and determines whether the ratio is within the allowable level of the shape difference of the image received from the MFP Step S . Then when the ratio of the number of the labels determined as the missing defect exceeds the allowable level No at Step S the message transmitting unit transmits a message indicating that a print image printed on the sheet has a missing portion to the MFP as a transmission source terminal Step S . is a diagram illustrating a print example when the missing defect occurs in an image.

On the other hand when the ratio of the number of the labels determined as the missing defect is equal to or lower than the allowable level Yes at Step S it is determined that the print image does not have a missing defect and the image storing unit deletes JPEG image data stored in the HD Step S .

Next the stain defect determination is explained. Upon scanning the RGB image data as the inspection image data at Step S the image difference determining unit performs the difference processing on the RGB image data as the inspection image with the RGB image data as the reference image data for each of the RGB components of the RGB image data synthesizes the RGB components and performs the MAX processing to generate a stain candidate image Step S .

Next the image difference determining unit performs the MIN processing with the stain candidate image and the ROI candidate image to generate a neighborhood minimum value stain image Step S .

Next the image difference determining unit performs the AND processing on the neighborhood minimum value stain image and the ROI image to generate a stain inspection image Step S .

Next the image difference determining unit calculates the average density and the labeling area value of a ROI or a minimum rectangular area circumscribing the ROI for each label in the stain inspection image. When they are larger than a predetermined setting value the label is determined as the stain defect Step S . Then the image difference determining unit calculates a ratio of the number of labels determined as the stain defect to the number of all of the labels and determines whether the ratio is within the allowable level of the shape difference of the image received from the MFP Step S . Then when the ratio of the number of the labels determined as the stain defect exceeds the allowable level No at Step S the message transmitting unit transmits a message indicating that a print image printed on the sheet has a stain portion to the MFP as a transmission source terminal Step S .

On the other hand when the ratio of the number of the labels determined as the stain defect is equal to or lower than the allowable level Yes at Step S it is determined that the print image does not have a stain defect and the image storing unit deletes JPEG image data stored in the HD Step S .

In this manner in the present embodiment it is possible to check whether there is a defect i.e. a missing portion and a stain on an image printed on the side of the MFP so that reliability of the MFPs and can be improved.

Each function described above can be realized by a computer executable program written in a legacy programming language such as assembler C C C and Java registered trademark an object oriented programming language or the like. The computer executable program can be stored in a recording medium readable by the apparatus such as a ROM an electrically erasable programmable read only memory EEPROM an erasable programmable read only memory EPROM a flash memory a flexible disk a compact disc ROM CD ROM a compact disc rewritable CD RW a digital versatile disc DVD a secure digital SD card and a magneto optical MO disc for distribution.

According to an aspect of the present invention a transmitter can check the quality of an image printed by a receiving side apparatus. Thus reliability of an image communication apparatus is improved.

Although the invention has been described with respect to specific embodiments for a complete and clear disclosure the appended claims are not to be thus limited but are to be construed as embodying all modifications and alternative constructions that may occur to one skilled in the art that fairly fall within the basic teaching herein set forth.

