---

title: Fuel dispensing payment system for secure evaluation of cardholder data
abstract: A system used in a retail environment for providing end-to-end encryption of payment cardholder data. An input device configured to receive cardholder data is operative to encrypt the cardholder data according to a first encryption method to produce first encrypted cardholder data. A cardholder data handling device is in electronic communication with the input device. A secure evaluation assembly (SEA) is operatively connected to the cardholder data handling device and comprises antitampering control electronics adapted to decrypt the first encrypted cardholder data to produce unencrypted cardholder data. The antitampering control electronics evaluate the unencrypted cardholder data to determine whether the unencrypted cardholder data is payment cardholder data or nonsensitive cardholder data. Finally, if the unencrypted cardholder data is payment cardholder data, the antitampering control electronics of the SEA are adapted to encrypt the unencrypted cardholder data according to a second encryption method to produce second encrypted cardholder data.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09262760&OS=09262760&RS=09262760
owner: Gilbarco, S.r.l.
number: 09262760
owner_city: Florence
owner_country: IT
publication_date: 20101222
---
The present invention relates generally to fuel dispensing and other retail payment systems. More particularly the invention relates to a device and method for creating a secure evaluation assembly at a retail terminal or point of sale POS and securely evaluating an encrypted communication from the terminal or POS to a host computer.

Payment systems have been incorporated into fueling sites in order to allow a customer to pay for fuel and other goods and services such as fast food or convenience store products using a credit or debit card. Loyalty or program specific cards that entitle the customer to a fixed credit or percentage discount or other favorable pricing are also typically accepted.

Such payment systems comprise various input devices such as card readers and PIN pads that are configured to accept data necessary to process the payment. The customer may provide certain payment data by swiping a payment card bearing a magnetic stripe through a card reader. Data stored in the magnetic stripe may include a Primary Account Number PAN the cardholder s name a service code and the card s expiration date. Also if required to complete the transaction the customer may enter a personal identification number PIN using a PIN pad. The system communicates the data to a remote host system responsible for the customer s account for verification.

Because of the continuing challenges fraud poses to customers merchants and banks among others payment card companies are requiring more and more security during payment card transactions. For example organizations that process store or transmit payment cardholder data must comply with certain industry standards. Merchants and service providers must demonstrate compliance with the standards on a recurrent basis a costly and complex process.

One method of processing and transmitting payment cardholder data is known as end to end encryption E2EE . In a typical implementation of E2EE cardholder data is encrypted at an input device and remains encrypted until it reaches its intended destination usually a host computer . Payment cardholder data is never accessible to a merchant in clear text form as it passes through intermediate system components.

Although use of E2EE provides a high level of security for payment cardholder data it presents certain problems for merchants. For example merchants require portions of the payment cardholder data for reconciliation purposes. However in a system employing E2EE merchants cannot access the cardholder data after it is encrypted at an input device. Thus if a customer disputes a transaction the merchant cannot verify the PAN in order to prove that the transaction occurred. Likewise the merchant cannot credit a customer s account or manually complete a transaction that was previously declined in error.

Further industry standards governing payment card transactions typically do not apply to nonsensitive cardholder data from other cards processed on site or in a private retailer s network such as data from loyalty or program specific cards. However in an E2EE system this data is encrypted at the input device along with payment cardholder data. Thus for example the merchant cannot access loyalty card data in order to give the customer credit for a transaction.

The present invention recognizes and addresses disadvantages of prior art constructions and methods. In one aspect the present invention provides a system used in a retail environment for providing end to end encryption of payment cardholder data. The system comprises an input device configured to receive cardholder data. The input device is operative to encrypt the cardholder data according to a first encryption method to produce first encrypted cardholder data. The system also comprises a cardholder data handling device in electronic communication with the input device. A secure evaluation assembly is operatively connected to the cardholder data handling device and the secure evaluation assembly comprises antitampering control electronics adapted to decrypt the first encrypted cardholder data to produce unencrypted cardholder data. The antitampering control electronics of the secure evaluation assembly evaluate the unencrypted cardholder data to determine whether the unencrypted cardholder data is payment cardholder data or nonsensitive cardholder data. Finally if the unencrypted cardholder data is payment cardholder data the antitampering control electronics of the secure evaluation assembly are adapted to encrypt the unencrypted cardholder data according to a second encryption method to produce second encrypted cardholder data.

According to a further aspect the present invention provides a secure evaluation assembly in which an encrypted communication of cardholder data from an input device to a remote host processing system may be securely evaluated. The secure evaluation assembly comprises antitampering control electronics and a secure evaluation assembly memory. The secure evaluation assembly memory contains information needed to decrypt data encrypted according to a first encryption method and information needed to encrypt data according to a second encryption method. Further the secure evaluation assembly memory is encrypted according to a third encryption method. The antitampering control electronics are adapted to decrypt the secure evaluation assembly memory and are further adapted to decrypt cardholder data encrypted according to the first encryption method to produce unencrypted cardholder data. Finally the antitampering control electronics are further adapted to evaluate the unencrypted cardholder data and encrypt the unencrypted cardholder data according to the second encryption method if the unencrypted cardholder data is payment cardholder data.

In a further aspect the present invention provides a method for processing a transaction involving cardholder data in a retail payment system. The method comprises receiving cardholder data at an input device and encrypting the cardholder data according to a first encryption method to produce first encrypted cardholder data. The method further comprises receiving the first encrypted cardholder data at a secure evaluation assembly coupled to a cardholder data handling device and decrypting the first encrypted cardholder data to produce unencrypted cardholder data. In addition the method comprises evaluating the unencrypted cardholder data in an antitampering control electronics to determine whether the unencrypted cardholder data is payment cardholder data or nonsensitive cardholder data. Finally the method comprises encrypting the unencrypted cardholder data according to a second encryption method to produce second encrypted cardholder data if the unencrypted cardholder data is payment cardholder data.

Those skilled in the art will appreciate the scope of the present invention and realize additional aspects thereof after reading the following detailed description of the preferred embodiments in association with the accompanying drawing figures.

Repeat use of reference characters in the present specification and drawings is intended to represent same or analogous features or elements of the invention.

Reference will now be made in detail to presently preferred embodiments of the invention one or more examples of which are illustrated in the accompanying drawings. Each example is provided by way of explanation of the invention not limitation of the invention. In fact it will be apparent to those skilled in the art that modifications and variations can be made in the present invention without departing from the scope or spirit thereof. For instance features illustrated or described as part of one embodiment may be used on another embodiment to yield a still further embodiment. Thus it is intended that the present invention covers such modifications and variations as come within the scope of the appended claims and their equivalents.

As used herein payment cardholder data refers to information associated with a payment cardholder including a PAN or other account number the cardholder s name a service code and the card s expiration date. Nonsensitive cardholder data refers to data associated with payment devices processed on site or in a private retailer s network such as data from loyalty or program specific cards. Because data received at an input device is immediately encrypted as described below the system may not be able to distinguish between payment cardholder data and nonsensitive cardholder data until the data are evaluated in the secure evaluation assembly SEA . Thus as used herein cardholder data refers to either or both of payment cardholder data and nonsensitive cardholder data before evaluation in the SEA.

Embodiments of the present invention provide a retail payment system which enables E2EE of payment cardholder data while allowing access to nonsensitive cardholder data. The system comprises an SEA in which cardholder data encrypted according to a first encryption method and transmitted from an input device may be securely evaluated. In some embodiments the SEA may comprise a dongle having an antitampering chip. If the SEA determines that encrypted cardholder data transmitted from an input device is nonsensitive cardholder data the data may be made available in clear text form for local processing. If the SEA determines that the encrypted cardholder data is payment cardholder data the data may be encrypted according to a second encryption method and transmitted to a remote host network for authentication. Because the system provides E2EE of payment cardholder data a merchant is unable to access payment cardholder data in clear text form. In further embodiments a merchant may be able to reconcile or validate one or more transactions via the SEA.

The term encryption method as used herein refers to encryption schemes algorithms and or keys used to encrypt and decrypt cardholder data. The first encryption method may be the same as the second encryption method but they may utilize different algorithms. It should be further understood that the two encryption methods may utilize the same or similar encryption algorithms but may utilize different encryption keys. That is the first and second encryption methods may utilize the same or different schemes standards algorithms and or keys. In many embodiments the first encryption method may be provided by the vendor of the device tasked with transmitting the cardholder data to the SEA. Alternatively the first encryption method is injected into the input device and the SEA. The second encryption method may be provided by a financial institution operatively connected to the retail payment system.

Any suitable encryption method known to those of skill in the art may be used in accordance with the present invention but the method used may preferably comply with or exceed industry standards. For example the encryption methods may include Rivest Shamir Adelman RSA and triple Data Encryption Standard DES . Also as those of skill in the art will appreciate the encryption method used may be dictated by encryption methods required by a host network. Background information on encryption in retail environments is provided in U.S. Pat. No. 5 448 638 entitled Security Apparatus and System for Retail Environments hereby incorporated by reference in its entirety for all purposes.

Finally as used herein the term input device broadly refers to secure devices capable of receiving payment cardholder data and nonsensitive cardholder data including but not limited to encrypting PIN pads keypads touchscreens secure card readers and smartcard readers. Desirably all input devices used in accordance with the present invention comprise a secure encryption processor and a memory or storage unit. The memory of the input devices stores one or more encryption algorithms keys and or ciphers used to immediately encrypt cardholder data upon receipt according to the first encryption method. In a preferred embodiment the input devices may allow triple DES derived unique key per transaction DUKPT encryption of cardholder data.

The input devices are also preferably configured to be antitampering so that in the case of unauthorized access the input device s contents including data contained in or handled by the input device s processor are erased deleted or destroyed. Alternatively any portion of the contents of the input device sufficient to identify payment cardholder data is erased should the input device be tampered with. However those of skill in the art will appreciate that in some embodiments where an input device is adapted to encrypt cardholder data such as via an encrypting head the input device may not need to be antitampering. Also in preferred embodiments the input devices may be further adapted to prevent real time skimming or theft of cardholder data.

Some embodiments of the present invention are particularly suitable for use in transactions in a retail service station environment and the below discussion will describe preferred embodiments in that context. However those of skill in the art will understand that the present invention is not so limited. In fact it is contemplated that the present invention be used with any appropriate retail environment.

Referring now to an exemplary fueling environment may comprise a central building a car wash and a plurality of fueling islands . The central building need not be centrally located within the fueling environment but rather is the focus of the fueling environment and may house a convenience store and or a quick serve restaurant therein. Both the convenience store and the quick serve restaurant may include a point of sale POS respectively. POS may comprise a single computer or server operatively connected to an associated card reader and payment terminal. Additionally POS may include a display a touch screen and or other input devices.

The central building may further house a site controller SC which in an exemplary embodiment may be the PASSPORT POS system sold by Gilbarco Inc. of Greensboro N.C. although third party site controllers may be used. Site controller may control the authorization of fueling transactions and other conventional activities as is well understood and site controller may preferably be in operative communication with each POS. Alternatively site controller may be incorporated into a POS such as point of sale if needed or desired.

Further site controller may have an off site communication link allowing communication with a remote host processing system for credit debit card authorization content provision reporting purposes or the like as needed or desired. In one embodiment communication link may be a stand alone router switch or gateway although it should be appreciated that site controller may additionally perform the functions of and therefore replace such a device. The off site communication link may be routed through the Public Switched Telephone Network PSTN the Internet both or the like as needed or desired. Remote host processing system may comprise at least one server maintained by a third party such as a financial institution. Although only one remote host processing system is illustrated those of skill in the art will appreciate that in a retail payment system allowing payment via payment devices issued by multiple payment card companies or financial institutions site controller may be in communication with a plurality of remote host processing systems .

Car wash may have a POS associated therewith that communicates with site controller for inventory and or sales purposes. Car wash alternatively may be a stand alone unit. Note that car wash convenience store and quick serve restaurant are all optional and need not be present in a given fueling environment.

Fueling islands may have one or more fuel dispensers positioned thereon. Fuel dispensers may be for example the ENCORE sold by Gilbarco Inc. of Greensboro N.C. Fuel dispensers are in electronic communication with site controller through any suitable link such as two wire RS 422 Ethernet wireless etc. if needed or desired.

Fueling environment also has one or more underground storage tanks USTs adapted to hold fuel therein. As such USTs may each be a double walled tank. Further each UST may include a tank monitor TM associated therewith. Tank monitors may communicate with fuel dispensers either through site controller or directly as needed or desired to determine amounts of fuel dispensed and compare fuel dispensed to current levels of fuel within USTs to determine if USTs are leaking.

Tank monitor may communicate with site controller and further may have an off site communication link for leak detection reporting inventory reporting or the like. Much like off site communication link off site communication link may be through the PSTN the Internet both or the like. If off site communication link is present off site communication link need not be present and vice versa although both links may be present if needed or desired.

Further information on and examples of fuel dispensers and retail fueling environments are provided in U.S. Pat. No. 6 453 204 entitled Fuel Dispensing System U.S. Pat. No. 5 956 259 entitled Intelligent Fueling U.S. Pat. No. 5 734 851 entitled Multimedia Video Graphics in Fuel Dispensers U.S. Pat. No. 6 052 629 entitled Internet Capable Browser Dispenser Architecture U.S. Pat. No. 5 689 071 entitled Wide Range High Accuracy Flow Meter U.S. Pat. No. 6 935 191 entitled Fuel Dispenser Fuel Flow Meter Device System and Method and U.S. Pat. No. 7 289 877 entitled Fuel Dispensing System for Cash Customers all of which are hereby incorporated by reference in their entireties for all purposes. An exemplary tank monitor may be the TLS 350R manufactured and sold by the Veeder Root Company of Simsbury Conn. For more information about tank monitors and their operation reference is made to U.S. Pat. No. 5 423 457 entitled Real time tank product loss detection system U.S. Pat. No. 5 400 253 entitled Automated Statistical Inventory Reconciliation System for Convenience Stores and Auto truck Service Stations U.S. Pat. No. 5 319 545 entitled System to Monitor Multiple Fuel Dispensers and Fuel Supply Tank and U.S. Pat. No. 4 977 528 entitled Apparatus and Method for Determining the Amount of Material in A Tank all of which are hereby incorporated by reference in their entireties for all purposes.

The memory of control system may be any memory or computer readable medium as long as it is capable of being accessed by the control system including random access memory RAM read only memory ROM erasable programmable ROM EPROM or electrically EPROM EEPROM CD ROM DVD or other optical disk storage solid state drive SSD magnetic disc storage including floppy or hard drives any type of non volatile memories such as secure digital SD flash memory memory stick or any other medium that may be used to carry or store computer program code in the form of computer executable programs instructions or data. Control system may also include a portion of memory accessible only to control system .

In the illustrated embodiment dispenser has a base and a top with a canopy supported by two side panels . Fuel dispenser is subdivided into multiple compartments. A hydraulic area encloses hydraulic components and an electronic area encloses electronic components. A vapor barrier may be used to separate the hydraulic area from the electronic area .

Several components used to control fuel flow may be housed within the hydraulic area . Fuel from USTs is pumped through a piping network into inlet pipe . Fuel being dispensed passes though a meter which is responsive to flow rate or volume. A displacement sensor is employed to generate a signal in response to fuel flow though the meter . Control data lines provide a signaling path from sensor to control system and provide signals to control system indicative of the flow of fuel being dispensed. Control data lines may provide control signaling to a valve that may be opened and closed to permit or not permit dispensing of fuel.

Meter flow measurements from sensor are collected by control system . Control system also typically performs calculations such as cost associated with a fuel dispensing transaction. Additionally control system controls transactional processing at fuel dispenser as will be described in more detail below.

As a dispensing transaction progresses fuel is then delivered to a hose and through a nozzle into the customer s vehicle. Dispenser includes a nozzle boot which may be used to hold and retain nozzle when not in use. Nozzle boot may include a mechanical or electronic switch to indicate when nozzle has been removed for a fuel dispensing request and when nozzle has been replaced signifying the end of a fueling transaction. A control line provides a signaling path from the electronic switch to control system . Control system may use signaling received via the control line in order to make a determination as to when a transaction has been initiated or completed.

Control data lines provide electronic communication between control system and a user interface . User interface includes various combinations of subsystems to facilitate customer interaction with dispenser and acceptance of payment for dispensed fuel. A bezel acts as a lip around the various subsystems of interface . In most cases bezel is flush with the face of the fuel dispenser however in some embodiments it may extend outwardly from the face in effect forming a raised lip. Bezel may also comprise a plurality of sections that frame or house various subsystems or components.

As shown user interface includes several input devices. For example user interface may include a keypad . Keypad is typically used for entry of a PIN if the customer is using a debit card for payment of fuel or other goods or services. In a preferred embodiment keypad may be the FlexPay encrypting PIN pad offered by Gilbarco Inc.

User interface may also include a secure card reader for accepting credit debit or other magnetic stripe cards for payment. Additionally secure card reader may accept loyalty or program specific cards as described above. Card reader comprises a mechanism for receiving payment card data such as a read head in the case of a magnetic stripe card reader as well as at least one input output I O port for receiving and loading the encryption keys of the first encryption method. In presently preferred embodiments card reader may be analogous to the MagTek PermaSeal secure card reader or the FlexPay secure card reader offered by Gilbarco Inc.

User interface may also include other input devices such as a contactless card reader e.g. for integrated circuit or smart cards . Further user interface may include other payment or transactional devices such as a bill acceptor a receipt printer and a change delivery device . Receipt printer may provide a customer with a receipt with a recording of the transaction carried out at fuel dispenser . Change delivery device may deliver change to a customer for overpayment. Other transactional devices such as an optical reader and a biometric reader are also contemplated.

A display may be used to display information such as transaction related prompts and advertising to the customer. In some embodiments a touch screen may be used for display . In this case display may be configured to display a virtual keypad for receiving payment data such as a PIN of a debit card or the billing zip code of a credit card for instance. Display may also be used to receive a selection from the customer regarding the displayed information.

The customer may use soft keys to respond to information requests presented to the user via the display . An intercom may be provided to generate audible cues for the customer and to allow the customer to interact with an attendant. In addition dispenser may include a transaction price total display that presents the customer with the price for fuel that is dispensed. A transaction gallon total display may be used to present the customer with the measurement of fuel dispensed in units of gallons or liters. Octane selection buttons may be provided for the customer to select which grade of fuel is to be dispensed before dispensing is initiated. Finally price per unit PPU displays may be provided to show the price per unit of fuel dispensed in either gallons or liters depending on the programming of dispenser .

According to embodiments of the present invention any device in the retail payment system which handles or processes cardholder data hereinafter a cardholder data handling device including the input devices described above may be equipped with an SEA. As described in more detail below an SEA preferably comprises antitampering control electronics and encrypted memory. The SEA may be adapted to receive encrypted cardholder data from one or more input devices and evaluate the data within the antitampering control electronics to determine whether it is payment cardholder data or nonsensitive cardholder data. The SEA may also comprise an encrypted transaction log against which encrypted payment cardholder data may be compared for reconciliation or validation purposes.

As shown for example an SEA may be operatively connected to any of site controller POS and fuel dispenser control system . Site controller and POS are shown as separate devices in but it will be appreciated that site controller may be incorporated into a POS as noted above. In a preferred embodiment the SEA may comprise a dongle that may be coupled to a cardholder data handling device. For example SEA may have a universal serial bus USB interface that may connect to a USB port at POS . Alternatively the dongle may be located inside of fuel dispenser and connected to a USB interface at control system . Although the SEA may communicate with a cardholder data handling device via any suitable interface including but not limited to Ethernet and parallel and serial interfaces those of skill in the art will appreciate that the high communications speed that a USB interface offers may be desirable for certain functions of the SEA including reconciliation. Further where the SEA is implemented as a dongle the SEA may be easily moved from one cardholder data handling device to another in case the first device malfunctions.

According to an alternative embodiment the SEA may be implemented as an antitampering central processing unit CPU rather than as a dongle. As with the dongle embodiment the CPU may be provided in any cardholder data handling device. In some cases the CPU may replace and perform the functions of the device s processor or control system. The CPU may comprise an encrypted memory that may be analogous to the encrypted SEA memory described below. This encrypted memory may be in addition to other internal memory of the CPU. In the alternative the CPU may communicate with an encrypted SEA memory external to the CPU. In one embodiment the antitampering CPU may be analogous to the secure controller described in U.S. Pre Grant Pub. No. 2009 0265638 entitled System and Method for Controlling Secure Content and Non secure Content at a Fuel Dispenser or Other Retail Device hereby incorporated by reference in its entirety for all purposes.

Although embodiments are contemplated in which more than one SEA is provided a retail payment system according to the present invention may preferably comprise a single SEA which receives and evaluates all encrypted cardholder data transmitted through the system. In other words SEA may evaluate encrypted cardholder data transmitted by an input device regardless of the location of SEA and input device . For example if POS comprises SEA and a customer provides cardholder data via an input device at fuel dispenser the encrypted cardholder data is still transmitted to SEA for evaluation. Those of skill in the art will appreciate that this may facilitate compliance with industry standards.

The SEA preferably comprises encrypted SEA memory and antitampering control electronics. The antitampering control electronics may also comprise internal memory. These memories may comprise computer executable program code or instructions that when executed by the antitampering control electronics perform one or more steps of the processes described above and in more detail below. The memories may also comprise data and one or more data structures for storing information. The computer executable program code or instructions in this scenario as should be known to those skilled in the art usually include one or more application programs other program modules program data firmware and or an operating system.

As shown for example SEA comprises an SEA memory and antitampering control electronics having internal memory . A power supply such as a battery or the like may be provided to preserve the integrity of data in memory and power antitampering control electronics when the SEA is not connected to a primary power source such as a cardholder data handling device. Communications to and from SEA may pass through a USB interface as discussed above.

The antitampering control electronics may preferably be implemented as a secure integrated circuit IC or chip. Further the antitampering control electronics preferably incorporates physical and or logical protection mechanisms designed to deter tampering. In a presently preferred embodiment antitampering control electronics may be the USIP Professional IC sold by Maxim Integrated Products Inc. of Sunnyvale Calif. However those of skill in the art will appreciate that any control electronics providing analogous functionality may be used for control electronics . Importantly the antitampering control electronics are preferably programmed to disallow passage of payment cardholder data from the SEA unless it is encrypted according to the second encryption method.

The internal memory of the antitampering control electronics may comprise any type of memory as discussed above in reference to control system and may preferably store one or more encryption algorithms keys and or ciphers used to communicate with the encrypted SEA memory according to a third encryption method. In one embodiment internal memory may comprise a static random access memory SRAM . Also in the case of unauthorized access the protection mechanisms described above are preferably enabled to erase delete or destroy the contents of the internal memory. Thus for example if a thief attempts to obtain the decryption keys for the third encryption method from memory by tampering with antitampering control electronics the protection mechanisms may cause the decryption keys for the third encryption method or the entirety of memory to be erased. In either case encrypted SEA memory would no longer be readable. Further the internal memory of the antitampering control electronics may include a card processing engine. In particular the card processing engine may evaluate cardholder data that has been decrypted within the antitampering control electronics to determine whether the cardholder data should be encrypted according to the second encryption method and transmitted to a remote host processing system or made available in clear text form for local processing.

As noted above SEA memory may be encrypted according to a third encryption method. Preferably the antitampering control electronics may employ on the fly encryption OTFE to read from and write to the encrypted SEA memory. The third encryption method is preferably distinct from the first and second encryption methods and in one embodiment the third encryption method may be the 128 bit Advanced Encryption Standard AES 128 . Desirably the USIP chip may perform OTFE of an SEA memory using AES 128.

In preferred embodiments SEA memory may preferably be injected with the decryption keys for the first encryption method and the encryption keys for the second encryption method. Thereby antitampering control electronics may decrypt cardholder data transmitted to SEA from an input device and encrypt payment cardholder data before transmitting it to a remote host processing system. SEA memory may preferably comprise flash memory but as with the internal memory of the antitampering control electronics discussed above the SEA memory may comprise any suitable type of memory. Also as described in more detail below encrypted SEA memory preferably stores a site configuration file against which cardholder data may be compared and a log file for reconciliation or validation purposes.

As discussed above antitampering control electronics may preferably employ OTFE when accessing SEA memory . Thus SEA memory and or the relevant data stored thereon may be automatically decrypted and encrypted using the keys of the third encryption method each time antitampering control electronics reads from or writes to SEA memory .

Next antitampering control electronics may access a site configuration file stored in memory step . Further using the decryption keys of the first encryption method antitampering control electronics may decrypt the cardholder data step . The site configuration file preferably contains criteria that antitampering control electronics may use to determine whether the cardholder data is payment cardholder data or nonsensitive cardholder data. Where an input device is adapted to receive payment cardholder data issued by more than one financial institution the site configuration file may also contain a lookup table associating a portion of payment cardholder data such as the first six digits of the PAN with a particular financial institution.

Next antitampering control electronics may compare the cardholder data against the site configuration file stored in memory to determine whether the cardholder data is payment cardholder data or nonsensitive cardholder data step . If the data is payment cardholder data antitampering control electronics may store a record of the transaction in a log file in memory step . The stored data may include the total amount of the transaction and at least a portion of the payment cardholder data such as the PAN associated with the customer s account. A merchant may require this information for various reasons such as for accounting or reporting.

In an alternative embodiment discussed in more detail below antitampering control electronics may instead store only a transaction lookup reference number in memory . The transaction lookup reference number may be unique to each transaction. In this case the transaction details may be stored in a log file in an external memory such as that of the cardholder data handling device or a remote system along with the associated transaction lookup reference number. Thereby payment cardholder data may remain securely encrypted without eliminating the ability of the merchant to perform transaction validation.

In any case antitampering control electronics may then encrypt the payment cardholder data using the encryption keys of the second encryption method stored in memory step . In one embodiment the same second encryption method is used irrespective of the financial institution to which the payment cardholder data corresponds. In another embodiment the site configuration file in memory is used to identify which second encryption method to use when encrypting the payment cardholder data. In particular the lookup table in the site configuration file may also contain the second encryption scheme required by each financial institution. In such an embodiment multiple second encryption methods corresponding to respective financial institutions may also be stored within memory . Once the antitampering control electronics identifies the financial institution associated with the payment cardholder data the applicable second encryption method is selected and used to encrypt the payment cardholder data.

Antitampering control electronics may finally transmit the encrypted payment cardholder data to remote host processing system step . The process then ends step . The remote host processing system may return a message either authorizing or denying authorization of the payment card transaction. According to a further embodiment the antitampering control electronics may store this information in the log file in encrypted SEA memory .

Returning to step if the cardholder data does not meet the criteria of payment cardholder data in the site configuration file in memory the system may determine that the cardholder data is nonsensitive cardholder data. In this case antitampering control electronics may transmit the nonsensitive cardholder data in clear text form to local processing system step . Local processing system may use the nonsensitive cardholder data to provide a user credit for a transaction or a discount on fuel for example. Although not illustrated in this embodiment antitampering control electronics may also store a record of the transaction in the log file. The process then ends step .

As noted above any cardholder data handling device may comprise an SEA including a site controller a POS and a fuel dispenser control system. In some embodiments depending on the amount of information stored the transaction log file may become larger than the SEA memory. In this case the memory e.g. a hard disk at the cardholder data handling device comprising the SEA may store the large transaction log again encrypted according to the third encryption method. Then the antitampering control electronics of the SEA may read from and write to the log in the manner described above. In a further embodiment the transaction log file may be stored in and accessed on a remote system such as a remote computer or server associated with a plurality of retail payment systems. Also a back up copy of the log may be periodically transmitted from the SEA to the remote system. Here for example the SEA may communicate with the remote system via off site communication link which in one embodiment may be routed through the Internet.

According to a further embodiment the present invention contemplates a method by which a merchant may perform reconciliation or validation of a disputed transaction. In this regard is a flow chart illustrating an exemplary method for processing a request to validate a transaction involving payment cardholder data using the system of . The retail payment system may comprise an application programming interface API which allows a merchant to provide payment cardholder data from a customer disputing a transaction to the SEA and request information regarding whether the transaction is valid. As described below the SEA is adapted to respond to this request in one embodiment without making payment cardholder data available in clear text form. In other embodiments it is contemplated that the API may be used in a similar fashion to perform reconciliation. The API may be implemented as a software program on a computer or server in operative communication with the SEA such as at a computer or server associated with POS .

The process starts step and a merchant initiates a transaction validation request via the API and obtains a customer s payment cardholder data via input device step . Input device immediately encrypts the payment cardholder data according to the first encryption method step and transmits the encrypted payment cardholder data to SEA . Encrypted payment cardholder data transmitted from input device is received at antitampering control electronics in SEA step .

Next antitampering control electronics may access a transaction log stored in memory step . As described above because memory is encrypted according to the third encryption method antitampering control electronics which possess the encryption and decryption key s of the third encryption method may employ OTFE when accessing memory . Using the decryption keys of the first encryption method stored in memory antitampering control electronics may access the payment cardholder data step .

Next antitampering control electronics may compare the payment cardholder data against the transaction log file stored in memory to determine whether the payment cardholder data corresponds to a transaction processed at the merchant s site step . If so antitampering control electronics may provide details regarding the transaction to the merchant preferably omitting payment cardholder data step . The details may include the time of the transaction the amount charged or the goods or services purchased. Thus the merchant may obtain validation of a transaction without payment cardholder data being accessible in clear text form. The process ends at step . However based upon evaluation of the log file if the payment cardholder data does not correspond to a transaction processed at the merchant s site the antitampering control electronics may output an appropriate message to so inform the merchant step . The process again ends at step .

In an alternative embodiment where the transaction log is stored in a memory external to memory of SEA and associated with a transaction lookup reference number a merchant may again initiate a transaction validation request as described above in steps . In this case however antitampering control electronics may access the transaction lookup reference number for the requested transaction. Antitampering control electronics may then provide the lookup reference number to the merchant. The merchant may use the lookup reference number to access the transaction details stored in a log in an external memory and associated with the lookup reference number.

Based on the above those of skill in the art will appreciate that the SEA may provide E2EE of payment cardholder data. According to preferred embodiments cardholder data is only decrypted and evaluated within the antitampering control electronics and when it is stored payment cardholder data is stored in the SEA memory encrypted according to the third encryption method. The antitampering control electronics are preferably the only device in the retail payment system able to decrypt the SEA memory. Moreover the antitampering control electronics may be programmed never to pass unencrypted payment cardholder data from the SEA. Such an arrangement may desirably satisfy certain security requirements of the payment card industry or avoid such requirements altogether.

While one or more preferred embodiments of the invention have been described above it should be understood that any and all equivalent realizations of the present invention are included within the scope and spirit thereof. The embodiments depicted are presented by way of example only and are not intended as limitations upon the present invention. Thus it should be understood by those of ordinary skill in this art that the present invention is not limited to these embodiments since modifications can be made. Therefore it is contemplated that any and all such embodiments are included in the present invention as may fall within the scope and spirit thereof.

