---

title: Method and apparatus for SATA hot unplug
abstract: A method and apparatus are provided for serial advanced technology attachment (SATA) hot unplug. In one embodiment, a method includes detecting a connection of a SATA storage device to a SATA host interface by monitoring physical (PHY) layer signals derived from SATA communication terminals, by a controller of the host interface. The detection being based on phase locked loop (PLL) response of the PHY layer signals. The method further includes detecting disconnection of the SATA device based on the PLL response and outputting a notification, by the controller, when the PLL response indicates that the SATA device has been disconnected.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08549191&OS=08549191&RS=08549191
owner: CSR Technology Inc.
number: 08549191
owner_city: Sunnyvale
owner_country: US
publication_date: 20100104
---
The present invention relates in general to storage devices and more particularly to providing hot unplug of SATA devices.

Serial advanced technology attachment Serial ATA or SATA is a communication interface. Currently SATA is primarily used for coupling mass storage devices such as hard disk drives optical drives etc. to host bus adapters. Many modern computing devices include SATA host adapters for interfacing with SATA storage devices as SATA storage interfaces provide faster and more efficient data transfer in comparison to conventional interfaces such as Parallel ATA PATA or External Integrated Drive Electronics EIDE .

The first generation of SATA interfaces SATA 1.5 Gb s as developed by the Serial ATA International Organization SATA IO provide for communication at a rate of 1.5 GB s. Limitations imposed by some devices such as mechanical hard drives required only a portion of the interface data transfer rates to speeds to about 150 MB s. SATA Revision 2.0 SATA 3 Gb s provides 3 Gb s signaling rate and effective doubling of data throughput to 300 MB s. SATA Revision 3.0 refers to SATA 6 GB s allowing for increased interface transfer speeds. Although mechanical drives may hardly utilize full throughput of SATA Revision 3.0 solid state disk drives may benefit from the increased read speeds.

SATA interfaces may be preferred over conventional interfaces as these interfaces provide greater speed allow for upgradeable storage devices simplify device configuration and maintenance and significantly reduce the space needed for cables. Currently SATA hosts support hot plugging that is adding SATA devices which interact with a computer and or operating system while the computer is operating. SATA hosts may also allow for hot swapping which relates to replacing SATA devices without shutting down the system. As provided in the SATA standard SATA devices support hot plug. Thus SATA host devices are aware when a new devices is connected.

Notably absent however from the SATA standard and conventional methods and devices that utilize the SATA standard is any provision for hot unplugging of a SATA device. As a result a SATA host will not recognize disconnection of a SATA device. SATA host systems will typically provide an indication that the SATA device is still available until a user or application tries to access the non existent device. At which point the system will try several attempts at accessing the device before declaring device failure. Because existing software applications and SATA host interfaces in general do not address hot unplug host systems are unaware when SATA devices are disconnected. Thus operating errors may be generated.

Conventional solutions to SATA device disconnection rely on device manufacturers to provide host systems with software to detect disconnection. However this is a tough obstacle for device manufacturers to determine software for every type of operating system of which the devices may be used. Further these software solutions may not detect hot unplug. Thus there is a need in the art for systems and methods of which address hot unplugging of SATA devices.

Another solution proposed in the SATA standard relates to monitoring SATA device power lines. This solution relies on the ability of a SATA host to not only to provide power to SATA device but also to monitor the SATA device. Both requirements appear to be a significant obstacle. Moreover the majority of current SATA devices receive power externally and completely independent from a SATA host holding system power supply. As a result monitoring power lines by a SATA host may be virtually impossible. Thus there is a need in the art for systems and methods of which address hot unplugging of SATA devices using SATA communication lines only.

Disclosed and claimed herein are systems and methods for serial advanced technology attachment SATA hot unplug. In one embodiment a method includes detecting a connection of a SATA storage device to a host interface and monitoring physical PHY layer signals of SATA communication terminals by a controller of the host interface based on phase locked loop PLL response of the PHY layer signals. The method further includes detecting disconnection of the SATA device based on the PLL response and outputting a notification by the controller when the PLL response indicates that the SATA device has been disconnected.

Other aspects features and techniques of the invention will be apparent to one skilled in the relevant art in view of the following detailed description of the invention.

One aspect of the present invention is to provide hot unplug of Serial ATA serial advanced technology attachment devices. As disclosed herein a method and apparatus are provided for hot unplug of SATA communication cables. In one embodiment a method for hot unplug of SATA comprises monitoring SATA physical PHY layer signals by a controller of the interface. Specifically PHY layer phase locked loop PLL status signals are monitored and used for detecting disconnection and or unavailability of the SATA device. In such an embodiment hot unplug may be provided by monitoring communication lines only of the SATA device. In this fashion monitoring of the SATA connection may allow for recognition that a device is no longer accessible to provide a host device with an indication of why a device is not accessible or should not be accessed. The solution may be incorporated into a host interface.

In another embodiment a host interface is provided which is configured to provide hot unplug of a SATA device. The host interface may include a controller to monitor communication signals. As such hot unplug may be provided for storage interface for connecting host bus adapters to mass storage devices such as hard disk drives and optical drives. It should also be appreciated that the invention may be applied to other types of SATA devices including port multiplier and switching devices and any SATA communication device in general. In one embodiment monitoring communication lines of the SATA terminals may be independent of power terminals of the SATA storage device. In yet another embodiment the host interface may support native command queuing.

Referring now to the figures depicts a graphical representation of a device configured for hot unplug of SATA devices as described herein. Host computer is depicted according to one embodiment of the invention. Computer may relate to a computer having one or more interfaces to communicate with SATA devices according to one or more embodiments of the invention. As shown in computer includes removable drive bays and each configured to receive a SATA storage devices. SATA devices can be one or more of a hard disk drive optical drive and storage device in general. SATA device relates to a SATA hard disk drive.

According to one embodiment of the invention computer may include a host interface to allow for hot plug hot swapping and hot unplug of one or more SATA devices in contrast to the conventional methods and devices that do not support hot unplug of SATA drives. The host interface may provide a storage interface for connecting host bus adapters to mass storage devices such as hard disk drives and optical drives. In one embodiment the host interface of computer relates to an advanced host controller interface AHCI providing an application programming interface which defines the operation of SATA host bus adapters in a non implementation specific manner. As will be discussed in more detail below with respect to the host interface of computer may provide a system memory structure for computer hardware vendors to exchange data between host system memory and attached storage devices.

According to another embodiment of the invention a host interface may be provided for hot unplug of external SATA eSATA devices. Referring now to a graphical representation of a system employing eSATA hot unplug according to one embodiment of the invention. System may be configured to provide data from inside a computer to an external drive and respectively from the eSATA drive to a computer in a fast and reliable fashion while allowing for hot unplug. System in includes computer which may relates to a portable computer. It should also be appreciated that hot unplug of eSATA device may be provided for desktop computers servers etc. According to one embodiment of the invention computer includes a SATA interface for coupling to one or more eSATA devices such as eSATA device . eSATA device may relate to one of a hard disk drive optical drive and storage device in general wherein eSATA device is configured to operate with an eSATA configuration. By way of example eSATA device may be coupled to computer via a SATA port shown in window .

Communication cable may relate to an eSATA communication cable and may be coupled to SATA port via eSATA connector . In one embodiment communication cable provides serial communication with shielded cables. In certain embodiments communication cable may include conductors to provide power to eSATA device . Connector may have a SATA pinout as will be described in more detail below with respect to . As will be discussed below a host interface of computer may be configured to detect hot plug and hot unplug of connector according to one or more embodiments.

Referring now to a simplified block diagram is depicted of a host interface of a computer e.g. computer to provide data relative to a computer bus and SATA drive. Host interface may also be configured for hot plug and hot unplug of a SATA device according to one or more embodiments of the invention. In one embodiment host interface may be included within a computer bus interface. According to another embodiment host interface may relate to an AHCI configured to support SATA functions. For example host interface may be configured to provide hot unplug according to one embodiment of the invention.

Input of host interface relates to a part of a SATA connector interface configured to receive data from a SATA device e.g. SATA device . According to one embodiment input signals received from the SATA device by input are provided to controller . Controller may be configured to receive SATA signals recover data and send the data to output for output on a bus of a host device e.g. computer server etc. . According to one embodiment controller includes a physical layer module PHY which may be configured to receive SATA signals from input .

According to another embodiment input and output may be configured to support a plurality of SATA devices. In an exemplary embodiment input and output may be configured to support four SATA drives. According to another embodiment input and output and host controller may be configured to support SATA and eSATA drives.

Controller further includes memory which may be configured to store operating instructions of controller . According to another embodiment controller may be configured to operate based on one or more instructions stored in memory wherein memory relates to one of ROM and RAM memory.

Controller may be configured to detect hot plug hot unplug and or hot swapping of SATA devices. Controller may be configured to monitor connection of a SATA device using one of phase locked loop PLL and delayed lock loop DLL functionality to detect disconnection of a device. As shown in controller includes PLL functionality . In addition to PLL functionality or some instances DLL functionality controller employs an RX JOCK signal to detect hot plug hot unplug and or hot swapping of SATA devices the RX LOCK signal being a PLL lock status indicator.

Controller may additionally be configured for native command queuing according to another embodiment. Similarly controller may be configured to support SATA 1.5 Gb sec SATA 3 Gb sec and SATA 6 Gb sec. According to another embodiment interface may be configured to provide an interface for up to four SATA devices. In that fashion interface provides users a cost effective solution for upgrading an existing desktop and or server systems with the advantage of transferring large quantities of data rapidly. In certain embodiments host interface may be integrated with bus components of a host device. Alternatively host interface may be a standalone unit.

According to another embodiment of the invention controller may employ low pass filtering for the PHY signal to avoid false triggering. In certain instances signals received by controller and processed by PLL functionality may indicate PLL unlock for short periods of time due to communication disturbances. Accordingly host interface may include optional low pass filter LPF configured to filter high frequency spikes which may trigger PLL unlock signal. Controller may further be configured to provide functions for one or more of SATA logical SATA PHY functionality physical connection and SATA glue logic.

Although host interface has been described above with reference to a SATA interface for a computer it should equally be appreciated that host interface may relate to an eSATA interface. Further although described as units of hardware in it should be appreciated that the functions of the units may be implemented in a variety of ways including hardware firmware software and combinations thereof.

In one embodiment the lock state of received PLL and the RX lock signal are of particular interest to the controller. For example the host controller may determine if prepared patterns of the PHY signals are below a threshold or unlocked for a predetermined period of time. Monitoring of communication lines may be independent of power signals of the SATA device. The controller may employ low pass filtering for the RX LOCK PLL signal to avoid false triggering.

At block the host interface can detect disconnection of the SATA device based on signals from the PLL of the PHY such as disconnection of SATA device or disconnection of a cable to an eSATA device. According to the SATA standard the SATA host and SATA device are constantly communicating by a special set of bit patterns e.g. primitives . The primitives are constantly running between a SATA host and SATA device to maintain transfer clock synchronization of the transfer clock between both. The primitives may be embedded within synchronization clock signal based on 8b 10b encoding. According to one embodiment of the invention detecting the presence of synchronization clock signal may provide a clear indication of the presence of transmitter such as a SATA device. PHY level signals may be employed by SATA host according to one embodiment for recovering clock signal synchronization synchronizing a receive clock and or locking on to the clock. Thus according to one embodiment as soon as received PLL is locked the SATA device is present. By way of example if an RX LOCK signal of the PHY is true the SATA device is present. When a SATA device is not present the RX LOCK signal of the PHY will be false. Process may include low pass filtering for the RX LOCK PHY signal to avoid false triggering. By monitoring the PHY signals of a SATA device disconnection and or powering down of the SATA device may be detected. In that fashion hot unplug may be provided according to one embodiment. Similarly process may be employed to detect a SATA device which is still coupled to the host device but not accessible due to power down of the SATA device. Further monitoring communication lines of the SATA terminals may be independent of power terminals of the SATA storage device.

Process may then proceed by outputting a notification by the controller indicating the SATA device has been disconnected at block . For example the controller may output a signal to a communication bus of the computer to notify the host computer that an external device is no longer connected. Similarly signals may be output to configure the host device to recognize disconnection of the SATA device. In that fashion the host computer can terminate attempts to receive or transmit data to the devices.

Referring now to a process is depicted of interface functions according to one or more embodiments of the invention. According to one embodiment a controller of the host interface may perform process as part of a SATA host interface including functions for hot plug hot unplug and hot swapping. Process may be initiated by monitoring one or more SATA ports at block . At decision block process may determine if a device is detected. Device detection may be based on a SATA standard for hot plugging. When a device is not detected NO path out of decision block the host interface continues to monitor the SATA port at block . When a device is detected YES path out of decision block the interface enables operation of the SATA device at block . For example the interface may notify an operating system of the host computer of the drive.

Following detection of a device process may proceed by monitoring SATA lines at block to determine if the device is disconnected at decision block . When each device remains connected NO path out of decision block the host interface continues to monitor the SATA port at block . When a disconnection of a device is detected YES path out of decision block the host interface may then determine if a hot swap has been performed. Following disconnection the host interface may check for connection of a new SATA device in the particular port which a device was disconnected. Process may proceed by monitoring SATA lines and determining if a device was replaced within a predetermined period of time at decision block . When a disconnection of a device is detected YES path out of decision block the host interface may provide a notification to a host device of a hot swap at block . When a new device is not connected NO path out of decision block the host interface can provide a notification to a host device that the device has been removed at block .

While certain exemplary embodiments have been described and shown in the accompanying drawings it is to be understood that such embodiments are merely illustrative of and not restrictive on the broad invention and that this invention not be limited to the specific constructions and arrangements shown and described since various other modifications may occur to those ordinarily skilled in the art. Trademarks and copyrights referred to herein are the property of their respective owners.

