---

title: Methods and systems for network traffic security
abstract: The present invention is directed to methods of and systems for adaptive networking that monitors a network resource of a network. The method monitors an application performance. The method categorizes a first subset of traffic of the network. The categories for the first subset include trusted, known to be bad, and suspect. The method determines an action for a second subset of traffic based on the category for the first subset of traffic. Some embodiments provide a system for adaptive networking that includes a first device and traffic that has a first subset and a second subset. The system also includes a first resource and a second resource for the transmission of the traffic. The first device receives the traffic and categorizes the traffic into the first and second subsets. The first device assigns the first subset to the first resource. Some embodiments provide a network device that includes an input for receiving incoming traffic, an output for sending outgoing traffic, a categorization module that categorizes incoming traffic, and a resource assignment module that assigns the categorized traffic for a particular resource. A traffic category for the device includes suspect traffic.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08051481&OS=08051481&RS=08051481
owner: Avaya Inc.
number: 08051481
owner_city: Basking Ridge
owner_country: US
publication_date: 20100826
---
This application is a divisional of patent application Ser. No. 12 284 933 filed Sep. 25 2008 and entitled METHOD AND SYSTEMS FOR NETWORK TRAFFIC SECURITY which is a divisional application of patent application Ser. No. 11 223 236 filed Sep. 9 2005 entitled METHODS AND SYSTEMS FOR NETWORK TRAFFIC SECURITY now U.S. Pat. No. 7 596 811 which claims priority under 35 U.S.C. 119 e of U.S. Provisional Patent Application Ser. No. 60 609 062 filed Sep. 9 2004 and entitled METHODS AND SYSTEMS FOR REMOTE OUTBOUND CONTROL SECURITY STRAWMAN which is hereby incorporated by reference.

This invention is related to network traffic security. Specifically this invention is related to providing network traffic security by using traffic categorization and or resource allocation.

In the current connected world of inter operating networks preventing unwanted access and unwanted intrusions are a constant issue. Some approaches to coping with network based attacks involve detecting the occurrence of intrusions as a step to formulating a response. Typical intrusion detection techniques have suffered from false positives and false negatives both of which often have disastrous consequences. False negatives result in failure to protect a network from attacks while false positives result in either lost business or in systems that cry wolf. Thus false positives also result in failure to protect the network because this type of error also ultimately reduces the effectiveness of the solutions that are intended to protect the network from real attacks.

The problem of false positives and negatives results from two characteristics of typical intrusion detection systems. Even though there exist many products and approaches that attempt to protect data centers servers and network resources from intrusion or attack such as for example Denial of Service DoS attacks the typical approaches all share the following characteristics 

 1 The approach bases intrusion detection solely on some kind of an examination of the network traffic. That is whether the approach is online or offline the approach determines whether an attack is present by looking at each packet and examining its characteristics and contents. Thus more specifically extrinsic knowledge that is gained from interacting with other tools and protocols in the network is seldom used to help in the detection. Moreover the determination of whether traffic is trusted or is known to be bad when based solely on an examination of the current traffic itself is often not effective or is too late to be useful.

 2 The intrusion detection s outcome is either black or white. That is traffic is either categorized as trusted or known to be bad. There is typically no additional categorization of traffic that is neither trusted nor known to be bad. There is no concept of a gray area in a conventional system. Thus there is no category of traffic that is intermediate unknown or suspect but not yet determined as known to be bad. Typically depending on the particular implementation and user configuration such suspect traffic is either categorized as trusted or as known to be bad.

As mentioned above one problem with having only the two categories of trusted and known to be bad is that the user ends up with a significant amount of false positives false negatives or both. Both false negatives and false positives can cost a great deal of time and money. Both false positives and false negatives can cause disastrous consequences. For instance when false negatives occur the detection measure fails to protect against an unwanted intrusion and the organization s resources are exposed to the intruder. False positives can also be costly. Depending on the implementation traffic categorized as known to be bad either triggers alarms or is dropped. Dropping good traffic typically results in lost business and missed opportunities and often has additional consequences. Alarm triggers result in information technology IT personnel spending time investigating the occurrence which can cost a company in terms of employee resources system down time and money. Having several false alarms erodes the confidence in the protective system such that when the system cries wolf enough times the alarms are either ignored or the safeguards responsive counter measures and notifications and or protections are tuned down too low to be effective. This reduces the ability of the protective system to detect and protect against the real attacks.

The U.S. Pat. No. 5 835 726 filed Jun. 17 1996 and entitled System for securing the flow of and selectively modifying packets in a computer network and U.S. Pat. No. 6 701 432 filed Apr. 1 1999 and entitled Firewall including local bus discuss the traditional systems mentioned above including firewall type systems. The U.S. Pat. Nos. 5 835 726 and 6 701 432 are hereby incorporated by reference.

The present invention is a system for and method of protecting a network. The system prevents data traffic that can harm the network. Moreover the system prevents false positive and false negative determinations relative to potential unwanted intrusions.

Traffic is categorized into at least three categories including trusted known to be bad and suspect. The system can utilize different resources for different categories of traffic. This can prevent bad data or suspect data from damaging the network resources and also provide enhanced service to trusted traffic. The system tracks a history of network users and usage. The history is utilized in determining which category is designated for traffic. New end points and or traffic can initially be handled as suspect and then later be upgraded to trusted or demoted to bad. The history can also be used to determine a so called frequent flyer which can receive enhanced handling.

Traffic that is determined to be bad can be dropped or also black holed to the edge of the network. Traffic that is suspect can be directed through a different resource. The different resource can be a different physical resource or a different logical resource in the same physical resource but handled with a different priority. Detection of attacks can be source based destination based frequent flyer based or flow rate based.

An additional boundary can be used in conjunction with traditional intrusion detection to enhance security. By handling suspect and bad traffic with different network resources the impact of any error introduced by traditional intrusion detection methods is minimized. The invention can be implemented in hardware software or a combination thereof.

In the following description numerous details and alternatives are set forth for purpose of explanation. However one of ordinary skill in the art will realize that the invention can be practiced without the use of these specific details. In other instances well known structures and devices are shown in block diagram form in order not to obscure the description of the invention with unnecessary detail. Section I below describes the process implementation of some embodiments of the present invention. Section II describes the critical boundary that results from the implementation of some embodiments. Section III describes several system implementations and Section IV discusses the particular advantages of the invention.

The invention is used to monitor network resources and measure the performance at an end user s system of operating an application over the internet or another network. By using the monitoring a unique view of network activity that combines application knowledge historical knowledge of the users in the network the applications they use traffic patterns and the expected characteristics and requirements of the users and applications. The unique views are used to enhance the effectiveness of intrusion detection by reducing the number of false positives and false negatives. These advantages are provided by using a novel set of application programming interfaces APIs network management tools and applications while certain alternatives introduce a number of novel concepts to existing intrusion detection tools.

As an example illustrates .a first device providing traffic to a second device through an exemplary network . The network is a network of networks such as for example the Internet . The first device acts as a source to the second device that acts as a destination. The first and second devices and are each coupled to a subnetwork A and D respectively. In this embodiment the first and second devices and provide an interface between the Internet and the subnetwork s A and D. As shown in the traffic arrives at the second device through a network resource . One of ordinary skill will recognize that the network illustrated in is exemplary. Thus the network is representative of other types and configurations of networks such as for example an MPLS network an MPLS VPN network a private network a VPN network and or an ATM network. 

As mentioned above traffic is monitored as it flows from a source to a destination through the network. Again referring to while traffic flows through the network a first subset of the traffic is categorized into a first category at step in the process . The types of traffic for the first category include trusted known to be bad suspect traffic and or a combination thereof. It will be appreciated by those of ordinary skill in the art that additional levels of categories can be implemented according to the present invention. Next at step an action for a second subset of traffic is determined based on the category of the first subset of traffic. The process then concludes. The first subset of traffic is categorized based on the monitoring of the network resources and or based on the monitoring of the performance of the application. Similarly the action for the second subset is based on the network resources and or based on the performance of the application.

One of ordinary skill in the art will further recognize variations of the particular process implementation illustrated in . For instance the processes of alternative implementations include additional steps and or different orderings of the steps. Specifically the system of a particular implementation preferably tracks a history that includes information based on users and their patterns of network usage while monitoring the resources and or applications for the network. The system can also determine an action for the first subset and or categorize a second subset of traffic. illustrates an additional exemplary implementation of a process that includes these additional steps. Reference numerals used on elements of the several figures will be the same for the same elements of the illustrated embodiments. For instance similarly labeled steps in the process of are the same as the steps described above for the process of . As shown in after the first traffic subset is categorized at step the process transitions to step where an action is determined for the first subset of traffic. Then the process transitions to step where a second subset of traffic is categorized. Next at step an action for the second subset of traffic is determined and the process transitions to step . At step a history is tracked of users and their patterns of network usage. The process then concludes. As mentioned above one of ordinary skill will recognize the possible variations of the exemplary implementations illustrated in . For instance in an equivalent process implementation of the process illustrated in the second subset of traffic is categorized before the action is determined for the first subset of traffic.

Preferably the first subset and second subset of traffic do not overlap. For instance according to certain alternatives of the present invention the first subset of traffic includes suspect traffic while the second subset includes trusted traffic. Alternative embodiments treat the traffic differently. For instance illustrates a network in accordance with such an embodiment. shows substantially the same network with substantially the same elements as except there is an additional network resource . As shown in traffic that is categorized as trusted is routed separately from the suspect traffic through the additional resource . Other alternative embodiments include a third category for traffic that is known to be bad. The bad traffic of some embodiments is further treated differently than the trusted and suspect traffic. shows substantially the same network with substantially the same elements as except there is an additional network resource . As shown in traffic that is categorized as known to be bad is routed through the additional resource . In some embodiments the traffic includes traffic that has already been determined as trusted. These embodiments will be described further in Section III.

Preferably the invention observes traffic and monitors the users of the network. Alternative embodiments further monitor one or more network resources. For example some embodiments monitor bandwidth utilization. These embodiments assess performance of the operation of an application over the network and inject the changes to the network as needed to ensure adequate application performance at a destination. Other embodiments also enforce a business policy for example by ensuring that important transactions get the best service. In these embodiments the general population of users on the network continue to receive adequate service which minimizes the cost and use of the shared network resources.

The shared network resources include the different routing mechanisms for traffic such as for example channels protocols and or services. This can constrain the flow of traffic and or inject changes by restricting resource allocation. Resource allocation can be performed by assigning the differently categorized traffic 

However one of ordinary skill will recognize various additional resource allocations which can be used. Resource allocation is discussed further below.

Traffic can be categorized by detecting traffic that has unusual characteristics. When traffic is detected with unusual characteristics the unusual traffic can be assigned a non zero probability of being part of an attack representing a confidence in the traffic. When the confidence is less than a predetermined threshold the system can presume that such traffic constitutes an attack the unusual traffic is categorized as suspect.

As mentioned above the network resources and or application performance are monitored to categorize a first subset of traffic. The monitoring and or categorization can be used to determine an action to take for the first and or a second subset of traffic. By measuring the network resources and performance the system is aware of the application performance for a given subset of the traffic across the different resources. The measurements are used categorize the traffic as either trusted or suspect. These embodiments typically send trusted traffic to a first set of resources while sending suspect traffic to a second set of resources as mentioned above in relation to .

The separate first and second resources ensure that the suspect traffic is isolated from the trusted traffic. The separation minimizes the negative effects of the suspect traffic particularly of the suspect traffic that proves problematic for example the suspect traffic that is later determined to be bad. Moreover the data carried by the trusted traffic of some embodiments are given a higher priority such as a lower latency as compared to suspect data. In these embodiments trusted traffic preempts suspect traffic thereby minimizing the potentially damaging effects of the suspect traffic carrying data that later proves harmful.

A new endpoint and or new traffic can be initially categorized as suspect. These new endpoints and or new traffic can later be adjusted from the suspect category to trusted or bad based on a number of factors. Additionally any endpoint that is generating more traffic than expected can be categorized as either suspect or bad. Further unusual traffic and or traffic from an endpoint that is behaving unusually can be demoted to the suspect and or bad category.

Traffic is determined to be unusual when it operates according to criteria programmed into the system such as excessive traffic such as from a DoS attack. The unusual traffic and or endpoint can be demoted even if the traffic in question was previously considered trusted. These embodiments typically protect from attacks that originate from what appear to be trusted endpoints regardless of the nature of the attack. For instance when trusted traffic consumes too many resources even the trusted traffic is temporarily downgraded to protect against attacks staged from the trusted endpoints. Attacks from the trusted endpoints of some embodiments can be of several possible types including 1 the source address of the trusted endpoint is spoofed 2 the trusted endpoint is in fact responsible for the attack and 3 the trusted endpoint has been compromised.

An endpoint and or traffic that has previously been categorized as trusted can be assigned a special status for example as a frequent flyer. Frequent flyer status is discussed in detail next.

A frequent flyer concept can be added to help in the determination of a category for a particular subset of traffic and or in the determination of an action for the subset. While monitoring the network and traffic historical information can be tracked which is related to the source addresses of traffic that is intended for a particular destination or set of destinations. A trend of certain parameters pertaining to this history is can be discovered. The parameters for which a trend is determined in some embodiments include 

A subset of the parameter trends is used to categorize addresses as frequent flyers in relation to a destination or set of destinations. A frequent flyer is a source address that is determined to be legitimate and thus is trusted. This determination is based on historical observations related to the frequency and time of appearance of traffic from this source address to the destination s in question. Other criteria for identifying the frequent flyers are based on 1 time of day considerations pertaining to the traffic coming from the address and intended for the destination or set of destinations 2 anomalies in transactions and or 3 completed transactions such as for example frequency and or recentness of transactions.

The frequent flier concept has particular advantages. For instance a characteristic of single packet inbound attacks is that a single packet is seen from an endpoint that was never seen before. Some embodiments leverage this characteristic by declaring as frequent flyers those endpoints that complete bi directional transactions. Since spoofed sources typically cannot complete a bi directional transaction the expected response by the real owner of the spoofed address is to drop or ignore the first packet. Thus a frequent flyer category for trusted data and or traffic can provide protection against spoofed source attacks. One of ordinary skill will recognize various additional embodiments employing the frequent flyer concept. For instance a third packet can be identified in a transaction as a good indication of an endpoint that is trusted. Some embodiments can require the third packet to not be a reset RST packet.

Some embodiments rely on anomalies in the transactions to determine frequent flyers. These embodiments are often effective against various types of the single packet user datagram protocol UDP Microsoft variety of attacks such as Slammer. Slammer type attacks typically contain anomalies in the transactions. These embodiments often give a significant proportion of frequent flyer customers better service such as for example a higher priority resource than the Slammer traffic. Thus the frequent flyers of these embodiments are unaffected by the Slammer traffic because of the high priority resource. The larger the proportion of frequent flyer customers from uninfected locations the more these embodiments minimize the Slammer type attacks. The detection and control implemented by the embodiments illustrated in include the frequent flyer concept described above. The frequent flyer concept can be implemented for a service provider and or an enterprise. These embodiments typically involve communication between the service provider and the enterprise. Some examples of various embodiments implemented for an enterprise and or for a service provider are described in Section III below. However the discussion proceeds next to the resources of some embodiments. Once traffic has been categorized it typically must reach its destination through one or more resources.

If at step the traffic was not classified as bad at step then the process transitions to step where a determination is made whether the traffic is suspect. If at step the traffic is determined to be trusted then the process transitions to step where the traffic is assigned to a first resource that is designated for example for trusted traffic. The process then concludes. If at step the traffic is suspect then the process transitions to step where the traffic is assigned to a second resource designated for example for suspect traffic. The process then concludes.

As shown in the traffic from the source to the destination is determined at various times and or locations in the network to be either trusted suspect or known to be bad. Some embodiments employ the process described above in relation to to categorize the traffic. Then each category of the traffic is directed to a resource that is assigned to that category of traffic. For instance the traffic from the network device is directed to the resources for suspect trusted and or bad traffic while the traffic from the network device is directed to the resource s for the bad traffic. As illustrated in the resources of some embodiments are such that the bad traffic does not affect the suspect traffic and the suspect traffic does not affect the trusted traffic. Some embodiments perform the resource allocation differently. These differences are described below.

Suspect traffic can be rate limited. Some embodiments achieve rate limiting by using a token bucket while some embodiments achieve rate limiting through another means such as for example weighted fair queuing. In these embodiments the weight assigned to suspect traffic is lower than the weight assigned to trusted traffic.

Also a service provider such as an Internet service provider has knowledge of one or more parameters pertaining to its peers. For example the service provider has knowledge of the capacity of its enterprise customers inbound links. In such instances the service provider of some embodiments uses this knowledge to throttle traffic so that the capacity of the enterprise s links is not overwhelmed. For example a particular enterprise customer has a total inbound capacity for handling the traffic directed toward and or through its subnetwork. If the sum of the trusted and suspect traffic directed through the enterprise s subnetwork adds up to more than the total inbound capacity for the particular enterprise s subnetwork the service provider may either rate limit or drop a portion of the suspect traffic. In these cases the service provider maintains the quality of service provided to the enterprise regarding the trusted traffic to the detriment of the suspect traffic. Rate limiting and or dropping traffic are achieved by using various methods. Rate limiting is implemented in some embodiments by for example using token buckets using ToS markings and or by using multiprotocol label switch MPLS tags. Some embodiments drop the packets by using buffer management schemes and or black holing as mentioned above. One of ordinary skill will recognize that additional means can be used to control traffic by rate limiting and or dropping for example the packets that comprise the traffic.

The resources for the different traffic categories can comprise different ToS markings. For example trusted traffic is assigned a ToS marking that will guarantee the trusted traffic to have priority over traffic from the other categories. Likewise the different traffic categories are routed differently. These embodiments are described further in the examples below. In some embodiments the different traffic categories are tagged differently such that they use logically different paths.

The different resources of some embodiments include different logical resources. Different logical resources can actually share the same physical resource. Different logical and or physical resources preferably correspond to different priority levels. For instance priority queuing PQ provides the different priority levels of some embodiments while some embodiments use class based weighted fair queuing CBWFQ to provide the different priority levels.

Different embodiments use different criteria for the detection of attacks and the control of traffic and routing. As described above different embodiments use different categories resources and allocations to effect control. Some embodiments use the source while some embodiments use the destination of the traffic for the detection and control. The attributes of the packets are used in some embodiments. Some embodiments track the source of the traffic that is intended for a particular destination address. Based on the source and or destination address these embodiments determine whether the traffic is trusted or suspect. The source address is used to send the traffic to the appropriate resource. For example traffic that is determined to be suspect because of its source is diverted to the resources reserved for suspect traffic. More specifically some embodiments direct traffic such as suspect traffic to the various resources by for example 

 3 marking the traffic with a particular MPLS tag such that the traffic is directed along a particular set of MPLS tagged routes or to a particular set of MPLS capable routers.

Moreover some embodiments track traffic having a particular destination address or set of destinations. Based on this destination address these embodiments determine whether the traffic is trusted or suspect. In some embodiments the destination address is used to send the traffic to the appropriate resource. For example traffic that is determined to be suspect based on the destination is diverted in some embodiments to the resource s reserved for suspect traffic. As described above some embodiments treat suspect traffic differently by using for example ToS markings particular physical paths and or MPLS tags over tagged routes.

Some embodiments identify categorize and or control traffic based on the frequent flyer model described above. Also mentioned above frequent flyer traffic is typically assigned to the best available resources to provide the highest quality of service to this category of traffic.

The features of source based and or destination based categorization and or resource allocation in the context of other identification categorization and or control methods can be applied. For example detection control and frequent flyer membership determinations are based on a combination of source and destination information. These determinations are based on per flow information. Other ways to identify and or categorize traffic are evident to those of ordinary skill. For instance some embodiments are constructed based on the destination or set of destinations that include enterprises service providers and or a combination of these with another destination.

The foregoing can be expanded to other contexts. These contexts include the spoofed source single packet attacks mentioned above and additional contexts such as for example zombie farms perpetrating real transactions. In these cases successful transactions are tracked over time per one or more endpoints. Those endpoints that include long time customers are trusted. These embodiments categorize as either suspect or bad any new endpoint and similarly some embodiments categorize by default unknown and or new traffic as suspect rather than bad.

While the traditional intrusion detection systems IDS in the art typically determine that traffic is bad these intrusion detection systems do not typically determine that suspect traffic is indeed trusted. Section II below describes some common features of the traditional intrusion detection system. In contrast to the typical intrusion detection system some embodiments keep a history of resource usage application performance and other patterns for various users of a network. The history is typically kept in a database. The history is typically used to determine whether suspect traffic should be trusted. The categorization of a first subset of traffic and or the determination of an action for a second subset of traffic can be performed by utilizing a set of application management tools and directories. For instance the application management tools and directories are used to determine whether the suspect traffic should be trusted. In certain instances these application management tools and directories are provided by Avaya Inc.

To distinguish trusted traffic from other traffic information from directories and other network management and application management tools is used. These tools include for example lightweight directory access protocol LDAP session initiation protocol SIP and or Netflows computer network performance system. Netflows is a trademark Janus Research Group Inc. of Appling Ga. Knowledge of the users characteristics and requirements contributes in the determination of whether traffic is indeed trusted. For example some embodiments know that a given user is currently in a particular geographic area is expected to run a particular application and is using a cellular device. Some embodiments obtain this information by using a SIP directory while some embodiments discover the information through integration with a call server. The traffic is observed from this user to determine whether it matches the expected pattern for a trusted endpoint. A suite of protocols can be used to aid in the determination of a category for the first subset of traffic and or to determine an action for the second subset of traffic.

Some embodiments interact with other network elements such as for example a router by using various protocols such as for example border gateway protocol BGP and simple network management protocol SNMP . These embodiments leverage the protocols in both the detection and control phases. For example some embodiments employ prefix information. These embodiments consider as suspect traffic that originates sources from addresses having a known address prefix. These embodiments then determine whether the suspect traffic from the prefix is in fact known to be bad. Also when attempting to control traffic that is either suspect or known to be bad some embodiments leverage a set of BGP controls to send appropriate route changes for the appropriate prefixes. Moreover SNMP plays a synergistic role in the detection and control of some embodiments. For instance in some embodiments detection and or control is based on changes in load readings as obtained from SNMP for example.

Providing monitor assess and control technologies enhances the quality of security solutions by adding an additional constraint to the network environment. An additional boundary is implemented in conjunction with the traditional intrusion detection system IDS boundary. These embodiments provide an additional level of granularity in dealing with network traffic and attacks. The enhanced subtlety in reacting to attacks leverages the system s unique ability to control the traffic by choosing with a high level of granularity the resources for one or more types of traffic. Traffic that is determined to be suspect is still forwarded without harm by ensuring that the resources used for suspect traffic are different from those used by trusted traffic. Only traffic that is determined to be bad with a high level of certainty is dropped. Through monitoring of application performance the trusted traffic receives the best level of service. These embodiments also control the service level that suspect traffic receives. For instance the most highly suspect traffic receives the most degraded or lowest quality of service particularly when resources become constrained such as during an attack.

In contrast illustrates the boundaries implemented by preferred embodiments of the present invention. As shown in this figure the critical boundary of some embodiments is between traffic that is determined to be trusted and all other traffic such as for example suspect and known to be bad traffic. Thus the success of these embodiments in detecting and or preventing attacks becomes less dependent on the high accuracy at pinpointing the traditional boundary between traffic that is known to be bad and all other traffic.

This can leverage the fact that suspect traffic flows are able to still gain access. This treatment of suspect traffic tends to move the boundary more centrally. This feature allows a more accurate balance between false positives and false negatives. This can also provide the advantage of imposing the relatively mild action of demoting or downgrading from trusted status to suspect status previously trusted traffic that becomes suspicious. Thus the downgrade is milder than the action taken at the traditional permit deny boundary that is known in the art.

By using application programming interfaces APIs network management tools applications and through monitoring of network resources and application performance to end users a unique view is provided that combines application knowledge historical knowledge of the users their traffic patterns and the applications they use and the expected characteristics and requirements of the users and their applications. This more intelligent view affords the embodiments of the present invention more knowledge in detecting and responding to attacks. Some embodiments further allow more precise and or subtle reactions to attacks. The intelligence in detecting attacks is significantly enhanced by identifying at least three categories for traffic instead of the two categories of the standard intrusion detection approach. Some embodiments examine the applications and extend the knowledge of applications to traditional systems and further enhance existing intrusion detection systems in other ways. Some embodiments further address the issues that traditional systems face such as for example down time.

Various embodiments are implemented in software and or hardware. The hardware implementations include a device a network and or a combination of software hardware and one or more device s . Some embodiments implement network control and administration functions in a network device such as for example a router that is implemented in software and or hardware. The network devices of some embodiments include enhanced features over typical devices known in the art. These enhanced devices include for example a routing intelligence unit RIU provided by Avaya Inc.

Some embodiments effect control by injecting route changes to one or more of the routers and or routing intelligence units in a network architecture. These embodiments assign traffic to a resource that is suited to a given category of traffic. For instance some embodiments assign ToS markings to identify the categories of traffic. The traffic that these embodiments identify as more important such as for example trusted and or frequent flyer traffic receives prioritized treatment.

The various features of the embodiments described above are combined differently in different embodiments. These embodiments include implementation in enterprise and or Internet service provider ISP settings. For instance illustrates the system of some embodiments. As shown in this figure the system includes an ISP subnet coupled to an enterprise subnet through a network . The network is typically a wide area network or a network of networks such as the Internet. Also shown in multiple instances of network routing devices and are installed at one or more locations on the network . The devices in the system of include a heterogenous collection of networked devices such as for instance the routing intelligence units and and a standard router .

The invention can be implemented within the network of an enterprise and or an Internet service provider. When implemented within an enterprise some embodiments are implemented within the enterprise s central headquarters the headquarters edges within a branch and or at the branch edges. Similarly when implemented within a service provider location some embodiments are implemented at the core and or at the edge of the service provider s network. In particular some embodiments are implemented as close as possible to the edge of the enterprise and or service provider s network. Various implementation locations provide for certain features such as notification and feedback. These implementations are described in relation to the figures referenced below.

For instance the invention can be deployed at the edge of the enterprise network. These embodiments particularly serve to scan incoming traffic to the particular site. illustrates a network containing a network device located at the edge of an enterprise subnetwork . As shown in this figure the subnet operates in conjunction with the networked devices and . The subnet also includes several networked devices and that form the subnet including a nested sub subnet . The network device is a routing intelligence unit. The representative embodiment illustrated in typically uses the methods discussed above in Section Ito categorize traffic that is entering the enterprise s subnet . Thus these embodiments typically categorize the incoming traffic as trusted suspect or known to be bad. Traffic that is known to be bad is dropped or black holed while trusted and suspect traffic are directed to resources that are assigned to each of these traffic categories. As mentioned above such resources include for example ToS markings MPLS tagged routes different physical links different routes and or one or more rate controller s . In some embodiments rate control is achieved by using token buckets. For example in some embodiments suspect traffic is rate limited in the site s infrastructure by using the token buckets. Also shown in an additional routing intelligence unit is located well inside the infrastructure of the enterprise subnetwork . One of ordinary skill will recognize that some embodiments have several nested layers of sub subnets within the subnetwork and that additional network devices and or routing units are optionally installed within very deep layers of these nested sub subnetworks.

The networked devices can be different servers. In such embodiments the trusted and suspect traffic streams entering the enterprise subnetwork are directed toward the different servers . For instance the suspect traffic of some embodiments is specifically directed toward the networked server device while the trusted traffic is directed toward a trusted server . These embodiments reduce the likelihood of having trusted servers affected by the content in the suspect traffic.

The nested device and or subnetwork architecture illustrated in has further advantages. For instance the multiple installations of the routing intelligence units and permit traffic that is destined for the site and for various locations within the site to be checked at multiple stages with varying levels of granularity. Moreover in these embodiments the traffic that is known to be bad is dropped at the routing intelligence unit and also at the routing intelligence unit . Further previously categorized traffic is up down graded at these various locations. Additionally the routing intelligence unit illustrated in is installed deeper in the site s infrastructure and closer to certain server locations. Placement at this location has particular advantages such as allowing for more specialized detection and or control for the nearby servers.

In addition the system architecture can enhance scalability because the amount of traffic that reaches the different servers deep into the site s subnetwork is less voluminous than the aggregate traffic that crosses at the site s edge. Moreover the invention performs the functions described in the previous example such as directing different categories of traffic toward different servers.

Also shown in the service provider subnet also includes a sub subnet and a network device installed within the site. Thus similar to the enterprise model illustrated in the service provider subnet of some embodiments includes exterior installations and and an interior installation . In these embodiments the different locations of installation provides multiple lines and or levels of defense from attack. Specifically the interior installation provides more granular detection and control for the service provider site .

Moreover the multiple installations can provide additional features within the site. These additional features include feedback and or upstream notification. For instance as illustrated in the interior installation shares its more detailed information with the exterior installation at the network edge by using upstream notification. The upstream notification of these embodiments typically includes control signalling type information regarding for example 1 traffic that is determined to be trusted including frequent flyer information 2 traffic that is determined to be suspect and or 3 traffic that is determined to be bad. The upstream notification of some embodiments requests the exterior installation at the site s edge to act differently for the different traffic categories. Some embodiments enforce the different actions for different traffic categories described above. Similarly the exterior location feeds information forward regarding traffic destined for a location within the service provider subnetwork .

The intra site notification described above can be adapted for inter site locations. In such systems network devices such as routing intelligence units in both the service provider and enterprise subnetworks independently perform one or more of the functions described above. The service provider notifies the enterprise of the presence of suspect traffic directed to the enterprise s network. In these embodiments the service provider notifies the enterprise of a variety of aspects pertaining to the traffic categorization and control. The service provider of some embodiments offers the notification as a service to the enterprise customers. For instance illustrates a network that has a service provider notifying an enterprise with additional control type information such as for example information that the traffic directed to the enterprise contains suspect traffic. The mixture of heterogenous network devices illustrated in include intelligent devices such as the routing intelligence units and as well as standard network devices such as a typical router . Some embodiments send and receive control signal information such as notifications by using the intelligent devices.

The notifications of some embodiments further include identification of specific sources that are to be marked as being suspect a list of frequent flyers as determined by the enterprise additional information regarding the location s routing intelligence unit s and or information regarding rate limits for suspect traffic or a subset of suspect traffic for example. In some embodiments the rate limiting protects the enterprise s inbound links from being overwhelmed.

The network routing control of some embodiments is passive. Passive control indicates that the control and protective properties are always on. These embodiments do not require triggering based on the detection of an attack. Some of these embodiments further handle attacks consisting of completely legitimate traffic. Thus some embodiments detect attacks that are smarter. For example some embodiments detect unusual load patterns from legitimate sources. In some instances these embodiments detect load parameters and or patterns that are undetectable by typical intrusion detection systems. Regardless of source or type if an attack starts then some embodiments do not need to determine that an attack is under way. Rather in some embodiments the trusted users have a smooth experience and the attack is automatically self limited.

Some embodiments do not depend on an ability to determine whether an attack is actually occurring. The determinations of the processes described above in relation to are set up to operate the same under normal and attack conditions. Such systems detect suspect traffic and handle it in a manner that does not necessarily involve the traditional approaches to handling suspect traffic. As mentioned above typical approaches in the art treat suspect traffic as either known to be bad or trusted. Moreover traffic that is known to be bad is typically dropped and trusted traffic is typically sent to a resource designated for trusted traffic. Accordingly the typical approaches yield an undesirably large number of false positives and false negatives. In contrast some embodiments instead implement an always on architecture by treating traffic as being suspect before it is proved to be trusted. In this manner such systems minimize an attack s impact even if the attack is not readily identified before the traffic carries the attack data to a target destination. These embodiments are implemented in various different ways. For instance 

 3 normal traffic receives beneficial status according to the business policies in place or according to another rationale. Some of these embodiments are described next.

Trusted and suspect traffic initially use the same resource then trusted traffic is re routed during certain periods of network operation. In certain implementations of the always on architecture all flows are directed by default into a bottleneck resource. The bottleneck is initially set wide enough to accommodate normal traffic. Alternatively there is no detectable impact on suspect traffic until an attack starts. During normal network operation some endpoints become trusted. As these endpoints become trusted such systems direct the trusted endpoints to avoid the bottleneck. Alternatively the trusted traffic can be directed around the bottleneck through another resource during various other times such as for example during periods of unusual network activity.

Trusted and suspect traffic is assigned to different resources regardless of the time and or the network s operation. The traffic entering the bottleneck resource includes bad and or suspect traffic such as for example the suspect traffic from users who are not sufficiently trusted. Such systems have particular advantages over traditional intrusion detection systems which likely have not yet even recognized the bad traffic flowing through the bottleneck. Thus traditional IDS systems will likely not have started blocking dropping the bad traffic until it is too late.

A service provider supplies one or more of the foregoing embodiments as a service to enterprise customers. The service yields certain benefits to these customers. For instance by allowing suspect traffic to still receive service some embodiments reduce the chance that trusted traffic is mistakenly dropped. Occurrences of lost business or missed opportunities are therefore minimized. Thus these embodiments particularly reduce the number of false positives. Further by ensuring that trusted traffic uses resources that are separate from suspect traffic special protection is provided for the trusted traffic. For instance the suspect traffic in these embodiments does not impact the trusted traffic. This is particularly advantageous if it is determined that some of the suspect traffic that was allowed through is in fact bad.

Moreover given that attacks typically cause load related performance problems such as congestion either within an enterprise or within a service provider network some embodiments minimize and or avoid the attack related performance problems by directing traffic away from the portions of the networks where the problems occur. Load performance congestion and other problems for networks under attack are described for instance in the U.S. patent application Ser. No. 10 070 515 filed Jul. 25 2002 having publication number 2003 0039212 and entitled Method and apparatus for the assessment and optimization of network traffic U.S. patent application Ser. No. 09 923 924 filed Aug. 06 2001 having publication number 2002 0078223 and entitled Method and apparatus for performance and cost optimization in an inter network U.S. patent application Ser. No. 09 960 623 filed Sep. 20 2001 having publication number 2002 0075813 and entitled Method and apparatus for coordinating routing parameters via a back channel communication medium U.S. patent application Ser. No. 10 070 338 filed Dec. 12 2002 having publication number 2003 0161321 and entitled Method and apparatus for characterizing the quality of a network path and PCT International Application PCT US03 03297 filed 4 Feb. 2003 having international publication number WO 03 067731 and entitled Load optimization. These applications are incorporated herein by reference.

In addition some of the embodiments described above provide an alternative and or a scalable improvement to existing architectures. For instance such systems are implemented instead of or in conjunction with one or more methods and or systems that relate to outbound performance optimization outbound application performance optimization outbound load optimization inbound performance optimization inbound application performance optimization and or inbound load optimization. These contexts are described for instance in the United States Patent Applications incorporated by reference above.

While the invention has been described with reference to numerous specific details one of ordinary skill in the art will recognize that the invention can be embodied in other specific forms without departing from the spirit of the invention. Thus one of ordinary skill in the art will understand that the invention is not to be limited by the foregoing illustrative details but rather is to be defined by the appended claims.

