---

title: Color image processing method, color image processing device, and recording medium
abstract: To provide a color image processing method and device capable of improving the texture of a specific object in a color image taken by a color imaging device by controlling the quantity of a specular component in the specific object. A color image processing device () includes an image information acquisition unit () that detects an object area based on an input image, and obtains color information and 3D information of the object area, a reflection information restoration unit () that restores a specular component and a body reflection component containing shade of the object area based on the color information and the 3D information, a specular component correction unit () that corrects the specular component, and a reproduced-color calculation unit () that calculates a reproduced color of the object area by using the shade in the body reflection component and the corrected specular component and generates an output image.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08693773&OS=08693773&RS=08693773
owner: NEC Corporation
number: 08693773
owner_city: Tokyo
owner_country: JP
publication_date: 20100127
---
This application is the National Phase of PCT JP2010 000460 filed Jan. 27 2010 which is based upon and claims the benefit of priority from Japanese patent application No. 2009 017940 filed on Jan. 29 2009 the disclosure of which is incorporated herein in its entirety by reference.

The present invention relates to image processing of a color image in particular a color image processing method to realize desired color reproduction of an object in a color image that is actually taken by a color imaging device and thereby to improve the texture a color image processing device and a color image processing program.

As a technique to improve the image quality of a color image taken by a color imaging device a technique to make the color of a specific object such as flesh color green of plants and a blue sky in a color image closer to the recorded color of that object and thereby to reproduce a desirable color has been proposed.

For example Patent literature 1 discloses a technique relating to a color correction of a color image. In Patent literature 1 a representative color is extracted from an object area in an image and RGB correction parameters are determined by comparing that representative color with a predefined center color for correction. Then each pixel is corrected by controlling the strength at which these correction parameters are applied according to the distance from the center color. Specifically a technique to intensively correct the color of an object by converting the color information i.e. the RGB values of each pixel in the color image into a hue a saturation and a lightness calculating a distance between that color and the center color for correction in the color space and adjusting the correction strength according to that distance has been proposed.

In this technique a color correction is performed based on the addition subtraction of correction parameters in the RGB color space. For example in the case of flesh color of a human face the ROB correction amount is calculated for each pixel according to the distance from the center color for correction. If the face area is to be lightened in whole a correction parameter is added to or subtracted from the RGB values of each pixel located in substantially the entire face area according to the above mentioned distance from the center color for correction. Further Patent literature 2 discloses a technique relating to the detection of a face area in an input image.

Patent literature 3 discloses a color correction device and method in which when a color correction is made to spectral color image data the spectral color is converted into a color space having dimensions lower than the original dimensions a color correction is made in the lower dimensional color space and a spectral color in appropriate dimensions is generated from the lower dimensions.

Further Patent literature 4 discloses a technique to convert an original color space into a target color space between color systems having different reference white colors while maintaining the way in which colors are viewed unchanged from that in the original color space. Specifically the spectral power distribution characteristic of the original reference white is restored from the color temperature of the original reference white i.e. the reference white of the original color space. Further the spectral power distribution characteristic of the target reference white is restored from the color temperature of the target reference white i.e. the reference white of the target color space. Then the surface reflectance of a given color in the original color space is restored by using the tristimulus values of the given color the spectral power distribution characteristic of the original reference white and the color matching functions of human beings. Further tristimulus values which are a color in the target color space are obtained based on the restored surface reflectance the restored spectral power distribution characteristic of the target reference white and the color matching functions of human beings.

Patent literature 5 discloses a technique to automatically make an excellent white correction for an important object in a natural image that is taken under various lighting environments. Specifically the body surface color of a specific object is extracted and optimal color correction parameters are set for the extracted body surface color. In this way it is possible to automatically make a color correction for an important object in a natural image taken under various lighting environments. Note that the inventions disclosed in Patent literatures 3 4 and 5 have completely different configurations from that of the present invention described below.

Patent literature 6 proposes to apply a modeling technique for the skin reflection of a human being to the rendering of a face image. In this method a 3D three dimensional shape of a face is obtained by scanning the face by a 3D scanner. Then a plurality of face images are obtained by illuminating the face from different viewpoints in different directions. A total reflectance and a normal vector map are estimated by using the surface scan data and the image data. Then a transmittancy map is obtained by scanning the under surface reflectance using a fiber optic spectrometer. The total reflectance is separated into two components of an under surface scattering and a specular surface reflectance.

Patent literature 7 proposes an image processing device in which a pixel value of each pixel constituting an image is separated into a specular light component by surface reflection on a 3D three dimensional object and a diffuse reflection light component by diffuse reflection and at least one of the specular light component and the diffuse reflection light component is modified. In this technique a reflection model by Klinker et al. as separated into a specular light component and a diffuse reflection light component and each component is modified by using Phong illumination model Lambertian Reflection model or the like without restoring the 3D shape of the object.

The disclosures of the above mentioned Patent literatures 1 and 2 and Non patent literatures 1 and 2 are incorporated herein by reference. The analysis of the related art in accordance with the present invention is described hereinafter.

In the color image processing technique in which the three properties of a color such as RGB and or a hue a saturation and a lightness are used for an object area in a color image as in the case of Patent literature 1 there is a problem that the original texture of an object could deteriorate.

This is because in Patent literature 1 color corrections such as making a color lighter increasing a saturation and changing a hue are performed while handling the color of a certain object area in an image as a whole. When the color of a certain object in an image is corrected so as to make the image lighter these color corrections cause such a phenomenon that a color component originally having a high pixel value e.g. red is saturated while a correction parameter is added to or subtracted from other color components green and blue . If this process is carried out for the entire area of an object the dispersion of the color information or the pixel values in the object area become narrower and thus deteriorating the apparent texture in the object area.

In Patent literature 6 although the human skin reflection modeling is proposed for the rendering of a face image it requires a special measurement device i.e. fiber optic spectrometer. Therefore it is very difficult to apply this technique to color corrections for ordinary color image processing.

Patent literature 7 proposes a method of changing the color of a 3D object in a 2D two dimensional image. However 3D information of the object in the image is not restored. Instead a model relating to lighting and or reflection such as a reflection model by Klinker et al. Phong illumination model Lambertian Reflection model is applied to realize the color change method. This method is effective when the object matches excellently with a supposed reflection model as in the case of plastic paint paper pottery and the like. However when the object has complex reflection characteristics as in the case of human skins the method suffers from a problem that artifacts occur and so on. Further in this technique it does not show any method for correcting an object in an input image to desirable image quality.

As described above the techniques in the related art achieve a high quality image by changing the color of an object in a color image to a more desirable color. These techniques have a problem that the texture deteriorates. Accordingly it is desirable to develop color image processing that can be realized by an easier technique using only an input image and is capable of suppressing the deterioration of the texture in an object area in a color image.

An object of the present invention is to provide a color image processing method a color image processing device and a color image processing program capable of improving the texture of an object in a color image and thereby improving the image quality of the color image by focusing attention on a specular component highlight component in the object in the color image and adjusting the quantity of this specular component to a desired quantity.

An aspect of a color image processing method according to the present invention is a color image processing method including detecting an object area based on an input image obtaining color information and 3D information of the object area restoring a specular component and a shade contained in a body reflection component or diffuse component of the object area based on the color information and the 3D information correcting the specular component and calculating a reproduced color of the object area by using the shade in the body reflection component and the corrected specular component and thereby generating an output image.

Further an aspect of a color image processing device according to the present invention is a color image processing device including an image information acquisition unit that detects an object area based on an input image and obtains color information and 3D information of the object area a reflection information restoration unit that restores a specular component and a shade contained in a body reflection component of the object area based on the color information and the 3D information a specular component correction unit that corrects the specular component and a reproduced color calculation unit that calculates a reproduced color of the object area by using the shade in the body reflection component and the corrected specular component and thereby generates an output image.

Further an aspect of a computer readable recording medium storing a color image processing program according to the present invention is a computer readable recording medium storing a color image processing program that causes a computer to execute an image information acquisition procedure for detecting an object area based on an input image and obtaining color information and 3D information of the object area a reflection information restoration procedure for restoring a specular component and a shade contained in a body reflection component of the object area based on the color information and the 3D information a specular component correction procedure for correcting the specular component and a reproduced color calculation procedure for calculating a reproduced color of the object area by using the shade in the body reflection component and the corrected specular component and thereby generating an output image.

According to the present invention it is possible to realize desired color reproduction of a certain object in a color image taken by a color imaging device and thereby to maintain or improve the texture.

Exemplary embodiments of the present invention are explained hereinafter with reference to the drawings. For clarifying the explanation the following descriptions and drawings are partially omitted and simplified as appropriate. Components and equivalent parts having the same configuration or function are denoted by the same symbols throughout the drawings and their duplicated explanation is omitted.

An aspect of an exemplary embodiment according to the present invention is explained. In the present invention when the texture of a specific object in an input image is to be improved a 3D three dimensional shape also referred to as 3D information of the specific object and geometrical conditions also referred to as geometrical information of the lighting at the time of the image taking are restored from the input image. Next a specular component highlight and a shade contained in a body reflection component occurring on the specific object are calculated from the restored 3D shape. Then the calculated quantity of the specular component of that specific object is corrected to a desired quantity and a reproduced color of the specific object is calculated by using the corrected specular component and the shade contained in the body reflection component. In this way the corrected apparent texture of the specific object appears more naturally and the specific object is represented by a more desirable texture.

I. Firstly an input image and information about the input image are obtained image information acquisition process . Specifically an input image is supplied to a color image processing device and a specific object is specified from the input image. By specifying a specific object an area in which the specular component is to be corrected object area is detected. Further a 3D shape of the specific object and color information color of object area are obtained.

II. Next reflection information of the specific object is restored reflection information restoration process . Specifically geometrical conditions of the lighting are restored based on the 3D shape of the specific object. Next a specular component and a body reflection component containing shade are restored by using the color information the 3D shape and the lighting geometrical conditions. In this process the specular component is removed from the pixel value of each pixel of the input image and separated from the shade contained in the body reflection component.

III. The specular component is corrected specular component correction process . The specular component is corrected by using a mean value of the specular component and a reference specular component.

IV. A reproduced color of the specific object is calculated by using the shade contained in the body reflection component and the corrected specular component reproduced color calculation process .

In this specification it is assumed that an object area detected from a specific object is composed of a plurality of pixel. Further each pixel has color information and the color information may be also called pixel value . It is also assumed that the color information contains at least shade information a specular component and a body reflection component containing shade and may also contain other color information.

Further in the following explanation the specific object and the object area are not differentiated from each other unless otherwise specified.

The body reflection component containing the shade is color information obtained by removing a specular component glitter from the original color information of an object area.

The reference specular component is a surface reflectance that is defined in advance according to the specific object.

Further shows a configuration example of a color image processing device according to an exemplary embodiment of the present invention. A color image processing device includes an image information acquisition unit a reflection information restoration unit a specular component correction unit and a reproduced color calculation unit .

The image information acquisition unit externally receives an input image specifies a specific object based on the input image and detects an object area of the specific object. Further the image information acquisition unit obtains color information and a 3D three dimensional shape of the object area.

The reflection information restoration unit restores a specular component and a body reflection component containing shade of the object area based on the color information and the 3D shape. Specifically the reflection information restoration unit restores geometrical information of the lighting irradiance of the lighting by using the 3D information and restores a specular component and a body reflection component containing shade by using the color information the 3D shape and the lighting geometrical information.

The specular component correction unit corrects the restored specular component. For example it changes the quantity of the specular component by changing the size of the area of the specular component and or the shape of the specular component. As for the correction method a mean value of the specular component of the object area is calculated and then a correction is made by using the calculated mean value. For example a correction is made by comparing the mean value with a predefined arbitrary value. For example the specular component may be corrected by using a reference specular component as the arbitrary value. Further a correction value may be entered by a user and a correction may be made by using the entered correction value.

The reproduced color calculation unit calculates a reproduced color of the object area by using the body reflection component containing shade and the corrected specular component and generates an output image by using the calculated reproduced color.

As described above the color image processing device can correct the accurately restored specular component by using the 3D information of the specific object. Specifically the image information acquisition unit first obtains 3D information of a specific object. Next the reflection information restoration unit restores a specular component and a body reflection component containing shade of the specific object with accuracy by using the obtained 3D information of the specific object. Then the specular component correction unit corrects the accurately restored specular component.

The reflection information restoration unit can accurately restore the specular component and the body reflection component containing the shade of the specific object by using the color information obtained from the image and the restored lighting geometrical information. In this way it is possible to suppress the occurrence of unnatural artifacts. In contrast to this if the 3D information is not used it is very difficult to restore the specular component and the body reflection component containing the shade with accuracy. Therefore output images that are generated by correcting specular components and body reflection components containing the shade that are restored without using the 3D information are more susceptible to unnatural artifacts.

Firstly a process flow of a color image processing method according to an aspect of the present invention is explained with reference to the drawings. The following explanation is made by using a configuration example of a color image processing device shown in .

To improve the texture of a specific object in an arbitrarily given color image in terms of image quality the reproduced color of each pixel in the object area in the color image is re calculated.

Note that the specific object is not limited to any particular objects provided that even when individuals are different from each other i.e. even when there are individual differences the object can be determined as the supposed object based on characteristics obtained from the color image because of the general color information and the universality of the texture.

Firstly the image information acquisition unit automatically detects a specific object from an input image step S . In this process the image information acquisition unit obtains color information of the object area for the detected specific object.

As shown in a specific object is detected from an input color image by using color information texture and the like. The following explanation is made on the assumption that the specific object is a human face. When the specific object is a human face a face area is detected by using features such as an eye s a nose and a mouth.

As a technique for detecting a face area a face detection method disclosed in Non patent literature 2 for example can be used. This technique is a face detection method obtained by combining an Image based technique with a Feature based technique for detecting an eye s using generalized learning vector quantization.

Further as a technique for detecting a face area in an input image a method for detecting an eye s in an image disclosed in Patent literature 2 can be used. That is if the position of an eye s is detected from an input image a face area can be easily estimated.

Note that in general the above mentioned two techniques detect a face by using monochrome information. However it is possible to improve the accuracy of the face area detection by incorporating an additional determination whether the detected face area is flesh color or skin color or not.

As for the flesh color determination method a technique using an image histogram disclosed in Patent literature 1 can be used. The face detection method is not limited to the above mentioned two techniques and other techniques may be also used.

Although a case where a face is automatically detected from an arbitrarily given input image as the object to be detected is described in the above explanation the object to be detected can be any objects other than faces. Note that in order to automatically detect an object other than faces for example a method for automatically detecting an object by comparing visual characteristic information of the image data with visual characteristic information of a pre registered object area can be used.

Next the image information acquisition unit restores a 3D shape of the specific object in the image step S . The explanation has been made on the assumption that the specific object is a human face. Therefore a technique disclosed in the literature mentioned below hereinafter called Non patent literature 3 can be used. In this technique a 3D shape of a human face is estimated from a 2D two dimensional image by using a face model having average 3D information on the shapes of human faces prepared in advance.

Non patent literature 3 Recognition of Non Frontal Facial Images by Pose Conversion using Generic 3D Face Model Rui Ishiyama IEICE General Conference 2007 D 12 085 2007 p. 201.

The above mentioned technique is a 3D shape restoration method specialized in the cases where the specific object is a human face. However this technique can also restore rough 3D shapes of other specific objects from input images by extending the technique disclosed in Non patent literature 3 to those specific objects provided that even when there are individual differences the specific objects have a roughly universal shape.

Note that the fact that the 3D shape of the specific object in the input image is restored means that the normal vector right arrow over n at each pixel position in the image is obtained.

The apparent color of a specific object in an input image is affected by the lighting in the scene and its geometrical conditions with respect to the object. That is when the geometrical conditions of the lighting and the object area are changed the apparent color of the object area is also changed.

Therefore next the geometrical conditions of the lighting with respect to the specific object in the input image are restored step . In the present invention a simple physical reflection model is applied to represent an actual apparent color. The following three literatures show techniques relating to such physical models hereinafter called Non patent literatures 4 5 and 6 respectively .

Non patent literature 4 R. Basri and D. Jacobs Lambertian Reflectance and Linear Subspaces Weizmann Institute of Science Technical Report MCS00 21 NEC Research Institute Technical Report 2000 172R 2000 pp. 1 27.

Non patent literature 5 R. Ramamoorthi and P. Hanrahan An efficient representation for irradiance environment maps online Proc. ACM SIGGRAPH 01 pp. 497 500 2001. Searched on Jan. 26 2009. the Internet 

Non patent literature 6 Ravi Ramamoorthi and Pat Hanrahan On the relationship between radiance and irradiance determining the illumination from images of a convex Lambertian object J. Opt. Soc. Am. A Vol. 18 No. 10 October 2001.

According to Non patent literatures 4 and 5 when cast shadows and proximity lighting are ignored the apparent irradiance E of the object area is expressed by a function of a normal vector right arrow over n alone and can be excellently approximated by using spherical surface harmonics. When distant lighting from a direction vector right arrow over is represented as L right arrow over the irradiance on a perfectly diffuse hemisphere object right arrow over n is expressed as shown below right arrow over 1 where right arrow over n and right arrow over are unit direction vectors.

Scaling is performed on the irradiance with a surface albedo right arrow over p in a position vector right arrow over p . Radiosity B corresponding to the luminance in the image is expressed as shown below. 2 

Assume that lighting conditions are estimated from observed values irradiance on a Lambertian surface. As stated above the lighting is expressed as a non negative function on the surface of a convex object on the assumption that the influences of cast shadows and proximity lighting can be ignored. In Non patent literatures 4 and 5 this function is expressed by using spherical surface harmonics.

Spherical surface harmonics Y 1 0 1 m 1 have a similar figure to a Fourier basis for a straight line or a circle on a spherical surface. Nine spherical surface harmonics 1 2 become a constant 1 0 a linear expression 1 1 or a quadratic polynomial expression 1 2 in a Cartesian coordinates x y z and expressed as shown below.

Note that an analysis formula for can be derived from Non patent literature 6. disappears when l is an odd number greater than one l 1 and drops sharply as lwhen l is an even number. when l 1 

As described above an irradiance E in each pixel of the specific object expressed by Expression 13 is obtained. That is it means that the lighting geometrical conditions with respect to the specific object in the input image can be restored. Note that the irradiance E is regarded as the geometrical conditions.

Next the reflection information restoration unit restores calculates a specular component and a body reflection component containing shade in the specific object in the input image step S .

In general the reflectance of an object area depends on the geometrical conditions of incident light and emitted light. In general this reflection characteristic is expressed as a BRDF Bidirectional Reflectance Distribution Function . A BRDF is often composed of two components of a specular component and a body reflection component containing shade. In a state in which an object area in an input image is separated into a specular component and a body reflection component is shown in a image information acquisition process and b reflection information restoration process.

When the specific object is a living creature such as a human the specular component and the body reflection component are defined as described below.

The reflection body component is a component of light that is generated when light temporarily enters inside the skin and is scattered inside the skin and dispersed again through the skin.

By assuming that the surface reflection characteristic of the specific object is Lambertian i.e. perfect diffusion an irradiance in each pixel of the specific object is calculated by using spherical surface harmonics as shown in the step S. Since the perfect diffusion is assumed this irradiance E can be regarded as a diffuse reflection component or body reflection component DR Diffuse Reflection of the specific object. The irradiance E is assumed to be calculated for each color channel e.g. R G and B . Therefore it is represented as Ei . The letter i indicates each color channel. Similarly the diffuse reflection component or the body reflection component is represented as DRi . 17 

The diffuse reflection component or the body reflection component is calculated on the assumption that the specific object is Lambertian. However in practice it contains the specular component rather than the diffuse reflection component or the body reflection component . In other words the pixel value of each color channel in an input image represents apparent brightness in that color channel containing a diffuse reflection component or a body reflection component and a specular component. The diffuse reflection component or the body reflection component is calculated by using a least squares method or the like in the object area and therefore the irradiance does not necessarily match the pixel value. It can be safely said that the difference occurring in this discrepancy is the specular component. Therefore a specular component SPi for each color channel of a certain pixel in the specific object area is calculated by using the following expressions. when 0 when 0 other than that above 18 Note that Ii represents the pixel value of a certain pixel in the specific object area in the input image and i represents a color channel e.g. R G B or the like .

The body reflection component BRi of a certain pixel in the specific object area in the input image is obtained by subtracting the specular component SPi from the pixel value Ii of the image 19 where Min x y is a function that outputs the smallest value between x and y.

With the processes described above the specular component and the body reflection component are calculated with higher accuracy by using the 3D information of the specific object in the input image.

Next the specular component is corrected step S . When the specular component occurring in the specific object area in the input image is obtained the texture of the specific object is improved by controlling the quantity size and strength of this specular component. That is a desired specular component is generated by controlling adjusting the quantity of the original specular component such as the magnitude of the size and the strength of the specular component in the specific object in the input color image.

A predefined desired quantity strength of a specular component in an object area is represented as . Note that i indicates a color channel such as R G and B. This can be calculated in the following manner. Firstly a reference image in which the texture of a specific object is excellent is prepared in advance. By applying the above described steps S to S a specular component SPi obtained by Expression 18 for the specific object having an excellent texture is calculated. The specular component SPi is a pixel value of each pixel in the specific object area. Therefore a mean value of the specular components SPi in that object area is calculated and the obtained mean value is represented as . Similarly a mean value of the specular components SPi in the specific object area in the input image is calculated and the obtained mean value is represented as . 20 

Then the quantity strength of the specular component is corrected to a desired quantity by multiplying the specular component SPi in the object area in the input image by a correction coefficient i obtained by Expression 20 . 21 

As for the correction of the quantity size of the specular component the quantity size of the specular component of the specific object in the input image is adjusted by using a predefined desired quantity size of the specular component of the object area as in the case of the adjustment of the strength. Note that the ratio of the number of pixels of the specular component to the number of pixels of the specific object area may be used as the size of the specular component.

When the size is to be reduced the value of i in Expression 21 is adjusted so that the number of pixels i.e. the size of the specular component in the specific object area in the input image gets closer to a desired quantity size of the specular component of the object area. Specifically the strength of the specular component is restrained and when the pixel value SPi becomes smaller than a certain threshold it may set to zero.

On the other hand when the size is to be increased it is necessary to take a certain measure. This is because pixels that are not originally the specular component never become the specular component according to Expression 18 . When the size is to be increased a pixel that is not originally the specular component and is located adjacent to a pixel that is originally the specular component is selected in a random fashion and a positive real number is added to the pixel value SPi of that pixel while adjusting i in Expression 21 . The process in which a pixel that is located adjacent to a pixel that is originally the specular component is selected in a random fashion and a positive real number is added to the pixel value of that pixel while adjusting i in Expression 21 is repeated until the desired size is achieved.

Next a corrected color of each pixel in the object in the input image is calculated by using the corrected specular component and the body reflection component step S .

A color corrected pixel value Ii is calculated by adding the corrected specular component SPi obtained in the step S to the body reflection component BRi. 22 

An image that is obtained by correcting the color of the object area in the input image is output as an output image.

Although a case where the device dependent colors of the input and output images are RGB is explained in the above explanation the present invention can be also applied to images of device dependent colors other than RGB such as CMY and CMYK provided that the corresponding relation between those device dependent colors and the tristimulus values XYZ of device independent colors can be obtained. Not that device dependent colors mean a color space that depends on the device to which the image is output.

Next a color image processing device color correction device to which the color image processing method according to the first exemplary embodiment of the present invention is applied is explained. shows a configuration example of a color image processing device according to a first exemplary embodiment of the present invention.

A color image processing device is a device that corrects the specular component of an object area in an input image and thereby outputs an output image . The color image processing device includes an object area detection unit a 3D information restoration unit object area 3D information restoration unit a reflection information restoration unit unit for restoring a specular component and a body reflection component of an object area a specular component correction unit a reference specular component storage memory and a reproduced color calculation unit object area reproduced color calculation unit .

When an input image is supplied the object area detection unit analyzes the input image detects a pre assumed specific object and outputs information indicating an object area for the detected specific object. The information indicating the object area contains color information of the object area.

Note that the object to be detected from the input image is such an object that the color and the shape feature of its object area can be limited to some extent like a human face as described above. As for the detection method the above described technique may be used. Note that if no object to be processed is detected from the input image the input image itself is output as an output image .

The 3D information restoration unit restores a 3D shape of the object area detected by the object area detection unit . The 3D information restoration unit performs a process corresponding to the step S in .

The reflection information restoration unit restores calculates an irradiance E in the object area by using the 3D shape i.e. normal vector of the object area in accordance with the step S in . The 3D shape of the object area is calculated by the 3D information restoration unit .

Further it restores calculates the specular component and the body reflection component in the object area according to the process method described in the step S in .

The specular component correction unit corrects the calculated specular component in the object area to a desired quantity by using a reference specular component. The reference specular component is a specular component with which a desirable image of the object area is achieved and is defined in advance according to the object area. The specular component correction unit performs a process corresponding to the above described step S in . The specular component correction unit enables the color of an object having complex reflection characteristics such as a human skin to be reproduced with high accuracy. Further it can prevent the occurrence of artifacts.

The reproduced color calculation unit calculates a corrected color of each pixel in the object area by using the corrected specular component and the body reflection component containing the shade and outputs the color corrected image as an output image. The corrected specular component is a component corrected by the specular component correction unit and indicates a desirable specular component of each pixel in the object area. The body reflection component containing the shade is a component calculated by the reflection information restoration unit . The reproduced color calculation unit performs a process corresponding to the step S in .

As described above the color image processing device provides as a method for realizing desirable image quality of a human face a method for improving image quality by adjusting the unpleasant specular reflection component specular component i.e. glitter . Specifically the specular component correction unit corrects the specular component and the reproduced color calculation unit generates an output image by using the corrected specular component. That is the color image processing device can correct the image quality of an object to desirable image quality by using the specular component correction unit and the reproduced color calculation unit . In contrast to this a method of changing the color of an artificial object such as plastic having a dichromatic reflection model from red to blue has been provided in the related art. For the artificial object like this it is very difficult to improve the image quality and thereby achieve desirable image quality by correcting the color.

Further the color image processing device according to the first exemplary embodiment and the color image processing device shown in are related to each other in the following manner.

The image information acquisition unit is composed of the object area detection unit and the 3D information restoration unit .

The reflection information restoration unit corresponds to the reflection information restoration unit .

The specular component correction unit is composed of the specular component correction unit and the reference specular component storage memory .

Note that the configuration of the color image processing device shown in or is merely an example and any other device configurations capable of realizing similar functions may be also used.

Further the color image processing device can be implemented by using a computer and each of the components constituting the color image processing device i.e. the object area detection unit the 3D information restoration unit the reflection information restoration unit the specular component correction unit the reference specular component storage memory and the reproduced color calculation unit can be implemented as a program s that causes the central processing unit CPU of a computer to implement the above described functions. The fact that each component constituting the color image processing device can be implement by a computer and can be implemented as a program s is not limited to the first exemplary embodiment and also holds true in other exemplary embodiments.

Next a color image processing device according to a second exemplary embodiment of the present invention is explained. shows a configuration example of a color image processing device according to a second exemplary embodiment of the present invention. A color image processing device is a device that corrects the specular component of an object area in an input image and thereby outputs an output image .

The color image processing device includes the object area detection unit the 3D information restoration unit the reflection information restoration unit the specular component correction unit a user interaction unit and thus reproduced color calculation unit .

The color image processing device is obtained by replacing the reference specular component storage memory of the color image processing device by the user interaction unit . Therefore only the user interaction unit is explained.

The user interaction unit provides interaction means that enables a user to adjust the quantity of the specular component in a specific object area in an input image. show an example of the user interaction means. In the reflection information restoration unit a graphical user interface GUI through which the calculated quantity of the specular component of a specific object area in an input image can be adjusted in an interactive fashion is provided. A slider bar of this GUI can be used to adjust for example the value of in Expression 21 . shows an example in which the specular component is weakened while shows an example in which it is strengthened. The user interaction unit displays a corrected image on which the adjustment result of the specular component in the input image is reflected in real time.

The user interaction unit receives a quantity correction value of a specular component entered by a user and notifies the received quantity to the specular component correction unit . The correction value may be a value indicating the total quantity of the specular component or a value indicating a quantity by which the current specular component is to be changed.

The specular component correction unit corrects the specular component of each pixel by using the notified quantity for the specular component.

Further although a configuration example in which the reference specular component storage memory is replaced by the user interaction unit is explained above with reference to both components may be provided at the same time.

For example an image in which a specular component is corrected by using the reference specular component storage memory is displayed for a user. When the user desires to change the specular component for the corrected image even further he she can enter a correction value. In this way an output image desired by the user can be generated. Further the user can change the specular component according to the particular use.

The color image processing method and device in each of the above described exemplary embodiments can be implemented by using a computer. Each process of the color image processing method and device can be also implemented by combining two or more of software hardware and firmware.

For example when the color image processing device shown in is implemented by using a program s the program a group of commands causes a computer to execute at least the following procedures. The program is loaded into a memory of the computer and each command is executed under the control of the CPU.

 a An image information acquisition procedure for receiving an input image detecting an object area based on the input image and obtaining color information and 3D information of the object area. This procedure corresponds to the image information acquisition unit in . b A reflection information restoration procedure for restoring a specular component and a body reflection component containing shade of the object area based on the color information and the 3D information. This procedure corresponds to the reflection information restoration unit in . c A specular component correction procedure for correcting the specular component. This procedure corresponds to the specular component correction unit in . d A reproduced color calculation procedure for calculating a reproduced color of the object area by using the body reflection component containing the shade and the corrected specular component and thereby generating an output image. This procedure corresponds to the reproduced color calculation unit in .

Specifically in the specular component correction procedure a mean value of the specular component of the object area may be calculated and the spectral power distribution of the lighting may be restored by using the calculated mean value. Further the mean value of the specular component may be corrected by using reference specular component information that is defined in advance for the object area.

Further the specular component correction procedure may include a user interaction procedure for receiving a correction value for the specular component from a user and the mean value of the specular component may be corrected by using the received correction value.

The program can be provided by recording it in a recording medium or can be provided by transmitting it through the Internet or other communication media. Note that examples of the storage media include a flexible disk a hard disk a magnetic disk magneto optic disk a CD ROM a DVD a ROM cartridge a RAM memory cartridge with a battery backup a flash memory cartridge and a nonvolatile RAM cartridge. Further examples of the communication media include a wire communication medium such as a telephone line a radio communication medium such as a microwave line.

As has been explained so far according to an aspect of an exemplary embodiment in accordance with the present invention for a specific object in a color image taken by a color imaging device it is possible to improve the texture by controlling the quantity of the specular component in the specific object.

According to an aspect of an exemplary embodiment of the present invention it is possible to solve the problem that the texture of an object could deteriorate in the related art color correction method and to achieve a desired texture of an object area of a specific object in a color image taken by a color imaging device by controlling the specular component of the specific object. Further since the present invention does not require the use of a special measurement device such as a fiber optic spectrometer it is possible to realize an easier technique using only an input image.

Although the present invention is explained with reference to exemplary embodiments in the above explanation the present invention is not limited to the above described exemplary embodiments. Various modifications that can be easily understood by those skilled in the art can be made to the configurations and the details of the present invention without departing from the scope of the present invention.

The present invention is applicable to functions of improving the image quality of color image input output devices. Further the present invention is also applicable as image correcting software or utility for given color images by applying the present invention in the form of a program running on a computer system.

