---

title: Recommending queries according to mapping of query communities
abstract: A set of queries, such as a search log, is divided into commercial queries and non-commercial queries. A first set of query communities is determined from the non-commercial queries and a second set is determined from the commercial queries. The query communities are correlated based on the users who submitted the queries and instances where a query from the first set of query communities was followed by a query from the second set to generate a mapping between the first set of query communities and the second set. Later, a non-commercial query is received from a user, and the mapping is used to predict one or more commercial queries that the user is likely to submit in the future based on the non-commercial query. One or more of the commercial queries are presented to the user according to the mapping with search results responsive to the non-commercial query.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09171045&OS=09171045&RS=09171045
owner: MICROSOFT TECHNOLOGY LICENSING, LLC
number: 09171045
owner_city: Redmond
owner_country: US
publication_date: 20101111
---
Many search engines are configured to recommend products or services to a user based on a query submitted by a user. For example a user may submit the query digital camera to the search engine and may be presented with links to reviews of digital cameras and or links to websites where the user may purchase the digital camera. These links may be sponsored and or non sponsored.

In the above example recommending digital cameras to the user based on the query is relatively simple because the commercial intent of the query digital camera is apparent based on the query itself. In contrast for some queries determining a possible commercial intent from the query may be more difficult. For example consider the query Mayan Riviera . The query does not have an immediately recognizable commercial intent like digital camera but may instead be related to an information gathering session for the user related to an upcoming vacation. Thus appropriate product recommendations may be for sun block beach shoes sunglasses or other vacation related items. However because the commercial intent of the query is not easily discernable based on the terms of the query the products are not recommended to the user resulting in potential loss or revenue and a degraded search experience for the user.

A set of queries such as a search log is divided into commercial queries and non commercial queries. A first set of query communities is determined from the non commercial queries and a second set of query communities is determined from the commercial queries. The first and second sets of query communities are correlated based on the relatedness of the queries to generate a mapping between the first set of query communities i.e. non commercial queries and the second set of query communities i.e. commercial queries . At a later time a non commercial query is received from a user and the mapping is used to predict one or more commercial queries that the user is likely to submit in the future based on the non commercial query. One or more of the commercial queries are presented to the user according to the mapping along with search results responsive to the non commercial query.

In an implementation a set of queries is received at a computing device through a network. Each query is associated with a user who provided the query and each query has an associated time. A first set of query communities is determined from the set of queries and a second set of query communities is determined from the set of queries by the computing device. Each query community includes at least one query and each query in a query community is related to every other query in the query community. A set of mappings of query communities from the first set of query communities to query communities from the second set of query communities is determined according to the users and times associated with the queries in the query communities. A query from the first set of query communities is received and one or more queries from the second set of query communities are recommended based on the mapping.

Implementations may include some or all of the following features. One or more of the queries in the determined query community from the second set of query communities may be presented to the user. The set of queries may be divided into a set of commercial queries and a set of non commercial queries and generating the first set of query communities from the set of queries and the second set of query communities from the set of queries may include generating the first set of query communities from the set of non commercial queries and generating the second set of query communities from the set of commercial queries. A product taxonomy may be received and the second set of query communities may be generated from the set of commercial queries based on the product taxonomy. Each query community in the second set of query communities may correspond to a product category.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the detailed description. This summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

In some implementations the client device may include a desktop personal computer PC workstation laptop personal digital assistant PDA cell phone or any WAP enabled device or any other computing device capable of interfacing directly or indirectly with the network . The client device may run an HTTP client e.g. a browsing program such as MICROSOFT INTERNET EXPLORER or other browser or a WAP enabled browser in the case of a cell phone PDA or other wireless device or the like allowing a user of the client device to access process and view information and pages available to it from the search engine . The client device may be implemented using a general purpose computing device such as the computing device illustrated in for example.

The provider may be configured to provide webpages responsive to requests received from users using devices such as the client device . The webpages may be stored as webpage data . The provider may also allows users to search for view and purchase a variety of products or services through one or more webpages associated with various products and services. For example the provider may be associated with an electronics retailer and users may browse and search for electronics available for sale by providing queries to the provider . The provider may return a set of webpage identifiers of webpages stored in the webpage data . In addition the provider may store a classification or taxonomy of the available products and or services as taxonomy data .

The search engine may be configured to receive queries such as a query from users using clients such as the client device . The search engine may search for media responsive to the query by searching a search corpus using the received query. The search corpus may comprise an index of media such as webpages e.g. webpages from the provider product descriptions image data video data map data etc. The search engine may generate and return search results to the client device using the search corpus . The results may comprise a webpage and may include links to some or all of the media that is responsive to the query .

In some implementations the search engine may store some or all of the queries that it receives over a period of time as query data . The stored query data may include a list or set of received queries along with a time that they were received and some indicator of a user associated with the query. In an implementation the queries may be ordered based on the time they were received by the search engine . For example the indicator may include a unique user name associated with the user or some other identifier such as a cookie id associated with the user or an IP address associated with the user. Further while not illustrated a provider may also collect and store query data based on queries received by the provider for example.

The environment may further include a recommender . The recommender may recommend one or more alternative queries to a user based on the query . The recommended queries are referred to in as the recommendations . The recommendations may be provided to the user along with the results . While the recommender is illustrated as part of the search engine it is contemplated that the recommender may also be implemented separately from the search engine or as part of the provider for example.

The queries that are comprised within the recommendations may be generated from the received query and the history of previously received queries as stored in the query data . In particular the recommendations may be generated according to the sequences of queries posed by users as evidenced by the query data .

For example the query data may show that users who search for a query such as Mayan Riviera later submit queries such as underwater camera and suntan lotions . Thus the recommender may generate recommendations including the queries underwater camera and suntan lotions when a user submits the query Mayan Riviera . By providing recommendations corresponding to the queries that the user is likely to later submit the user may be encouraged to extend their search session by selecting one or more of the queries in the recommendations .

In some implementations the queries in the recommendations are referred to herein as commercial queries. A commercial query is a query that has a readily discernable commercial intent. Typical commercial queries include products or service categories or names of specific products or services that may be purchased from a provider . For example the queries underwater camera sunscreen Sony television and 42 inch plasma all have an easily discernable commercial intent and are therefore commercial queries.

In contrast a non commercial query is a query that does not have a readily discernable commercial intent. Examples of non commercial queries may include Mayan Riviera French Alps and fettuccini alfredo .

In some implementations the recommender may receive a non commercial query and generate recommendations that include one or more commercial queries. For example the recommender may receive the non commercial query French Alps . Based on the queries previously submitted by users in the query data the recommender may determine that users who submit the non commercial query French Alps often later submit the commercial queries English to French translation book travel adaptor and alps guidebook . The determined commercial queries may then be provided in the recommendations .

In some implementations the recommendations may be provided along with or as part of the search results . For example the results may comprise a webpage that includes the links that were responsive to the query and the recommendations may be included in the webpage in a section marked related queries or other users who submitted the same query as you later submitted the following queries .

In addition along with the recommendations there may be some indicator of the reliability of each query in the recommendations or some other justification for the queries. In some implementations a recommended query may be preceded by the frequency with which the recommended query was provided by a user after submitting the same query. For example a recommended query underwater camera for the query Mayan Riviera may be followed by 15 of the users who submitted the query Mayan Riviera later submitted the query underwater camera . Such justifications may encourage the user to select one of the recommended queries.

The classifier may divide the queries in the query data into a first set of queries and a second set of queries. In some implementations the first set of queries may be non commercial queries and the second set of queries may be commercial queries or vice versa. Other criteria may also be used to separate the set of queries into a first set and a second set of queries. The commercial queries may be stored in the commercial query data and the non commercial queries may be stored in the non commercial query data for example.

In some implementations the commercial queries and the non commercial queries may be identified by the query classifier using a classifier trained using a set of known commercial queries and a set of known non commercial queries. For example the set of known non commercial queries may be queries that were submitted to a non commercial website such as Wikipedia and the set of known commercial queries may be queries that were received by a provider such as Amazon.com or Target.com for example. In some implementations the commercial queries may be queries with commercial intent and may be identified using the methods and techniques described in U.S. Patent Publication No. 2009 0228353 the contents of which are hereby incorporated by reference.

The community determiner may generate query communities from the commercial query data and the non commercial query data . A query community may comprise a set of one or more queries where each query in the set is related to each and every other query in the set. The community determiner may generate a first set of query communities from the non commercial query data and a second set of query communities from the commercial query data . The query communities may be determined using any of variety of known methods and techniques of grouping data.

In some implementations the community determiner may generate the first set of query communities by generating a graph representing the queries in the non commercial query data . The graph may include a vertex for each unique query in the non commercial query data . The community determiner may then generate an edge between each vertex pair that are deemed to be related. One example of related queries are queries that were received from the same user within a set time window more than a threshold number of times. For example queries that are received from a single user in a short period of time are generally related because the user may have revised an initial query with a new related query. The duration of the set time window and the threshold may be set by a user or administrator for example.

Other heuristics may be used to determine if two queries are related. For example if two queries lead to a click on the same webpage the queries may be related. If two queries are bid on by the same advertiser in a keyword auction the queries may be related. If two queries serve as anchor text in a HTML document that links to the same document the queries may be related. If two queries appear in the same snippet text of a search engine the queries may be related. Other methods may also be used. In some implementations the snippet data keyword auction data and click data may be stored and maintained with the query data .

After generating the edges the community determiner may densify the graph by generating an edge between pairs of vertices that are connected to a threshold number of vertices in common. For example vertices representing queries that are connected to a large number of common vertices are likely to represent queries that are also related. The threshold may be set by a user or administrator for example. Other data such as user click data may also be used to generate edges between vertices.

The community determiner may cluster the graph based on the connectedness of the vertices and may generate communities for the first set of communities from the queries associated with the vertices in each cluster. Any system method or technique for clustering a graph may be used. The first set of query communities may be stored as the non commercial query community data .

In some implementations the community determiner may generate the second set of query communities using the commercial query data and the taxonomy . The providers may each store taxonomy data . The taxonomy data comprises a categorization or hierarchy of the products or services offered by the providers . In some implementations the community determiner may generate each of the communities in the second set of query communities based on one or more categories in the taxonomy data and may add the commercial queries to the communities corresponding to the categories that the queries belong based on the taxonomy data . For example the taxonomy data may have a category digital camera that includes various digital camera models. The community determiner may generate a query community corresponding to the category digital camera and may add each commercial query that is a digital camera model to the digital camera query community. The second set of query communities may be stored by the community determiner as the commercial query community data .

The community mapper may determine a set of mappings of query communities of the first set of query communities to query communities of the second set of query communities. The set of mappings may map the query communities from the non commercial query community data to the query communities from commercial query community data . The set of mappings may be stored as the community mapping by the community mapper .

In some implementations each mapping in the set of mappings may be generated by what is referred to herein as the co occurrence method. In one implementation of the co occurrence method each unique query community pair from the first set of query communities and the second set of query communities e.g. the non commercial query community data and the commercial query community data are determined. For each unique query community pair a first amount of users who provided a query from the non commercial query community followed by a query from the commercial query community is determined. Similarly a second amount of users who provided a query from the commercial query community followed by a query from the non commercial query community is determined. The determination may be made by the community mapper using the query data .

The community mapper may further determine if the first amount is greater than both a threshold amount and the second amount. If so a mapping from the non commercial query community to the commercial query community is added to the community mapping . The community mapper may repeat this implementation of the co occurrence method for each unique query community pair from the first set of query communities and the second set of query communities. The threshold amount may be chosen by a user or administrator for example.

In another implementation of the co occurrence method each unique query community pair from the first set of query communities and the second set of query communities are determined. For each unique query community pair a number of users who provided a query from the non commercial query community followed by a query from the commercial query community is determined. The community mapper may then determine if the number of users is greater than a threshold amount. If so a mapping from the non commercial query community to the commercial query community is added to the community mapping . The community mapper may repeat this implementation of co occurrence method for each unique query community pair from the first set of query communities and the second set of query communities. The threshold amount may be chosen by a user or administrator for example. This implementation differs from the previous implementation of the co occurrence method described above in that it does not consider whether the commercial query proceeded the non commercial query.

In another implementation of the co occurrence method each unique query community pair from the first set of query communities and the second set of query communities are determined. For each unique query community pair determination is made as to whether the two queries co occur e.g. are received by the same user . If so a mapping from the non commercial query community to the commercial query community is added to the community mapping . The community mapper may repeat this implementation of co occurrence method for each unique query community pair from the first set of query communities and the second set of query communities. This implementation differs from the previous implementations of the co occurrence method described above in that it does not consider the order that the queries are received in.

In some implementations each mapping in the set of mappings may be generated by what is referred to herein as the hitting set recommendation method. In the hitting set recommendation method the method is repeated on each query community in the second set of query communities. For a selected query community from the second set of query communities the community mapper may determine each query community from the first set of query communities that includes a query that has a user in common with a query from the selected query community from the second set of query communities.

For each determined query community from the first set of query communities the community mapper may determine a count of each query in the determined query community that has a user in common with a query from the selected query community. If the determined count for a query community is greater than a threshold count the community mapper may add a mapping from the query community from the first set of query communities to the selected query community from the second set of query communities to the community mapping . After adding a mapping the community mapper may remove the queries from the determined query community from the first set of query communities that have users in common with queries from the selected query community from the second set of query communities. The community mapper may repeat the process for each of the communities in the second set of query communities.

In some implementations the set of mappings may be generated by what is referred to herein as the random walk method. In the random walk method a graph is generated with a vertex for each query community from the first set of query communities and a vertex for each query community from the second set of query communities. A directed edge is placed between each vertex representing a query community from the first set of query communities to each vertex representing a query community from the second set of query communities if the query community from the second set includes a query that was submitted after a query from the query community from the first set by a user. Each edge may be weighted based on the number of such queries in the query community from the second set.

The community mapper may then perform a number of random walks of various lengths on the graph beginning on vertices that represent query communities from the first set and ending at the end of the walk or when a vertex representing a query community from the second set is reached. A mapping may be added to the community mapping between two query communities if the probability of a random walk originating from the first query community and ending at the second query community is sufficiently high. The threshold probability may be set by a user or administrator for example.

The recommendation selector may generate recommendations based on a received query and the community mapping . When a query is received the recommendation selector may determine the query community from the first set of query communities that includes the query . The recommendation selector may use the community mapping to determine one or more query communities from the second set of query communities that map to the determined query community from the first set of query communities. The recommendation selector may then present one or more queries from each of the determined query communities from the second set of query communities as the recommendations . The recommendations may be presented to the user along with one or more results generated by the search engine in response to the query for example.

In some implementations the recommendation selector may further provide justifications and or statistics supporting the recommendations presented to the user. For example each recommended query may be provided with a percentage of users who later submitted the recommended query after submitting the query .

A set of queries is received at . The set of queries may be received by the recommender . The set of queries may be part of the query data and may comprise a query log for example. The queries in the set of queries may be each associated with a user and a time. In some implementations the set of queries may be divided into a first set of commercial queries and a second set of non commercial queries by the query classifier of the recommender .

A first set of query communities and a second set of query communities are generated at . The first and second sets of communities may be generated by the community determiner from the set of queries. In some implementations the first set of query communities may be non commercial query communities and may be stored as the non commercial query community data . Similarly the second set of query communities may be commercial query communities and may be stored as the commercial query community data . Each query in a query community is related to every other query in the query community in an implementation.

A set of mappings from the first set of query communities to the second set of query communities is determined at . The set of mappings may be determined by the community mapper and stored as the community mapping .

A query is received at . The query may be received by the recommender and or the search engine for example. In some implementations the query may be a non commercial query and may be received from a user of a client device .

A query community in the first set of query communities that includes the received query is determined at . The query community may be determined by the recommendation selector . The determined query community may be a non commercial query community.

A query community from the second set of query communities is determined using the set of mappings and the determined query community at . The query community may be determined by the recommendation selector . The determined query community may be a commercial query community.

One or more recommended queries from the determined query community from the second set of query communities are presented at . The one or more queries may be presented by the recommendation selector . The one or more queries may be commercial queries and may be presented to the user in a webpage along with one or more search results responsive to the query received at . The one or more queries may be selected from the queries in the determined query community from the second set of query communities. The recommended queries may be presented in an area of the webpage labeled recommended queries or the like for example. The recommended queries may be presented along with a justification that explains why the queries were recommended. For example a percentage of users who submitted the same query as the original and later submitted each recommended query may be determined from the query data and presented along with each recommended query. In some implementations the recommended queries may be stored in an inverted index.

A unique query community pair is selected from the first set of query communities and the second set of query communities at . The unique query may be selected by the community mapper of the recommender . The method may be performed on each unique query community pair from the first set of query communities and the second set of query communities e.g. the non commercial query community data and the commercial query community data .

A first amount of users who provided the selected query from the query community from the first set of query communities followed by the selected query from the query community from the second set of query communities is determined at . The determination may be made by the community mapper of the recommender using the query data and the commercial query community data and the non commercial query community data .

A second amount of users who provided the selected query from the query community from the second set of query communities followed by the selected query from the query community from the first set of query communities is determined at . The determination may be made by the community mapper of the recommender using the query data and the commercial query community data and the non commercial query community data .

A determination is made as to whether the first amount is both greater than the second amount and a threshold amount at . The determination may be made by the community mapper of the recommender . The comparison to the threshold amount is optional and may be set by a user or administrator to increase the number of users who submitted both queries from the query communities for a mapping to be generated. If the first amount is both greater than the second amount and the threshold amount then the method may continue at where a mapping is added to the set of mappings. Otherwise the method may return to and select a new query community pair.

A mapping is added to the set of mappings from the query community from the first set of query communities to the query community from the second set of query communities at . The mapping may be added by the community mapper to the community mapping . After adding the mapping the method may return to and select a new query community pair.

A query community is selected from the second set of query communities at . The query community may be selected by the community mapper of the recommender .

Each query community from the first set of query communities that includes a query that has a user in common with a query from the selected query community from the second set of query communities is determined at . The determination may be made by the community mapper of the recommender .

For each determined query community from the first set of query communities a count is determined of each query in the determined query community that has a user in common with a query from the selected query community from the second set of query communities at . The determinations may be made by the community mapper of the recommender .

A determination is made for each determined query community from the first set of query communities as to whether the determined count for that community is greater than a threshold count at . The determinations may be made by the community mapper of the recommender .

For each determined query community from the set of query communities with a count that is greater than the threshold count a mapping is added from the query community from the first set of query communities to the selected query community from the second set of query communities at . The mapping may be added by the community mapper of the recommender to the community mapping .

Queries from the query community from the first set of query communities that have users in common with queries from the query community from the second set of query communities may be removed from the first set of query communities for each added mapping at . The queries may be removed by the community mapper of the recommender . The method may then return to where a new query community from the second set of query communities is selected. The method may continue until all query communities from the second set of query communities have been considered.

Numerous other general purpose or special purpose computing system environments or configurations may be used. Examples of well known computing systems environments and or configurations that may be suitable for use include but are not limited to personal computers server computers handheld or laptop devices multiprocessor systems microprocessor based systems network PCs minicomputers mainframe computers embedded systems distributed computing environments that include any of the above systems or devices and the like.

Computer executable instructions such as program modules being executed by a computer may be used. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Distributed computing environments may be used where tasks are performed by remote processing devices that are linked through a communications network or other data transmission medium. In a distributed computing environment program modules and other data may be located in both local and remote computer storage media including memory storage devices.

With reference to an exemplary system for implementing aspects described herein includes a computing device such as computing device . In its most basic configuration computing device typically includes at least one processing unit and memory . Depending on the exact configuration and type of computing device memory may be volatile such as random access memory RAM non volatile such as read only memory ROM flash memory etc. or some combination of the two. This most basic configuration is illustrated in by dashed line .

Computing device may have additional features functionality. For example computing device may include additional storage removable and or non removable including but not limited to magnetic or optical disks or tape. Such additional storage is illustrated in by removable storage and non removable storage .

Computing device typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computing device and includes both volatile and non volatile media removable and non removable media.

Computer storage media include volatile and non volatile and removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Memory removable storage and non removable storage are all examples of computer storage media. Computer storage media include but are not limited to RAM ROM electrically erasable program read only memory EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by computing device . Any such computer storage media may be part of computing device .

Computing device may contain communications connection s that allow the device to communicate with other devices. Computing device may also have input device s such as a keyboard mouse pen voice input device touch input device etc. Output device s such as a display speakers printer etc. may also be included. All these devices are well known in the art and need not be discussed at length here.

It should be understood that the various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the presently disclosed subject matter or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium where when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the presently disclosed subject matter.

Although exemplary implementations may refer to utilizing aspects of the presently disclosed subject matter in the context of one or more stand alone computer systems the subject matter is not so limited but rather may be implemented in connection with any computing environment such as a network or distributed computing environment. Still further aspects of the presently disclosed subject matter may be implemented in or across a plurality of processing chips or devices and storage may similarly be effected across a plurality of devices. Such devices might include personal computers network servers and handheld devices for example.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

