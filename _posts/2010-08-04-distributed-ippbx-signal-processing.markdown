---

title: Distributed IP-PBX signal processing
abstract: Techniques are described by which an IP telephone system leverages the digital signal processing functions of end-user IP telephones by distributing signal processing tasks typically carried out by a centralized IP-PBX. The end-user IP telephones publicize their signal processing capabilities and availabilities to an IP-PBX, which maintains a resource capability mapping of the IP telephones. When the IP-PBX receive a bitstream for a communication session involving IP telephones and/or legacy phones of the IP telephone system, the IP-PBX determines the signal processing requirements for the bitstream, selects an available, capable IP telephone to perform the requirements, and distributes the bitstream to the selected IP telephone. The IP telephone performs the requisite signal processing and returns the processed bitstream to the IP-PBX, which forwards the processed bitstream to the destination endpoint for the communication session.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08711842&OS=08711842&RS=08711842
owner: Juniper Networks, Inc.
number: 08711842
owner_city: Sunnyvale
owner_country: US
publication_date: 20100804
---
The invention relates to telephony and more specifically to voice data processing within a packet based telephony network.

Deploying Internet Protocol IP telephone systems allow enterprises and individuals to transport voice communication over a packet based network and thereby avoid leasing traditional circuit switched telephone lines that constitute the public switched telephone network PSTN . Beyond voice communication IP telephony provides extensive voice and data services including instant messaging call waiting caller identification and conferencing as well as connectivity to legacy telephone networks.

IP telephone systems such as an IP Private Branch eXchange IP PBX phone system that comprises an IP PBX and one or more IP telephones include coder decoders codecs to convert analog waveforms into a digital bitstream for transmission over an IP network and to reconstruct analog waveforms from a digital bitstream received via the IP network. In addition to analog to digital and digital to analog conversion IP telephone systems provide signal processing functionality to voice calls including voice compression decompression echo cancellation silence suppression and teleconference mixing. For example individual IP telephones include codecs to provide signal processing functionality for endpoint use. An IP PBX gateway coupling the IP telephone system to the PSTN and or analog telephones also include dedicated codecs to provide signal processing functions to bridge traditional voice and digital bitstream voice networks.

In general techniques are described by which an IP telephone system leverages the digital signal processing functions of end user IP telephones by distributing signal processing tasks typically carried out by a centralized IP PBX. A resource manager of the IP telephone system manages digital signal processing functions of the individual endpoint IP telephones as a network of distributed signal processing resources. For example techniques are described in which the IP telephone system identifies a digital bitstream that requires processing to carry out IP telephony functionality within the system such as a digital bitstream captured from an analog signal of a legacy phone that a centralized IP PBX would typically process and convert for introduction into the IP telephone system. Instead of fully processing the digital bitstream in a centralized manner with the codecs of the IP PBX the system directs the digital bitstream to for instance an idle IP telephone having available digital signal processing capacity and directs the IP telephone to process the digital bitstream using its digital signal processing resources. Upon completing the signal processing task the IP telephone returns the processed digital bitstream to the IP telephone system.

In one example implementation the resource manager is integrated within an IP PBX and includes a database that describes current availability and capabilities of re targetable geographically distributed signal processing resources e.g. endpoint IP telephones of the IP telephone system. An interface to software integrated on the distributed resources enables the central resource manager to update the database according to changes in the status of the distributed resources such as when individual endpoint IP phones are busy servicing calls. The central resource manager receives signal processing tasks from elements of the IP telephone system including the IP PBX and distributes each task to a distributed resource that is both available and capable of completing the task. After completing a task a distributed resource returns processed digital data to the central resource manager for further processing and or relay to a destination device.

In one embodiment the invention is directed to a method comprising the steps of receiving with an internet protocol IP telephony device a signal processing capability description that specifies one or more signal processing capabilities for a first IP telephone DSP resource connected to the IP telephony device via a network communication link and storing the signal processing capability description to the IP telephony device. The method further comprises the steps of receiving with the IP telephony device communication session parameters in a signaling protocol message for the communication session wherein the communication session parameters specify a signal processing requirement for communication session data associated with the communication session and receiving with the IP telephony device a bitstream for the communication session that comprises communication session data. The method also comprises generating a signal processing task comprising signal processing task parameters that describes the signal processing requirement and identifies the bitstream determining from the signal processing capability description the first IP telephone DSP resource is capable of performing the signal processing requirement and based at least on the determination that the first IP telephone DSP resource is capable of performing the signal processing requirement sending the signal processing task to the first IP telephone DSP resource. The method further comprises the steps of directing the bitstream from the IP telephony device to the first IP telephone DSP resource receiving with the IP telephony device a first processed bitstream generated by the first IP telephone DSP resource in accordance with the signal processing task parameters and sending the first processed bitstream to a destination device for the communication session.

In one embodiment the invention is directed to a method comprising the steps of sending a signal processing capability description that specifies one or more signal processing capabilities for an Internet Protocol IP telephone from the IP telephone to an IP telephony device via a network communication link. The method further comprises receiving with the IP telephone a signal processing task having signal processing task parameters that identifies a bitstream and describes a signal processing requirement for the bitstream and receiving the bitstream with the IP telephone. The method also includes the steps of applying one of the signal processing capabilities of the IP telephone to perform the signal processing requirement for the bitstream to generate a processed bitstream and outputting the processed bitstream.

In another embodiment the invention is directed to an Internet Protocol IP telephony device comprising a central resource manager having a set of one or more resource mappings a network interface and a resource interface to receive a signal processing capability description that specifies one or more signal processing capabilities for a first IP telephone DSP resource connected to the IP telephony device via a network communication link wherein the resource interface stores the signal processing capability description to the set of resource mappings. The IP telephony device additionally comprises a call agent having a signaling stack to receive communication session parameters in a signaling protocol message for the communication session wherein the communication session parameters specify a signal processing requirement for communication session data associated with the communication session and a data stream stack to receive via the network interface a bitstream that comprises communication session data for the communication session. The IP telephony device additionally comprises a task manager to generate a signal processing task comprising signal processing task parameters that describes the signal processing requirement and identifies the bitstream wherein the task manager uses the signal processing capability description stored to the set of resource mappings to determine the first IP telephone DSP resource is capable of performing the signal processing requirement. The IP telephony device additionally comprises a task interface to based at least on the determination that the first IP telephone DSP resource is capable of performing the signal processing requirement sending the signal processing task to the first IP telephone DSP resource wherein the task manager directs the bitstream to the first IP telephone DSP resource via the network interface wherein the data stream stack receives via the network interface a first processed bitstream generated by the first IP telephone DSP resource in accordance with the signal processing task parameters and wherein the task manager directs the first processed bitstream to a destination device for the communication session.

In another embodiment the invention is directed to an IP telephone comprising a central resource manager interface having a resource interface to send a signal processing capability description that specifies one or more signal processing capabilities for the IP telephone from the IP telephone to an IP telephony device via a network communication link. The IP telephone further comprises a task interface to receive a signal processing task having signal processing task parameters that identifies a bitstream and describes a signal processing requirement for the bitstream a network interface and a data stream stack to receive via the network interface the bitstream. The IP telephone also includes a task manager and a digital signal processing resource that executes an algorithm to apply one of the signal processing capabilities of the IP telephone to perform the signal processing requirement for the bitstream to generate a processed bitstream wherein the task manager directs the data stream stack to output via the network interface the processed bitstream.

In another embodiment the invention is directed to a system comprising an IP telephone and an IP private branch exchange IP PBX . The IP PBX comprises a central resource manager having a set of one or more resource mappings a first network interface and a first resource interface to receive a signal processing capability description that specifies one or more signal processing capabilities for the IP telephone connected to the IP PBX via a network communication link wherein the first resource interface stores the signal processing capability description to the set of resource mappings. The IP PBX also includes a call agent having a signaling stack to receive communication session parameters in a signaling protocol message for the communication session wherein the communication session parameters specify a signal processing requirement for communication session data associated with the communication session and a first data stream stack to receive via the first network interface a bitstream that comprises communication session data for the communication session. The IP PBX further comprises a first task manager to generate a signal processing task comprising signal processing task parameters that describes the signal processing requirement and identifies the bitstream wherein the first task manager uses the signal processing capability description stored to the set of resource mappings to determine the IP telephone is capable of performing the signal processing requirement. The IP PBX also comprises a first task interface to based at least on the determination that the IP telephone is capable of performing the signal processing requirement sending the signal processing task to the IP telephone wherein the first task manager directs the bitstream to the IP telephone via the first network interface wherein the first data stream stack receives via the first network interface a first processed bitstream generated by the IP telephone in accordance with the signal processing task parameters and wherein the first task manager directs the first processed bitstream to a destination device for the communication session. The IP telephone comprises a central resource manager interface having a second resource interface to send the signal processing capability description to the IP PBX via the network communication link and a second task interface to receive a signal processing task having signal processing task parameters that identifies a bitstream and describes a signal processing requirement for the bitstream. The IP telephone further includes a second network interface a second data stream stack to receive via the second network interface the bitstream and a second task manager. The IP telephone also comprises a digital signal processing resource that executes an algorithm to apply one of the signal processing capabilities of the IP telephone to perform the signal processing requirement for the bitstream to generate a processed bitstream wherein the task manager directs the second data stream stack to output via the second network interface the processed bitstream to the IP PBX.

The techniques described in this disclosure may provide one or more advantages. For example an IP telephone system typically includes a number of IP telephones that have idle signal processing resources during extended periods of non use. The described techniques enable the IP telephone system to better utilize already existing resources and avoid adding dedicated signal processing resources. In addition because an IP PBX gateway is often required to simultaneously perform large numbers of signal processing tasks for multiple voice calls distributing the tasks to pre existing elements of the IP telephone system may allow the system administrator to forgo a resource intensive IP PBX in favor of a simplified lower cost model. Furthermore the techniques may enable IP telephones to share tasks with one another such that not every IP telephone requires advanced capabilities to present such advanced capabilities to a respective user. Rather more simple IP telephones can distribute to an advanced phone those tasks that require an advanced capability and thereby leverage the advanced capabilities of their high performance peers. In addition adding more IP telephones automatically increases the amount of available signal processing resources.

The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features objects and advantages of the invention will be apparent from the description and drawings and from the claims.

IP PBX is communicatively coupled to Wide Area Network WAN via network link to establish and manage communication sessions between one or more devices within IP telephone system and or coupled to IP telephone system via WAN or Public Switched Telephone Network PSTN . WAN may comprise leased communication lines a circuit switched network a packet switched network such as the Internet or a virtual private network VPN or some combination thereof. WAN may transport data for the communication sessions over IP Frame Relay Asynchronous Transfer Mode ATM Ethernet and or another protocol. IP PBX may be deployed by an enterprise on an enterprise network e.g. LAN to enable IP telephone system to deliver voice calls and other services among geographically distributed enterprise campuses over WAN . In some embodiments IP PBX is a PBX hosted by a service provider or network operator. In some embodiments IP PBX uses a Centrex service. In some embodiments IP telephone system includes a session border controller SBC and or a firewall or other intrusion prevention device that couples to WAN via network link to mediate traffic and communication sessions between WAN and IP PBX .

IP PBX is additionally communicatively coupled to Public Switched Telephone Network PSTN via trunk and to legacy phone via line . PSTN is a circuit switched network that carries signaling data and telephone calls over a plurality of channels. Trunk is a transmission link capable of carrying a plurality of channels i.e. digital signals between IP PBX and PSTN that are aggregated using for example time division multiplexing TDM . Trunk may include for instance a T1 or E1 line. Legacy phone is a traditional analog TDM phone and line may comprise for example a Plain Old Telephone Service POTS local loop. IP PBX switches legacy phone and telephones connected to IP PBX via PSTN . That is IP PBX uses signaling data provides by these telephones to create a connection using an internal switching network and or crossbar switch between the telephones and other telephones or devices including intermediate devices such as IP PBX . In some embodiments PSTN is a private circuit switched network that couples IP PBX to another telephone system.

IP telephones establish communication sessions with other devices to enable voice calls conference calls and other data transmission using Voice over IP VoIP control protocols. Each of IP telephones may be an IP telephone or a softphone such as a personal computer handheld device mobile phone or gaming console that is VoIP capable. IP telephones support one or more VoIP control protocols such as H.323 Session Initiation Protocol SIP Media Gateway Control Protocol MGCP and H.248 Megaco to establish communication sessions with other devices.

IP PBX comprises gateway to interoperate with PSTN and legacy phone to provide a translation or conversion between IP and Time division multiplexing TDM Pulse Code Modulation PCM signaling protocol and communication data for communication sessions carried by PSTN to external TDM devices and communication sessions in which legacy phone participates. Gateway also supports VoIP control protocols to establish communication sessions with IP capable devices such as IP telephones or devices connected to IP telephone network via WAN . Gateway stitches together circuit switched aspects of a communication session operating over PSTN or link with packet switched aspects of a communication session operating over LAN or WAN to create an end to end communication session between a VoIP capable device and a TDM device. In some embodiments gateway is a circuit card module insertable within the IP PBX platform. In some embodiments gateway is a separate network device such as a dedicated media gateway or a computer executing VoIP software.

A communication session may comprise a Real time Transport Protocol RTP session operating over LAN and or WAN to transport communication data between endpoints which include IP PBX or one of IP phones . The RTP session is carried by a transport protocol such as Transmission Control Protocol TCP or User Datagram Protocol UDP running on a network layer protocol e.g IP . IP phones each include analog to digital converters and a coder decoder codec to convert analog voice signals to RTP packet streams for transmission to destination devices. Upon receiving RTP packets IP phone codecs decode the application layer payload data i.e. the digital voice data received during RTP sessions and a digital to analog converter convert decoded digital bitstream to analog voice signals for output via a speaker for example.

IP phones additionally include digital signal processing resources that enable IP phones to provide one or more signal processing features to enhance a user experience increase transmission efficiencies or perform other processing functions. For instance IP phones may perform echo cancellation to improve a user experience as well as voice compression decompression for voice data to reduce bandwidth utilization over LAN and or WAN . As another example IP phone A may be a high performance phone that performs silence suppression and teleconference mixing.

Similarly gateway converts voice data received in a TDM channel of link or trunk to an RTP stream for transmission to a destination device. Gateway includes digital signal processing resources that allow gateway to provide additional signal processing capabilities to communication sessions such voice compression decompression echo cancellation silence suppression and teleconference mixing. Furthermore IP PBX may connect to another IP telephone system via WAN that uses a set of encoding techniques on voice data to generate RTP packets for transmission that are not available to IP phones . For example IP telephone system may use the International Telecommunication Unit ITU G.711 64 kbit s codec while the other IP telephone system uses the ITU G.723.1 6.3 kbit s codec. Upon receiving an RTP packet stream for a communication session involving one of IP phones and an endpoint device on the other IP telephony system IP PBX transcodes the voice data to conform to the ITU G.711 codec used by IP telephone system . IP PBX may then forward the transcoded voice data to one of IP phones in an RTP packet stream.

In accordance with the techniques of this disclosure IP PBX additionally comprises central resource manager CRM to monitor and manage the availability and capabilities of re targetable digital signal processing DSP resources within IP phones and gateway . CRM generates signal processing tasks such as directives to perform transcoding or echo cancellation for a communication session bitstream and distributes the tasks via LAN to available capable DSP resources within IP phones or gateway . A communication session bitstream may comprise an RTP packet stream. A signal processing task is a digital signal processing routine to be performed on a bitstream. A signal processing task may be defined by task parameters which may comprise an identity of a codec transcoding function or other DSP resource that a receiving one of IP phones is to apply to the bitstream as well as deadline priority forwarding information bitstream identifiers and other data parameters to direct an operation of one of IP phones with respect to a bitstream.

The targeted DSP resources receive the signal processing task and complete the task as assigned before returning the processed data to CRM . Gateway obtains the processed data from CRM for further processing and or forwarding to an endpoint device of the corresponding communication session. In this way CRM offloads to idle DSP resources signal processing tasks that would otherwise be performed by gateway or another dedicated resource.

In some embodiments CRM is an internal proxy for IP telephone system . That is CRM intermediates between elements of IP telephone system and external elements so as to receive bitstreams for communication session involving IP phones A and or legacy phone . CRM may then redirect the bitstreams along with signal processing tasks to IP phones for processing. In some embodiments CRM replicates a bitstream to multiple ones of IP phones for processing according to the same signal processing task. In this way CRM promotes simultaneous redundant processing and may receive multiple redundant processed bitstreams from IP phones . If one of the redundant processing IP phones encounters a processing failure CRM may continue to maintain an uninterrupted communication session using a remaining redundant processed bitstream. An IP phone may encounter a processing failure when for example the IP phone receives an incoming call request or a user picks up the handset to indicate an impending outbound call request thus causing the IP phone to stop processing the signal processing task to focus processing on the incoming outgoing call. That is the IP phone may need to immediately utilize DSP resources for a call in which the IP phone participates prevent the IP phone from further processing the signal processing task. Redundant processing using multiple ones of IP phones enables CRM to failover to a redundant processed bitstream from a backup one of IP phones to maintain an uninterrupted communication session.

According to the described techniques each of IP phones comprises a respective one of central resource manager interfaces A C illustrated as CRM IF A C . For example IP phone A comprises CRM interface A. CRM interfaces interact with CRM of IP PBX to expose the available DSP resources on each of IP phones . CRM interfaces and CRM communicate over LAN using a network communication protocol such as TCP IP to carry application messages. For example CRM interface A may send CRM an indication of the DSP capabilities of IP phone A including performance and algorithmic capabilities. CRM interface A may send CRM a description of IP phone A DSP chipset properties of the central processing unit CPU and of a list of codecs transcoding functions and other routines stored by IP phone A in main memory as firmware in a programmable read only memory PROM or ROM or in some other tangible computer readable storage medium. In some instances CRM interfaces receive codecs transcoding functions and other routines from CRM with which to upgrade the DSP capabilities of corresponding IP phones . For example CRM interface A may receive a transcoding function in the form of a bit file or other compilation of computer readable instructions. CRM interface A may install the transcoding function into a digital signal processor firmware of IP phone A store the function in main memory for IP phone to be executed by a CPU of IP phone A or otherwise make the transcoding function available as a signal processing resource of IP phone A.

CRM interfaces additionally send status updates to CRM to provide an indication of the availability of DSP resources on corresponding IP phones . If for example IP phone A receives a control protocol packet requesting a communication session e.g. a voice call CRM interface A may send CRM a message indicating IP phone A DSP resources are unavailable. Conversely when the communication session terminates IP phone A may send CRM a message indicating IP phone A DSP resources are free. As another example if IP phone A is upgraded with new firmware CRM interface A may send CRM a description of the DSP resources e.g. codec identifiers provided by the new firmware. As another example IP phone A may send CRM a message indicating IP phone A is currently engaged in a communication session e.g. a user is using IP phone A to make a voice call .

CRM interfaces receive signal processing tasks from CRM based on respective availability and capabilities of corresponding IP phones . For instance CRM may determine that IP phone A is capable of and available to transcode a bitstream encoded with ITU G.723.1 to a bitstream encoded with ITU G.711. CRM sends the signal processing task including the task parameters and directs the bitstream to CRM interface A to cause IP phone A to process the bitstream in accordance with the task parameters.

In some embodiments as described in detail with respect to aspects of CRM functionality is distributed to CRM interfaces such that any of CRM interfaces may also distribute a signal processing task to another one of CRM interface . For example a communication session involving IP phone A may require teleconference mixing a DSP capability that IP phone A in this example does not provide. However CRM interface A may send a signal processing task to CRM interface B to direct IP phone B to perform the teleconference mixing on behalf of IP phone A. In some instances CRM interfaces may request CRM to provide an identity of an IP phone that is capable of and available to perform a signal processing task on behalf of the IP phone corresponding to the requesting CRM interface.

By cooperating to enable to CRM to distribute signal processing tasks to IP phones the techniques described with respect to CRM and CRM interfaces may enable IP telephone system to increase the utilization of existing DSP resources and thereby avoid or reduce the amount of dedicated DSP resources needed to support the service requirements of the system. In addition adding additional ones of IP phones automatically increases the amount of available DSP resources. The techniques may also allow IP phones to distribute tasks among IP phones which may have enable simpler IP phones to leverage the capabilities of high performance IP phones.

IP PBX and WAN exchange packetized communication data for communication session as a packet based bitstream e.g. an RTP bitstream arriving as a series of one or more RTP packet payloads . Gateway of IP PBX acts as a gateway between the packet switched IP domain within IP telephone system and the TDM based circuit switched domain that comprises legacy phone . That is gateway transcodes the downstream packet based bitstream of communication session received by IP PBX to a digital signal compatible with legacy phone . Gateway receives upstream TDM based digital signal data for communication session from legacy phone and transcodes the digital signal to a packet based bitstream for transmission by IP PBX to a destination device via WAN . In some instances gateway may be tasked with tone detection echo cancellation voice compression decompression and other signal processing functions.

CRM monitors availability and capabilities of DSP resources within IP telephone system including DSP resources of IP phones and of gateway . CRM interfaces update CRM with a DSP resource status of corresponding IP phones and CRM manages the updates to maintain a record of available DSP resources.

CRM may determine gateway does not have sufficient resources available to perform the requisite signal processing for communication session or is otherwise not a preferred DSP resource for performing signal processing for communication session . For example during a capability negotiation to set up communication session CRM may determine gateway has reserved DSP resources in use such that gateway DSP resources are unable to additionally transcode a bitstream of communication session according to a particular negotiated codec.

Having determined gateway is not a preferred DSP resource CRM selects primary and backup ones of IP phones that each comprise a DSP resource sufficient to perform an aspect of the requisite signal processing for communication session . In the illustrated example CRM selects IP phone A as a primary DSP resource and selects IP phone B as a backup DSP resource for at least one signal processing task for which gateway is responsible to further communication session . Upon selecting IP phones A and B as redundant DSP resources CRM sends via LAN signal processing task A to CRM interface A and sends signal processing task B to CRM interface B. Signal processing tasks A B are collectively referred to hereinafter as signal processing tasks . In the illustrated example signal processing tasks include signal processing parameters that direct respective IP phones to transcode on behalf of gateway the downstream packet based bitstream of communication session received by IP PBX to a digital signal compatible with legacy phone .

In addition to sending signal processing tasks CRM operates as a destination proxy for legacy phone for communication session . That is CRM intermediates the downstream packet based bitstream of communication session as it traverses IP telephone system to legacy phone . CRM replicates and directs via LAN the replicated unprocessed bitstreams A and B unprocessed bitstreams to respective CRM interfaces A and B for simultaneous redundant distributed processing. IP phones A and B then process the unprocessed bitstreams in accordance with signal processing tasks and return respective processed bitstreams A and B to CRM . For example CRM interface A receives unprocessed bitstream A from CRM and provides the unprocessed bitstream to the DSP resource of IP phone A which processes and returns the bitstream via CRM interface A to CRM as processed bitstream B. In the exemplary embodiment processed bitstreams comprise communication session data encoded as TDM based data signals compatible with legacy phone . In some examples processed bitstreams comprise communication session data encoded as RTP streams a collection of one or more RTP packets or some other data format.

CRM selects processed bitstream A received from IP phone A the primary DSP resource in this example and forwards processed bitstream A to gateway for transmission to legacy phone via link to further communication session . In this manner CRM and CRM interfaces A and B cooperate to enable IP PBX to distribute aspects of signal processing for communication session to DSP resources located on IP phones A and B.

In this embodiment in accordance with the techniques of this disclosure CRM interfaces distribute signal processing tasks among idle ones of IP phones to perform distributed signal processing using idle DSP resources located within IP phones .

CRM interfaces may request CRM to provide an identity of one of IP phones that is capable of and available to perform a signal processing task on behalf of the IP phone corresponding to the requesting CRM interface. In the illustrated example CRM interface B sends resource request message to CRM which responds with an identity of IP phone C in resource response message . Resource request message may include task parameters to characterize the signal processing task that IP phone B is to have performed. Resource response message may include a network address of IP phone C.

Upon receiving the identity of IP phone C from CRM CRM interface B sends CRM interface C signal processing task and unprocessed bitstream . In the illustrated example signal processing tasks includes signal processing parameters that direct IP phone C to process on behalf of IP phone B an unprocessed bitstream of communication session between IP phone B and legacy phone . Unprocessed bitstream may be downstream or upstream with respect to IP phone B. Signal processing task may comprise echo cancellation transcoding a codec function or some other DSP function. In some instances CRM interface B replicates unprocessed bitstream to send a replicated bitstream to IP phone A for redundant processing.

CRM interface C receives signal processing task and directs IP phone C to process bitstream in accordance with the task to generate processed bitstream . CRM interface C returns processed bitstream to IP phone B via CRM interface B.

In some embodiments aspects of CRM are distributed to CRM interfaces to reduce reliance of CRM interfaces on CRM and thereby reduce the processing burden on IP PBX . For example CRM interfaces may maintain a database of available DSP resources on IP phones and when necessary send signal processing tasks to any of the available capable DSP resources for the tasks. In another example one of CRM interfaces may send resource request messages to other CRM interfaces rather than to CRM to determine availability the corresponding IP phones .

Router performs network routing functions for IP PBX including executing routing protocols maintaining a routing table of route data learned from the routing protocols and forwarding traffic along network paths using forwarding information derived from the route data. Router exchanges packets with other network devices via LAN interface and WAN interface .

Proxy represents IP PBX to other communication devices as one or more other elements of IP telephone system . For example proxy may advertise to WAN via network link a network address of IP PBX as a destination address for one or more IP phones or gateway i.e. the gateway to legacy phone of IP telephone system of . As another example proxy may send a SIP REGISTER request to a SIP registrar that registers a network address of IP PBX to a SIP Uniform Resource Identifier URI for one of IP phones . Proxy performs network address translation NAT to map a bitstream to an intended communication device and enable router to forward the bitstream to the intended destination. In this way communication session bitstreams intended for IP phones can be received by IP PBX for processing and eventual forwarding to an intended destination IP phone via LAN interface .

IP PBX comprises call agent to manage signaling control for creating maintaining and tearing down communication sessions that IP PBX intermediates on behalf of legacy elements such as legacy phone or PSTN of . Call agent includes a signaling stack that comprises a protocol stack for one or more call signaling protocols such as SIP H.323 Media Gateway Control Protocol MGCP and H.248. To establish a new communication session call agent executes protocols in signaling stack to exchange control information with other signaling devices such as media gateway controllers signaling controllers other IP PBXs or IP phones . Call agent directs data stream stack to create and tear down communication sessions when the calls are generated or terminated. For example call agent may direct data stream stack to establish an RTP session with another network device.

Call agent additionally includes signaling system 7 SS7 stack to exchange control information with legacy devices and or remote traditional exchanges to create and tear down in conjunction with switch TDM channels or other circuit switched connections between gateway and legacy devices. Switch couples to digital and or analog circuits such as trunk and analog line via circuit interfaces and switches circuit based connections for communication sessions using an internal switching network such as a cross bar switch according to corresponding record parameters in communication sessions .

Data stream stack comprises a protocol stack for one or more communication protocols. In the illustrated embodiment data stream stack comprises RTP operating over UDP IP. Data stream stack may further comprise Real time Transfer Control Protocol RTCP or RTP operating over TCP IP. Call agent executes protocols in data stream stack to establish a communication session for instance an RTP session with another network device.

Call agent stitches together circuit switched connections created using SS7 stack and packet switched connections created using signaling stack to create an end to end communication session to deliver voice and other data between communication devices. For each such communication session call agent maintains a record in communication sessions sessions which stores one or more records that comprise parameters and state data for a corresponding one or more communication sessions for which gateway is an intermediary. Communication session parameters may for example identify endpoints using e.g a network address or SIP URI identify an RTP stream and specify switch circuit interfaces. In this way sessions map circuit switched connections coupled to switch of gateway with packet switched connections such as RTP sessions for RTP streams received by LAN interface or WAN interface . Records in sessions may additionally specify and describe for a communication session digital signal processing requirements for the session including echo cancellation teleconference mixing and or transcoding for instance. For example a session record may specify transcoding an incoming RTP stream from an ITU G.723.1 6.3 kbit s encoding to an ITU G.711 64 kbit s encoding and forwarding the processed RTP stream to IP phone B.

Gateway additionally includes dedicated digital signal processors DSPs to transcode TDM channel bitstreams and RTP streams for a communication session to interface the circuit switched and packet switched connections that terminate at the gateway. DSPs may additionally perform other digital signal processing functions required for the session as specified by a corresponding record in sessions . DSPs comprise one or more digital signal processors application specific integrated circuits ASICs or other logic circuits general or special purpose processors or other logic circuits to execute digital signal processing routines stored in firmware or other tangible computer readable media. DSPs may operate as co processors for a central processing unit CPU that provides an operating environment for elements of gateway . DSPs are referred to herein as static DSP resources and may be prioritized by IP PBX components for performing signal processing functions over non local DSP resources.

IP PBX comprises central resource manager CRM illustrated in in further detail to monitor and manage the availability and capabilities of re targetable digital signal processing DSP resources within IP phones and static DSP resources within gateway and to coordinate distribution of signal processing tasks and corresponding bitstreams to available capable DSP resources.

CRM comprises resource interface to interface with gateway and to exchange messages via LAN interface with CRM interfaces to determine capabilities and availability of various re targetable and static DSP resources within the IP telephone system including DSPs of gateway and DSPs or other processing resources of each of IP phones . A re targetable resource as the phrase is used herein is a device or device component other than DSPs that is capable of executing signal processing tasks delegated to the resource by a resource manager such as CRM . For instance a re targetable resource may refer to one of IP phones to a particular digital signal processor or other logic that constitutes an IP phone to a particular pipeline or sub component e.g. an arithmetic logic unit or floating point unit of a DSP or other processor of the IP phone or some other resource. An IP telephone DSP resource is a re targetable resource of an IP telephone. Resource interface may query gateway to obtain descriptions of signal processing capabilities provided by the resources as well as descriptions of resources availability. In some instances gateway and or CRM interfaces provide resource updates to CRM via resource interface whenever capabilities or availability of the respective resource changes. For example call agent may upon routing a call involving IP phone C send a resource update that indicates an unavailability of IP phone C to CRM .

Signal processing capability descriptions may include for instance a list of codecs executable by a resource one or more signal processing routines e.g. echo cancellation executable by a resource a description of performance capabilities e.g. processing rate latency and number of 1 kilobyte fast fourier transforms calculable per minute provided by a resource a total number of execution threads sustainable by a resource and other information that may be used by CRM to determine an appropriate resource to target with a signal processing task. Resource availability descriptions may include historical usage data current usage data anticipated usage data or other information that may be used by CRM to effectively coordinate delegation of a signal processing task to a re targetable resource.

Resource interface maps re targetable resources to signal processing capabilities in resource mappings an associative data structure that keys an identifier for a signal processing capability such as a codec to a list of identifiers for resources that are qualified to perform the capability. For example resource mappings may include a record that lists IP phone A as a re targetable resource capable of transcoding an ITU G.723.1 6.3 kbit s encoding of the bitstream to an ITU G.711 64 kbit s encoding for the bitstream. In some embodiments resource mappings includes records that specify a characteristic performance measure for the associated DSP resource with respect to the signal processing routine mapped by the record.

Resource interface receives updated resource availability descriptions from DSPs and CRM interfaces and stores the descriptions in resource availability records in resource statistics of CRM . Resource statistics is a data structure that stores one or more resource availability descriptions for the re targetable and static resources of IP telephone system . Each resource availability description comprises for example an identifier for a resource such as a network address or a DSP identifier a flag that indicates whether a resource is currently available a list of previous dates and times in which the resource was unavailable to perform signal processing tasks as well as other information that may enable CRM to predict a future availability of re targetable resources to perform signal processing tasks.

CRM additionally comprises task manager illustrated as task mgr. task interface illustrated as task if and tasks to manage distribution of signal processing tasks to the re targetable resources within IP telephone system . Task manager determines from sessions signal processing requirements for the communication sessions involving gateway and or IP phones . In some embodiments call agent triggers task manager with a message requesting performance of a signal processing task with respect to a particular session. When task manager finds a new or otherwise not delegated signal processing requirement in one of sessions task manager obtains the requirement description e.g. codec identifiers type of processing requirements and creates a new signal processing task and stores the new task as a record in tasks of CRM . Signal processing task records in tasks specify task parameters as well as whether a task is delegated and if so an identifier for the delegate e.g. IP phone B or DSPs .

Task interface exchanges signal processing task related information with re targetable resources. For example task interface may receive a task update from CRM interface B of IP phone B indicating that a task is complete. As another example task interface may send a signal processing task to a re targetable resource directing the resource to perform the task. Task interface and resource interface may be standardized to enable multiple vendors to provide compatible algorithms and bitstream handling by CRM .

Task manager queries resource mappings and resource statistics to identify one or more available capable DSP resources with which to delegate a signal processing task. Upon identifying such resources task manager selects one of the resources and delegates the signal processing task to the selected resource. Task manager stores a delegated resource identity in the corresponding record for the signal processing task in tasks and sends the signal processing task via task interface to the delegated resource for the task. Task manager updates resource statistics to indicate that the delegated resource is currently in use. In some aspects task manager selects and delegates to multiple DSP resources to provide redundant processing via primary and backup DSP resources. In this way task manager may provide graceful failover if the primary DSP resource fails in some way to perform a delegated signal processing task.

In some embodiments task manager prioritizes static resources such as DSPs for delegation over re targetable resources such as IP phones . An administrator or software agent may set a low watermark setting for DSPs such that when utilization of DSPs exceeds the low watermark task manager delegates signal processing tasks to re targetable resources rather than to the static resources. For example an administrator may set a low watermark at 80 utilization. Task manager monitors DSPs utilization and delegates tasks when utilization exceeds 80 .

In some embodiments task manager queries and analyzes statistical usage data in resource statistics for re targetable resources to predict impending availabilities of the resources. For example task manager may determine IP phone C frequently participates in voice calls during weekday afternoons and may thus determine that even if IP phone C is immediately available during a weekday afternoon the phone nevertheless should be given a low priority for receiving signal processing tasks during those times due to a relatively high probability that the tasks may be interrupted by a voice call. In such embodiments task manager may reduce the probability that a signal processing task will be interrupted by an incoming outgoing call in which a delegated one of IP phones participates. In conjunction with employing redundant bitstream processing by multiple IP phones these techniques may reduce the probability that a transcoding operation will be interrupted during a communication session.

In addition to delegating signal processing tasks task manager re directs corresponding bitstreams for the tasks to the delegated resource. If a bitstream is proxied by proxy task manager may direct proxy to forward the bitstream to the delegated resource via LAN interface . In some embodiments task manager directs router to install forwarding information to enable proxy to properly forward the bitstream. If a bitstream is intermediated by gateway in a communication session that involves legacy devices task manager may direct call agent to forward the bitstream to the delegated resource via LAN interface . In some embodiments task manager modifies a corresponding record in sessions to stitch the bitstream to a path via LAN interface to the delegated resource.

In some embodiments task manager receives resource requests from one of CRM interface requesting an identity of another one of IP phones that is capable of and available to perform a signal processing task on behalf of the requesting CRM interface. In such embodiments task manager resource mappings and resource statistics to identify such a resource return the identity of the resource to the requesting CRM interface.

CRM additionally maintains algorithm library a store of one or more signal processing routines that CRM may upload to re targetable resources to upgrade the resources for delegated signal processing tasks. Algorithm library may store for instance particular codecs echo cancellation routines teleconference mixing algorithms and or other signal processing routines that can be performed by re targetable resources such as IP phones in firmware or other computer readable storage media including tangible computer readable storage media. In some instances DSPs may store one or more algorithms of algorithm library . Task manager directs resource interface to upload signal processing routines such as codecs to re targetable resources to augment capabilities of the re targetable resources. For example task manager may direct resource interface to upload an ITU G.711 codec to IP phone B to enable the IP phone to transcode a communication bitstream encoded according to the ITU G.711 standard.

Delegated DSP resources for signal processing tasks such as one or more of IP phones return bitstreams processed in accordance with delegated signal processing tasks to IP PBX for forwarding to destination endpoints for the corresponding communication sessions. Task manager re directs processed bitstreams to the appropriate destination endpoints via LAN interface WAN interface or switch . In this manner CRM distributes signal processing tasks and corresponding unprocessed bitstreams to re targetable DSP resources and receives in return processed bitstreams that static DSPs would otherwise generate for IP PBX . As a result the techniques of this disclosure may reduce processing requirements of dedicated static DSPs by leveraging existing idle DSP resources distributed within IP telephone system .

In this example the request may cause CRM interface to invoke the GetRTCloudCaps method using the TerminalType parameter to return signal processing capabilities of IP phone to the request device.

User interface of IP phone may comprise one or more of a telephone headset or handset a microphone a speaker or other devices with which a user interacts with IP phone to send and receive communication data. User interface digitizes received voice or other analog signals from a user using analog to digital converter ADC which then directs the digitized user data to DSPs for processing. In the other direction user interface receives analog signals converted from digital bitstreams by digital to analog converter DAC for output to a user.

DSPs comprise one or more signal processing resources provided by one or more digital signal processors ASICs or other logic circuits general or special purpose processors or other logic circuits. DSPs execute digital signal processing routines stored by algorithms in firmware or other computer readable storage media including tangible computer readable storage media and in some aspects may operate as co processors for a central processing unit CPU that provides an operating environment for elements of IP phone . In some instances one or more of algorithms may be stored by DSPs . In accordance with the techniques of this disclosure DSPs may be targeted to performing distributed signal processing tasks on behalf of another device e.g. IP PBX and is therefore referred to herein as a re targetable resource. Algorithms may comprise for instance particular codecs echo cancellation routines teleconference mixing algorithms and or other signal processing routines.

Call agent of IP phone manages signaling control for creating maintaining and tearing down communication sessions in which IP phone participates. Call agent includes signaling stack that comprises a protocol stack for one or more call signaling protocols such as SIP H.323 Media Gateway Control Protocol MGCP and H.248. To establish a new communication session call agent executes protocols in signaling stack to exchange control information with other signaling devices such as media gateway controllers signaling controllers an IP PBX or other IP phones. Call agent directs data stream stack to create and tear down communication sessions when the calls are generated or terminated. For example call agent may direct data stream stack to establish an RTP session with another network device.

Data stream stack comprises a protocol stack for one or more communication protocols. In the illustrated embodiment data stream stack comprises RTP operating over UDP IP. Data stream stack may further comprise Real time Transfer Control Protocol RTCP or RTP operating over TCP IP. Call agent executes protocols in data stream stack to establish a communication session for instance an RTP session with another network device.

IP phone exchanges network packets with other network devices via LAN interface . In one example LAN interface receives an RTP stream associated with an RTP session. Data stream stack decapsulates the application layer communication session data from the RTP packets and delivers the data to DSPs for processing. DSPs may apply transcoding functions echo cancellation functions or other signal processing functions to the communication session data to enable or enhance user communications.

In accordance with the described techniques CRM interface receives signal processing tasks for execution by DSPs to process a received bitstream. CRM interface comprises resource interface to communicate signal processing capabilities and availability of IP phone to a central resource manager such as central resource manager of IP PBX . For instance resource interface publicizes descriptions of signal processing routines stored by algorithms to the central resource manager. In addition resource interface may collect statistical data regarding IP phone usage and publicize the data to the central resource manager. Resource interface also sends availability update messages to the central resource manager that comprise an indication of whether DSPs are available for use as a re targetable resource. For example when resource interface signaling stack is establishing a voice call for a user resource interface may send an availability update message indicating a non availability of DSPs .

In the example procedures above query RT cloud stats returns a structure that embodies statistical data regarding IP phone usage to a requesting device. As another example query RT cloud caps returns a structure that embodies a list of capabilities in the form of available codecs and a processing power of DSPs .

CRM interface also comprises task interface to receive signal processing tasks and exchange task related data with a central resource manager. Task interface stores received task parameters in a corresponding record in tasks a set of one or more signal processing task records for execution by DSPs . Task parameters for a signal processing task received by task interface and stored in tasks identify a corresponding bitstream received by LAN interface for the signal processing task. Task manager applies the signal processing task to process the bitstream by allocating one or more constituent DSP resources of DSPs to the signal processing task such that the allocated resources perform the signal processing function specified by the task parameters. Task manager then returns the processed bitstream to the central resource manager or a bitstream destination device via LAN interface . In some aspects task manager may modify sessions to direct the processed bitstream to a destination. Task interface and resource interface may be standardized to enable multiple vendors to provide compatible algorithms and bitstream handling by CRM interface . In some aspects a received bitstream is processed by DSPs and returned via LAN interface as a stream. That is DSPs continually process the bitstream as the bitstream data is received and task manager returns any processed bitstream data as it is processed.

For example set codec params sets the parameters of a codec in algorithms . As another example request RT cloud transcode channel requests a digital signal processing channels of DSPs to process a particular bitstream using an ingress and egress codec.

In some embodiments CRM interface interacts with signaling stack to offload signal processing tasks for a communication session in which IP phone participates to another device having improved signal processing capabilities. For example signaling stack may establish a communication session that requires IP phone to transcode a bitstream using a codec that algorithms does not store or that DSPs are unable to perform within specified requirements. As a result CRM interface may send a resource request to a central resource manager to request an identity of an available capable re targetable resource. Upon receiving an identity for such a resource CRM interface directs one or more corresponding bitstreams for the communication session to the re targetable resource and receives in response the processed bitstreams. CRM interface may send a processed downstream bitstream to data stream stack or DSPs for further processing or output via user interface .

Task manager of central resource manager obtains signal processing requirements for the communication session negotiated by signaling stack during the setup phase from sessions . Task manager creates a signal processing task having task parameters that specify the requirements . Task manager then queries resource mappings and resource statistics to identify and select a capable available re targetable resource to perform the signal processing task .

Task interface sends the signal processing task to the selected delegate resource and task manager directs proxy to forward via LAN interface the downstream unprocessed RTP stream associated with the communication session to the selected resource . LAN interface receives the processed RTP stream which data stream stack decapsulates if necessary and then task manager directs the resulting digital bitstream to switch for transmission to the legacy phone .

When IP phone is capable and available to perform a particular signal processing task task interface may receive the signal processing task from the central resource manager . In addition LAN interface of IP phone receives a RTP stream that transports communication session data associated with the signal processing task . If signaling stack receives or sends a voice call request YES branch of task manager terminates the signal processing task and task interface sends a message to the central resource manager indicating IP phone is not available for delegated signal processing for the duration of the voice call . So long as IP phone does not engage in a voice call however NO branch of task manager reads the signal processing task parameters from tasks and directs DSPs to apply signal processing routines stored by algorithms to the RTP stream in accordance with the task parameters . Task manager directs the processed stream as it is processed to the central resource manager . After creating a signal processing task for a communication session task manager queries resource mappings and resource statistics to identify and select a primary DSP re targetable resource to perform the signal processing task based on statistical usage patterns of the various re targetable resources in IP telephone system . As described with respect to resource statistics comprises resource availability descriptions for various resources in IP telephone system e.g. IP phones that includes for example a list of previous dates times in which the resource was unavailable to perform signal processing tasks as well as other information that might enable CRM of IP PBX to predict a future availability of the resource to perform signal processing tasks. Task manager analyzes resource statistics using statistical analysis to determine the re targetable resource that is currently available and is most likely to remain available for the communication session duration. Task manager selects this re targetable resource as the primary resource.

After selecting a primary resource task manager performs a similar process to select a backup re targetable DSP resource based on resource statistics in view of a statistical analysis . For example task manager may analyze resource availability descriptions for various resources in IP telephone system to determine the re targetable resource that is currently available and is next most likely to remain available for the communication session duration. Task manager selects this re targetable resource as the backup resource.

Task interface sends the signal processing task to both the primary and backup selected resources and task manager directs proxy to forward via LAN interface the unprocessed bitstream associated with the communication session to both the primary and backup selected resources .

To retain redundant processing for the signal processing task and the bitstream of the communication session task manager then queries resource mappings and resource statistics to identify and select a capable available re targetable resource to perform the signal processing task as a backup resource . Task interface sends the signal processing task to the new backup resource and task manager directs proxy to forward via LAN interface the unprocessed bitstream associated with the communication session to the new backup resource .

The techniques described in this disclosure may be implemented at least in part in hardware software firmware or any combination thereof on the device management system and the managed devices. For example various aspects of the described techniques may be implemented as encoded program code executed by one or more processors including one or more microprocessors digital signal processors DSPs application specific integrated circuits ASICs field programmable gate arrays FPGAs or any other equivalent integrated or discrete logic circuitry as well as any combinations of such components. The term processor or processing circuitry may generally refer to any of the foregoing logic circuitry alone or in combination with other logic circuitry or any other equivalent circuitry. A control unit comprising hardware may also perform one or more of the techniques of this disclosure.

Such hardware software and firmware may be implemented within the same device or within separate devices to support the various operations and functions described in this disclosure. In addition any of the described units modules or components may be implemented together or separately as discrete but interoperable logic devices. Depiction of different features as modules or units is intended to highlight different functional aspects and does not necessarily imply that such modules or units must be realized by separate hardware or software components. Rather functionality associated with one or more modules or units may be performed by separate hardware or software components or integrated within common or separate hardware or software components.

The techniques described in this disclosure may also be embodied or encoded in a computer readable medium such as a tangible computer readable storage medium containing instructions. Instructions embedded or encoded in a computer readable medium may cause a programmable processor or other processor to perform the method e.g. when the instructions are executed. Computer readable storage media may include random access memory RAM read only memory ROM programmable read only memory PROM erasable programmable read only memory EPROM electronically erasable programmable read only memory EEPROM flash memory a hard disk a CD ROM a floppy disk a cassette magnetic media optical media or other computer readable storage media. It should be understood that the term computer readable storage media refers to physical storage media and not signals or carrier waves although the term computer readable media may include transient media such as signals in addition to physical storage media.

Various embodiments of the invention have been described. These and other embodiments are within the scope of the following claims.

