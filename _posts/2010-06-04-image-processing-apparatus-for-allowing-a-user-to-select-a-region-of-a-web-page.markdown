---

title: Image processing apparatus for allowing a user to select a region of a web page
abstract: An image processing apparatus includes a determination unit configured to determine coordinate of a region in a web page having a plurality of elements in a structured document, the display region being specified by a user, an extraction unit configured to extract image data corresponding to the coordinate determined by the determination unit in the web page, an output unit configured to output an image based on the image data extracted by the extraction unit, wherein, when the region specified by the user is a part clipped out of an element in the web page, the extraction unit extracts image data of the part of the element corresponding to the coordinate determined by the determination unit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09317226&OS=09317226&RS=09317226
owner: Canon Kabushiki Kaisha
number: 09317226
owner_city: Tokyo
owner_country: JP
publication_date: 20100604
---
The present invention relates to an image processing apparatus that outputs an image based on a structured document.

Nowadays people can obtain various pieces of information when accessing web pages on the Internet. Each of the web pages is a structured document written in a structured language such as Hyper Text Markup Language HTML or Extensible Hyper Text Markup Language XHTML . The web page is displayed for viewing on a display in software called a browser for the structured document. Japanese Patent No. 03588337 discusses a method for selecting and printing a region of a web page as an image. When the method is used usually a web page is displayed in a browser on a display and a region in the displayed web page is selected by a user using a pointing device such as a mouse.

Conventionally however when a region of a web page displayed in a browser is selected in the browser the selection is made only on an element by element basis in the structured document. In other words a user cannot select a desired region such as a part of an image element or a part of a text element.

The present invention is directed to an image processing apparatus that allows a user to select a region of a web page as desired.

According to an aspect of the present invention an image processing apparatus includes a determination unit configured to determine coordinate of a region in a web page having a plurality of elements in a structured document the display region being specified by a user an extraction unit configured to extract image data corresponding to the coordinate determined by the determination unit in the web page an output unit configured to output an image based on the image data extracted by the extraction unit wherein when the region specified by the user is a part clipped out of an element in the web page the extraction unit extracts image data of the part of the element corresponding to the coordinate determined by the determination unit.

Further features and aspects of the present invention will become apparent from the following detailed description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the invention will be described in detail below with reference to the drawings.

A USB interface is configured to be connected to a USB cable for data communication between the PC and the printer . The communication may be established through SCSI or radio transmission for example other than USB cable.

A display device includes a cathode ray tube CRT or a liquid crystal display and a graphic controller for various displays on the PC that serves as an image processing apparatus. For example web pages downloaded from the WWW server print preview images and graphic user interfaces GUIs are displayed on the display device . An input device is used by a user for input of various instructions to the PC and may include a mouse and a keyboard. A system bus is used for transmission of data among the CPU the RAM the ROM and the hard disk .

A local area network LAN interface is connected to a LAN cable for data communication with the external WWW server via a router not illustrated and the Internet . The data communication may be wirelessly established using an interface for radio transmission.

In the PC is a laptop PC having the display device and the input device that are combined with a control unit including the CPU and the RAM . The present invention is however not limited to this type of PC and may be applied to a desktop PC having a display device and an input device that are separated from a control unit.

In a browser is an application for displaying web pages and displays each web page based on a structured document received from the WWW server . The browser downloads structured document files such as HTML files onto the hard disk of the PC and displays web pages on the display device based on the files. The web pages are structured document files written in HTML or XHTML and each structured document is composed of elements for texts and images the elements being written using tags. Each structured document further includes a file called Cascading Style Sheet hereinafter simply referred to as CSS that specifies a style for displaying each element. The browser analyzes these structured document files and displays them on the display device .

In the structured document printing module is plug in software which is invoked by the browser . The structured document printing module is executed when a user inputs an instruction for region selection to the browser . The structured document printing module executes an extraction of a part of a web page.

In the structured document printing module a region selection object insertion unit inserts at least one region selection object onto the web page displayed on the browser the region selection object being in the form of a rectangular region for region selection. To raise the region selection object to the forefront of the screen the region selection object insertion unit obtains a Z order of each element in a structured document the Z order indicating a display order of the element. Then the region selection object insertion unit sets the region selection object to have the obtained Z order that allows the region selection object to be displayed in a structured document in front of the element of the structured document that has been displayed at the forefront of the screen.

A region selection object change unit receives an instruction to change a selected region from a user. The instruction is made through the input device such as a mouse by a user. The term selected region means a region that is selected from a web page for printing. Upon receipt of the instruction the region selection object change unit changes the coordinates of the selected region which is specified by the region selection object inserted by the region selection object insertion unit in the web page. Accordingly a user can specify any region as a selected region in a web page by changing the position and size of the rectangular region in the web page through the input device such as a mouse.

A selected region data extraction unit is executed in the case where after selection of a region in a web page a user inputs an instruction to the browser for printing or print preview of the region. The selected region data extraction unit obtains coordinates of the selected region in the web page that is specified by the region selection object and set by the region selection object change unit . Then the selected region data extraction unit extracts an element in the structured document that is contained in the selected region represented by the region selection object and generates an intermediate data file that is used to extract a part of the element. The intermediate data file is image data that is generated by a normal browser based on a structured document for display. The selected region data extraction unit generates bit map data using the intermediate data file to display a web page. The image data that is used to extract a part of the element may be bit map data. In the case of the bit map data however when an image is enlarged the image has a lower resolution. Thus as the image data that is used to extract a part of the element text information and graphic information are desirably stored in a vector data format instead of bit map data. For example Enhanced Metafile Format EMF and Portable Document Format PDF can be used in the intermediate data file.

A print layout unit lays out the image data based on the intermediate data file extracted by the selected region data extraction unit according to a paper size that is described in print settings. The print settings include information such as paper size resolution and printable regions and are obtained from a printer driver via an operation system OS .

A print preview unit displays a print preview image on the display device based on the image data laid out by the print layout unit .

Upon receipt of an instruction to start printing from a user a print processing unit executes a image generating process on the printer driver via the OS according to the arrangement information of the elements laid out by the print layout unit .

The OS provides an application programming interface API for transmitting receiving print setting data between the structured document printing module and the printer driver and provides an API for image drawing. The OS includes various types of control software such as a spooler system that manages print jobs and a port monitor that outputs printer commands to a port which will not be described below in detail.

The printer driver generates print data according to the image drawing process executed by the print processing unit . The printer driver converts the generated print data into a printer command and transmits the printer command to the printer via the OS . Upon receipt of the printer command the printer prints out the data according to the received printer command.

With reference to an image displayed on the display device by the PC as an apparatus for image processing of a structured document according to the present exemplary embodiment. illustrates an example of a GUI screen. The browser displays a web page on the GUI. The browser contains a back button and an advance button for switching a web page to be displayed and an address input area . Furthermore a print button a print preview button and a region selection button for selection of a region in a web page are arranged in a window. When a user clicks the region selection button the browser invokes the structured document printing module . In the structured document printing module the region selection object insertion unit inserts a region selection object having initial coordinates into a structured document in the browser .

The region selection object includes the rectangular object for a selected region and objects to for changing a rectangular size that are disposed at the four corners and on the four sides of the rectangular object . The rectangular object has a semi transparent image drawing attribute so that a user can see the selected region in a web page based on a structured document through the rectangular object rectangular object .

A user can change the coordinates of a selected region represented by the region selection object as desired through an operation onto the rectangular object rectangular object with the input device such as dragging using a mouse.

When a user specifies and drags one of the objects to for changing a rectangular size on the screen as an instruction for a change in the rectangular size the region selection object change unit changes the size of the rectangular object in response to the instruction.

As illustrated in a print button is also provided for printing a region that is specified by the region selection object . Upon a click of the print button the selected region data extraction unit obtains the coordinates of the region selection object and the size of the rectangular object and extracts a structured document contained in the rectangular object as an intermediate data file. In a cancel button for canceling a region selection is also provided. When the cancel button is clicked the screen returns to the state illustrated in .

In the present exemplary embodiment a user changes coordinates and a size of the rectangular object by dragging. The operation is not limited to the dragging and any operation with which a user can specify a position on a screen can be used to change the coordinates and size. When a user specifies a position on a screen the positional information is input to the PC which is then controlled according to the information.

Even if the region specified by the rectangular object exceeds the region of a web page displayed on the screen by a dragging operation by a user the rectangular object is controlled to be displayed inside of the web page.

The structured document contains a tag to display the region selection object . In the tag in a position absolute attribute is used to specify the position of the region selection object in the absolute coordinates on a web page so that the region selection object can be displayed at any coordinates. The absolute coordinates which are different from the coordinates of a screen or the coordinates of a window of a browser are not affected even when the window is shifted enlarged or reduced. The tag in specifies the position of the region selection object at left 100 px and right 100 px with a width of 200 px and a height of 200 px wherein px represents the number of pixels.

A z index attribute in specifies a display order of the region selection object in the display and the z index 1000 is a description for the forefront display. Under the condition if the elements other than the region selection object in the structured document each have a z index of less than 1000 the region selection object is raised to the forefront of the screen. The tag for the region selection object has a unique ID in the structured document so that the ID can be used to obtain an object when the size of the region selection object is changed.

Not illustrated in but with respect to the region selection object a color and a background of the rectangular region and a filter attribute to make the rectangular region transparent are specified. Not illustrated in but with respect to the region selection object in addition to the tags for the rectangular region tags for the objects to for changing a rectangular size are written in the document which are not described here.

Even when the position or size of the rectangular object on the screen is changed the rectangular object corresponds to the absolute coordinates of a selected region in the web page and thereby there is no change in the region in the web page to be printed out.

In step the region selection button of the browser is clicked which activates the structured document printing module to start the process. In step the structured document printing module starts to capture a mouse event occurring within a region that is displayed based on a structured document in the displayed browser . A captured mouse event is processed in the region selection object change unit based on information input through a mouse connected to the PC . In step the region selection object insertion unit obtains a z index attribute value of each element in the structured document and specifies a z index attribute value of the object that is raised to the forefront of the screen.

In step the region selection object insertion unit sets initial coordinates an initial size and a z index attribute value for a forefront display of a selected region represented by the region selection object and inserts these descriptions in the element of the structured document. To raise the display of the region selection object to the forefront of the screen the region selection object is set to have a z index attribute value larger than the other elements obtained in step .

In step the structured document printing module waits for an instruction based on information from the mouse. When an instruction to select the cancel button is input through a mouse operation then in step the structured document printing module cancels the capture. Then in step the structured document printing module ends the region selection process. In step when an instruction to change the position and size of the region selection object is input the process proceeds to step . In step the structured document printing module changes the position and size of the region selection object in the structured document in response to the instruction input through a mouse operation. Then the process returns to step .

In step when an instruction to select the print button is input the structured document printing module executes printing operations in steps to and the process returns to step to wait for input of an instruction. In step the selected region data extraction unit obtains the coordinates of the selected region represented by the region selection object inserted in the structured document within the entire web page based on the structured document. In step the selected region data extraction unit extracts elements and clip information within the region that overlaps the region selection object at the coordinates obtained in step within the web page based on the structured document and generates an intermediate data file. The clip information indicates the position where a web page is partly clipped out when the region is extracted from the web page as described above. According to the clip information image data is generated by clipping out a region corresponding to the selected region from the image data that is generated based on the generated intermediate data file. The region selection object extracted in step has the initial size or a size that is changed in step as described above. After the operation in step the structured document printing module determines the region in the web page that corresponds to the region selection object at the coordinates obtained in step as a region to be printed. In step the print layout unit lays out the image data for printing based on the intermediate data file and according to the paper size indicated by print settings. Based on the image data laid out by the print layout unit the print processing unit performs a printing operation.

In step an intermediate data file only for a selected region may be generated. In this case the generated intermediate data file can be used as it is to obtain image data corresponding to a selected region.

In step the print preview unit may display a print preview on the display device based on the image data laid out by the print layout unit .

Through the operations described above the structured document printing module can select a region from a web page displayed by the browser in response to a mouse operation by a user and extracts and prints out the selected region. As a result a user can specify a desired region in a web page for printing. A selected region can be changed through a mouse operation and thereby any region can be selected even when the size of a web page is so large that a scroll of the screen is required to select the region.

In the above description a selected region is displayed by inserting an object for selecting a region in a structured document. This enables a package with a scripting language that is independent of a platform such as Java registered trademark Script and facilitates the execution of the process using software for scripting languages such as a web application. In the present exemplary embodiment a region of a web page based on a structured document is selected using plug in software from a browser but the selection may be made using single application software.

Another approach for a user to specify a region to be printed will be described. is a block diagram illustrating a software configuration in the PC . A program running on the PC and its data processing will be described with reference to .

The browser in is similar to that in which will not be described below in detail. In a structured document printing module is plug in software from the browser and is executed when a user inputs an instruction for a region selection to the browser .

In the structured document printing module a region selection window control unit displays a region selection window for selecting a region in a structured document at the forefront of the browser.

The region selection window control unit changes coordinates of a selected rectangular region in response to an input of an instruction to change a selected region through the input device such as a mouse from a user. Accordingly a user can specify any rectangular region in a displayed web page as a selected region using an input device such as a mouser.

When a user selects a region in a web page and inputs an instruction to the browser to start to print the region or to display a print preview of the region the selected region data extraction unit is executed. The selected region data extraction unit obtains coordinates of the rectangular region set by the region selection window control unit . The coordinates may be absolute coordinates in the entire web page or have an absolute size or have coordinates or a size in a region in the web page within a window of the browser . In the case of coordinates in a region of a web page in a window the coordinates and size of the region selected by a user in the web page of the browser can be obtained by referring to the coordinates. Then the coordinates and the size in the displayed web page are converted into those of the entire web page resulting in the coordinates and the size of the region selected by a user from the entire web page.

After obtaining the coordinates of the rectangular region the selected region data extraction unit extracts elements that correspond to the region defined by the obtained coordinates and size in the web page displayed by the browser from the elements in the structured document. The extracted elements are generated as an intermediate data file as described above.

The print layout unit the print preview unit the print processing unit the OS and the printer driver in each operate as those in which will not be described in detail.

As described above the data processing in displays a region selection window having transparent and semi transparent regions at the forefront of the browser to enable a selection of any region in a web page based on a structured document.

The coordinates and size of the rectangular region may be obtained at any point of time between the display of a region selection window by the region selection window control unit and the extraction of data by the selected region data extraction unit . For example the coordinates and size may be obtained when a window of a browser is shifted the size of the window is changed or the print button is clicked.

In the present exemplary embodiment a region selection window having transparent and semi transparent regions is provided separately from a browser to display a selected region. In this case the position and size of a region selection window are changed according to the shift and size of a window of a browser which requires monitoring of the browser information.

The browser in is similar to that in which will not be described below in detail. In a structured document printing module is plug in software from the browser and is executed when a user inputs an instruction for a region selection to the browser .

In the structured document printing module a region selection sub window control unit generates a region selection window that allows a user to select a region in a web page as a sub window of a browser. The sub window is arranged on a window of a browser at a fixed position relative to the browser.

As illustrated in a web page is generated in the region selection window based on a structured document obtained from the browser. The region selection window may be provided with a scroll bar if needed so that the entire region of the web page can be displayed by scrolling the scroll bar .

The region selection window is further provided with a rectangular selection region that is a semi transparent rectangle. The region selection sub window control unit inputs an instruction to change coordinates and a size of the semi transparent rectangle when a user operates the input device such as a mouse. In response to the input the coordinates and size of the rectangular selection region are changed to generate the rectangular selection region again. Accordingly a user can specify any rectangular region in a web page using a structured document through the input device such as a mouse as a selected region.

After a user selects a region in a web page as described above when the user inputs an instruction to start to print the region or to display a print preview of the region a selected region data extraction unit is executed. The selected region data extraction unit obtains coordinates of a rectangular selection region that is set by the region selection sub window control unit . Then the selected region data extraction unit extracts a region at the coordinates of the rectangular selection region from the displayed web page which is generated into an intermediate data file.

The print layout unit the print preview unit the print processing unit the OS and the printer driver in each operate as those in which will not be described in detail.

As described above the region selection window is provided as a sub window of a browser which allows a user to select any region in a web page. Particularly in the present exemplary embodiment no monitoring of browser information is required to accommodate the region to a shift or change in size of a browser.

In the present exemplary embodiment the focus is primarily put on the case where the data of a region a user selects from a web page is extracted and generated into an intermediate data file. The data of a region a user selects from a web page however may be extracted as bit map data. To extract such a region as bit map data bit map data stored in an image memory for display on a display device may be used. In this case however a user may accidentally select a region that is not within a web page from images to be displayed on the screen.

In contrast in the present exemplary embodiment image data is extracted based on absolute coordinates of a web page or coordinates of a web page displayed in a browser. This limits the region selected by a user for printing or print preview to the region where a web page is displayed.

In the present exemplary embodiment a region selection image which is used to specify a region in a web page for output by a user is overlapped on the web page based on a structured document. The overlapping however is not the only approach as long as a user specifies a region in a web page and the coordinates of the region in the web page can be obtained. For example in response to dragging by a user in a region where a web page is displayed coordinates of a region in a web page that is specified by the dragging may be obtained.

Furthermore in the present exemplary embodiment a region for printing and print preview is determined based on coordinates and size of the region in a web page. Thus even if the target region is not displayed when printing of the region is performed the output can be achieved according to the coordinates of the region in the web page. For example even when a region is scrolled out after the region is determined to be printed or displayed for print preview the image of the region can be output.

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU or MPU that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiment s and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiment s . For this purpose the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device e.g. computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims priority from Japanese Patent Application No. 2009 138399 filed Jun. 9 2009 which is hereby incorporated by reference herein in its entirety.

