---

title: Real time backup storage node assignment
abstract: A method of assigning a storage node from a storage grid to a server is presented. The storage grid includes multiple storage nodes capable of backing up a policy stored on the server. The method includes receiving an assignment request which requests assignment of one of the multiple storage nodes of the storage grid to the server to backup the policy stored on the server. The method also includes performing a storage node assignment operation in an automated manner in response to the assignment request, the storage node assignment operation providing an assignment result identifying a storage node assigned to backup the policy stored on the server, the assignment result being based on an assessment of storage space requirements of the policy and available storage space resources of the storage grid. The method further includes notifying the server of the assignment result to effectuate backing up of the policy stored on the server by the storage node.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08412899&OS=08412899&RS=08412899
owner: Autonomy, Inc.
number: 08412899
owner_city: San Francisco
owner_country: US
publication_date: 20100528
---
This patent application is a Utility application claiming the benefit of U.S. Provisional Application No. 61 320 051 filed on Apr. 1 2010 entitled REAL TIME BACKUP STORAGE NODE ASSIGNMENT the contents and teachings of which are hereby incorporated by reference in their entirety.

A policy refers to a collection of disk files. A policy may also specify among other things folders and or files residing on a server to be protected.

It is common practice to back up policies stored on servers to storage vaults. Typically such vaults are located remotely from the server storing the policy to be backed up. Further there are typically multiple vaults from which to choose for the backup.

A simple way to choose a storage node for backing up a policy is to randomly assign the node. For example a system administrator may have a list of storage vaults from which to choose and arbitrarily chooses a vault from the list.

The random assignment of storage vaults does not facilitate an optimal utilization of storage capacity. Presently vaults are limited to approximately 60 65 of its capacity to leave enough space for backup data growth and enough space to perform replication and rotation. It is desired to push this capacity as close as possible to 80 to maximize the usage of the existing vaults.

At the same time other considerations beside raw storage space need to be taken into account in order to control the load placed on the vaults. For example an optimal vault would be filled to approximately 80 capacity would have less than 200 000 versions stored on it would have less than 200 backup policies on it and less than 50 of the policies on the vault would have a continuous schedule i.e. every 15 minutes.

In contrast to the above described conventional random assignment of storage vaults a technique of assigning a storage node from a storage grid to a server is presented as an embodiment of a solution to the problem of using storage resources more efficiently. The storage grid includes multiple storage nodes capable of backing up a policy stored on the server. The technique involves receiving an assignment request which requests assignment of one of the multiple storage nodes of the storage grid to the server to backup the policy stored on the server. The technique further involves performing a storage node assignment operation in an automated manner in response to the assignment request the storage node assignment operation providing an assignment result identifying a storage node assigned to backup the policy stored on the server the assignment result being based on an assessment of storage space requirements of the policy and available storage space resources of the storage grid. The technique further involves notifying the server of the assignment result to effectuate backing up of the policy stored on the server by the storage node.

By making the provisioning process more intelligent existing vault space can be optimized for small to mid range backup policies and allow newer vaults to accept larger backup policies.

Performing the storage node assignment operation in the automated manner in response to the assignment request can include performing a comparison of the storage space requirements of the policy with available storage space resources of a particular storage node to generate the assessment of storage space requirements of the policy and available storage space resources of the storage grid.

The storage space requirements of the policy can include a current amount of storage space currently occupied by the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i multiplying the current amount of storage space currently occupied by the policy on the server by a growth rate factor to generate a future amount of storage space projected to be occupied by the policy on the server at a future point in time and ii comparing the future amount of storage space projected to be occupied by the policy on the server to the current amount of free storage space currently available on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can include a total amount of storage space currently available to the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node and a current amount of allocated storage space on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i subtracting the current amount of allocated storage space on the particular storage node from the current amount of free storage space currently available on the particular storage node to provide an amount of non allocated storage space on the particular storage node and ii comparing the total amount of storage space currently available to the policy on the server with the amount of non allocated storage space on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can further include a backup frequency. In this case the available storage space resources of the particular storage node would further include a current number of versions associated with the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would further include i increasing the current number of versions by a particular number of versions based on the backup frequency to provide a potential number of versions and ii comparing the potential number of versions to a predefined maximum number of versions permitted for the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can further include a backup type setting the backup type setting identifying one of a continuous backup type in which a policy backup operation is to be performed every 15 minutes and a scheduled backup type in which a policy backup operation is to be performed at user specified intervals. In this case the available storage space resources of the particular storage node would further include a current number of continuous backup type policies assigned to the storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would further include only when the backup type setting identifies the continuous backup type i incrementing the current number of continuous backup type policies currently assigned to the particular storage node to provide a potential number continuous backup type policies assigned to the particular storage node and ii comparing the potential number of continuous backup type policies assigned to the storage node to a predefined maximum number of continuous backup type policies permitted for the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can further include a load balance setting the load balance setting identifying whether multiple policies on the server are permitted to be backed up to a same storage node. In this case comparing the storage space requirements of the policy with available storage space resources of the particular storage node would further include when the load balance setting identifies that multiple policies on the server are not permitted to be backed up to the same storage node detecting whether the particular storage node is already assigned to backup another policy stored on the server to determine whether to assign the particular storage node to backup the policy stored on the server.

In the context of a method embodiment the method can further include prior to comparing the storage space requirements of the policy with the available storage space resources of the particular storage node setting the growth rate factor to be a value which increases the current amount of storage space currently occupied by the policy on the server by a predefined percentage to provide the future amount of storage space projected to be occupied by the policy on the server at the future point in time.

The method can further include after assigning the particular storage node to backup the policy stored on the server adjusting the available storage space resources of the particular storage node to account for assignment of the particular storage node to backup the policy stored on the server.

The method can further include prior to receiving the assignment request establishing a storage grid database which stores storage node entries each storage node entry i corresponding to a storage node of the storage grid ii identifying currently available storage space resources for that storage node and iii imposing assignment restrictions for that storage node. In this case the method would further include dynamically updating the storage node entries of the storage grid database to account for new storage node assignments.

A further embodiment to the stated problem is an electronic apparatus to assign a storage node from a storage grid to a server. The storage grid includes multiple storage nodes capable of backing up a policy stored on the server. The electronic apparatus includes a network interface. The electronic apparatus also includes a control circuit coupled to the network interface. The control circuit is constructed and arranged to receive through the network interface an assignment request which requests assignment of one of the multiple storage nodes of the storage grid to the server to backup the policy stored on the server. The control circuit is also constructed and arranged to perform a storage node assignment operation in an automated manner in response to the assignment request the storage node assignment operation providing an assignment result identifying a storage node assigned to backup the policy stored on the server the assignment result being based on an assessment of storage space requirements of the policy and available storage space resources of the storage grid. The control circuit is further constructed and arranged to notify the server through the network interface of the assignment result to effectuate backing up of the policy stored on the server by the storage node.

The control circuit when performing the storage node assignment operation in the automated manner in response to the assignment request can be constructed and arranged to perform a comparison of the storage space requirements of the policy with available storage space resources of a particular storage node to generate the assessment of storage space requirements of the policy and available storage space resources of the storage grid.

The storage space requirements of the policy can include a total amount of storage space currently available to the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node and a current amount of allocated storage space on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i subtracting the current amount of allocated storage space on the particular storage node from the current amount of free storage space currently available on the particular storage node to provide an amount of non allocated storage space on the particular storage node and ii comparing the total amount of storage space currently available to the policy on the server with the amount of non allocated storage space on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can include a current amount of storage space currently occupied by the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i multiplying the current amount of storage space currently occupied by the policy on the server by a growth rate factor to generate a future amount of storage space projected to be occupied by the policy on the server at a future point in time and ii comparing the future amount of storage space projected to be occupied by the policy on the server to the current amount of free storage space currently available on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The control circuit can be constructed and arranged to after assigning the particular storage node to backup the policy stored on the server adjust the available storage space resources of the particular storage node to account for assignment of the particular storage node to backup the policy stored on the server.

A further embodiment to the stated problem is computer program product which includes code which when executed by a computer causes the computer to assign a storage node from a storage grid to a server. The storage grid includes multiple storage nodes capable of backing up a policy stored on the server. The code includes instructions to receive through the network interface an assignment request which requests assignment of one of the multiple storage nodes of the storage grid to the server to backup the policy stored on the server. The code also includes instructions to perform a storage node assignment operation in an automated manner in response to the assignment request the storage node assignment operation providing an assignment result identifying a storage node assigned to backup the policy stored on the server the assignment result being based on an assessment of storage space requirements of the policy and available storage space resources of the storage grid. The code further includes instructions to notify the server through the network interface of the assignment result to effectuate backing up of the policy stored on the server by the storage node.

The instructions to perform the storage node assignment operation in the automated manner in response to the assignment request can include instructions to perform a comparison of the storage space requirements of the policy with available storage space resources of a particular storage node to generate the assessment of storage space requirements of the policy and available storage space resources of the storage grid.

The storage space requirements of the policy can include a total amount of storage space currently available to the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node and a current amount of allocated storage space on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i subtracting the current amount of allocated storage space on the particular storage node from the current amount of free storage space currently available on the particular storage node to provide an amount of non allocated storage space on the particular storage node and ii comparing the total amount of storage space currently available to the policy on the server with the amount of non allocated storage space on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The storage space requirements of the policy can include a current amount of storage space currently occupied by the policy on the server. In this case the available storage space resources of the particular storage node would include a current amount of free storage space currently available on the particular storage node. Also comparing the storage space requirements of the policy with available storage space resources of the particular storage node would include i multiplying the current amount of storage space currently occupied by the policy on the server by a growth rate factor to generate a future amount of storage space projected to be occupied by the policy on the server at a future point in time and ii comparing the future amount of storage space projected to be occupied by the policy on the server to the current amount of free storage space currently available on the particular storage node to determine whether to assign the particular storage node to backup the policy stored on the server.

The code can further include instructions to adjust the available storage space resources of the particular storage node to account for assignment of the particular storage node to backup the policy stored on the server after the particular storage node is assigned to backup the policy stored on the server.

An improved technique smartly assigns for backing up a policy e.g. a collection of files of a server i.e. agent a storage node to the agent based on information from the agent and information from a storage grid of available storage nodes. Such a technique preferably uses real time information and enables greater flexibility in distributing storage load across the storage grid as well as better bandwidth utilization during backups and or restores.

The communications medium conveys electronic communications between the various components of the electronic environment . The communications medium is illustrated as a cloud because it is capable of having a variety of topologies including hub and spoke backbone loop irregular a combination of the Internet and LAN s combinations thereof and so on.

Storage nodes or vaults are storage platforms which include a front end computer and a disk array e.g. an array of magnetic disk drives . Individual storage nodes are labeled where i is an index representing a particular storage node. Storage nodes form a storage grid . At least some storage nodes can be chained together within storage grid to provide storage redundancy e.g. data mirroring.

Agents have data in the form of one or more policies. A policy specifies among other things folders and or files to be protected a time interval for protecting new changes and a duration for which the data should be protected. Thus for each policy there are typically multiple versions where the number of versions associated with a policy is determined by the time interval and duration. Also each policy may further specify that different versions be coalesced into a single version at either a specified time interval or according to another criterion. A similar technique is described for example in U.S. Ser. No. 12 711 413 entitled DATA RESTORATION UTILIZING FORWARD AND BACKWARD DELTAS the teachings of which are hereby incorporated by reference in their entirety.

The provider apparatus is a specialized device which is constructed and arranged to perform the task of assigning a particular storage node of the storage grid to an agent e.g. the agent when the agent requests a storage location to backup a policy. As shown in the provider apparatus includes an electronic interface and an electronic controller . In some arrangements the electronic controller includes a microprocessor and memory which are configured to receive a specialized application from a computer program product through electronic interface . When the electronic controller executes the specialized application the provider apparatus is equipped to robustly and reliably assign storage nodes to the agents for policy backups.

Database system is a device configured to store information related to the storage nodes . As illustrated in database system maintained by provider apparatus stores a database . Database is constructed and arranged to store storage node entries e.g. storage node entries and which correspond to for example storage nodes and respectively. Each storage node entry contains a collection of storage node information characterizing an ability of each storage node to accept a policy from an agent.

A collection of storage information that is found in for example database is illustrated in . The collection of storage node information for each storage node of the storage grid includes a how many backup policies currently exist on that storage node b a percentage of continuous backup policies vs. scheduled policies residing on that storage node c how many versions exist on that storage node d whether there is another policy being moved to that storage node e how much total storage capacity exists on that storage node f how much available storage capacity exists on that storage node g whether that storage node forms part of a storage chain which mirrors data with another storage node and if so whether the storage chain is disabled and h whether new backup policies have already been assigned to that storage node but that are not currently present on that storage node and if so what the anticipated storage requirements are for those new backup policies. It should be understood that a continuous backup policy is one that is automatically backed up every say 15 minutes. In contrast a scheduled backup policy is one that is backed up at specific times during the week i.e. the users specifies when and how often . The collection of storage node information may include other data as well.

During operation the provider apparatus assigns a storage node e.g. the node from the storage grid to an agent . Along these lines the controller receives an assignment request from the agent through the electronic interface . Additionally the controller obtains from the agent an available amount indicating a total available storage space amount on the agent a used amount indicating an amount of storage space consumed by the policy stored on the agent and a policy type indicating a particular type of the policy among multiple types. In some arrangements the assignment request includes this information. In other arrangements the controller queries the agent for this information in response to the assignment request. The controller may acquire other data from the agent as well as and is preferably updated in real time.

It should be understood that different policy types may impose different storage requirements. For example if a policy is a standard type the provider apparatus considers the policy to include traditional files and folders and thus places significance on the agent s storage capacity.

However if a policy is a DPM type the provider apparatus considers the policy to include a Microsoft Data Protection Manager DPM replica. For such a type data storage is raw disk space and is not reported as part of the agent s storage capacity. In some arrangements the provider apparatus imposes a default amount of required storage space e.g. 1 TB for a DPM backup policy. In other arrangements if an actual amount of storage space is available the required storage space is based upon the actual amount.

It should be understood that the information within the database is updated routinely. In some arrangements the controller of the provider apparatus or database itself polls the storage nodes for current operating status data and updates the storage node information within the database e.g. periodically after changes occur within the nodes etc. . In other arrangements the storage nodes are configured to directly update the storage node information within the database e.g. periodically after changes occur within the nodes etc. . In yet other arrangements the agents or one or more other external devices update the storage node information within the database .

Next in response to the assignment request the controller selects a particular storage node from the multiple storage nodes of the storage grid based on an assessment that takes into account the following an available amount of storage space of the particular storage node in the storage grid an amount of space on agent used by the policy the policy type and the collection of storage node information corresponding to the particular storage node.

For example controller examines the number of versions that exist on the particular storage node . This information is available on for instance database as illustrated in . Controller then compares this number of versions for the particular storage node to say a predefined maximum number of versions permitted to be stored on the particular storage node .

In a further example controller examines the number of continuous backup policies available for example on database as illustrated in currently stored on the particular storage node and increments the current number of continuous policies to get a potential number of continuous policies to be allocated onto the particular storage node . The potential number of continuous policies to be allocated is compared with a predefined maximum number of continuous backup policies permitted for the particular storage node .

In a further example controller examines whether multiple policies on agent are permitted to be backed up by the particular storage node . In this regard a load balancing setting is included in the storage space requirements of the policy. That is when the load balance setting identifies that multiple policies on agent are not permitted to be backed up to the same storage node controller detects whether the particular storage node is already assigned to backup another policy stored on agent to determine whether to assign the particular storage node to backup the policy stored on agent .

In a still further example controller performs a comparison of the amount of space used by the policy with the available amount of storage space on the particular storage node . Because of the dynamic nature of the storage space on agent used by a policy controller preferably makes a projected estimate of storage space requirements for the policy over a period of time in determining whether to allocate space on a particular storage node . For example controller may multiply a current amount of storage occupied by the policy on agent by a growth rate factor to generate the projected estimate. The growth rate factor is typically a value which increases the current amount of storage space occupied by the policy on agent by a predefined percentage e.g. 15 50 75 100 .

Controller would then compare such a projected estimate with the available amount of storage space on the particular storage node . For example controller computes the following quantity AdjustedAvailableVaultSpace AvailableVaultDisk TotalVaultDisk Critical Percentage RentedSpace where AvailableVaultDisk is the amount of disk space available on the particular storage node for storage of the policy TotalVaultDisk is the amount of physical space on the particular storage node Critical Percentage is the percentage of the TotalVaultDisk that is not available to store backup data from any policies and RentedSpace is the amount of space currently allocated for storage of other policies that have not yet completed a successful backup to the storage device. Controller would compare the quantity AdjustedAvailableVaultSpace with a projected amount of space to be required by the policy on agent .

In some arrangements the controller applies a set of algorithms or rules to make the selection. The table illustrated in shows a particular scheme for assessing whether to assign a particular storage node to a policy stored on agent for backup. In the scheme the collection of storage node information that is analyzed by controller is quantified according to the table in . A best fit value is assigned to a particular state representing a violation of a condition such as exceeding the maximum number of policies. In some arrangements a storage node having a best fit value exceeding a predefined value e.g. 0 3F is considered unavailable for assignment.

The controller then allocates the particular storage node to the agent to backup the policy stored on the agent . Once the allocation is made controller notifies agent of the assignment so that a backup of the policy from agent to storage node may proceed. Storage space resources for the particular node can then be adjusted to account for the new assignment. In some implementations database is also updated to account for the new assignment.

A method of assigning a storage node from a storage grid to an agent is illustrated in . A storage grid is defined by a set of storage nodes. A request to assign a backup of a policy to a storage node within the storage grid is received by for example an electronic controller. An operation of assigning the backup of the policy to a storage node is performed by say the controller. Once the operation has been performed and the assignment has been made the agent is notified of the assignment. Data may then be backed up from the agent to the storage node chosen for the backup.

The storage grid is defined to include storage nodes that may for example form a storage chain. A set of storage nodes can be chained together to provide redundancy or data mirroring. The storage nodes in the storage grid are connected to say an electronic controller and an agent containing a policy to be back up through a communications medium.

The controller receives a request from an agent to assign a backup of a policy to a storage node within the storage grid. The request is received over the communications medium the communications medium connecting the controller with the agent.

Once the request is received the controller then performs the assignment of the backup of the policy to one of the storage nodes within the storage grid. The assignment is based upon an assessment of various state values within both the agent and a particular storage node. The assessment considers both storage space requirements of the policy stored on the agent and available storage space resources of the particular storage node. Details concerning the storage space requirements of the policy and available space on a particular storage node are described above.

Once the storage node has been assigned the controller then notifies the agent of the assignment. The notification takes place through the electronic communications medium connecting the agent and the storage nodes within the storage grid to the controller.

Once the agent has been notified of the assignment the backing up of the policy on the agent to the assigned storage node commences.

Such smart assignment of a storage node to an agent enables efficient utilization of the storage nodes e.g. when performing backup operations for multiple agents and policies . Additionally such assignment simplifies the management of the storage grid and is able to occur automatically and in a consistent manner with little or no manual involvement.

While various embodiments of the invention have been particularly shown and described it will be understood by those skilled in the art that various changes in form and details may be made therein without departing from the spirit and scope of the invention as defined by the appended claims.

For example it should be understood that the provider apparatus may reside on a dedicated device. Alternatively the provider apparatus may form part of a server a storage node or another apparatus which performs other operations.

Additionally it should be understood that each storage node is capable of backing up multiple policies stored on multiple agents . Similarly each agent is capable of storing multiple policies which are backed up on one or more storage nodes .

Furthermore it should be understood that some embodiments are directed to an electronic backup environment which utilizes intelligent backup storage node assignments. Some embodiments are directed to a storage provider infrastructure e.g. a provider apparatus in combination with a storage grid which performs intelligent backup storage node assignments. Some embodiments are directed to an apparatus or device which performs intelligent backup storage node assignments. Some embodiments are directed to a process of performing intelligent backup storage node assignments. Also some embodiments are directed to a computer program product which enables computer logic to perform intelligent backup storage node assignments.

In some arrangements provider apparatus is implemented by a set of processors or other types of control processing circuitry running software. In such arrangements the software instructions can be delivered to electronic controller in the form of a computer program product illustrated generally by a diskette icon in having a computer readable storage medium which stores the instructions in a non volatile manner. Examples of suitable computer readable storage media include tangible articles of manufacture and apparatus such as CD ROM flash memory disk memory tape memory and the like.

