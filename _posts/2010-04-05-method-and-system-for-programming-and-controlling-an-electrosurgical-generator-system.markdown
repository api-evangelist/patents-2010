---

title: Method and system for programming and controlling an electrosurgical generator system
abstract: A method and system are disclosed enabling configuration of a control system for an electrosurgical generator system for creating new surgical applications without changing the underlying software system. The electrosurgical generator system includes an RF stage to output at least one waveform of electrosurgical energy; a sensor module having at least one sensor to sense electrical or physical properties related to the output electrosurgical energy and generate sensor data; and at least one control module executable on at least one processor that controls at least one parameter of the output electrosurgical energy. The at least one control module includes an outer loop controller to generate a control signal in accordance with at least a first subset of the sensor data and an inner loop controller to generate a setpoint control signal and provide the setpoint control signal to the RF stage for controlling at least an amplitude of the energy output by the RF stage.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08303580&OS=08303580&RS=08303580
owner: Covidien AG
number: 08303580
owner_city: 
owner_country: CH
publication_date: 20100405
---
This application is a continuation of application ser. No. 10 554 837 filed Dec. 19 2006 which issued as U.S. Pat. No. 7 722 601 which is a national stage filing based upon international application Ser. No. PCT US04 13443 filed Apr. 30 2004 which claims priority to an application entitled METHOD AND SYSTEM FOR PROGRAMMING AND CONTROLLING AN ELECTROSURGICAL GENERATOR SYSTEM filed in the United States Patent and Trademark Office on May 1 2003 and assigned Ser. No. 60 466 954 the contents of which are hereby incorporated by reference.

The present disclosure is directed to electrosurgery and in particular to a method and system for programming and controlling an electrosurgical generator system.

Electrosurgery entails the use of electrosurgical energy to cut or coagulate tissue or perform some other type of surgical procedure. An electrosurgical generator system is used for generating the electrosurgical energy and delivering the same to an electrode connected to the generator. The electrode is then brought into contact with tissue and depending on the frequency and other parameters of the electrosurgical energy the tissue is either cut coagulated sealed etc.

In order to achieve desired surgical results when operating the electrosurgical generator system in one of several control modes e.g. cut coagulate and blend the electrosurgical generator system needs to be programmed to generate electrosurgical energy having output parameters with predetermined values. These desired output parameters typically include the frequency power amplitude duty cycle and waveform type of the electrosurgical energy as well as the output current and output voltage of the electrosurgical generator system.

It is evident that by programming the electrosurgical generator system one can control various parameters including other factors such as the maximum allowable temperature of the tissue during electrosurgery rate of change of impedance etc. prior to initiating the electrosurgical procedure.

Accordingly the present disclosure provides a method and system capable of enabling an individual to quickly create new electrosurgical applications without major re programming of the software system of an electrosurgical generator system.

A method and system are disclosed capable of enabling an individual to quickly create new electrosurgical applications without major re programming of the software system of an electrosurgical generator system. In one embodiment an electrosurgical generator system includes an RF stage to output at least one waveform of electrosurgical energy a sensor module having at least one sensor to sense electrical or physical properties related to the output electrosurgical energy and generate sensor data and at least one control module executable on at least one processor that controls at least one parameter of the output electrosurgical energy. The at least one control module includes an outer loop controller to generate a control signal in accordance with at least a first subset of the sensor data and an inner loop controller to generate a setpoint control signal and provide the setpoint control signal to the RF stage for controlling at least an amplitude of the energy output by the RF stage.

A control loop system is chiefly responsible for the operation of the electrosurgical generator system and it is composed of three basic components an inner loop system which is responsible for changing and sculpting basic RF output an outer loop system which is responsible for setting the output target of the inner loop based on a variety of algorithms such as the control of temperature and a configuration control system which is responsible for reprogramming the inner and outer loop systems on the fly or in virtual real time for the inner and outer loop systems to change operation.

All user programming is preferably accomplished using at least one input device such as a keyboard touch screen display etc. while the software programming may be based on a file based programming language to input programming commands to the electrosurgical generator system. The combination of the two inputted programming commands are stored into command files and define all aspects and parameters of the electrosurgical generator system.

The simple input and storage of the programming commands according to the present disclosure allows for easy creation and modification of new electrosurgical generator modes. For example a mode can be created by inputting programming commands and storing the same in a command file subsequent modes can easily be created by modifying associated parameters and storing them as a new command file.

Further features of the above embodiments will become more readily apparent to those skilled in the art from the following detailed description when taken in conjunction with the drawings.

Reference should be made to the drawings where like reference numerals refer to similar elements. Referring to there is shown a block diagram of an embodiment of a control loop system for an electrosurgical generator system in accordance with the present disclosure. The control loop system is designated generally by reference numeral and it is designed to enable a software developer to efficiently program and control the operation of the electrosurgical generator system . The electrosurgical generator system is particularly designed for the easy creation of multiple different electrosurgical systems. The method and system of the present disclosure enables an individual to efficiently create new application modes by creating configuration or command files for downloading or programming these new modes into the electrosurgical generator system for creating new surgical applications without changing the underlying software system.

The control loop system is chiefly responsible for the operation of the electrosurgical generator system and it is composed of three basic components an inner loop system which is responsible for changing and sculpting basic RF output e.g. current power or voltage output duty cycle frequency and inner loop control system dynamics of an RF output stage based on user and or sensor inputs from various sensors and or user input devices not shown an outer loop system which is responsible for controlling the inner loop setpoint based on a variety of algorithms e.g. temperature control impedance control pulse control vessel sealing etc. based on user and or sensor inputs from the various sensors and time and or user input devices not shown and a configuration control system which is responsible for changing the programming of the inner and outer loop systems on the fly or in virtual real time based on user or sensor inputs received from various sensors and or user input devices not shown .

With reference to the electrosurgical generator system is also able to maintain the output constant. shows the output current being maintained at a constant level over a load impedance range. shows the output power being maintained at a constant level over a load impedance range. shows the output voltage being maintained at a constant level over a load impedance range.

As shown by the inner loop system is controlled by an inner loop controller the outer loop system is controlled by an outer loop controller and the configuration control system is controlled by a configuration controller . The controllers perform their various functions by the execution of a set of programmable instructions by at least one microprocessor and or at least one digital signal processor DSP e.g. DSPs respectively.

The configuration controller performs its various functions by the execution of a set of programmable instructions executed by at least one microprocessor and or a DSP e.g. DSP . The controllers are configured for receiving inputted programming commands for operating the electrosurgical generator system .

All programming is preferably accomplished using at least one input device such as a keyboard touch screen display remote computer system etc. to input the programming commands to the electrosurgical generator system . The inputted programming commands are stored into command files within at least one memory module such as a RAM module and define all aspects and parameters of the electrosurgical generator system .

The simple input or download and storage of the programming commands according to the present disclosure allows for easy creation and modification of new electrosurgical generator modes. For example one mode can be created by inputting programming commands and storing the same in a command file. A new mode can be created based on the original programming.

A description will now be presented with reference to programming the at least one microprocessor by way of a programming language in a preferred embodiment for controlling and programming the electrosurgical generator system of the present disclosure.

The set of programmable instructions for operating the electrosurgical generator system in accordance with the present disclosure has been designed to enable two analog inputs to the configuration controller to control the mode outer and inner loop programming and the desired output current I power P voltage V etc. depending on the control mode selected of the electrosurgical generator system 

In an exemplary embodiment of the present disclosure the method of mode control is accomplished by making a data structure e.g. Local Cfg an array When a mode switch is desired a host variable e.g. Config Index is adjusted and then copied to a processing file e.g. Out Local IO.Config Index where it switches an active command file e.g. Local Cfg Local IO.Config Index .

The method of desired output programming is accomplished by adjusting a host variable e.g. OutLocal IO.Desired Amplitude Multiplier where Desired Amplitude Multiplier represents a multiplier value for adjusting the output curves of the outer loop system when enabled or is passed directly to the inner loop system as a current power voltage level if the outer loop system is disabled.

The configuration selection is programmed by filling the variable e.g. Local Cfg with the data from the sets of command files. The configuration index is first specified then the data is read from the command files then the next index is specified etc.

The programming of the configuration control system is controlled by a Meta command file. This command file loads the Local Cfg array with each configuration and specifies how the configuration and Desired Amplitude Multiplier is controlled.

 INCLUDE FILE xxx where xxx is a valid path and filename of outer and inner loop command files which define the configuration to be loaded in the memory module.

Mode selection can be programmed to be selected by one of three inputs a user input device e.g. a keyboard AD7 or AD8 where AD7 and AD8 are sensor modules. Mode modification can be programmed to be controlled by one of three inputs a user input device e.g. a keyboard AD7 or AD8. The operation of the mode selection and mode modification control is that one control input can be set to select the mode then another control can make the fine adjustments to that selection. The mode modification may be done in an additive fashion as shown in the example below Actual Mode Mode 7 Modifier 8 . I.b.1. Command File Programming

A Mode Modification Algorithm which controls how the active mode switching is set by a modifier also may be selected.

Amplitude multiplication selection can be selected by one of three inputs a user input device e.g. a keyboard AD7 or AD8. Amplitude multiplication modification can be controlled by one of three inputs keyboard AD7 or AD8. The operation of the selection and modification control is that one control input can be set to select the amplitude multiplication then another control can make fine adjustments to that selection. The amplitude multiplication modification may be done in an additive fashion as shown in the example below Actual Amp Amp 7 Modifier 8 .

It is noted that amplitude multiplication is used both for outer loop programming and if the outer loop system is off for the desired output of the inner loop system . When the outer loop system is on a normalized curve is designed which specifies the desired output over time and an amplitude multiplier controls the amplitude of this curve. A time multiplier controls the time scale at which this curve is interpreted.

The control loop system can be programmed to activate RF output based on either AD7 or AD8 inputs. A user input device such as footswitch of the electrosurgical generator system can also be used to activate RF output. The threshold of activation can be programmed.

It is noted that in a preferred embodiment footswitch activation of the electrosurgical generator system is always active even if inputs AD7 or AD8 are selected.

The programming of sensor input controls is accomplished through the creation of a map which specifies the amplitude multiplier and configuration index and maps these values to an input voltage.

The Mode Control and Amplitude Multiplier Control Maps for each Control Voltage AD7 AD8 need to be specified.

The outer loop system is responsible for controlling the setpoint e.g. DSP Shared Data.RF Desired Output for the inner loop system . The concept of temperature control will be used to describe how this is accomplished however other control methods may be used such as but not limited to rate of change of temperature control impedance control and rate of change of impedance control. In temperature control mode the outer loop system is programmed to follow a specific temperature vs. time curve. The outer loop system uses the temperature versus time curve to retrieve its target temperature after lapse of a specified time e.g. after a procedure has started. If the temperature is low then the outer loop system raises the inner loop setpoint. If the temperature is high then the outer loop system lowers the inner loop setpoint. The inner loop system then attempts to deliver RF as specified by the inner loop setpoint and thus raise or lower the temperature.

The user is given control of the amplitude multiplier and or the time multiplier which adjust the temperature versus time curves. The curves are specified as normalized values from 0.0 to 1.0. Thus the temperature curve can be increased by increasing the amplitude multiplier Target Temperature Temperature Curve Time Amplitude Multiplier 

The time scale in which the curve is executed may also be adjusted by modifying the time multiplier in a similar fashion to the target temperature thus Time Time Curve Time Multiplier 

The outer loop system operates in selectable modes for controlling temperature rate of change of impedance and work in Joules . The source code enables the addition of other modes if desired.

The outer loop system can also be turned off. In this case the amplitude multiplier is passed directly to the inner loop system as the setpoint and the time multiplier is not used.

Sitting on top of all the outer loop modes and algorithms is a pulsing control system. This pulsing control system allows the user to specify pulsing waveform pattern parameters such as the number of pulses in a burst of pulses the duty cycle e.g. ratio of on time to off time delay time e.g. time between bursts of pulses frequency e.g. 1 time between rising edges of on time and on off amplitude envelope e.g. amplitude pattern of a burst of pulses for pulses to be delivered.

Outer loop Proportional Integral Derivative PID parameters control the dynamic behavior of the outer loop system . Preferably the control system is a PID system.

Outer loop control output limit parameters including minimum and maximum inner loop target values are used to limit the range that the outer loop system can change the inner loop setpoint. The outer loop control output limit parameters are sent from the outer loop system to the inner loop system . The data is either in watts amps or volts depending on the inner loop programming e.g. using curves selected from I P V curves .

An outer loop start point is the starting inner loop target. This gives the outer loop system a point at which to start prior to starting active control.

Outer loop curve types specify which outer loop algorithm is to be executed. The software system may support numerous different algorithms. A few exemplary valid types are shown below 

An outer loop amplitude curve specifies the target amplitude part of the target versus time curve that the outer loop system uses to determine its target.

Outer loop time curve parameters specify the shape of the time curve where each location in the OUTER LOOP CURVE AMP corresponds to the values in the time curve. The time multiplier thus allows the user to expand or contract the time at which the AMP curve generates the targets to the outer loop.

Outer Loop Misc Parms is an array of parameters which may be passed to the outer loop system to make modifications in the algorithm providing a method for making subtle adjustments to an algorithm for different tissue types or handsets.

A miscellaneous outer loop algorithm parameter table is for sub variations within a specific algorithm structured as a two dimensional array Outer Loop Misc Parm y x .

The inner loop system is responsible for the low level control of the RF delivery. The inner loop system has programming controls for the control variable selection e.g. current power or voltage control control curve definition e.g. power curve shape waveform definition RF Frequency selection calibration sensor variable gain dynamics e.g. automatic gain control dynamics for the V I sensors and control dynamics e.g. PID variables for the control system .

The inner loop system can be programmed for two basic modes of operation open loop and closed loop. In open loop mode the RF output is set to the fixed value of the high voltage power supply and is not adjusted by software The calibration of output RF power is controlled by Econ Gain and Offset parameters and the power curve is defined by the RF stage characteristics. In closed loop mode the software reads the sensor board values of V VI phase shift and I and calculates Vrms Irms Pavg which may be determined in accordance with the VI phase shift Zrms crest factor cable impedances Vpeak and or Ipeak and controls the RF output to match the desired control curve.

Inner loop commands are typically specified in an Inner Loop command file so that the commands are separate from the Outer Loop and Meta commands files. This configuration allows easier sharing of command file programming.

The system may have various RF frequency selections available such as 250 500 750 1000 1250 1500 1750 2000 Khz.

The inner loop control dynamics are controlled by two sets of parameters the PID parameters and the I P V gain adjusts. The PID parameters are adjusted to give the appropriate dynamic response assuming a system gain of 1. The I P and or V gain adjusts are used to modify the PID parameters based on the actual gains of the system in the respective control area e.g. current power and voltage which changes based on load impedance frequency and waveform duty cycle.

Control system target gain compensation controls the change in loop gain based on which target the control system is aiming at e.g. current power voltage . The PM GAIN ADJ is multiplied by the PID values to change the loop gain e.g. P CNTL SYS P I PID GAIN ADJ.

Crest factor is defined as Crest Factor Pk Rms. Crest factor specifies the ratio of the signal PK to RMS value thus giving an indication of maximum amplitude to be expected from the waveform.

Since the system reads the actual V I waveforms the software needs to know how to set the sealing for sensors on a sensor board for the specified waveform. Crest factor allows the software to calculate the maximum expected amplitude of the waveform so that it can calculate the PID settings for the sensor board.

The crest factor should be measured at about ohms which is typically the highest e.g. corresponds to the least ringing .

A control mode definition specifies which basic mode the control system operates in open or closed loop.

Control system maximum parameters control the maximum outputs allowed for the generator in the given mode. This protects the generator as the control system does not allow the current power and or voltage to go beyond these limits no matter what other settings are programmed to be set to. Current is in RMS Amps power in watts and voltage is in RMS volts.

An RF output control curve can be programmed to one of at least three modes of operation constant current constant power and constant voltage.

The modes of operation specify the target that the control system tries to control. All of these modes use two maps e.g. the curve map and the impedance map and the Zlow and

Zhigh parameters to define the operation. Viewed together these two maps define the basic shape of the control curve at the specified impedance points. Preferably the curve map is normalized from 0 to 1.0 and the impedance map is in ohms.

A curve defined by the exemplary map value is shown in . Exemplary charts of each mode are shown in and explained below 

The constant current mode attempts to provide constant current from 0 to Z High ohms. After Z High ohms it switches to providing constant voltage see .

The constant power mode attempts to provide constant power from Z Low to Z High ohms. Below Z Low it switches to providing constant current mode and above Z High it switches to providing constant voltage see 

The constant voltage mode attempts to provide constant voltage from Z Low and above. Below Z Low it switches to providing constant current see .

To accurately read the voltage and current sensors an automatic gain control system is provided to the electrosurgical generator system for providing a high speed AID converter with a properly amplified signal. The dynamics of this gain control are programmed as a PID controller. The commands for programming the PID controller are as follows 

The RF waveform is defined by a pulse generator which activates the main RF stage e.g. FETs . The programming of the pulse generator allows specification of at least the pulse width the number of pulses and an off time. This allows a wide variety of waveform patterns to be programmed for the electrosurgical generator system .

One embodiment of the present disclosure includes splitting the outer loop system into two sub sections an outer loop target generator which handles the time based changes to the setpoint of the outer loop e.g. temperature versus time curves and an inner loop target generator which selects which target e.g. voltage current power the inner loop is controlling.

It is contemplated that the system of the present disclosure can he configured such that the system allows the downloading of the configuration files into the electrosurgical generator by the user. The new configuration files could be purchased or given to the user for upgrading the electrosurgical system.

Configuration data is generated by the configuration controller . The inner loop controller includes an inner loop target generator ILTG and an inner loop control module ILCM . The outer loop controller includes an outer loop target generator OLTG and an outer loop control module OLCM . The ILTG configuration data is provided to the ILTG . The ILCM configuration data is provided to the OLCM . The OLTG configuration data is provided to the OLTG the OLCM configuration data is provided to the OLCM . The waveform controller configuration data is provided to the waveform controller . The HLA module configuration data is provided to the HLA module .

The elements ILTG ILCM OLTG OLCM the configuration controller the configuration sensor module the HLA module the waveform controller or the sensor module or a combination thereof may be disabled and or bypassed or a connection between two or more elements may be disabled so that the electrosurgical generator control system may operate without the disabled element. The disabled elements pass the input directly to the output of the module thus allowing the enabled elements to operate with no change from the disabled units. The inner loop controller processes sensor data received from the sensor module in accordance with configuration data received from the configuration controller updated configuration data received from the HLA module and the inner loop multiplier control signal received from the outer loop controller and generates a supply setpoint control signal which is provided to the RF stage where an amplitude of an aspect of the RF energy output by the RF stage is controlled in accordance with the supply setpoint. In the example provided in the supply setpoint is an HV supply setpoint which controls amplitude of the voltage output by the RF stage .

The ILTG receives configuration data including at least one algorithm selected from algorithms including a sculpted curve including sculpted current sculpted voltage and sculpted power and RF limit algorithms pulse parameters pulse enable for enabling or disabling pulsing function pulse on length of high pulse pulse off length of low pulse pulse min amplitude of low pulse an inner loop gain curve maximum RF limits a control curve and Zlow Zhigh Zentl values where Zentl indicates when to switch the control variable e.g. from current to voltage or vice versa sensor data from the sensor module and the inner loop multiplier from the outer loop controller . The ILTG generates a target signal to the ILCM based on the inner loop control curve provided via the configuration data from the configuration controller and updatable by the configuration update data from the HLA module the inner loop multiplier from the outer loop controller and impedance and actual RF current and voltage from the sensor module . The target signal preferably represents voltage but it can also represent the HV supply setpoint in the case when the ILCM is bypassed and or disabled.

The ILTG further includes modules for performing the following functions performing a sculpted curve algorithm including for example but not limited to converting a sculpted current or power control curve into a voltage control curve limiting the control curve to the maximum values e.g. for current voltage and power allowed for the hardware calculating and generating the inner loop target based on the sensor data the control curve and the inner loop multiplier controlling the inner loop control module gains based on impedance sensor data and the gain curve which specifies changes in gain due to changes in impedance for generating the gain multiplier pulsing the inner loop target and selecting a mode based on the sensed load impedance and the impedance breakpoints Zlow Zhigh and Zentl and generating a control mode signal in accordance with the selected mode.

Mode selection determines which sensor data is to be used by the ILCM and which variable is to be controlled e.g. sensor data that corresponds to current voltage or power for controlling current voltage or power respectively. referably current control is to be used for impedances less than Zlow power or voltage control is used for impedance values between Zlow and Zhigh and voltage control is used for the remaining impedance values. To avoid inaccuracy and prevent unnecessary control mode switching when the impedance is near a breakpoint hysteresis is used when the impedance is close to a breakpoint.

The RF limit algorithm causes the ILTG and the ILCM to operate in an open loop mode in which there is minimal software control of the HV supply setpoint output in response to sensor data. The open loop mode is generally used for calibration and service functions but is not limited thereto. Preferably in the open loop mode the amplitude activation setting determines the percentage of full scale output that the RF stage will deliver. The RF limit algorithm protects the RF stage from user actions such as setting the activation amplitude setting to a level that could cause the HV supply setpoint to be set to a level that could damage the RF stage . The HV supply setpoint is kept within predetermined limits where the limits are determined by the control curve 

The inner loop control curve is interpreted to represent the maximum allowed HV supply setpoint at the specified impedance Z . As long as the maximum HV supply setpoint allowed is not exceeded as defined by the inner loop control curve control of the HV supply setpoint is based on the inner loop multiplier. If the control curve is exceeded then the output HV supply setpoint is held at the maximum allowed HV supply setpoint for providing protection to the electrosurgical unit receiving the energy generated by the RF stage . The HV supply setpoint is set to equal the inner loop multiplier after the ITV supply setpoint is less than the maximum RF limit value with some possible hysteresis.

The max RF limits parameter provides another layer of control layered on top of the control curve for use with any algorithm by providing maximum limits for current voltage and or power levels of the HV supply setpoint. The control layer which uses the max RF limits parameter further provides protection to the RF stage unit and the electrosurgical unit ESU receiving the energy generated by the RF stage including protection from changes to the software. Furthermore the control system may use the minimum of the limits described by the control curve and the max RF limit for limiting the HV supply setpoint 

The pulsing function may run in parallel with other ILTG algorithms. The duration of the high and low pulses the time between leading edges the level for the low pulse etc. are specified by the pulse parameters. The level for the high pulse is defined by the control curve the impedance data from the sensor data and the inner loop multiplier for closed loop control or by the inner loop multiplier for open loop control such as when the RF limit algorithm is performed. The pulsing of the inner loop target may contribute to providing sharp edged pulses of the HV supply setpoint if desired.

The inner loop control curve received via the configuration data specifies the inner loop desired output values versus sensed impedance values obtained from sensor data. The desired output values of the received inner loop control curve represent current voltage or power as determined by the algorithm received via the configuration data e.g. the sculpted current voltage or power algorithm respectively . The received inner loop control curve may be converted into a voltage current or power curve in accordance with the mode selected in which the desired output values represent voltage current or power respectively. The control curve or converted control curve may be structured for example as a multi dimensional array. One column of the array specifies impedance values and another column specifies desired output values where the desired output values represent current power or voltage in accordance with the control mode. Preferably the desired output values are normalized between 0 and 1.0. A desired output value which is output as the inner loop target is generated by obtaining a normalized desired output value via linear interpolation based on the actual impedance and multiplying the normalized desired output value by the inner loop multiplier.

Control of the inner loop control module gains herein referred to as inner loop gain control includes generating the gain multiplier in response to a constant control voltage as impedance changes. System gain e.g. RF voltage HV supply set point where the RF voltage is measured RF voltage output by the RF stage varies with patient load impedance. The inner loop gain control objective is to stabilize the system gain to keep it close to constant as the load impedance changes. The inner loop gain curve is theoretically a set of points of a gain multiplier plotted versus impedance derived from the design of the hardware which is designed to adjust the gains due to the response of the electrosurgical generator system .

The gain curve preferably holds a normalized voltage response versus impedance. By using a normalized voltage response the voltage is converted into the variable that we are controlling current power or voltage . The gain multiplier is computed by taking the inverse of the voltage response that corresponds to the sensed impedance. The gain multiplier is used to adjust the inner loop PID values of the ILCM so that the control system gain is close to constant. Accordingly the PID values should be calculated assuming a system gain of 1.0 as the PID values are adjusted as described above.

To compute the gain multiplier for voltage control the interpolated value of the gain curve is inverted. For power control the gain multiplier is Z V where V is the interpolated value from the gain curve . For current control the gain multiplier is Z V. Accordingly the ILSM can use a single set of PID gain values for the inner loop voltage current or power control and the gain multiplier is used to modify the PID gains during the procedure in virtual real time.

The ILCM receives configuration data including control parameters such as PID parameters sensor data from the sensor module and the inner loop target the gain multiplier and the control mode Inns Vrms Pavg or Bypass from the ILTG . The ILCM adjusts the HV supply setpoint in accordance with the received data so that the inner loop target is reached.

The ILCM preferably uses a control algorithm such as a PID algorithm which is able to switch between control modes such as current control voltage control power control and a bypass mode e.g. minimal control where received data is provided as the output without large disturbances when switching control modes. When the ILTG is performing the RF limit algorithm the ILCM is preferably in bypass mode. When switching between control modes the PID loop algorithm if active pre loads the integral term for minimum disturbance.

With respect to the outer loop controller the OLTG receives configuration data including the outer loop target curve the target slew rate the time multiplier and an algorithm selectable from algorithms including time control or bypass algorithms the amplitude multiplier from the HLA module and time signals. Other than when performing the bypass algorithm the OLTG generates a time varying outer loop target in accordance with the received data which is provided to the OLCM where the outer loop target may represent a property such as but not limited to temperature current power voltage or impedance. Preferably the outer loop target is generated by a linear interpolation of the adjusted outer loop target curve where the target curve provided via the OLTG configuration data is adjusted in accordance with the amplitude multiplier the time multiplier and or time.

The outer loop target slew rate parameter allows the system to have a programmable slew rate of the outer loop target so that regardless of how quickly the amplitude multiplier changes the outer loop target will not change faster than the programmed slew rate. The outer loop target slew rate control function is typically used in systems in which the user may have direct control of a parameter such as the activation amplitude setting and it is desired to limit the rate at which the activation amplitude setting can be changed.

The OLCM receives configuration data including control parameters such as PID parameters inner loop multiplier maximum and minimum limit values pulse parameters at least one algorithm selectable from algorithms such as temperature temperature limit impedance Z or bypass algorithms algorithm parameters such as temperature limits and an outer loop gain curve sensor data from the sensor module and the outer loop target from the OLTG . Preferably the OLCM uses a control algorithm such as a PID algorithm which operates in accordance with the PID parameters. The OLCM adjusts the inner loop multiplier in accordance with the received data in order to reach the outer loop target.

The OLCM is capable of pulsing the inner loop multiplier. When the pulse is on the output value is the computed inner loop multiplier. When the pulse is off the output is set to a predetermined value.

The OLCM controls outer loop gain. The outer loop gain curve describes a plot of gain multiplier versus impedance derived from the inner loop control curve and thus the programming of the inner loop by way of the configuration parameters. The outer loop gain curve may be structured for example as a two dimensional array. When outer loop gain control is enabled the outer loop gain is multiplied by the gain multiplier that corresponds to the received impedance sensor data. The outer loop gain control stabilizes the system gain to maintain system gain that is close to constant. From the perspective of the outer loop controller the system gain varies with patient load impedance due to the inner loop control curve programming. Conceptually the outer loop gain is multiplied by the inverse of the normalized inner loop control curve thus keeping the system gain close to constant. The outer loop gain curve specifies the inverse of the normalized inner loop control curve where the outer loop gain curve may be further adjusted for keeping the system stable.

The HLA module receives configuration data including at least one procedural algorithm selectable from algorithms for controlling the electrosurgical generator system during specific types of procedures or procedures performed under specific conditions such as on specific organs. The procedural algorithms include algorithms such as vessel sealing e.g. LigaSure standard and precise rate of change of impedance dZ dt lung bowel ablation etc. and bypass algorithms and a combination thereof algorithm specific data for adjusting at least one specified procedural algorithm sensor data from the sensor module time signals user entered settings and the activation amplitude setting from the configuration controller .

Preferably the HLA module uses a state based control algorithm. The HLA module performs top level RF delivery algorithms which are primarily state based. The HLA module has the capability of changing the configuration data of the lower level modules including the ILTG the ILCM the OLTG and the OLCM and the waveform controller . The HLA module sets up the lower level modules in accordance with the received data by adjusting the corresponding configuration data as determined necessary. Furthermore during a procedure the HLA module reprograms the lower level modules in accordance with the received data by adjusting the corresponding configuration data in accordance with the algorithm selected and in response to measured properties as indicated by the received sensor data where the reprogramming may be performed in virtual real time.

The user entered settings may be used in conjunction with any of the algorithms selected. Furthermore the user entered settings may control the activation amplitude setting for one or more electrical or physical properties e.g. power current voltage or temperature without directly identifying the particular property and target setting. For example the user may select from a variety of generic settings where each generic setting includes a predetermined setting for one or more properties.

The waveform controller receives configuration data including on time dead time number of pulses per burst of pulses and delay time between bursts of pulses. It is contemplated that the waveform controller may be programmed by the HLA module if determined necessary and or by the configuration file via download from the configuration controller . The waveform controller controls the hardware which generates a wave pattern such as a square wave pattern which drives FETs in the RF stage. Parameters of the waveform pattern that may be controlled by the waveform controller include at least on time pulse width of a single pulse dead time delay to next pulse number of pulses per group of pulses and delay time between groups of pulses.

The waveform generator may receive an amplitude envelope parameter with the configuration parameters and may further include circuitry such as analog and or logic circuitry for adjusting amplitude of pulses within a burst of pulses. The amplitude envelope parameter may describe the amplitude setting for individual pulses of groups or bursts of pulses. The amplitude adjustments may be performed at a rate that is faster than the rate at which the software such as the inner loop controller is capable of providing control so that the amplitude adjustments may be provided for individual pulses of groups of pulses. The waveform generator may receive a control signal such as a control signal from the ILCM indicative of the HV supply setpoint for synchronizing the amplitude adjustments with the HV supply setpoint or with the signals output by the RF stage .

Preferably the configuration controller is a system which selects the required configuration files based on user input and download them to the rest of the system. It is contemplated that the configuration controller may be removable and replaceable. The configuration controller receives configuration sensor data from the configuration sensor module and or user input devices not shown for direct user input. The configuration controller generates the configuration data and the activation amplitude setting in accordance with the received data. The configuration controller selects the algorithm to be used by the ILTG OLTG OLCM and the HLA . The configuration data is provided to the appropriate modules as described above and the activation amplitude setting is provided to the HLA module .

The configuration controller may configure itself or alternatively be configured by another processor in accordance with conditions such as the ESU and or the user interface to the electrosurgical generator system being used.

The configuration sensor module includes sensors for sensing user actions including user actions not intentionally related to providing input to the configuration controller environmental conditions patient conditions or other properties or conditions. The configuration sensor module further includes analog and or digital circuitry and software modules for processing signals generated by the sensors such as for preparing the signals for input to the configuration controller and for controlling the sensors.

The sensors of the configuration sensor module may include for example a sensor for sensing adjustment of a slider mechanism on the ESU for selecting a parameter on the ESU an optical sensor for sensing a property of the patient s tissue a proximity sensor for sensing thickness of the patient s tissue a motion sensor for sensing motion of the ESU or the patient a sensor for sensing moisture levels of tissue etc. A portion of the sensors may be provided within the sterile field of the electrosurgical procedure. The configuration sensor module may further include one or more commercially available user input devices.

The sensor module includes sensors for sensing electrical properties of energy as output by the electrosurgical device and or electrical and or physical properties proximate the surgical site or the ESU. Furthermore the sensor module includes analog and or digital circuitry and software modules for processing signals generated by the sensors such as for preparing the signals for input to the control system of the electrosurgical generator system and for calculating values derived from the sensed properties. It is contemplated that sensors and circuitry may be shared by the sensor module and the configuration controller . Furthermore the sensor module may further include at least one control system for controlling the sensors amplification of sensed signals sampling rates of the sensors etc. The sensor module may further include one or more commercially available user input devices.

In a preferred embodiment a user may enter user input to the configuration controller for selecting directly or indirectly configuration parameters the activation amplitude setting and the amplitude multiplier. As described above the user input to the configuration controller may not be intentionally entered for selecting configuration parameters.

It is contemplated that another configuration parameter an expected crest factor parameter may be provided to at least one of the modules of the control system of the electrosurgical generator for providing further control. Furthermore the sensor module may include sensors for sensing the crest factor. The control system may further include a safety monitor module which compares the expected crest factor parameter with the sensed crest factor and sends control signals to other modules of the control system for making adjustments in accordance with the results of the comparison. The sensor module may configure the sensors for setting up the dynamic range of the sensors in accordance with the expected crest factor parameter.

It is further contemplated that the control system includes an activation sequencer which controls startup and ending of RF delivery. The activation sequencer may receive configuration data from the configuration controller and or updated configuration data from the HLA module for performing startup and or shutdown procedures in accordance with the configuration data and or updated configuration data.

The software modules of the electrosurgical generator control system including the inner loop controller outer loop controller the configuration controller the HLA module the waveform controller and control modules associated with the sensor module and or the configuration sensor module are respectively executable on at least one processor such as a microprocessor and or a DSP. Resources for processing storage etc. or a combination thereof may be shared by any combination of the aforementioned software modules. The software instructions of the respective software modules may be stored on computer readable medium such as CD ROMs or magnetic disks and or may be transmitted and or received via propagated signals.

In operation the control system may be initialized during the power up and or the activation process. The electrosurgical generator system recognizes via sensing or plug and play notification the type of ESU and or electrosurgical generator user interface to be used. Sensors of the sensor module and or the configuration sensor module sense initialization properties associated with the environment ESU or patient. Information is entered via a user interface such as patient and or procedure related information procedure to be performed tissue to be operated upon patient identification age weight expected fat content . The information or additional information may be retrieved from a database accessible by the control system of the electrosurgical generator system .

The appropriate configuration files are selected or generated by the configuration controller . It is contemplated that at least a portion of the configuration files are stored by the configuration controller and or associated memory. Accordingly selected configuration files not stored by the configuration controller may be downloaded to the configuration controller through various methods. Upon activation of the electrosurgical generator system the configuration controller downloads the configuration files into the respective modules of the control system.

The control system for the electrosurgical generator system provides a high degree of flexibility for performing a wide variety of different types of control for controlling the output of electrosurgical energy for use in a wide variety of types of procedures which may be performed under a wide variety of circumstances. Furthermore the control system provides a wide variety of different types of control during a procedure where the control and selection of the type of control is provided on the fly or in virtual real time in response to properties associated with sensed properties and or user input or actions. The type of control provided may be selected in response to a variety of factors such as sensed or input tissue response type of electrosurgical instrument being used patient profile the type of procedure being performed environmental conditions the type of tissue being treated and the condition of the tissue being treated.

Although this disclosure has been described with respect to preferred embodiments it will be readily apparent to those having ordinary skill in the art to which it appertains that changes and modifications may be made thereto without departing from the spirit or scope of the claims appended hereto.

