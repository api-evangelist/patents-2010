---

title: Authentication server and method for granting tokens
abstract: An authentication server and method are provided for generating tokens for use by a mobile electronic device for accessing a service. Communications between the device and the authentication server are through a relay. A memory stores a secret shared with a service server from which the service is provided. A processor is configured to generate the token using the shared secret and based on a reliance on the relay to ensure that the device has authorization to access the service. One or more computer readable medium having computer readable instructions stored thereon that cause the device to obtain proof of authorization to access the service is also provided. The instructions implement a method comprising: outputting via a wireless connection to a relay a request addressed to an authentication server for a token and receiving the token from the authentication server via the relay.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08898453&OS=08898453&RS=08898453
owner: BlackBerry Limited
number: 08898453
owner_city: Waterloo
owner_country: CA
publication_date: 20100429
---
The present disclosure relates generally to an authentication server and method for granting tokens to a mobile electronic device for accessing a service on a service server.

To access some services offered by service providers mobile communications devices are required to authenticate. There are different existing protocols and architectures for authentication of mobile communications device. One such protocol is Kerberos in which a client obtains a ticket from an authentication server and then uses that ticket to access a service on server.

Many mobile communications devices today are able to browse the Internet using web browsers. In some systems mobile communications devices communicate with origin web servers directly. In other systems devices communicate with origin web servers through a browsing proxy.

In accordance with one aspect there is provided an authentication server comprising a receiver for receiving communications from a relay a transmitter for transmitting communications to the relay a memory having stored thereon a secret shared with a service server from which a service is provided and a processor configured in response to a request originating from a mobile electronic device received from the relay at the receiver to generate a token based on a reliance on the relay to ensure that the mobile electronic device has authorization to access the service and the processor configured to cause the transmitter to transmit the token to the mobile electronic device through the relay the token generated using the shared secret and the token including an indication that the mobile electronic device is authorized to access the service.

In accordance with another aspect there is provided a method of issuing a token for use by a mobile electronic device for authorization to access a service provided from a service server the method comprising receiving at an authentication server a request for the token from the mobile electronic device through a relay generating the token based on a reliance on the relay to ensure that the mobile electronic device is authorized to access the service and transmitting the token to the mobile electronic device through the relay.

In accordance with another aspect there is provided one or more computer readable medium having computer readable instructions stored thereon that when executed by a processor on a mobile electronic device cause the mobile electronic device to obtain proof of authorization to access a service provided from a service server by a method comprising outputting to a relay a request addressed to an authentication server for a token the token including an indication that the mobile electronic device is authorized to access the service and receiving the token from the authentication server via the relay.

Embodiments of the present application are not limited to any particular operating system mobile electronic device architecture server architecture or computer programming language. It is to be understood that alternate embodiments are feasible.

Reference is now made to which illustrates an exemplary embodiment of the mobile electronic device in which example embodiments described in the present disclosure can be applied. The mobile electronic device is a two way communication device having data and voice communication capabilities and the capability to communicate with other computer systems for example via the Internet. Depending on the functionality provided by the mobile electronic device in various embodiments the device may be a multiple mode communication device configured for both data and voice communication a smartphone a mobile telephone or a PDA personal digital assistant enabled for wireless communication or a computer system with a wireless modem.

The mobile electronic device includes a rigid case not shown housing the components of the device . The internal components of the device are constructed on a printed circuit board PCB . The mobile electronic device includes a controller comprising at least one processor such as a microprocessor which controls the overall operation of the device . The processor interacts with device subsystems such as a wireless communication subsystem sometimes referred to as a radio layer for exchanging radio frequency signals with the wireless network to perform communication functions. The processor interacts with additional device subsystems including a display screen such as a liquid crystal display LCD screen input devices such as a keyboard and control buttons flash memory random access memory RAM read only memory ROM auxiliary input output I O subsystems data port such as serial data port such as a Universal Serial Bus USB data port speaker microphone short range communication subsystem and other device subsystems generally designated as . Some of the subsystems shown in perform communication related functions whereas other subsystems may provide resident or on device functions.

The device may comprise a touchscreen display in some embodiments. The touchscreen display may be constructed using a touch sensitive input surface connected to an electronic controller and which overlays the display screen . The touch sensitive overlay and the electronic controller provide a touch sensitive input device and the processor interacts with the touch sensitive overlay via the electronic controller.

The communication subsystem includes a receiver a transmitter and associated components such as one or more antenna elements and local oscillators LOs and a processing module such as a digital signal processor DSP . The antenna elements and may be embedded or internal to the mobile electronic device and a single antenna may be shared by both receiver and transmitter as is known in the art. As will be apparent to those skilled in the field of communication the particular design of the wireless communication subsystem depends on the wireless network in which mobile electronic device is intended to operate.

The mobile electronic device may communicate with any one of a plurality of fixed transceiver base stations of the wireless network within its geographic coverage area. The mobile electronic device may send and receive communication signals over the wireless network after the required network registration or activation procedures have been completed. Signals received by the antenna through the wireless network are input to the receiver which may perform such common receiver functions as signal amplification frequency down conversion filtering channel selection etc. as well as analog to digital A D conversion. A D conversion of a received signal allows more complex communication functions such as demodulation and decoding to be performed in the DSP . In a similar manner signals to be transmitted are processed including modulation and encoding for example by the DSP . These DSP processed signals are output to the transmitter for digital to analog D A conversion frequency up conversion filtering amplification and transmission to the wireless network via the antenna . The DSP not only processes communication signals but may also provide for receiver and transmitter control. For example the gains applied to communication signals in the receiver and the transmitter may be adaptively controlled through automatic gain control algorithms implemented in the DSP .

The processor operates under stored program control and executes software modules stored in memory such as persistent memory for example in the flash memory . As illustrated in the software modules comprise operating system software software applications comprising an email messaging application also referred to as an email client a personal address book a calendar application a phone application an authentication module and a browsing module . Example embodiments of the authentication module will be discussed in detail later herein. It is recognized that the authentication module and its various components as described herein can form a discrete module running on the device or the functions of the authentication module can be distributed on the device as separate modules or integrated within other existing modules as desired. Such discrete or distributed implementations all fall within the embodiments of the authentication module as described herein. In some embodiments the authentication module is configured to obtain tokens from an authentication server for accessing a browsing proxy. In other implementations the token is for accessing a server containing data files. In still other implementations the token is for accessing a service such as banking services. Once obtained a token can be used by the browsing module to access the browsing proxy directly and enable the user of the mobile electronic device to access the Internet.

The software applications also may include a range of applications including for example a notepad application Internet browser application voice communication i.e. telephony application mapping application or a media player application or any combination thereof. Each of the software applications may include layout information defining the placement of particular fields and graphic elements e.g. text fields input fields icons etc. in the user interface i.e. the display screen according to the application.

Those skilled in the art will appreciate that the software modules or parts thereof may be temporarily loaded into volatile memory such as the RAM . The RAM is used for storing runtime data variables and other types of data or information as will be apparent to those skilled in the art. Although specific functions are described for various types of memory this is merely one example and those skilled in the art will appreciate that a different assignment of functions to types of memory could also be used.

In some embodiments the auxiliary I O subsystems may comprise an external communication link or interface for example an Ethernet connection. The mobile electronic device may comprise other wireless communication interfaces for communicating with other types of wireless networks for example a wireless network such as an orthogonal frequency division multiplexed OFDM network or a GPS Global Positioning System subsystem comprising a GPS receiver or transceiver for communicating with a GPS satellite network not shown . The auxiliary I O subsystems may comprise a pointing or navigational input device such as a clickable trackball or scroll wheel or thumbwheel or a vibrator for providing vibratory notifications in response to various events on the device such as receipt of an electronic message or incoming phone call or for other purposes such as haptic feedback touch feedback .

In some embodiments the mobile electronic device also includes a removable memory card or module typically comprising flash memory and a memory card interface . Network access is typically associated with a subscriber or user of the mobile electronic device via the memory card which may be a Subscriber Identity Module SIM card for use in a GSM network or other type of memory card for use in the relevant wireless network type. The memory card is inserted in or connected to the memory card interface of the mobile electronic device in order to operate in conjunction with the wireless network .

The mobile electronic device also stores other data in an erasable persistent memory which in one example embodiment is the flash memory . In various embodiments the data includes service data comprising information required by the mobile electronic device to establish and maintain communication with the wireless network . The data may also include user application data such as email messages address book and contact information calendar and schedule information notepad documents image files and other commonly stored user information stored on the mobile electronic device by its user and other data. The data stored in the persistent memory e.g. flash memory of the mobile electronic device may be organized at least partially into a number of databases each containing data items of the same data type or associated with the same application. For example email messages contact records and task items may be stored in individual databases within the device memory.

The mobile electronic device also includes a battery as a power source which is typically one or more rechargeable batteries that may be charged for example through charging circuitry coupled to a battery interface such as the serial data port . The battery provides electrical power to at least some of the electrical circuitry in the mobile electronic device and the battery interface provides a mechanical and electrical connection for the battery . The battery interface is coupled to a regulator not shown which provides power V to the circuitry of the mobile electronic device .

The short range communication subsystem is an additional optional component which provides for communication between the mobile electronic device and different systems or devices which need not necessarily be similar devices. For example the subsystem may include an infrared device and associated circuits and components or a wireless bus protocol compliant communication mechanism such as a Bluetooth communication module to provide for communication with similarly enabled systems and devices.

A predetermined set of applications that control basic device operations including data and voice communication applications will normally be installed on the mobile electronic device during or after manufacture. Additional applications and or upgrades to the operating system or software applications may also be loaded onto the mobile electronic device through the wireless network the auxiliary I O subsystem the serial port the short range communication subsystem or other suitable subsystem . The downloaded programs or code modules may be permanently installed for example written into the program memory i.e. the flash memory or written into and executed from the RAM for execution by the processor at runtime. Such flexibility in application installation increases the functionality of the mobile electronic device and may provide enhanced on device functions communication related functions or both. For example secure communication applications may enable electronic commerce functions and other such financial transactions to be performed using the mobile electronic device .

The mobile electronic device may provide two principal modes of communication a data communication mode and a voice communication mode. In the data communication mode a received data signal such as a text message an email message or Web page download will be processed by the communication subsystem and input to the processor for further processing. For example a downloaded Web page may be further processed by a browser application or an email message may be processed by the email messaging application and output to the display . A user of the mobile electronic device may also compose data items such as email messages for example using the input devices in conjunction with the display screen . These composed items may be transmitted through the communication subsystem over the wireless network .

In the voice communication mode the mobile electronic device provides telephony functions and operates as a typical cellular phone. The overall operation is similar except that the received signals are output to the speaker and signals for transmission are generated by a transducer such as the microphone . The telephony functions are provided by a combination of software firmware i.e. the phone application and hardware i.e. the microphone the speaker and input devices . Alternative voice or audio I O subsystems such as a voice message recording subsystem may also be implemented on the mobile electronic device . Although voice or audio signal output is typically accomplished primarily through the speaker the display screen may also be used to provide an indication of the identity of a calling party duration of a voice call or other voice call related information.

The phone application can be split into multiple applications or sub modules for example one or more user phone modules and a call control module. The user phone modules provide a variety of telephony features through a user interface while the call control module provides access to common telephony functions desired by the user phone modules such that telephony requests from phone modules can be coordinated and so that the user phone modules do not need to each provide instructions understood by the wireless communications subsystem . The call control function typically makes telephony features available to user phone modules through an application programming interface API . It is to be recognized that all or part of the phone application features or functions could be provided through the operating system or otherwise distributed in the device while continuing to fall within the term phone application .

An authentication system and method is provided for authenticating a mobile electronic device attempting to access a service such as a browsing proxy in order to browse the internet. The approach uses an authentication and authorization function to authenticate and authorize access to the service keeping the authentication and authorization function separate from the token granting function. The approach uses a Kerberos like authentication protocol.

Referring now to to support authorization and authentication for the service on a service server an authentication server is attached to a relay . The mobile electronic devices only one shown are granted access to the service on the service server by means of a relay based authentication and authorization mechanism. It is to be understood that mobile electronic devices referred to with reference to include but are not limited to mobile electronic device described above with reference to . An exemplary authentication mechanism is a user identification and password mechanism whereby the mobile electronic device provides the relay with a user identification and password unique to the mobile electronic device or a device PIN in order to access the relay . In embodiments the mobile device registers and thus authenticates itself with the relay prior to outputting the request for the token to the relay. An exemplary authorization mechanism is one in which the relay determines the services that a device may use on the basis of information provisioned in a service provisioning database in the relay.

The relay is configured to authorize a device to access to the authentication server only if that device is authorized to access the service on the service server .

In some embodiments the service server is a browsing proxy. The authentication server and the browsing proxy are configured with a shared secret such as but not limited to a password.

In some embodiments the authentication server and the service server are configured with the shared secret during setup. In some embodiments the shared secret is sent to each of the authentication server and the service server by a third entity. In other embodiments the shared secret is communicated from the authentication server to the service or vice versa. It is not necessary for the authentication server and service server to communicate with each other after the shared secret is exchanged.

An exemplary embodiment of an authentication server will now be described with reference to . The authentication server comprises a receiver a transmitter a memory and a processor . The receiver is for receiving communications from a relay. The transmitter is for transmitting communications to the relay. The memory stores a secret shared with a service server from which a service is provided. The processor is configured to generate a token using the shared secret and based on a reliance on the relay to ensure that the mobile electronic device has authorization to access the service. The processor generates the token in response to a request originating from a mobile electronic device received from the relay at the receiver . The processor is also configured to cause the transmitter to transmit the token to the mobile electronic device through the relay. The token includes an indication that the mobile electronic device is authorized to access the service.

In some embodiments of the authentication server the processor is configured to generate the token based on a reliance on the relay to authenticate the mobile electronic device.

In some embodiments the authentication server is connected to the relay by a direct connection and the request is received over the direct connection and the token is transmitted over the direct connection.

In some embodiments the processor is further configured to verify that a device identifier carried in the request matches a source address of a message containing the request. The mobile electronic device includes its device identifier in the request for the token. The request for the token is sent as part of a message that includes information such as the source address that includes the device identifier. The relay verifies that the source address is authentic. The processor at the authentication server extracts the device identifier from the source address in the message and compares it to the device identifier in the request.

In some embodiments the processor is further configured to obtain a device identifier for the mobile electronic device from the request and include the device identifier in the token.

In some embodiments the processor is configured to include an expiry threshold in the token. Non limiting examples of the expiry threshold include a time period after which the token expires and a number of times the mobile electronic device can access the service server using the same token after which the token expires.

In some embodiments the processor is configured to generate the token authorizing the mobile electronic device to access a browsing proxy. In some embodiments the processor is further configured to negotiate a session key with the mobile electronic device through the relay the session key being for encrypting and decrypting communications between the mobile electronic device and the authentication server.

An exemplary method of issuing a token for use by a mobile electronic device authorization to access a service provided from a service server directly will now be described with reference to . The method comprises receiving at an authentication server a request for the token from the mobile electronic device through a relay generating the token based on a reliance on the relay to ensure that the mobile electronic device is authorized to access the service and transmitting the token to the mobile electronic device through the relay .

In some embodiments generating the token is further based on a reliance on the relay to authenticate the mobile electronic device.

In some embodiments the method further comprises receiving a request from the mobile electronic device through the relay to negotiate a session key to be used for communications between the mobile electronic device and the authentication server in providing the token negotiating the session key with the mobile electronic device through the relay and using the session key for transmitting the token. In some embodiments these actions related to the negotiation of the session key take place before the request for the token is sent by the mobile electronic device.

In some embodiments the method further comprises verifying that a device identifier carried in the request matches a source address of an encrypted message containing the request.

In some embodiments the method further comprises obtaining a device identifier for the mobile electronic device from the request and including the device identifier in the token.

In some embodiments generating the token comprises generating a token for accessing a browsing proxy. In some embodiments the mobile electronic device is authorized to access the origin web servers directly.

To minimize any additional bandwidth requirements and network latency introduced by the authentication procedure in some embodiments the authentication token is refreshed automatically so that the service server hardly ever responds indicating that the token has expired causing a delay loading the web page . In some embodiments the refresh mechanism is randomized so that every mobile electronic device in the network is not requesting a token refresh from the relay at the same time.

Another exemplary embodiment is one or more computer readable medium having computer readable instructions stored thereon that when executed by a processor on a mobile electronic device cause the mobile electronic device to obtain proof of authorization to access a service provided from a service server. The method implemented by the processor in order to obtain the proof of authorization is shown in and comprises outputting to a relay a request addressed to an authentication server for a token the token including an indication that the mobile electronic device is authorized to access the service and receiving the token from the authentication server via the relay .

In some embodiments of the one or more computer readable medium the method further comprises encrypting the request using an encryption key shared with the authentication server.

In a further embodiment of the one or more computer readable medium as shown in the method further comprises outputting to the relay a request to negotiate a session key from the authentication server receiving a public key from the authentication server through the relay generating the session key transmitting the session key to the authentication server through the relay using the public key and using the session key to encrypt and decrypt communications with the authentication server through the relay for obtaining the token . Actions and of are the same as the actions described with reference to for obtaining a token with the exception that the communications are encrypted using the session key.

In a further exemplary embodiment of the one or more computer readable medium as shown in the method further comprises accessing the service on the service server through a direct connection using the token as proof of authorization for the mobile electronic device to access the service . The method may further comprise receiving a message from the service server from which the service in provided indicating that access has been granted .

In some embodiments of the one or more computer readable medium the method further comprises requesting a new token from the authentication server through the relay prior to an expiry of the token received.

The first phase negotiates a session key between the mobile electronic device and the authentication server.

In phase 2 the mobile electronic device uses the Needham Schroeder protocol such as described in Roger Needham and Michael Schroeder Communications of the ACM 21 12 December 1978 as modified for Kerberos to obtain an authentication key and token from the authentication server that it can use to authenticate to the service server from which the service is provided such as a browsing proxy.

In phase 3 the mobile electronic device initiates a new session with the service server providing the service. In some embodiments the service server providing the service is a browsing proxy and the session is a browser session. For a browser session the operation of this phase is similar to HTTP proxy authentication using the digest authentication method where the username is replace with the token and the password is the authentication key K. Action Mobile electronic device sends to the service server providing the service directly 

Action server providing service decrypts the token to obtain the authentication key K and verifies that the key is still valid by checking the timestamp and lifetime. It then uses the key to verify that the digest sent from the mobile electronic device is correct. If all checks pass then the service server providing the service knows that the device identifier A is valid. Then the service server providing the service sends to the mobile electronic device 

The embodiment of the protocol described above clearly separates phase 1 session key negotiation from phase 2 token generation . In another embodiment of the protocol phase 1 overlaps with phase 2 by sending messages and together as a single message. When messages and are sent as a dingle message the protocol described above requires two round trip message exchanges between mobile electronic device and authentication server followed by two round trip message exchanges between mobile electronic device and service server.

The protocols described herein rely on a relay such as a communications relay for the at least one of the following 

Since the token contains A the device identifier and the token is encrypted the browsing proxy is able to determine the device identity while preventing any third party from obtaining this information. This identity could be used for business intelligence purposes subject to privacy requirements .

In some embodiments after authentication token negotiation the mobile electronic device stores the authentication token in a memory such as RAM random access memory or flash memory. Authentication token contains the following information in encrypted form K T L A.

In some embodiments the mobile electronic device is configured to try to periodically refresh authentication token before the token expires. In an exemplary embodiment the heuristic is to refresh authentication token half way in its expiration period. For example if the token validity period is 48 hours the mobile electronic device will try to refresh the token 24 hours after token acquisition. To avoid bursts of token refresh requests in some embodiments a refresh schedule includes a random factor. For example the token will be updated every 20 8 hours and the expiration time can be computed as 20 16R 8 where R is a random number in the range of 0 1 .

In some exemplary embodiments additionally to the token refresh schedule a new token is requested in at least one of the following events HTTP 407 is received from a browsing proxy except initial request with the token not specified Battery pull or hard reset and Device time change.

In some embodiments all keys are generated using a cryptographically secure pseudo random number generator CSPRNG . In an exemplary embodiment the initialization vectors also use CSPRNG to avoid predictable IV Initialization Vector attack on symmetric key.

In some embodiments transaction IDs are used to prevent GME packet replay attack and to separate packets from different concurrent negotiations. Transaction IDs do not have to be sequential they can be also generated using CSPRNG.

In some embodiments before accepting incoming packet during token negotiation actions to the mobile electronic device and the authentication server should verify that the packets have expected transaction IDs.

In some embodiments the authentication token is stored in a memory on the mobile electronic device memory unencrypted. Some embodiments of the mobile electronic device comprise a device key store for storing the authentication keys. In some embodiments storing the token in the device key store requires a device user to enter a key store password every time a new attempt is made to access the service server providing the service such as each time a TCP connection is opened by a browser such as the browser module on mobile electronic device described with reference to . In some embodiments the authentication token is stored in a memory such that it survives memory cleaning. In some embodiments where the token will be stored in the memory only the token is renegotiated on device start up.

In some embodiments the authentication server long term public key will be specified in an authentication token service book to be stored in a memory on the mobile electronic device. Once retrieved from the service book the public key will be stored in persistent store. The public key will not be stored in the device key store to avoid key store password dialogs.

To ensure strong cryptography and keep computational complexity at a reasonable level on the service server side some embodiments of the authentication server use ECDSA long term public key with P521Fp curve. ECDSA with P521Fp has 256 bit symmetric strength.

To ensure strong cryptography and keep computational complexity at a reasonable level on the server side some embodiments of the authentication server will use ECDH short term public key with P521Fp curve. ECDH with P521Fp has 256 bit symmetric strength.

Because all communications between the mobile electronic device and the authentication server pass through a relay that ensures the mobile device is authorized to access the service and in some cases authenticates the mobile electronic device and in some further embodiments has cryptographic capabilities the authentication server is not required to authenticate the mobile electronic device or to receive any identifying information about the device. The authentication server relies on the relay to perform those functions. In essence if the request for a token makes it through the relay then the authentication server trusts that it is a valid request and grants the token. The authentication server thus can act solely as a token granting device.

The methods described herein may be implemented using hardware software firmware or combinations thereof. It is to be understood that the actions of the methods are not limited to the order in which they are described are can be performed in any feasible order.

The various embodiments presented above are merely examples and are in no way meant to limit the scope of this disclosure. Variations of the innovations described herein will be apparent to persons of ordinary skill in the art such variations being within the intended scope of the present application. In particular features from one or more of the above described embodiments may be selected to create alternative embodiments comprised of a sub combination of features which may not be explicitly described above. In addition features from one or more of the above described embodiments may be selected and combined to create alternative embodiments comprised of a combination of features which may not be explicitly described above. Features suitable for such combinations and sub combinations would be readily apparent to persons skilled in the art upon review of the present application as a whole. The subject matter described herein and in the recited claims intends to cover and embrace all suitable changes in technology.

