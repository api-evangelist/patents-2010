---

title: Quality of service for device assisted services
abstract: Quality of Service (QoS) for Device Assisted Services (DAS) are provided. In some embodiments, QoS for DAS includes providing a wireless communications device configures to determine a QoS request for a service over a wireless network; and verifying the QoS request for the service over the wireless network using one or more verification techniques.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08346225&OS=08346225&RS=08346225
owner: Headwater Partners I, LLC
number: 08346225
owner_city: Redwood Shores
owner_country: US
publication_date: 20100127
---
This application claims priority to U.S. Provisional Patent Application No. 61 206 354 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Jan. 28 2009 U.S. Provisional Patent Application No. 61 206 944 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 4 2009 U.S. Provisional Application No. 61 207 393 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 10 2009 U.S. Provisional Patent Application No. 61 207 739 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed on Feb. 13 2009 U.S. Provisional Patent Application No. 61 252 151 entitled SECURITY TECHNIQUES FOR DEVICE ASSISTED SERVICES filed on Oct. 15 2009 and U.S. Provisional Patent Application No. 61 252 153 entitled DEVICE GROUP PARTITIONS AND SETTLEMENT PLATFORM filed on Oct. 15 2009 which are incorporated herein by reference for all purposes.

This application is a continuation in part of co pending U.S. patent application Ser. No. 12 380 780 entitled AUTOMATED DEVICE PROVISIONING AND ACTIVATION filed on Mar. 2 2009 which is incorporated herein by reference for all purposes and which claims priority to U.S. Provisional Patent Application No. 61 206 354 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Jan. 28 2009 U.S. Provisional Patent Application No. 61 206 944 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 4 2009 U.S. Provisional Application No. 61 207 393 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed Feb. 10 2009 and U.S. Provisional Patent Application No. 61 207 739 entitled SERVICES POLICY COMMUNICATION SYSTEM AND METHOD filed on Feb. 13 2009 which are incorporated herein by reference for all purposes.

With the advent of mass market digital communications applications and content distribution many access networks such as wireless networks cable networks and DSL Digital Subscriber Line networks are pressed for user capacity with for example EVDO Evolution Data Optimized HSPA High Speed Packet Access LTE Long Term Evolution WiMax Worldwide Interoperability for Microwave Access DOCSIS DSL and Wi Fi Wireless Fidelity becoming user capacity constrained. In the wireless case although network capacity will increase with new higher capacity wireless radio access technologies such as MIMO Multiple Input Multiple Output and with more frequency spectrum and cell splitting being deployed in the future these capacity gains are likely to be less than what is required to meet growing digital networking demand.

Similarly although wire line access networks such as cable and DSL can have higher average capacity per user compared to wireless wire line user service consumption habits are trending toward very high bandwidth applications and content that can quickly consume the available capacity and degrade overall network service experience. Because some components of service provider costs go up with increasing bandwidth this trend will also negatively impact service provider profits.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

As wireless networks such as mobile networks evolve towards higher bandwidth services which can include or require for example various levels of Quality of Service QoS e.g. conversational interactive data streaming data and or various end to end real time services that may benefit from QoS demands will increase for converged network services to facilitate such services for end to end services between networks e.g. to allow for control and or support for such services for example QoS support across network boundaries such as between wireless networks such as various service provider networks and IP networks such as the Internet and or other networks . While various efforts have attempted to address such QoS needs such as policy management frameworks for facilitating QoS end to end solutions there exists a need to facilitate various QoS requirements using Device Assisted Services DAS .

Accordingly Quality of Service QoS for Device Assisted Services DAS is provided. In some embodiments QoS for DAS is provided.

To establish a QoS channel differentiated services are typically available in which one class level of service has a higher priority than another to provide for differentiated services on a network such as a wireless network. For example in a wireless network various network elements functions can be provisioned and controlled to establish a single end or end to end QoS channel. In some embodiments a centralized QoS policy coordination and decision function using DAS techniques to assist in coordinating the QoS channel setup and control among the various elements of a wireless network is provided.

In some embodiments QoS channel refers to the logical communication channel connected to a device that provides a desired level of QoS service level. For example the QoS channel can be created with one or more QoS links in which each link represents a QoS enabled connection that spans a portion of the total end to end network communication path from a near end device to a far end device. For example the far end device can be on the same network or on a different network potentially with different access technology and or a different access network carrier. In some embodiments the QoS channel includes one or more QoS links in which each link in the channel is QoS enabled or one or more of the links in the channel is QoS enabled and others are not. As an example a QoS channel can include the following links a first device traffic path link a first device to access network equipment element link e.g. 2G 3G 4G wireless base station WiFi access point cable network head end DSLAM fiber aggregation node satellite aggregation node or other network access point node a first carrier core network a long haul IPX network a second carrier core network a second device to access network equipment element link and a second device traffic path link as similarly described herein with respect to various embodiments.

In some embodiments each of the links described above have the ability to provide QoS services for that segment of an overall QoS channel. In some embodiments the device traffic path link and or the device to access network equipment element link are QoS enabled but the carrier core network and or IPX network links are not QoS enabled. In some embodiments the core network and or IPX network have sufficient over provisioning of bandwidth that QoS is not limited by these network elements and for example can be limited by the device traffic link and or the device to access network equipment element link do not have sufficient excess bandwidth making it desirable to QoS enable these QoS channel links. A common example is a 2G 3G 4G wireless network in which a device traffic path link and the device to access network element link e.g. Radio Access Bearer RAB are QoS enabled while the carrier core network and IPX network links are not e.g. are provided at a best effort service level or other service levels .

In some embodiments a QoS session refers to the QoS enabled traffic for a given device that flows over a QoS channel or QoS link. This QoS traffic supports a QoS service activity. In some embodiments a QoS service activity includes a device service usage that is requested configured or preferably serviced with a given level of QoS. In some embodiments a device QoS activity is a combination of one or more of the following application destination source URL or other similar service identifier service provider network type traffic type content type network protocol session type QoS identifier time of day network capacity e.g. network busy state user service plan authorization or standing roaming home network status and or other criteria measures as similarly described herein. For example QoS service activities that are supported by QoS sessions can include VOIP traffic streaming video traffic differentiated access bandwidth during busy network periods real time interactive traffic such as network connected multimedia meetings e.g. shared presentations picture video voice and or other such applications services best effort interactive such as Internet browsing time sensitive services such as email message body delivery near real time interactive services such as SMS or push to talk background download services such as email downloads and other file transfers e.g. FTP and or truly background download services such as software updates.

In some embodiments various QoS levels or classes are supported. For example a conversation class can provide for real time traffic which is typically very delay sensitive but can tolerate bit errors and packet losses. The conversational class is typically used for Voice Over IP VOIP and video telephony in which users of such services benefit from the short delay features of the conversational class. A streaming class is similar to the conversational class except that the streaming class typically can tolerate more delay than the conversational class. The streaming class is generally used for when one end of the connection is a user e.g. human user and the other end is a machine computer e.g. for streaming content applications such as streaming of video such as movies or other video content . An interactive class is generally intended for traffic that allows delay variation while requiring reasonably low response time e.g. web browsing or other applications in which the channel can be unused for long periods of time but when a user makes a request for a new page data the response time should be reasonably low . A background class is generally used for lowest priority service usages e.g. typically used for e mail software updates and or other similar applications . In some embodiments various QoS classes or services are applicable to the conversational class. In some embodiments various QoS classes or services are also applicable to the streaming class. In some embodiments various QoS classes or services are also applicable to the interactive class but typically not applicable to the background class. As will now be apparent to one of ordinary skill in the art various other classes can be provided with lower or higher granularity based on service usage channel requirements and or network architectures.

In some embodiments a QoS link or a QoS channel supports one QoS session. In some embodiments a QoS link or a QoS channel supports multiple QoS sessions. In some embodiments QoS link provisioning is provided to setup the QoS traffic level for a given QoS session or group of QoS sessions.

In some embodiments a QoS channel is a single ended QoS channel or an end to end QoS channel. For example if a QoS channel is end to end then the QoS channel provisioning is accomplished in a coordinated manner for each QoS enabled link in the QoS channel. If a QoS channel is single ended then the network elements and or device participate in provisioning as much of one end of the QoS channel as possible leaving provisioning of the QoS for the other end of the channel as the responsibility of the device and or network elements that handle the traffic at the other end of the QoS channel. In some embodiments a single ended QoS channel includes another single ended QoS channel at the other end. In some embodiments only one end has single ended QoS channel enablement while the other end of the channel is a best effort service level which for example can be used where one end of the QoS channel has tighter constraints on traffic capacity or quality than the other end e.g. a VOIP call with one end that is QoS enabled on a 3G wireless network that has relatively tight bandwidth compared to a lightly loaded cable modem network device on the other end which may not need to be QoS enabled in order to achieve adequate voice quality .

In some embodiments a QoS request e.g. a QoS channel request or QoS service request is a request for a QoS provisioning event to enable a QoS channel for one or more QoS service activities. In some embodiments QoS availability assessment includes determining whether one or more of the links in a possible QoS channel are available e.g. based on network capacity and transmission quality to provision the necessary level of QoS for a requested QoS channel. In some embodiments a QoS request is initiated by a device a user an application and or a network element function as similarly described herein.

In some embodiments a service plan refers to the collection of access service capabilities and or QoS capabilities that are associated with a communications device. In some embodiments the access and or QoS capabilities are determined by the collection of access service control policies for the device. In some embodiments these service control policies are implemented in the network equipment. In some embodiments these access service control policies are implemented both in the device and in the network equipment. In some embodiments these access service control policies are implemented in the device. In some embodiments there are different levels of service control capabilities e.g. policies based on different levels of service plan payments or device standing or user standing. In some embodiments there are different levels of service control policies based on network type time of day network busy status and or other criteria measures as similarly described herein with respect to various embodiments. In some embodiments the access control and QoS control policies are based on the type of service activity being sought. In some embodiments the QoS level and access level available for a given service activity for a given device or user is determined by the policies associated with the service plan. In some embodiments a QoS authorization assessment is performed to determine whether a device or user has sufficient service plan standing to allow the requested level of QoS.

In some embodiments before a QoS channel or link is provisioned or before a QoS request is responded to or filled a QoS availability assessment is performed to determine whether sufficient communication channel resources are available to provision the necessary level of QoS for the QoS channel or link. In some embodiments this QoS availability assessment is determined by assessing the available QoS capacity for one or more necessary QoS links in the channel. For example the available QoS link capacity can be assessed for one or more of a device traffic path a device to access network equipment element link a core network link and or an IPX network link. If the QoS assessment shows that the necessary channel capacity and quality is available for the desired QoS level for one or more desired QoS service activities then a QoS channel request or QoS service request can be granted. In some embodiments a QoS link or QoS channel reservation process is provided to reserve QoS capacity and quality in advance of link or channel provisioning to ensure that the available QoS resources are not assigned between the time of QoS availability assessment and QoS channel provisioning.

In some embodiments the QoS availability assessment is performed after QoS authorization assessment. This prevents the unnecessary exercising of network elements when the device or user does not have sufficient service plan standing to receive the desired level of QoS even if it is available. This can be an important screening function performed on the device in the service processor or by a centralized network function such as the service controller e.g. or interchangeably the home agent HA Homer Location Register HLR Authentication Authorization and Accounting AAA server gateway function base station one of the gateways or other network element function . In some embodiments QoS availability is assessed without conducting a QoS authorization assessment or before receiving the response to a QoS authorization assessment.

In some embodiments a QoS channel is provisioned to create the QoS channel to support a QoS session e.g. a QoS service activity . In some embodiments QoS channel provision includes assigning routing and or otherwise causing the QoS session traffic to flow over one or more QoS links in the assigned QoS channel.

In some embodiments device assisted service traffic control and QoS apply readily and directly to the problems of managing a QoS device link for QoS channel provisioning. Accordingly in some embodiments a service provider is provided to assist in provisioning the device portion of the QoS channel. In some embodiments the service processor provisions the device link portion of the QoS channel by placing a higher priority on higher QoS level traffic. In some embodiments this QoS priority is implemented in a number of ways including routing the higher priority QoS traffic into first priority in the downstream and or upstream traffic queues. Upstream traffic queuing is performed directly in some embodiments by transmitting guaranteed bit rate traffic first at higher available throttling rates differentiated QoS traffic second with a controlled throttling rate best effort traffic third with possibly lower controlled throttled rates and or background traffic fourth when if bandwidth not needed by the higher levels of QoS traffic and at lower controlled throttling rates. For example downstream traffic can be handled by queuing traffic and delaying or preventing TCP acknowledgements to be returned for the lower levels of QoS priority while immediately passing the traffic and TCP acknowledgements for higher levels of QoS priority. The device link portion of the QoS channel is thus provisioned by assigning policies for the queuing priority delay throttle rate and TCP acknowledgement return rate for device traffic in accordance with the bandwidth that is available at any point in time for the device. In some embodiments various device service processor traffic control capabilities regulate or partially regulate QoS in accordance with a set of network policy instructions including in some embodiments a service plan policy set.

In some embodiments the device service processor establishes multiple QoS channels through the device traffic path with each QoS channel having traffic control policies as described herein with each QoS channel policy set creating a different class of QoS. In some embodiments employing this multiple QoS channel approach QoS for a given service activity is provided by routing the traffic for that QoS activity to the appropriate QoS channel with the appropriate QoS policy settings. The routing to the appropriate QoS channel can be provided using various techniques. For example the routing can be provided by applying a common service traffic control policy set to traffic associated with all QoS service activities that require or request the QoS provided by the common service traffic control policy set. The application of the service traffic control policy set can be accomplished in a number of ways utilizing the embodiments described for the policy implementation agent and the policy control agent described herein. In such embodiments the problem of assigning a QoS channel to a number of QoS service activities is reduced to applying a pre determined set of service traffic control policies to each of the QoS service activities with each pre determined set of service traffic control policies representing a different QoS class. The device can then manage the overall QoS for all traffic based on the available traffic capacity and quality the total aggregate traffic demand for each QoS traffic class and the policy rules that determine how each traffic class is provided with differential bit rate and traffic quality as compared to the other traffic classes for a given level of available traffic capacity and quality.

Based on the aggregate demand for each traffic QoS class and the traffic capacity and quality level available to the device the service processor can adjust the total available bit rate or percentage of available traffic capacity for each QoS class. For example in some embodiments the aggregate demand for the real time interactive traffic control class e.g. services such as VOIP emergency communication services or high performance real time competitive gaming can be determined and the QoS routing function on the device e.g. a QoS router agent function can first allocate enough constant bit rate traffic capacity from the available traffic capacity to satisfy these services with each QoS service activity that requires this QoS class being assigned to this QoS channel. As more QoS service activities require this traffic class the capacity allocated to the QoS channel out of the available device capacity is increased and when fewer QoS service activities require this traffic class the capacity for this QoS channel is released. In the event that the device does not have any more available capacity with a guaranteed bit rate QoS level then additional QoS service activities that desire require or request this QoS level will not be provided this QoS level and instead will either be provided with a lower QoS level or will not be allowed to connect to the access network. In some embodiments there can be a hierarchy among the possible QoS service activities so that if there is no more capacity available at a given service QoS level then the available capacity for that QoS class is provided to the service activities requiring that QoS from highest priority to lowest until the available QoS class capacity is consumed and then one or more QoS service activities that are too low on the priority list to obtain service with that QoS class are either bumped to a lower QoS class or are denied access. In some embodiments once the required capacity to satisfy the real time constant rate traffic needs is satisfied the remaining capacity available to the device is then divided among the other QoS channel classes in accordance with a priority policy with the priority policy being based on the relative priority of each service class the relative priority of each QoS service activity or a combination of the relative priority of each QoS service class and each QoS service activity. For example these relative priority policies can vary from device to device based on service plan selection device type user standing user group device location device network connection type of network time of day network busy state and or other criteria measures.

In some embodiments a QoS link is established between the device and an access network equipment element. For example such equipment element embodiments can include a 2G 3G 4G wireless base station a wireless access point a cable network head end a DSL network DSLAM a fiber network device traffic aggregator a satellite network device traffic aggregator a frame relay aggregation node an ATM aggregation node and or other network equipment. In some embodiments a logical communication channel is created between the device and the network equipment element with the logical communication channel supporting a given level of QoS or QoS class traffic policy set. For example the logical channel can include a RAB formed between a 2G 3G 4G base station and a wireless end point device. The RAB can be formed by controlling the media access control MAC parameters of the base station radio channel so that a given level of QoS class policies can be implemented. For example the RAB can support constant bit rate low latency communication traffic for guaranteed bit rate real time traffic or a differentiated high priority access channel for streaming traffic or a best effort random access channel for best effort traffic or an available unused capacity traffic for background traffic. The QoS channel link created in this manner can be dedicated to a single device or shared with a subset of devices or available to all devices. The QoS channel link created in this manner can be used by the device to support a single QoS activity as described herein or a group of QoS activities as described herein. It will now be apparent to one of ordinary skill in the art that similar settings for cable head end and cable modem MAC can yield similar QoS classes for QoS links for the cable modem case and that similar techniques can be applied for a wireless access point or a satellite system MAC to achieve similar QoS classes for QoS links. It will also now be apparent to one of ordinary skill in the art that by creating multiple logical channels in the device link and or adjusting the available access network capacity and quality for each logical device communication channel in the DSLAM or fiber aggregator similar QoS class QoS links can be established for the DSL and fiber distribution network cases.

In some embodiments the device service processor serves to route QoS service activities to the appropriate logical communication channel established for the desired QoS class supported by a QoS link between the device and the access network equipment element. In some embodiments the device service processor elements e.g. the policy implementation agent and or the policy control agent can be used in some embodiments to assign the same QoS traffic control policies to one or more QoS service activities that require the same QoS level. In a similar manner in some embodiments the device service processor elements can be used to assign or route service activity traffic for a given QoS class to the correct logical communication channel between the device and the access network element e.g. a 2G 3G 4G base station that supports the traffic control policies for the desired QoS class. For example a QoS service link that supports guaranteed bit rate and latency can be established with one or more RABs from a base station to the device and a second QoS service link can be established that supports differentiated preferred access for streaming content using one or more differentiated access RABs and a third best effort RAB can be used to support best effort traffic. Each of the required RABs is first requested and then provisioned as described herein based on the aggregate required capacity and quality for one or more QoS service activities that require or desire the specific QoS service class associated with the RAB logical channel policy parameters. Once the set of logical QoS channels is thus established the service processor e.g. QoS router agent function routes the traffic associated with each QoS service activity to the appropriate RAB. In some embodiments the service processor can detect increases or decreases in aggregate QoS class demand for each QoS class as QoS activities are initiated or terminated for that QoS class and the service processor can communicate the required increases or decreases in the RAB assignments required to support that logical QoS channel.

In some embodiments the access QoS link is established by direct communication from the device in which the device requests the QoS channel or link from the access network equipment element or the device requests the QoS channel or link from an intermediate networking device such as a service controller e.g. or a readily substituted device with similar features such as a home agent an HLR a mobile switching center a base station an access gateway a AAA system or a billing system . In some embodiments the device service processor bases the QoS channel or link request on an association the device performs to match a QoS service activity with a desired or required QoS class or QoS traffic control policy set. For example this association of QoS class or QoS traffic control policy set with QoS service activity can be determined by a predefined policy mapping that is stored on the device and used by the service processor. In some embodiments this policy mapping store is populated and or updated by a service controller e.g. or similar function as described herein . In some embodiments the mapping is determined by a service controller e.g. or similar function as described herein based on a report from the device of the QoS service activity that needs the QoS channel or link.

In some embodiments the required or desired QoS level for one or more QoS service activities is determined by a set of QoS service traffic control policies that are pre assigned to various QoS service activities. For example a given application can be pre assigned a QoS class. As another example a web service destination such as a VOIP service site can be assigned a QoS class. As another example a given application can have one QoS assignment level for general Internet traffic but have a QoS assignment for real time gaming traffic. As another example a real time broadcasting website can have a best effort QoS level assigned to programming information and general browsing and have a differentiated streaming QoS level for broadcast traffic content. In some embodiments detection of QoS need or QoS assignment request for a given activity can be assigned by a device service processor according to a predefined QoS policy rules table e.g. QoS activity table or can be determined by a service controller based on information reported by the device or can be requested by an application through a QoS application interface e.g. QoS API or can be determined by the nature of incoming traffic.

In embodiments in which both end points in the QoS channel participate in establishing an end to end QoS channel the required QoS level is determined and or communicated by the originating end point. In some embodiments the required QoS level is determined and or communicated by the receiving end point. In some embodiments the QoS level is determined and or communicated by the originating end point service controller e.g. or the access network element such as a base station the HLR home agent mobile switching center AAA gateway or other network element function . In some embodiments the QoS level is determined and or communicated by the receiving end point service controller e.g. or alternatively the access network element such as a base station the HLR home agent mobile switching center AAA gateway or other network element function . In some embodiments the receiving end point service controller e.g. or the access network element such as a base station the HLR home agent mobile switching center AAA gateway or other network function and the originating end point service controller e.g. or other similar function communicate with one another to coordinate establishment of the QoS channel between the end points.

In some embodiments the near end or originating end device service processor contacts the far end or terminating device service processor to initiate a QoS channel. In some embodiments the initiation of the QoS channel from the near end or originating device is performed automatically by the far end device when its service processor detects that a given level of QoS is needed for the communication between the two devices. In some embodiments the near end or originating device service processor detects the need for a QoS channel to the far end or terminating device and contacts a central network resources such as the service controller e.g. or other equipment element with similar function for this purpose and the service controller provisions the far end of the QoS channel either by communicating directly with the far end device or by communicating with the far end device s service controller e.g. or other equipment element with similar function for this purpose . In some embodiments in which the far end device service controller is contacted to assist in provisioning the QoS channel there is a look up function to determine the address of the far end service controller based on a look up index formed from some aspect of the far end device credentials e.g. phone number SIM ID MEID IMSI IP address user name and or other device credentials .

In some embodiments the mapping of QoS service activity to the desired level of QoS class or QoS traffic control policies is determined by providing a QoS API in the device service processor that applications use to request a QoS class or QoS channel connection. In some embodiments an API is provided so that application developers can create application software that uses the standard interface commands to request and set up QoS channels. In some embodiments the API does one or more of the following accepts QoS requests from an application formats the QoS channel request into a protocol appropriate for transmission to network equipment responsible for assessing QoS channel availability e.g. including possibly the device traffic control system coordinates with other network elements e.g. including possibly the device traffic control system to reserve a QoS channel coordinates with other network elements e.g. including possibly the device traffic control system to provision a QoS channel informs the application that the desired QoS channel can be created or not and or coordinates with other network elements e.g. including possibly the device traffic control system to connect the application with the desired QoS channel class. In some embodiments the QoS API accepts the application QoS request and communicates and possibly coordinates with one or more QoS network equipment elements such as a base station cable head end or access point. In some embodiments the QoS API accepts the QoS request from the application and communicate and possibly coordinates with an intermediate network element such as a service processor e.g. or other similar function as described herein . In some embodiments the QoS API assesses the QoS service plan standing for the device or user before sending QoS channel requests to other network elements and only initiates the QoS request sequence if required service plan authorization is in place. In this manner the potentially complex process of establishing a QoS channel with all the specific equipment communication protocols that typically need to be supported to assess QoS channel availability and provision the QoS channel are simplified into a limited set of API commands that are easy for an application development community to learn about and use for QoS differentiated services and applications.

In some embodiments local traffic control on the device service processor is combined with traffic control in the link between the device and the access network equipment element. In this manner both the device traffic control path QoS link and the device to access network element QoS link can be coordinated for best device QoS performance results given the available capacity and quality of the access network traffic for the device. In some embodiments the policies for how the device manages local traffic control establishes access network element logical channels e.g. RABs and routes traffic to and from the access network element logical channels is all determined by predefined policy rules loaded onto the device by the service controller or other equivalent network element . In some embodiments these policies are determined in the service controller itself.

In some embodiments a QoS user interface e.g. QoS UI is presented to the Device user. In some embodiments the QoS UI notifies the user what level of QoS services the device is authorized to receive based on the service plan selection. In some embodiments the QoS UI notifies the user what level of QoS services are available on the present network the device is connected to at the present time. In some embodiments the QoS UI notifies the user when a level of QoS service that is higher than that authorized by the user service plan is required or desirable for a given service activity that the device has initiated. In some embodiments the QoS UI provides the user with a set of one or more upgrade options to upgrade the service plan to include a higher level of QoS for one or more service activities. In some embodiments the QoS UI provides the user with an opportunity to specify what level of QoS the user would like to employ for one or more service usage activities. In some embodiments the QoS UI allows the user to specify a service plan setting that provides differentiated QoS during times when the network is busy. In some embodiments the QoS UI allows the user to purchase one or more grades of service QoS with either a post pay for a pre defined service period and one or more pre defined service usage limits by QoS class a pre pay for one or more pre defined service usage limits by QoS class or another payment system for differentiated QoS services. In some embodiments the QoS UI provides the user with an opportunity to QoS enable or pay for QoS services for a connection that is initiated by an incoming connection to the device.

In some embodiments QoS for DAS techniques include verifying that the device is properly implementing the QoS traffic control policies for example in accordance with a service plan. This ensures that errors hacking user device software settings manipulations or other malware events do not result in inappropriate levels of QoS for a given device or group of devices. Accordingly in some embodiments the traffic control and QoS verification techniques described herein are employed to verify that the proper level of QoS is applied for a given service usage activity in accordance with a QoS priority policy. For example verification of QoS channel request policy rules behavior can be implemented in a variety of ways including as an example monitoring device QoS channel requests and comparing the level of QoS requested with the level of QoS the device is authorized to receive in the service plan in effect for the device. Verification of proper QoS channel usage behavior by a device can be implemented in a variety of ways including for example monitoring network based reports of QoS service usage and comparing the network based reports against the service policy rules that should be in effect given the device service plan. Verification of proper device traffic control to implement a QoS service policy that is in effect can be accomplished in a variety of ways by verifying that the appropriate traffic control policy rules are being properly implemented as described herein.

In some embodiments the QoS router prioritizes traffic on the device. In some embodiments the QoS router connects the QoS enabled session to the RAB that has the proper QoS level. In some embodiments one session is routed to the RAB. In some embodiments more than one session can be routed to an RAB. In some embodiments multiple RABs providing multiple QoS levels are created to the device and the QoS router routes each service activity to the RAB dictated by the QoS policy rules in effect on the device.

In some embodiments the network collects service usage charges for different QoS classes. In some embodiments there is differentiated service charging for the different classes of QoS service usage. As an example since guaranteed bit rate traffic consumes network resources whether the traffic capacity is used or not there can be a time element involved in the charging calculations. As a more detailed example guaranteed bit rate services can be charged by the total bandwidth provisioned to the device at a given time multiplied by the amount of time that that bandwidth is made available. In some embodiments differentiated access traffic that has higher QoS than best effort traffic but is not guaranteed bit rate can be charged at a higher rate than best effort traffic but lower than guaranteed bit rate. In some embodiments such traffic can be charged based on the time the QoS channel is made available and the total amount of data transmitted over the channel or can only be based on the total amount of data transmitted over the channel. Best effort traffic is charged in some embodiments based only on the total amount of data used with the data charges being less than differentiated streaming access services. Background data services in some embodiments are charged at the lowest rate possibly with only certain times of the day or periods of low network traffic demand being available for such services and with the service being based on total data transmitted. In some embodiments all QoS service levels can be charged based on a fixed price for a fixed charging period possibly with a service usage cap with additional charges if the service cap is exceeded. In such fixed price scenario embodiments the price charged is again higher for higher levels of QoS.

In some embodiments the network equipment e.g. access network element gateways AAA service usage storage systems home agent HLR mobile data center and or billing systems record and report service usage for one or more of the QoS service classes used by the device. In some embodiments the device service processor records and reports service usage for one or more of the QoS service classes used by the device and reports the QoS service class usage to the service controller e.g. or another substitute network element . In some embodiments in which the device is recording reporting usage for one or more QoS service classes it is important to verify the device service usage reports to ensure that the device usage reports are not distorted tampered with and or otherwise in error. In some embodiments verifying service usage reports against service usage that should be occurring given the service control policies in place on the device service processor agent functional operation verification test service usage events agent query response sequences device service processor software protection techniques device service processor software environment checks and several other techniques are provides as described herein. For example using one or more of these verification techniques can provide a verifiable device assisted QoS service usage charging system.

In some embodiments device assisted traffic control is provided for managing network congestion as follows. For example when a given base station or group of base stations experience traffic demand that is high relative to the available capacity and or service quality that can be provided and such a condition is detected by means of network busy state assessment as described below then a service controller e.g. or another interchangeable network function can issue traffic control throttling policies to the devices in accordance with a measure of the excess traffic demand the one or more base stations is experiencing. For example the device service processors connected to an overly busy base station can be instructed to reduce the traffic control priority for one or more classes of QoS traffic reducing the queuing priority throttling rate delay and or access allowance for some or all of one or more classes of traffic. As another example background download processes such as software updates can be turned off completely or throttled back significantly. As another example best effort traffic such as Internet browsing can be throttled or reduced for a group of devices connected to base stations experiencing excess traffic demand. As another example a policy can be implemented on the devices connected to busy base stations in which the device is allowed to browse or conduct other best effort service activities at a relatively high throttling rate for a period of time but if the device uses more than a certain amount of service e.g. total data downloaded and or uploaded in a certain period of time then the device may be traffic controlled according to an adaptive throttling policy as described herein. In some embodiments higher QoS level traffic cannot be throttled in such circumstances such as VOIP traffic where real time guaranteed bit rate is important to meet user service needs or expectations while lower priority traffic such as interactive browsing and or background download are throttled and or blocked. In some embodiments the QoS availability assessment processes described herein are adjusted so that higher QoS channels are not provided and provisioned in times or locations in which a given base station or group of base stations experience excess demand or demand above a given threshold.

In some embodiments users or devices that have service plans with higher QoS levels or service plans with higher priority during busy network periods have different traffic control policies applied to them that result in a higher level of traffic performance and or a higher level of QoS service availability. For example emergency service workers can be given higher traffic control access policies that result in differentiated services during peak busy times on the network or a portion of the network. In some embodiments users can obtain a premium service plan for differentiated access during peak busy time periods or may use higher levels of QoS service settings and or service plans to achieve differentiated service during peak busy periods. As another example services that demand high levels of QoS classes such as real time voice services instant messaging push to talk differentiated video streaming and or interactive gaming are not traffic controlled to the same extent that other lower priority services or lower class service plans are traffic controlled during peak busy times. For example this type of service differentiation can also be applied based on device type user group user standing user reward zone points and or other criteria measures as similarly described herein.

In some embodiments the decision to reduce the access traffic control settings as described above is made by the device service processor based on the device s assessment of the network capacity which can be determined using various techniques as described herein. In some embodiments the decision to reduce the access traffic control settings as described above is made by a service controller e.g. or other interchangeable network equipment element or elements as described herein connected to the device that provides instructions to the device to adjust the access policy settings. For example the service controller can obtain the network capacity information from access equipment elements from device reports of traffic capacity and or quality as described herein or from reports on traffic capacity and or quality obtained from dedicated devices used for the purpose of assessing network capacity. In some embodiments the decision to reduce the access traffic control settings as described above is based on the time of day or day of week or both to accommodate cyclical patterns in network capacity and traffic demand.

In some embodiments a service controller e.g. or another interchangeable network equipment element or elements as described herein assesses network busy state and then controls device traffic demand by reducing the offered capacity for one or more service classes supported by the access network equipment elements such as a wireless base station. In such embodiments the service controller e.g. or similar function gathers the network capacity information with one of the techniques described herein and instructs one or more of the access network equipment elements to reduce the offered capacity for one or more levels of service QoS to one or more of the devices connected to the access network equipment elements. For example the determination of which devices to throttle back can be made based on an equal throttling of all devices of a given service plan status or based on the device traffic usage patterns in the recent past as described herein or based on a combination of service plan status and recent traffic usage patterns.

In some embodiments the device is enabled with ambient services that have differentiated QoS services as part of the ambient service offering. For example this can be accomplished using the pre assigned QoS policies for a given service activity set within the ambient service or using an ambient service application that requests QoS through the QoS API. Other embodiments for providing QoS differentiated service activities within ambient service offerings will now be apparent to one of ordinary skill in the art.

In some embodiments a QoS service control policy is adapted as a function of the type of network the device is connected to. For example the QoS traffic control policies and or the QoS service charging policies can be different when the device is connected to a wireless network e.g. a 3G 4G network where there is in general less available QoS enabled traffic capacity than when the device is connected to a wired network e.g. a cable or DSL network where there is in general a higher level of QoS capacity available . In such embodiments the device service processor and the service controller can coordinate to adapt the QoS service control policies and or the QoS service charging policies to be different depending on which network the device is connected to. Similarly the device QoS service control policy and or QoS service charging policy can also be adapted based on whether the device is connected to a home wireless network or a roaming wireless network.

In some embodiments various of the QoS related techniques described herein are performed on the device using DAS techniques and or on the service controller in secure communication with a verified service processor executed on the device using DAS techniques. In some embodiments various of the QoS related techniques described herein are performed by in coordination communication with one or more intermediate network elements functions for assisting in various QoS functions.

As shown includes a 4G 3G 2G wireless network operated by for example a central provider. As shown various wireless devices are in communication with base stations for wireless network communication with the wireless network e.g. via a firewall and other devices are in communication with Wi Fi Access Points APs or Mesh for wireless communication to Wi Fi Access CPE in communication with central provider access network . In some embodiments one or more of the devices are in communication with other network element equipment that provides an access point such as a cable network head end a DSL network DSLAM a fiber network aggregation node and or a satellite network aggregation node. In some embodiments each of the wireless devices includes a service processor as shown e.g. executed on a processor of the wireless device and each service processor connects through a secure control plane link to a service controller e.g. using encrypted communications .

In some embodiments service usage information includes network based service usage information e.g. network based service usage measures or CDRs which can for example be generated by service usage measurement apparatus in the network equipment which is obtained from one or more network elements e.g. BTS BSCs RAN Gateways not shown Transport Gateways not shown Mobile Wireless Center HLRs AAA Service Usage History CDR Aggregation Mediation Feed or other network equipment . In some embodiments service usage information includes micro CDRs. In some embodiments micro CDRs are used for CDR mediation or reconciliation that provides for service usage accounting on any device activity that is desired. In some embodiments each device activity that is desired to be associated with a billing event is assigned a micro CDR transaction code and the service processor is programmed to account for that activity associated with that transaction code. In some embodiments the service processor periodically reports e.g. during each heartbeat or based on any other periodic push and or pull communication technique s micro CDR usage measures to for example the service controller or some other network element. In some embodiments the service controller reformats the heartbeat micro CDR usage information into a valid CDR format e.g. a CDR format that is used and can be processed by an SGSN or GGSN or other network elements equipment used authorized for generating or processing CDRs and then transmits it to a network element function for CDR mediation e.g. CDR Storage Aggregation Mediation Feed .

In some embodiments CDR mediation is used to account for the micro CDR service usage information by depositing it into an appropriate service usage account and deducting it from the user device bulk service usage account. For example this technique provides for a flexible service usage billing solution that uses pre existing solutions infrastructures and or techniques for CDR mediation and billing. For example the billing system e.g. billing system or billing interface processes the mediated CDR feed from CDR mediation applies the appropriate account billing codes to the aggregated micro CDR information that was generated by the device and then generates billing events in a manner that does not require changes to the existing billing systems e.g. using new transaction codes to label the new device assisted billing capabilities . In some embodiments network provisioning system provisions various network elements functions for authorization in the network such as to authorize certain network elements functions e.g. CDR storage aggregation mediation feed or other network elements functions for providing micro CDRs reformatted micro CDRs and or aggregated or reconciled CDRs.

As shown in a CDR storage aggregation mediation feed is provided. In some embodiments the CDR storage aggregation mediation feed receives stores aggregates and mediates micro CDRs received from mobile devices . In some embodiments the CDR storage aggregation mediation feed also provides a settlement platform using the mediated micro CDRs as described herein. In some embodiments another network element provides the settlement platform using aggregated and or mediated micro CDRs e.g. central billing interface and or another network element function .

In some embodiments various techniques for partitioning of device groups are used for partitioning the mobile devices e.g. allocating a subset of mobile devices for a distributor an OEM a MVNO and or another partner or entity . As shown in a MVNO core network includes a MVNO CDR storage aggregation mediation feed a MVNO billing interface and a MVNO billing system and other network elements as shown in . In some embodiments the MVNO CDR storage aggregation mediation feed receives stores aggregates and mediates micro CDRs received from mobile devices e.g. MVNO group partitioned devices .

Those of ordinary skill in the art will appreciate that various other network architectures can be used for providing device group partitions and a settlement platform and is illustrative of just one such example network architecture for which device group partitions and settlement platform techniques described herein can be provided.

In some embodiments CDR storage aggregation mediation feed e.g. service usage including a billing aggregation data store and rules engine is a functional descriptor for in some embodiments a device network level service usage information collection aggregation mediation and reporting function located in one or more of the networking equipment apparatus systems attached to one or more of the sub networks shown in e.g. central provider access network and or central provider core network which is in communication with the service controller and a central billing interface . As shown in service usage provides a function in communication with the central provider core network . In some embodiments the CDR storage aggregation mediation feed function is located elsewhere in the network or partially located in elsewhere or integrated with as part of other network elements. In some embodiments CDR storage aggregation mediation feed functionality is located or partially located in the AAA server and or the mobile wireless center Home Location Register HLR as shown in communication with a DNS DHCP server . In some embodiments service usage functionality is located or partially located in the base station base station controller and or base station aggregator collectively referred to as base station in . In some embodiments CDR storage aggregation mediation feed functionality is located or partially located in a networking component in the central provider access network a networking component in the core network the central billing system the central billing interface and or in another network component or function. This discussion on the possible locations for the network based and device based service usage information collection aggregation mediation and reporting function e.g. CDR storage aggregation mediation feed can be easily generalized as described herein and as shown in the other figures and embodiments described herein by one of ordinary skill in the art. Also as shown in the service controller is in communication with the central billing interface e.g. sometimes referred to as the external billing management interface or billing communication interface which is in communication with the central billing system . As shown in an order management and subscriber management are also in communication with the central provider core network for facilitating order and subscriber management of services for the devices in accordance with some embodiments.

In some embodiments a service processor download is provided which provides for periodical downloads updates of service processors e.g. service processor . In some embodiments verification techniques include periodically updating replacing and or updating an obfuscated version of the service processor or performing any of these techniques in response to an indication of a potential compromise or tampering of any service processor functionality and or QoS functionality executed on or implemented on the device .

In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements provides a device network level service usage information collection aggregation mediation and reporting function. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements collects device generated assisted service usage information e.g. micro CDRs for one or more devices on the wireless network e.g. devices and provides the device generated service usage information in a syntax and a communication protocol that can be used by the wireless network to augment or replace network generated usage information for the one or more devices on the wireless network. In some embodiments the syntax is a charging data record CDR and the communication protocol is selected from one or more of the following 3GPP 3GPP2 or other communication protocols. In some embodiments as described herein the CDR storage aggregation mediation feed collects receives micro CDRs for one or more devices on the wireless network e.g. devices . In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements includes a service usage data store e.g. a billing aggregator and a rules engine for aggregating the collected device generated service usage information. In some embodiments the network device is a CDR feed aggregator and the CDR storage aggregation mediation feed e.g. other network elements and or various combinations of network elements also aggregates network based CDRs and or micro CDRs for the one or more devices on the wireless network applies a set of rules to the aggregated CDRs and or micro CDRs using a rules engine e.g. bill by account transactional billing revenue sharing model and or any other billing or other rules for service usage information collection aggregation mediation and reporting and communicates a new set of CDRs for the one or more devices on the wireless network to a billing interface or a billing system e.g. providing a CDR with a billing offset by account service . In some embodiments a revenue sharing platform is provided using various techniques described herein.

In some embodiments the CDR storage aggregation mediation feed e.g. or other network elements and or various combinations of network elements communicates a new set of CDRs e.g. aggregated and mediated CDRs and or micro CDRs that are then translated into standard CDRs for a given wireless network for the one or more devices on the wireless network to a billing interface e.g. central billing interface or a billing system e.g. central billing system . In some embodiments the CDR storage aggregation mediation feed e.g. or other network elements and or various combinations of network elements communicates with a service controller e.g. service controller to collect the device generated service usage information e.g. micro CDRs for the one or more devices on the wireless network. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements communicates with a service controller in which the service controller is in communication with a billing interface or a billing system. In some embodiments the CDR storage aggregation mediation feed e.g. or other network elements and or combinations of network elements communicates the device generated service usage information to a billing interface or a billing system. In some embodiments the CDR storage aggregation mediation feed e.g. other network elements and or various combinations of network elements communicates with a transport gateway and or a Radio Access Network RAN gateway to collect the network generated based service usage information for the one or more devices on the wireless network. In some embodiments the service controller communicates the device assisted service usage information e.g. micro CDRs to the CDR storage aggregation mediation feed e.g. or other network elements and or various combinations of network elements .

In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs rules for performing a bill by account aggregation and mediation function. In some embodiments the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs rules for performing a service billing function as described herein and or for performing a service transactional revenue sharing function as described herein. In some embodiments the service controller in communication with the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs a rules engine for aggregating and mediating the device assisted service usage information e.g. micro CDRs . In some embodiments a rules engine device in communication with the CDR storage aggregation mediation feed and or other network elements or combinations of network elements performs a rules engine for aggregating and mediating the device assisted service usage information.

In some embodiments the rules engine is included in e.g. integrated with part of the CDR storage aggregation mediation feed . In some embodiments the rules engine and associated functions as described herein is a separate function device. In some embodiments the service controller performs some or all of these rules engine based functions as described herein and communicates with the central billing interface . In some embodiments the service controller performs some or all of these rules engine based functions as described herein and communicates with the central billing system .

In some embodiments a settlement platform service is provided. For example micro CDRs can be aggregated and mediated to associate service usage for one or more services used by a communications device e.g. a user of the communications device . A rules engine or another function can determine a revenue share allocation for the service usage for a particular service to determine the settlement for such service usage for the revenue sharing allocation model and to distribute accounting and settlement information to one or more of carriers distribution partners MVNOs wholesale partners and or other partners or entities. In some embodiments the service is a transactional service.

In some embodiments duplicate CDRs are sent from the network equipment to the billing system that is used for generating service billing. In some embodiments duplicate CDRs are filtered to send only those CDRs records for devices controlled by the service controller and or service processor e.g. managed devices . For example this approach can provide for the same level of reporting lower level of reporting and or higher level of reporting as compared to the reporting required by the central billing system .

In some embodiments a bill by account billing offset is provided. For example bill by account billing offset information can be informed to the central billing system by providing a CDR aggregator feed that aggregates the device assisted service usage data feed to provide a new set of CDRs for the managed devices to the central billing interface and or the central billing system . In some embodiments transaction billing is provided using similar techniques. For example transaction billing log information can be provided to the central billing interface and or the central billing system .

In some embodiments the rules engine e.g. performed by the service usage or another network element as described herein provides a bill by account billing offset. For example device assisted service usage information e.g. micro CDRs includes a transaction type field or transaction code e.g. indicating a type of service for the associated service usage information . For example the rules engine can apply a rule or a set of rules based on the identified service associated with the device generated service usage information to determine a bill by account billing offset e.g. a new CDR can be generated to provide the determined bill by account billing offset . In some examples the determined bill by account billing offset can be provided as a credit to the user s service usage account e.g. a new CDR can be generated with a negative offset for the user s service usage account such as for network chatter service usage or transactional service usage or for any other purposes based on one or more rules performed by the rules engine .

As another example for a transactional service a first new CDR can be generated with a negative offset for the user s service usage account for that transactional service related usage and a second new CDR can be generated with a positive service usage value to charge that same service usage to the transactional service provider e.g. Amazon eBay or another transactional service provider . In some embodiments the service controller generates these two new CDRs and the service usage stores aggregates and communicates these two new CDRs to the central billing interface . In some embodiments the service controller generates these two new CDRs and the service usage stores aggregates and communicates these two new CDRs to the central billing interface in which the central billing interface applies rules e.g. performs the rules engine for determining the bill by account billing offset .

In some embodiments the service controller sends the device generated CDRs to the rules engine e.g. a service usage data store and rules engine such as CDR storage aggregation mediation feed and the rules engine applies one or more rules such as those described herein and or any other billing service usage related rules as would be apparent to one of ordinary skill in the art. In some embodiments the service controller generates CDRs similar to other network elements and the rules e.g. bill by account are performed in the central billing interface . For example for the service controller to generate CDRs similar to other network elements in some embodiments the service controller is provisioned on the wireless network e.g. by network provision system and behaves substantially similar to other CDR generators on the network .

In some embodiments the service controller is provisioned as a new type of networking function that is recognized as a valid authorized and secure source for CDRs by the other necessary elements in the network e.g. CDR storage aggregation mediation feed . In some embodiments if the necessary network apparatus only recognize CDRs from certain types of networking equipment e.g. a RAN gateway or transport gateway then the service controller provides authentication credentials to the other networking equipment that indicate that it is one of the approved types of equipment for providing CDRs. In some embodiments the link between the service controller and the necessary CDR aggregation and mediation equipment is secured authenticated encrypted and or signed.

In some embodiments the CDR storage aggregation mediation feed discards the network based service usage information e.g. network based CDRs received from one or more network elements. In these embodiments the service controller provides the device assisted service usage information e.g. device based CDRs or micro CDRs to the CDR storage aggregation mediation feed e.g. the CDR storage aggregation mediation feed can just provide a store aggregate and communication function s as it is not required to mediate network based CDRs and device assisted CDRs and the device based service usage information is provided to the central billing interface or the central billing system .

In some embodiments the device based CDRs e.g. micro CDRs and or new CDRs generated based on execution of a rules engine as described herein are provided only for devices that are managed and or based on device group service plan or any other criteria categorization and or grouping such as based on ambient service or ambient service provider or transactional service or transactional service provider.

In some embodiments QoS for DAS includes a service processor e.g. any device assisted element function that facilitates coordination for and or provisions wireless access radio access bearers e.g. RABs . In some embodiments the service processor determines whether a request for QoS is authorized e.g. according to QoS service level user standing available local network capacity e.g. as reported by other device s and or network . In some embodiments device QoS capacity demand reports provide and or augment network capacity demand reports.

In some embodiments QoS for DAS includes a service controller e.g. any network device based service control element function that facilitates coordination for and or provisions wireless access radio access bearers e.g. RABs on a device e.g. a communications device such as a mobile wireless communications device and or an intermediate networking device on network and or on device plus network. In some embodiments the service controller provides device QoS capacity demand reports to other network equipment elements functions and then also provisions the RAB channel based on various criteria and determinations.

In some embodiments QoS for DAS provides for device assisted monitoring information and or functionality to facilitate QoS without and or to assist network based monitoring information and or functionality e.g. Deep Packet Inspection DPI and or provides such monitoring information and or functionality that may not be available via network based monitoring information and or functionality e.g. encrypted activities on the device may not be accessible by DPI or other network based techniques . For example QoS for DAS can assist in the QoS setup to facilitate the QoS setup and provide such information that may not otherwise be available using network based only techniques. For example device assisted activity and or service monitoring techniques can assist in classifying the QoS for the monitored activity and or service using for example a QoS activity map e.g. as described herein or other similar techniques . For example using such device assisted techniques eliminates and or minimizes DPI or other network based techniques that can give rise to privacy concerns issues network neutrality concerns issues and or otherwise may not be able to provide similar or equivalent granular service activity monitoring as discussed above and or also off loads such processing from the network e.g. network elements devices functionality to the communications devices e.g. at least for such communications devices that can perform such functions based on their processing and or memory capabilities as would be apparent to one of ordinary skill in the art . In some embodiments QoS for DAS includes the service provider for providing an initial authorization clearance for a QoS request e.g. using various techniques described herein and the service controller determines if the QoS request should be authorized e.g. based on various QoS authorization clearance approval criteria e.g. QoS activity maps and or QoS request rule and or network capacity as described herein . In some embodiments QoS for DAS includes the service provider for providing a QoS request including a QoS class to the service controller and the service controller determines if the QoS request should be authorized as described herein.

In some embodiments QoS for DAS includes providing or facilitating reports for base station BTS for network capacity e.g. sector channel busy state information or network capacity usage availability and or network capacity expected demand based on for example one or more of the following monitored application usage on the communications device monitored user activity on the communications device location of the communications other available networks and or other monitored or determined activity service usage measure and or metric. In some embodiments at or after execution of an application that is determined to require network service usage e.g. may require increased wireless network bandwidth such as based on a service usage activity map QoS for DAS sends information to the network e.g. a network controller or other network device element function that capacity demand is forthcoming for the communications device e.g. potentially initiating a provisioning of a QoS radio access bearer RAB or other type of RAB .

In some embodiments network capacity e.g. busy state information is collected from one or more communications devices in communication with a wireless network e.g. network capacity usage information measured from each respective communications device s perspective is determined and stored by the service processor on each respective communications device and reported to the service controller and the service controller e.g. or another network element function uses this information to determine what resources are available for allocation to various levels of QoS e.g. to respond to facilitate various QoS requests and or to workload balance across multiple base stations and or networks e.g. cellular Wi Fi and or other wireless networks .

In some embodiments the service processor executed on the communications device sends a QoS request e.g. a wireless network bearer channel reservation request or Radio Access Bearer RAB request to the service controller. The service controller verifies the request using various verification techniques as described herein. In some embodiments the service controller facilitates coordination of various device QoS requests with one or more base stations BTSs in communication with the communications device to provide for the requested QoS reservation to facilitate the new QoS session. In some embodiments the service controller provides a QoS routing function by for example providing various QoS routing instructions to a device service processor e.g. aggregating prioritizing queuing authorizing allocating reservations RABs denying re routing such as to other BTSs and or other networks and or otherwise managing QoS requests in which the BTS may or may not be QoS aware. For example QoS priority can be based on activity e.g. service usage and or application service level user standing network capacity time of day and or QoS priority can be purchased on a transaction basis a session basis a pre pay basis or a plan basis. As another example QoS priority can also vary by device type user within a group group application type content type or any other criteria or measure and or any combination thereof. In some embodiments the service controller also facilitates coordination of various device QoS requests with other network elements functions for QoS implementation and management to provide for an end to end QoS solution.

In some embodiments QoS can be symmetric for two mobile devices or asymmetric. In some embodiments QoS resource availability can be from communications devices BTS s other network functions e.g. service control service controller and or any other network elements functions or any combination thereof. In some embodiments the service controller provides QoS demand information to another network element function. In some embodiments the service controller provides the central aggregator and policy decision point PDP . In some embodiments the service controller controls e.g. at least in part QoS related functions for communications devices BTS s and or a combination of both.

In some embodiments charging e.g. monitoring and or determining associating charging or billing for QoS service usage transactions is determined using various techniques described herein. For example the service processor can assist in charging for QoS activities. In some embodiments the service processor uses device assisted Charging Data Records CDRs or micro CDRs to assist in charging for QoS activities e.g. using QoS class related transaction codes as described herein with respect to various embodiments. In some embodiments charging for QoS is performed in whole or in part by one or more network elements functions e.g. service controller SGSN GGSN other gateways and or billing interfaces servers .

In some embodiments service usage information includes network based service usage information. In some embodiments the network based service usage information includes network based CDRs. In some embodiments service usage information includes device based service usage information. In some embodiments device based service usage information includes device assisted CDRs also referred to herein as micro CDRs as described herein. In some embodiments micro CDRs are used for CDR mediation or reconciliation that provides for service usage accounting on any device activity that is desired e.g. providing granular service usage information such as based on application layer service usage monitoring transaction service usage monitoring QoS activities sessions transactions and or other types of service usage information . In some embodiments each device includes a service processor e.g. a service processor executed on a processor of a communications device such as a mobile device or an intermediate networking device that can communicate with a wireless network .

In some embodiments each device activity that is desired to be associated with a billing event e.g. for a QoS related billing event is assigned a micro CDR transaction code and the service processor is programmed to account for that activity associated with that transaction code e.g. various transaction codes can be associated with service usage associated with certain services applications and or based on QoS classes or priorities respectively which can be used for providing granular service usage for these various Internet network based services sites transactions and or any other Internet network based services sites which can include transactional based services . For example using these techniques as described herein essentially any type of device activity e.g. including QoS classes and prioritization can be individually accounted for and or controlled e.g. throttled restricted and or otherwise controlled as desired . In some embodiments the service processor periodically reports e.g. during each heartbeat or based on any other periodic push and or pull communication technique s micro CDR usage measures to for example a service controller or some other network element function. In some embodiments the service controller reformats the heartbeat micro CDR usage information into a valid CDR format e.g. a CDR format that is used and can be processed by an SGSN or GGSN or some other authorized network element function for CDRs and then transmits the reformatted micro CDRs to a network element function for performing CDR mediation.

In some embodiments CDR mediation is used to properly account for the micro CDR service usage information by depositing it into an appropriate service usage account and deducting it from the user device bulk service usage account. For example this technique provides for a flexible service usage billing solution that uses pre existing solutions for CDR mediation and billing. For example the billing system can process the mediated CDR feed from CDR mediation apply the appropriate account billing codes to the aggregated micro CDR information that was generated by the device and then generate billing events in a manner that does not require changes to existing billing systems infrastructures and techniques e.g. using new transaction codes to label the new device assisted billing capabilities .

In some embodiments the various QoS techniques performed on or by the communications device e.g. using a service processor to provide or assist in providing QoS session provisioning QoS policy management QoS policy enforcement and or QoS charging such as QoS charging records and reports are verified.

For example a QoS request QoS related policy rules e.g. QoS activity map QoS related service plan and or service policy settings and implementation QoS policy enforcement and QoS charging are verified e.g. periodically per transaction and or based on some other criteria metric . In some embodiments verification techniques include one or more of the following compare a network based service usage measure with a first service policy associated with the communications device compare a device assisted service usage measure with the first service policy compare the network based service usage measure to the device assisted service usage measure perform a test and confirm a device assisted service usage measure based on the test perform a User Interface UI notification e.g. which can include a user authentication password question answer challenge and or other authentication technique and other similar verification techniques as will now be apparent. Accordingly in some embodiments QoS for DAS closes the loop for verification of various QoS related techniques such as QoS requests QoS grants QoS usage and or QoS charging. In some embodiments the service processor and the service controller serve as a verifiable QoS management coordination system for other QoS elements functions in network. In some embodiments if such or other verification techniques determine or assist in determining that a QoS request QoS report and or QoS policy behavior does not match expected requests reports and or policy then responsive actions can be performed for example the communications device can be suspended quarantined and or flagged for further analysis scrutiny to determine whether the device is malfunctioning needs updating has been tampered with or compromised is infected with malware and or if any other problem exists.

In some embodiments the communications device e.g. the service processor maintains a QoS flow table that associates or maps device activity to QoS level class to RAB QoS channel and in some embodiments the communications device also informs a QoS management network function element of the relative priority of the QoS flows for the communications device e.g. based on or using the QoS flow table . In some embodiments the service controller receives or collects information from the communications device and maintains such a QoS flow table for the communications device and in some embodiments the service controller also informs a QoS management network function element of the relative priority of the QoS flows for the communications device e.g. based on or using the QoS flow table . In some embodiments flows can be assigned to activities originating at the communications device in a transparent way or simply by activity class or user preference or using other techniques.

In some embodiments the communications device maintains a table of QoS billing rates scheduled transmission times and other QoS related information to implement an overlay MAC at the data networking level to manage QoS on legacy networks that are not QoS MAC enabled and or do not have the various functionality to support QoS controls e.g. and such techniques can also be used to provide for QoS functionality across different networks . In some embodiments QoS related policies are exchanged between roaming and home service controllers to facilitate QoS support while roaming on a non home network s .

In some embodiments the communications device serves as a network capacity indicator e.g. collecting network capacity information for a local cell and communicating or reporting that network capacity information to the service controller . For example permanent local cell communications devices can be placed in local cell areas to augment legacy equipment for such network capacity indicator reporting functions.

In some embodiments service partners and or service providers can subsidize in whole or in part to upgrade a given user or group of users to better QoS related service level agreement SLA class for a preferred destination. In some embodiments based on monitored service usage and or other monitored behavior of the communications device such subsidized QoS upgrade offers can be presented to a user of the communications device e.g. as an incentive reward for desired or preferred user behavior or for other reasons .

In some embodiments QoS charging is based on QoS channel reservation service flow or RAB charging e.g. single flow per RAB multi flow per RAB multi RAB per flow . In some embodiments charging is based on one or more of the following user service class request traffic volume and class time and class network capacity e.g. network busy state and class time of day and class location traffic type application type application class destination destination type partner service and or other criteria measures. In some embodiments QoS charging is verified using the various verification techniques described herein e.g. test charging events . In some embodiments QoS charging is by data usage e.g. by Megabyte MB service flow by time by QoS class speed by time and or other criteria measures.

In some embodiments QoS for DAS includes coordinating functions with one or more of the following DAS elements functions Radio Access Network RAN Transport network Core network GRX network IPX network and or other networks elements functions.

As shown includes various devices including service processors . For example devices can include various types of mobile devices such as phones PDAs computing devices laptops net books tablets cameras music media players GPS devices networked appliances and any other networked device and or devices can include various types of intermediate networking devices as described herein. The devices are in communication with service control and central provider access and core networks . Service policies and accounting functions are also provided in communication with the central provider access and core networks . For example devices can communicate via the central provider access and core networks to the Internet for access to various Internet sites services e.g. Google sites services Yahoo sites services Blackberry services Apple iTunes and AppStore Amazon.com FaceBook and or any other Internet service or other network facilitated service .

In some embodiments provides a wireless network architecture that supports partitioned device groups in which each device group can be provided independent and secure management of transparent reconciliation. Those of ordinary skill in the art will appreciate that various other network architectures can be used for providing device group partitions and a settlement platform and is illustrative of just another such example network architecture for which device group partitions and settlement platform techniques described herein can be provided.

In some embodiments a service provider selects who receives a reconciliation report of activations and usage by service plan type. In some embodiments service usage information e.g. based on CDRs and or micro CDRs or other service usage measures are used for service plan billing and for reconciliation reports. In some embodiments different service plans on the same device e.g. device can be sent to different partners or the same partner. In some embodiments multi device and multi user reconciliation capabilities are provided. In some embodiments a settlement platform service is provided. In some embodiments various revenue share techniques as described herein are provided e.g. implemented using a settlement platform service using for example service policies and accounting functions .

In some embodiments partitioned device groups are provided. In some embodiments each partitioned group of devices e.g. mobile devices can be uniquely managed with secure admin log ins. In some embodiments multi device multi user accounting is provided. In some embodiments capabilities are provided to support multi party multi service reconciliation records to carriers and carrier partners which can also support various service transactional revenue share techniques e.g. for reducing or eliminating the up front subsidy and associated up front subsidy risk of certain bounty models . In some embodiments service usage and profitability analytics are provided e.g. using aggregated CDRs micro CDRs and service policies and accounting functions . For example a partitioned beta test group of devices can be tested and optimized for various service usage policies and or service plans and then the optimized service usage policies and or service plans can be published to an entire or larger device group. In some embodiments a carrier can be provided a carrier branded device group and or a MVNO can be provided a MVNO branded device group.

For example the architecture provides a relatively full featured device based service processor implementation and service controller implementation. As shown this corresponds to a networking configuration in which the service controller is connected to the Internet and not directly to the access network . As shown a data plane e.g. service traffic plane communication path is shown in solid line connections and control plane e.g. service control plane communication path is shown in dashed line connections. As will be apparent the division in functionality between one device agent and another is based on for example design choices networking environments devices and or services applications and various different combinations can be used in various different implementations. For example the functional lines can be re drawn in any way that the product designers see fit. As shown this includes certain divisions and functional breakouts for device agents as an illustrative implementation although other potentially more complex embodiments can include different divisions and functional breakouts for device agent functionality specifications for example in order to manage development specification and testing complexity and workflow. In addition the placement of the agents that operate interact with or monitor the data path can be moved or re ordered in various embodiments. For example the functional elements shown in are described below with respect to .

As shown in service processor includes a service control device link . For example as device based service control techniques involving supervision across a network become more sophisticated it becomes increasingly important to have an efficient and flexible control plane communication link between the device agents and the network elements communicating with controlling monitoring or verifying service policy. In some embodiments the service control device link provides the device side of a system for transmission and reception of service agent to from network element functions. In some embodiments the traffic efficiency of this link is enhanced by buffering and framing multiple agent messages in the transmissions. In some embodiments the traffic efficiency is further improved by controlling the transmission frequency or linking the transmission frequency to the rate of service usage or traffic usage. In some embodiments one or more levels of security or encryption are used to make the link robust to discovery eavesdropping or compromise. In some embodiments the service control device link also provides the communications link and heartbeat timing for the agent heartbeat function. As discussed below various embodiments disclosed herein for the service control device link provide an efficient and secure solution for transmitting and receiving service policy implementation control monitoring and verification information with other network elements.

As shown in the service controller includes a service control server link . In some embodiments device based service control techniques involving supervision across a network e.g. on the control plane are more sophisticated and for such it is increasingly important to have an efficient and flexible control plane communication link between the device agents e.g. of the service processor and the network elements e.g. of the service controller communicating with controlling monitoring or verifying service policy. For example the communication link between the service control server link of service controller and the service control device link of the service processor can provide an efficient and flexible control plane communication link a service control link as shown in and in some embodiments this control plane communication link provides for a secure e.g. encrypted communications link for providing secure bidirectional communications between the service processor and the service controller . In some embodiments the service control server link provides the network side of a system for transmission and reception of service agent to from network element functions. In some embodiments the traffic efficiency of this link is enhanced by buffering and framing multiple agent messages in the transmissions e.g. thereby reducing network chatter . In some embodiments the traffic efficiency is further improved by controlling the transmission frequency and or linking the transmission frequency to the rate of service usage or traffic usage. In some embodiments one or more levels of security and or encryption are used to secure the link against potential discovery eavesdropping or compromise of communications on the link. In some embodiments the service control server link also provides the communications link and heartbeat timing for the agent heartbeat function.

In some embodiments the service control server link provides for securing signing encrypting and or otherwise protecting the communications before sending such communications over the service control link . For example the service control server link can send to the transport layer or directly to the link layer for transmission. In another example the service control server link further secures the communications with transport layer encryption such as TCP TLS or another secure transport layer protocol. As another example the service control server link can encrypt at the link layer such as using IPSEC various possible VPN services other forms of IP layer encryption and or another link layer encryption technique.

As shown in the service controller includes an access control integrity server e.g. service policy security server . In some embodiments the access control integrity server collects device information on service policy service usage agent configuration and or agent behavior. For example the access control integrity server can cross check this information to identify integrity breaches in the service policy implementation and control system. In another example the access control integrity server can initiate action when a service policy violation or a system integrity breach is suspected.

In some embodiments the access control integrity server and or some other agent of service controller acts on access control integrity agent e.g. service policy security agent reports and error conditions. Many of the access control integrity agent checks can be accomplished by the server. For example the access control integrity agent checks include one or more of the following service usage measure against usage range consistent with policies e.g. usage measure from the network and or from the device configuration of agents operation of the agents and or dynamic agent download.

In some embodiments the access control integrity server e.g. and or some other agent of service controller verifies device service policy implementations by comparing various service usage measures e.g. based on network monitored information such as by using IPDRs or CDRs and or local service usage monitoring information against expected service usage behavior given the policies that are intended to be in place. For example device service policy implementations can include measuring total QoS data passed QoS data passed in a period of time IP addresses data per IP address and or other measures such as location downloads email accessed URLs and comparing such measures expected service usage behavior given the policies that are intended to be in place.

In some embodiments the access control integrity server and or some other agent of service controller verifies device service policy and the verification error conditions that can indicate a mismatch in QoS service measure and QoS service policy include one or more of the following unauthorized network access e.g. access beyond ambient service policy limits unauthorized network speed e.g. average speed beyond service policy limit network data amount does not match QoS policy limit e.g. device not stop at limit without re up revising service policy unauthorized network address unauthorized service usage e.g. VOIP email and or web browsing unauthorized application usage e.g. email VOIP email and or web service usage rate too high for plan and policy controller not controlling throttling it down and or any other mismatch in service measure and service policy. Accordingly in some embodiments the access control integrity server and or some other agent of service controller provides a policy service control integrity service to continually e.g. periodically and or based on trigger events verify that the service control of the device has not been compromised and or is not behaving out of policy.

As shown in service controller includes a service history server e.g. charging server . In some embodiments the service history server collects and records service usage or service activity reports from the Access Network AAA Server and the Service Monitor Agent . For example although service usage history from the network elements can in certain embodiments be less detailed than service history from the device the service history from the network can provide a valuable source for verification of device service policy implementation because for example it is extremely difficult for a device error or compromise event on the device to compromise the network based equipment and software. For example service history reports from the device can include various service tracking information as similarly described above. In some embodiments the service history server provides the service history on request to other servers and or one or more agents. In some embodiments the service history server provides the service usage history to the device service history e.g. CDR feed and CDR mediation . In some embodiments for purposes of facilitating the activation tracking service functions described below the service history server maintains a history of which networks the device has connected to. For example this network activity summary can include a summary of the networks accessed activity versus time per connection and or traffic versus time per connection. As another example this activity summary can further be analyzed or reported to estimate the type of service plan associated with the traffic activity for the purpose of bill sharing reconciliation.

As shown in service controller includes a QoS policy management server e.g. policy decision point PDP server . In some embodiments the QoS policy management server transmits policies to the service processor via the service control link . In some embodiments the policy management server manages policy settings on the device e.g. various policy settings as described herein with respect to various embodiments in accordance with a device service profile. In some embodiments the policy management server sets instantaneous policies on policy implementation agents e.g. policy implementation agent . For example the policy management server can issue policy settings monitor service usage and if necessary modify policy settings. For example in the case of a user who prefers for the network to manage their service usage costs or in the case of any adaptive policy management needs the policy management server can maintain a relatively high frequency of communication with the device to collect traffic and or service measures and issue new policy settings. In this example device monitored service measures and any user service policy preference changes are reported periodically and or based on various triggers events requests to the policy management server . In this example user privacy settings generally require secure communication with the network e.g. a secure service control link such as with the policy management server to ensure that various aspects of user privacy are properly maintained during such configuration requests policy settings transmitted over the network. For example information can be compartmentalized to service policy management and not communicated to other databases used for CRM for maintaining user privacy.

In some embodiments the policy management server provides adaptive policy management on the device. For example the policy management server can issue policy settings and objectives and rely on the device based policy management e.g. service processor for some or all of the policy adaptation. This approach can require less interaction with the device thereby reducing network chatter on the service control link for purposes of device policy management e.g. network chatter is reduced relative to various server network based policy management approaches described above . This approach can also provide robust user privacy embodiments by allowing the user to configure the device policy for user privacy preferences settings so that for example sensitive information e.g. geo location data website history is not communicated to the network without the user s approval. In some embodiments the policy management server adjusts service policy based on time of day. In some embodiments the policy management server receives requests or otherwise obtains a measure of network availability and adjusts traffic shaping policy and or other policy settings based on available network capacity.

As shown in service controller includes a network traffic analysis server . In some embodiments the network traffic analysis server collects receives service usage history for devices and or groups of devices and analyzes the service usage. In some embodiments the network traffic analysis server presents service usage statistics in various formats to identify improvements in network service quality and or service profitability. In some embodiments the network traffic analysis server estimates the service quality and or service usage for the network under variable settings on potential service policies. In some embodiments the network traffic analysis server identifies actual or potential service behaviors by one or more devices that are causing problems for overall network service quality or service cost.

As shown in Service Analysis Test Download B includes a beta test server e.g. policy creation point and beta test server . In some embodiments the beta test server publishes candidate service plan policy settings to one or more devices. In some embodiments the beta test server provides summary reports of network service usage or user feedback information for one or more candidate service plan policy settings. In some embodiments the beta test server provides a mechanism to compare the beta test results for different candidate service plan policy settings or select the optimum candidates for further policy settings optimization.

As shown in service controller includes a service download control server e.g. a service software download control server . In some embodiments the service download control server provides a download function to install and or update service software elements e.g. the service processor and or agents components of the service processor on the device as described herein.

As shown in service controller includes a billing event server e.g. micro CDR server . In some embodiments the billing event server collects billing events provides service plan information to the service processor provides service usage updates to the service processor serves as interface between device and central billing server and or provides trusted third party function for certain ecommerce billing transactions.

As shown in the Access Network HLR AAA server is in network communication with the access network . In some embodiments the Access Network AAA server provides the necessary access network AAA services e.g. access control and authorization functions for the device access layer to allow the devices onto the central provider access network and the service provider network. In some embodiments another layer of access control is required for the device to gain access to other networks such as the Internet a corporate network and or a machine to machine network. This additional layer of access control can be implemented for example by the service processor on the device. In some embodiments the Access Network AAA server also provides the ability to suspend service for a device and resume service for a device based on communications received from the service controller . In some embodiments the Access Network AAA server also provides the ability to direct routing for device traffic to a quarantine network or to restrict or limit network access when a device quarantine condition is invoked. In some embodiments the Access Network AAA server also records and reports device network service usage e.g. device network service usage can be reported to the device service history .

As shown in the device service history is in network communication with the access network . In some embodiments the device service history provides service usage data records used for various purposes in various embodiments. In some embodiments the device service history is used to assist in verifying service policy implementation. In some embodiments the device service history is used to verify service monitoring. In some embodiments the device service history is used to verify billing records and or billing policy implementation. In some embodiments the device service history is used to synchronize and or verify the local service usage counter.

As shown in the central billing e.g. central provider billing server is in network communication with the access network . In some embodiments the central provider billing server provides a mediation function for central provider billing events. For example the central provider billing server can accept service plan changes. In some embodiments the central provider billing server provides updates on device service usage service plan limits and or service policies. In some embodiments the central provider billing server collects billing events formulates bills bills service users provides certain billing event data and service plan information to the service controller and or device .

As shown in in some embodiments modem selection and control e.g. in communication with connection manager as shown selects the access network connection and is in communication with the modem firewall and modem drivers convert data traffic into modem bus traffic for one or more modems and are in communication with the modem selection and control . In some embodiments different profiles are selected based on the selected network connection e.g. different service profiles policies for WWAN WLAN WPAN Ethernet and or DSL network connections which is also referred to herein as multimode profile setting. For example service profile settings can be based on the actual access network e.g. home DSL cable or work network behind the Wi Fi not the fact that it is Wi Fi e.g. or any other network such as DSL cable satellite or T 1 which is viewed as different than accessing a Wi Fi network at the coffee shop. For example in a Wi Fi hotspot situation in which there are a significant number of users on a DSL or T 1 backhaul the service controller can sit in a service provider cloud or an MVNO cloud the service controls can be provided by a VSP capability offered by the service provider or the service controller can be owned by the hotspot service provider that uses the service controller on their own without any association with an access network service provider. For example the service processors can be controlled by the service controller to divide up the available bandwidth at the hotspot according to QoS or user sharing rules e.g. with some users having higher differentiated priority e.g. potentially for higher service payments than other users . As another example ambient services e.g. as similarly described herein can be provided for the hotspot for verified service processors.

In some embodiments the service processor and service controller are capable of assigning multiple service profiles associated with multiple service plans that the user chooses individually or in combination as a package. For example a device starts with ambient services that include free transaction services wherein the user pays for transactions or events rather than the basic service e.g. a news service eReader PND service pay as you go session Internet in which each service is supported with a bill by account capability to correctly account for any subsidized partner billing to provide the transaction services e.g. Barnes and Noble may pay for the eReader service and offer a revenue share to the service provider for any book or magazine transactions purchased from the device . In some embodiments the bill by account service can also track the transactions and in some embodiments advertisements for the purpose of revenue sharing all using the service monitoring capabilities disclosed herein. After initiating services with the free ambient service discussed above the user may later choose a post pay monthly Internet email and SMS service. In this case the service controller would obtain from the billing system in the case of network based billing e.g. or the service controller billing event server in the case of device based billing the billing plan code for the new Internet email and SMS service. In some embodiments this code is cross referenced in a database e.g. the policy management server to find the appropriate service profile for the new service in combination with the initial ambient service. The new superset service profile is then applied so that the user maintains free access to the ambient services and the billing partners continue to subsidize those services the user also gets access to Internet services and may choose the service control profile e.g. from one of the embodiments disclosed herein . The superset profile is the profile that provides the combined capabilities of two or more service profiles when the profiles are applied to the same device service processor. In some embodiments the device service processor can determine the superset profile rather than the service controller when more than one stackable service is selected by the user or otherwise applied to the device. The flexibility of the service processor and service controller embodiments described herein allow for a large variety of service profiles to be defined and applied individually or as a superset to achieve the desired device service features.

As shown in an agent communication bus represents a functional description for providing communication for the various service processor agents and functions. In some embodiments as represented in the functional diagram illustrated in the architecture of the bus is generally multipoint to multipoint so that any agent can communicate with any other agent the service controller or in some cases other components of the device such user interface and or modem components. As described below the architecture can also be point to point for certain agents or communication transactions or point to multipoint within the agent framework so that all agent communication can be concentrated or secured or controlled or restricted or logged or reported. In some embodiments the agent communication bus is secured signed encrypted hidden partitioned and or otherwise protected from unauthorized monitoring or usage. In some embodiments an application interface agent not shown is used to literally tag or virtually tag application layer traffic so that the policy implementation agent s has the necessary information to implement selected traffic shaping solutions. In some embodiments an application interface agent not shown is in communication with various applications including a TCP application an IP application and a voice application .

As shown in service processor includes a QoS API and OS stack interface . In some embodiments QoS API and OS stack interface provides the QoS API functionality as similarly described herein with respect to various embodiments. In some embodiments the QoS API is used to report back QoS availability to applications. As shown service processor also includes a QoS router e.g. QoS router agent function and a policy decision point PDP agent . In some embodiments QoS router provides the QoS router functionality as similarly described herein with respect to various embodiments. In some embodiments the QoS router supports multiple QoS channels e.g. one or more provisioned allocated QoS links forming a QoS channel between the device and the desired end point such as an access point BTS gateway network for a single ended QoS channel or other communication device for an end to end QoS channel depending on the QoS connection network support availability etc. . In some embodiments the QoS router supports multiple QoS channels which can each have different QoS classes levels. In some embodiments the QoS router routes application service usage traffic to an appropriate QoS channel. In some embodiments the QoS router determines the routing mapping based on for example one or more of the following a QoS API request a QoS activity map a user request a service plan a service profile service policy settings network capacity service controller or other intermediate QoS network element function device and or any other criteria measure as similarly described herein with respect to various embodiments. In some embodiments multiple different applications services are routed to a particular QoS channel using various techniques described herein. In some embodiments different applications services are routed to different QoS channels using various techniques described herein. In some embodiments the QoS router assists in managing and or optimizing QoS usage for the communications device. In some embodiments the QoS router assists in managing and or optimizing QoS usage across multiple communications devices e.g. based on network capacity for a given cell area base station or other access point . In some embodiments PDP agent provides the PDP agent functionality as similarly described herein with respect to various embodiments. As shown QoS for DAS architecture also includes a suspend resume interface network QoS provisioning interfaces an activation suspend resume server and billing interface server in the service controller A and a suspend resume interface and network QoS provisioning interfaces for providing the various QoS techniques described herein.

In some embodiments device assisted services DAS techniques for providing an activity map for classifying or categorizing service usage activities to associate various monitored activities e.g. by URL by network domain by website by network traffic type by application or application type and or any other service usage activity categorization classification with associated IP addresses are provided. In some embodiments a policy control agent not shown service monitor agent e.g. charging agent or another agent or function or combinations thereof of the service processor provides a DAS activity map. In some embodiments a policy control agent not shown service monitor agent or another agent or function or combinations thereof of the service processor provides an activity map for classifying or categorizing service usage activities to associate various monitored activities e.g. by Uniform Resource Locator URL by network domain by website by network traffic type by application or application type and or any other service usage activity classification categorization with associated IP addresses. In some embodiments a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor determines the associated IP addresses for monitored service usage activities using various techniques to snoop the DNS request s e.g. by performing such snooping techniques on the device the associated IP addresses can be determined without the need for a network request for a reverse DNS lookup . In some embodiments a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor records and reports IP addresses or includes a DNS lookup function to report IP addresses or IP addresses and associated URLs for monitored service usage activities. For example a policy control agent service monitor agent or another agent or function or combinations thereof of the service processor can determine the associated IP addresses for monitored service usage activities using various techniques to perform a DNS lookup function e.g. using a local DNS cache on the monitored device . In some embodiments one or more of these techniques are used to dynamically build and maintain a DAS activity map that maps for example URLs to IP addresses applications to IP addresses content types to IP addresses and or any other categorization classification to IP addresses as applicable. In some embodiments the DAS activity map is used for various DAS traffic control and or throttling techniques as described herein with respect to various embodiments. In some embodiments the DAS activity map is used to provide the user various UI related information and notification techniques related to service usage as described herein with respect to various embodiments. In some embodiments the DAS activity map is used to provide service usage monitoring prediction estimation of future service usage service usage billing e.g. bill by account and or any other service usage billing categorization techniques DAS techniques for ambient services usage monitoring DAS techniques for generating micro CDRs and or any of the various other DAS related techniques as described herein with respect to various embodiments.

In some embodiments all or a portion of the service processor functions disclosed herein are implemented in software. In some embodiments all or a portion of the service processor functions are implemented in hardware. In some embodiments all or substantially all of the service processor functionality e.g. as discussed herein is implemented and stored in software that can be performed on e.g. executed by various components in device . In some embodiments it is advantageous to store or implement certain portions or all of service processor in protected or secure memory so that other undesired programs e.g. and or unauthorized users have difficulty accessing the functions or software in service processor . In some embodiments service processor at least in part is implemented in and or stored on secure non volatile memory e.g. non volatile memory can be secure non volatile memory that is not accessible without pass keys and or other security mechanisms. In some embodiments the ability to load at least a portion of service processor software into protected non volatile memory also requires a secure key and or signature and or requires that the service processor software components being loaded into non volatile memory are also securely encrypted and appropriately signed by an authority that is trusted by a secure software downloader function such as service downloader as shown in . In some embodiments a secure software download embodiment also uses a secure non volatile memory. Those of ordinary skill in the art will also appreciate that all memory can be on chip off chip on board and or off board.

Referring to in some embodiments QoS functionality is performed at the communications device using service processor as similarly described herein. For example the service processor determines whether or not a QoS request is authorized e.g. based on the associated service plan and or other criteria measures . If the QoS request is authorized then the service processor communicates with the base station BTS to send the QoS request e.g. a RAB or multi RAB reservation request to the local BTS. The BTS determines whether to accept or deny the QoS request e.g. based on network capacity such as using a first come first service QoS network bandwidth or best effort access policy or other techniques and or other criteria measures . The BTS responds to the QoS request accordingly. If the QoS request is granted the QoS session can be initiated as similarly described herein. In some embodiments the service processor also performs various QoS charging functions using various techniques described herein and the service processor periodically sends QoS charging records or reports to the service controller . In some embodiments the service processor and the QoS related functions performed by the service processor are periodically verified using the various techniques described herein.

Referring to is similar to except that the service controller is also shown to be in communication with the service processor of the communications device which can provide for the download and periodically updating of the QoS rules and or other service plan profile policy information that can include QoS related information. In some embodiments the service processor also performs various QoS charging functions using various techniques described herein and the service processor periodically sends QoS charging records or reports to the service controller . In some embodiments the service processor and the QoS related functions performed by the service processor are periodically verified using the various techniques described herein.

Referring to at the service processor sends a QoS request to the service controller e.g. the service processor can also at least in part determine whether the QoS request is authorized as similarly described with respect to . At the service controller sends the QoS request to the BTS if it is determined that the QoS request is authorized using various techniques described herein and or whether the BTS has network capacity for the QoS request. For example the service controller can provide a central policy decision point function for QoS related activities e.g. based on QoS prioritization network capacity and or other criteria measures policies . At the service controller communicates the response to the QoS request accordingly. At if the QoS request was approved the device initiates the QoS session e.g. using a RAB or multi RAB reservation via the BTS . In some embodiments the service processor also performs various QoS charging functions using various techniques described herein and the service processor periodically sends QoS charging records or reports to the service controller . In some embodiments the service processor and the QoS related functions performed by the service processor are periodically verified using the various techniques described herein.

In some embodiments QoS techniques as described herein are implemented in the device e.g. using the service processor and one or more other network elements functions such as the BTS service controller RAN SGSN GGSN other gateways and or other network elements functions in which various of the QoS related functions can be distributed or allocated to such network elements functions based on various design network architecture approaches as will now be apparent to one of ordinary skill in the art in which QoS related activities and or functions at the device are verified using various verification techniques described herein.

In some embodiments the device determines QoS availability by directly Querying QoS link reservation equipment in the network e.g. an access point such as the BTS . In some embodiments the device determines QoS availability based on an intermediate network function that coordinates QoS requests with one or more network QoS link resources. In some embodiments the device requests a QoS reservation in advance of QoS link establishment with one or more QoS network link resources. In some embodiments in response to a QoS request a QoS channel is reported as available only if after it is determined that the necessary one or more QoS links required to create the QoS channel are available and for example the QoS channel can then be reserved based on a confirmation or automatically be reserved in response to the QoS request.

In some embodiments the service plan includes a list of activity policies and Each activity policy in the service plan specifies how the activity policy is modified by rules state information. In some embodiments each activity policy then becomes the instruction for the engine e.g. QoS mapping function that maps the activity policy to QoS activity rules . In some embodiments service controller downloads QoS mapping function which is implemented by service processor .

In some embodiments the service processor determines e.g. and classifies application service usage activity demand with or without granular application service usage activity e.g. depending on various user service plan service provider network legal and or other privacy restrictions and or any other related requirements or settings . For example policies e.g. service policy settings and or service profile settings can be downloaded to provide such application service usage activity monitoring rules and a QoS activity map for assigning such monitored activities to various QoS classes or priorities and in some embodiments such monitoring and the QoS activity map can also be implemented using various verification techniques described herein e.g. periodically audited tested compared with network service usage information . In some embodiments the QoS activity map is based on a service plan service profile and or service policy settings associated with the communications device. In some embodiments the QoS activity map is based on a device group and or user group. In some embodiments the QoS activity map is based on user input e.g. a user of the communications device can identify QoS classes service levels for various applications and or service activities in response to requests for user input based on user configurations user defined rules e.g. to eliminate or mitigate privacy and or net neutrality concerns issues and or confirmed monitored user behavior QoS related patterns or preferences . In some embodiments the QoS activity map includes mappings associations based on one or more of the following a user preference for a given destination destination class application application class e.g. by application class instead of with respect to a specific application can also eliminate or mitigate privacy and or net neutrality concerns issues flow traffic or flow class time period time of day location network busy state e.g. provide QoS when you can then charge more when busy notify user of busy state device type user type user plan user group user standing partner service tokens service type and or other criteria or measures.

In some embodiments various techniques described herein are managed for device for incoming and or outgoing QoS requests. In some embodiments as shown in QoS for DAS includes establishing an end to end coordinated QoS service channel control.

In some embodiments the service monitor agent and or other agents implement virtual traffic tagging by tracking or tracing packet flows through the various communication stack formatting processing and encryption steps and providing the virtual tag information to the various agents that monitor control shape throttle or otherwise observe manipulate or modify the traffic. This tagging approach is referred to herein as virtual tagging because there is not a literal data flow traffic flow or packet tag that is attached to flows or packets and the book keeping to tag the packet is done through tracking or tracing the flow or packet through the stack instead. In some embodiments the application interface and or other agents identify a traffic flow associate it with a service usage activity and cause a literal tag to be attached to the traffic or packets associated with the activity. This tagging approach is referred to herein as literal tagging. There are various advantages with both the virtual tagging and the literal tagging approaches. For example it can be preferable in some embodiments to reduce the inter agent communication required to track or trace a packet through the stack processing by assigning a literal tag so that each flow or packet has its own activity association embedded in the data. As another example it can be preferable in some embodiments to re use portions of standard communication stack software or components enhancing the verifiable traffic control or service control capabilities of the standard stack by inserting additional processing steps associated with the various service agents and monitoring points rather than re writing the entire stack to correctly process literal tagging information and in such cases a virtual tagging scheme may be desired. As yet another example some standard communication stacks provide for unused unspecified or otherwise available bit fields in a packet frame or flow and these unused unspecified or otherwise available bit fields can be used to literally tag traffic without the need to re write all of the standard communication stack software with only the portions of the stack that are added to enhance the verifiable traffic control or service control capabilities of the standard stack needing to decode and use the literal tagging information encapsulated in the available bit fields. In the case of literal tagging in some embodiments the tags are removed prior to passing the packets or flows to the network or to the applications utilizing the stack. In some embodiments the manner in which the virtual or literal tagging is implemented can be developed into a communication standard specification so that various device or service product developers can independently develop the communication stack and or service processor hardware and or software in a manner that is compatible with the service controller specifications and the products of other device or service product developers.

It will be appreciated that although the implementation use of any or all of the measurement points illustrated in is not required to have an effective implementation such as was similarly shown with respect to various embodiments described herein various embodiments can benefit from these and or similar measurement points. It will also be appreciated that the exact measurement points can be moved to different locations in the traffic processing stack just as the various embodiments described herein can have the agents affecting policy implementation moved to different points in the traffic processing stack while still maintaining effective operation. In some embodiments one or more measurement points are provided deeper in the modem stack where for example it is more difficult to circumvent and can be more difficult to access for tampering purposes if the modem is designed with the proper software and or hardware security to protect the integrity of the modem stack and measurement point s .

Referring to describing the device communications stack from the bottom to the top of the stack as shown the device communications stack provides a communication layer for each of the modems of the device at the bottom of the device communications stack. Example measurement point VI resides within or just above the modem driver layer. For example the modem driver performs modem bus communications data protocol translations modem control and configuration to interface the networking stack traffic to the modem. As shown measurement point VI is common to all modem drivers and modems and it is advantageous for certain embodiments to differentiate the traffic or service activity taking place through one modem from that of one or more of the other modems. In some embodiments measurement point VI or another measurement point is located over within or below one or more of the individual modem drivers. The respective modem buses for each modem reside between example measurement points V and VI. In the next higher layer a modem selection control layer for multimode device based communication is provided. In some embodiments this layer is controlled by a network decision policy that selects the most desirable network modem for some or all of the data traffic and when the most desirable network is not available the policy reverts to the next most desirable network until a connection is established provided that one of the networks is available. In some embodiments certain network traffic such as verification control redundant or secure traffic is routed to one of the networks even when some or all of the data traffic is routed to another network. This dual routing capability provides for a variety of enhanced security enhanced reliability or enhanced manageability devices services or applications. In the next higher layer a modem firewall is provided. For example the modem firewall provides for traditional firewall functions but unlike traditional firewalls in order to rely on the firewall for verifiable service usage control such as access control and security protection from unwanted networking traffic or applications the various service verification techniques and agents described herein are added to the firewall function to verify compliance with service policy and prevent tampering of the service controls. In some embodiments the modem firewall is implemented farther up the stack possibly in combination with other layers as indicated in other Figures and described herein. In some embodiments a dedicated firewall function or layer is provided that is independent of the other processing layers such as the policy implementation layer the packet forwarding layer and or the application layer. In some embodiments the modem firewall is implemented farther down the stack such as within the modem drivers below the modem drivers or in the modem itself. Example measurement point IV resides between the modem firewall layer and an IP queuing and routing layer e.g. QoS IP queuing and routing layer . As shown an IP queuing and routing layer is separate from the policy implementation layer where the policy implementation agent implements a portion of the traffic control and or service usage control policies. As described herein in some embodiments these functions are separated so that a standard network stack function can be used for QoS IP queuing and routing and the modifications necessary to implement the policy implementation agent functions can be provided in a new layer inserted into the standard stack. In some embodiments the IP queuing and routing layer is combined with the traffic or service usage control layer. For example a combined routing and policy implementation layer embodiment can also be used with the other embodiments such as shown in . Measurement point III resides between the IP queuing and routing layer and a policy implementation agent layer. Measurement point II resides between the policy implementation agent layer and the transport layer including TCP UDP and other IP as shown. The session layer resides above the transport layer which is shown as a socket assignment and session management e.g. basic TCP setup TLS SSL layer. The network services API e.g. HTTP HTTPS FTP File Transfer Protocol SMTP Simple Mail Transfer Protocol POP3 DNS resides above the session layer. Measurement point I resides between the network services API layer and an application layer shown as application service interface agent in the device communications stack of .

As shown in the application service interface layer e.g. QoS application service interface layer is above the standard networking stack API and in some embodiments its function is to monitor and in some cases intercept and process the traffic between the applications and the standard networking stack API. In some embodiments the application service interface layer identifies application traffic flows before the application traffic flows are more difficult or practically impossible to identify farther down in the stack. In some embodiments the application service interface layer in this way assists application layer tagging in both the virtual and literal tagging cases. In the case of upstream traffic the application layer tagging is straight forward because the traffic originates at the application layer. In some downstream embodiments where the traffic or service activity classification relies on traffic attributes that are readily obtainable such as source address or URL application socket address IP destination address time of day or any other readily obtained parameter the traffic type can be identified and tagged for processing by the firewall agent or another agent as it initially arrives. In other embodiments as described herein in the downstream case the solution is generally more sophisticated when a traffic parameter that is needed to classify the manner in which the traffic flow is to be controlled or throttled is not readily available at the lower levels of the stack such as association with an aspect of an application type of content something contained within TLS IPSEC or other secure format or other information associated with the traffic. Accordingly in some embodiments the networking stack identifies the traffic flow before it is fully characterized categorized or associated with a service activity and then passes the traffic through to the application interface layer where the final classification is completed. In such embodiments the application interface layer then communicates the traffic flow ID with the proper classification so that after an initial short traffic burst or time period the policy implementation agents can properly control the traffic. In some embodiments there is also a policy for tagging and setting service control policies for traffic that cannot be fully identified with all sources of tagging including application layer tagging.

As shown in a service monitor agent which is also in communication with the agent communication bus communicates with various layers of the device communications stack. For example the service monitor agent performs monitoring at each of measurement points I through VI receiving information including application information service usage and other service related information and assignment information. An access control integrity agent is in communication with the service monitor agent via the agent communications bus as also shown.

Referring to describing the device communications stack from the bottom to the top of the stack as shown the device communications stack provides a communication layer for modem MAC PHY layer at the bottom of the device communications stack. Measurement point IV resides above the modem MAC PHY layer. The modem firewall layer resides between measurement points IV and III. In the next higher layer the policy implementation agent is provided in which the policy implementation agent is implemented on the modem e.g. on modem hardware . Measurement point II resides between the policy implementation agent and the modem driver layer which is then shown below a modem bus layer. The next higher layer is shown as the IP queuing and routing layer followed by the transport layer including TCP UDP and other IP as shown. The session layer resides above the transport layer which is shown as a socket assignment and session management e.g. basic TCP setup TLS SSL layer. The network services API e.g. HTTP HTTPS FTP File Transfer Protocol SMTP Simple Mail Transfer Protocol POP3 DNS resides above the session layer. Measurement point I resides between the network services API layer and an application layer shown as application service interface agent in the device communications stack of .

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

