---

title: Image processing apparatus, image processing method, and storage medium
abstract: An image processing apparatus acquires information indicating a region to be output designated by a user in a web page displayed on a display apparatus by a browser, and extracts data indicating an image corresponding to at least a part of the region to be output indicated by the acquired information. The image processing apparatus updates a portion from which data is extracted in the region to be output based on the acquired information, when a portion corresponding to the extracted data of the region to be output indicated by the acquired information in the web page is a part of the region to be output.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08751923&OS=08751923&RS=08751923
owner: Canon Kabushiki Kaisha
number: 08751923
owner_city: Tokyo
owner_country: JP
publication_date: 20100625
---
The present invention relates to an image processing apparatus for outputting an image corresponding to a web page.

Conventionally a technique to access a server on the Internet download a structured document and display the web page on a display has been known. Structured documents are described with a markup language or a structured language such as Hyper Text Markup Language HTML or Hyper Text Markup Language XHTML . A user can analyze a structured document by software called as a browser corresponding to the structured language and display a web page on a display. Further when a user prints such a web page a method in which the user displays the web page on the display by a browser and prints the displayed page using a function of the browser is commonly used. However some types of browsers cannot perform rendering of the whole of a web page at one time.

Japanese Patent Application Laid open No. 2006 171851 discusses a technique in which when a user performs scroll movement of a document file of a text type different from a web page to convert the document file into an image capturing is performed on each displayed screen.

However the aforementioned method is for performing capturing of the whole document file and does not designate a part of regions of the document file as an output target. Further a technical constraint that the document file is not a web page and a browser cannot perform rendering of the whole web page at one time is not considered.

The present invention is directed to an image processing apparatus capable of outputting an image corresponding to a region to be output of a web page even when the image corresponding to the region to be output cannot be extracted by a browser at one time.

According to an aspect of the present invention an image processing apparatus includes an acquisition unit an extraction unit an updating unit and an output unit. The acquisition unit is configured to acquire information indicating a region to be output designated by a user in a web page displayed on a display apparatus by a browser. The extraction unit is configured to extract data indicating an image corresponding to at least a part of the region to be output indicated by the information acquired by the acquisition unit. When a portion corresponding to the data extracted by the extraction unit of the region to be output indicated by the information acquired by the acquisition unit in the web page is a part of the region to be output the updating unit is configured to update a portion of the region to be output from which data is extracted by the extraction unit based on the information acquired by the acquisition unit. The output unit is configured to output an image corresponding to the region to be output based on data extracted by the extraction unit according to updating by the updating unit and corresponding to the region to be output indicated by the information acquired by the acquisition unit in the web page.

Further features and aspects of the present invention will become apparent from the following detailed description of exemplary embodiments with reference to the attached drawings.

Various exemplary embodiments features and aspects of the invention will be described in detail below with reference to the drawings.

A communication interface is an interface for performing a data communication with the printer via for example a universal serial bus USB a small computer system interface SCSI or a wireless connection and a network interface for data communication with the WWW server via the Internet . A display apparatus includes a cathode ray tube CTR or a liquid display and a graphic controller and displays an image or a graphic user interface GUI on a display screen. A mouse and a keyboard are input devices for giving various instructions to the PC by a user. A system bus performs data exchange between the CPU and the RAM the ROM and the hard disk .

In a browser is an application for generating a web page to display the web page. The browser downloads a structured document stored in the WWW server onto the hard disk in the PC and displays a web page on the display apparatus . The structured document is written with a markup language such as HTML and XHTML and elements constituting the structured document such as text and an image are written using tags. Further another file called as Cascading Style Sheet CSS for designating a display style of these elements is designated in the structured document. The browser analyses the structured document and displays the web page in which elements are arranged based on the CSS on the display apparatus .

In a structured document printing module is plug in software invoked from the browser . The structured document printing module is executed when the browser receives a printing instruction from a user. When the structured document printing module is executed a print region acquisition unit acquires information indicating a print region in a web page from the browser . The print region is for example selected on a web page by a user s operation of the mouse . In such a case the print region acquisition unit acquires coordinates indicating a selected region in the web page. On the other hand a display region acquisition unit acquires information indicating a region in a web page displayed on the display apparatus from the browser .

A region determination unit compares information acquired by the print region acquisition unit and information acquired by a display region acquisition unit and determines a portion in which a display region and a printing region overlap each other in the web page. An intermediate file generation unit acquires information indicating a display region based on a result determined by the region determination unit when there is a portion becoming a print region in the display region. The intermediate file generation unit performs rendering of a display region and generates an image of Enhanced Meta File EMF format as an intermediate file and stores the image in the RAM . In addition the intermediate file is an image generated by a usual browser for displaying based on a structured document and the browser generates bitmap data based on the intermediate file and displays a web page. Further the intermediate file is of a format storing characters and graphics as vector data in elements contained in a structured document such as HTML.

An extraction unit extracts an image of a region overlapping a print region in a display region in the intermediate file generated by the intermediate file generation unit . An extracted region storage control unit stores an image extracted by the extraction unit in the RAM as an intermediate file . In addition when a display region is changed by scrolling the extraction unit does not extract the intermediate file already stored in the RAM or a region already extracted and stored in the RAM based on a moving amount of scrolling.

In addition the extraction unit can extract an image in a region overlapping a print region in a display region from bitmap data corresponding to a web page. However in the case of bitmap data when an image is enlarged a detailed portion of the image becomes coarse. Thus as for image data to be extracted a format storing character information and graphic information as vector data is preferable instead of bitmap data.

A scroll control unit receives a scroll position indicating a region in a web page displayed on the display apparatus from the browser . The scroll control unit can change a region in a web page that is displayed in a display screen of the display apparatus by controlling the browser to move a scroll position. The scroll control unit changes a display region by moving scroll so as to display the whole print region according to a determined result by the region determination unit . The display region acquisition unit acquires a display region again from the browser when the scroll control unit performs scrolling to change a display region.

A print control unit executes drawing processing of one or a plurality of intermediate files stored by the extracted region storage control unit . An operating system OS provides from the printer driver an Application Programming Interface API for performing drawing processing by the structured document print module . Further the OS includes various control software such as a spooler system for managing a print job and a port monitor for outputting a printer command to a port but a detail description thereof is omitted. The printer driver generates print data according to the drawing processing executed by the print control unit converts the print data into a printer command and then transmits the printer command to the printer via the OS . When the printer receives the printer command from the printer driver the printer prints an image on a print medium based on the print data.

When the print region is larger than the display region as illustrated in the scroll control unit moves a scroll position of the browser to change a region displayed on the display apparatus by the browser . illustrate changes of a display region by the scroll control unit . illustrates a case in which a display region displayed by the browser is at the upper left corner on the web page. A region illustrated by shading in is an overlapped region with the display region in the print region . illustrates for displaying the print region illustrated in altogether an example in which the display region is changed by moving the scroll and a region overlapping the print region is extracted. Further illustrates a region overlapping the print region in a display region in . Furthermore illustrates a generated intermediate file.

With reference to and and a flowchart illustrated in processing for storing an image in a memory will be described where the image corresponds to a print region according to the present example.

In step S the region determination unit determines whether the print region is contained altogether in the display region. For example as illustrated in when the print region is contained altogether in the display region on the browser YES in step S the processing proceeds to step S. In step S the intermediate file generation unit performs rendering of the display region to generate an EMF file. In step S the extraction unit extracts the print region from the EMF file. Finally in step S the extracted region storage control unit stores the extracted EMF file in a memory such as the RAM . Based on the stored EMF file by the extracted region storage control unit the print control unit can print the print region by controlling the printer driver to execute drawing processing via the OS .

On the other hand as illustrated in when the print region is not contained in the display region as a result of determination by the region determination unit in step S NO in step S the processing proceeds to step S. In step S the scroll control unit acquires a scroll position from the browser and performs scroll movement of the display region on the browser so as to display the upper left of the structured document file as illustrated in . In step S the display region acquisition unit acquires a new display region .

In step S the region determination unit determines whether the display region overlaps the print region . In the case illustrated in the display region overlaps the print region YES in step S and the processing proceeds to step S. In step S the intermediate file generation unit performs rendering of the display region to generate an EMF file. In step S the extraction unit based on an amount of movement of scroll movement by the scroll control unit confirms whether an EMF file already stored in the memory by the extracted region storage control unit is contained in the display region. When the EMF file already stored in the memory is not contained in the display region NO in step S the processing proceeds to step S. When the EMF file already stored in the memory is contained in the display region YES in step S the processing proceeds to step S. The processing in step S will be described below.

For example in the case of the display region since the EMF file already stored in the memory is not contained in the display region the processing proceeds to step S. In step S the extraction unit extracts in the web page an EMF file of a region where the display region overlaps the print region . In step S the extracted region storage control unit stores the extracted EMF file in the memory and the processing proceeds to step S. In addition in step S also when the region determination unit determines that the display region does not overlap the print region NO in step S the processing proceeds to step S.

In this way the image processing apparatus performs extraction and storage of the intermediate file with respect to one display region. Then processing for moving the display region by the scroll control unit will be described.

In step S the scroll control unit determines whether it is possible to scroll the display region to the right. When the scroll control unit determines that it is possible to scroll the display region to the right YES in step S then in step S the scroll control unit controls the scroll to move to the right only a horizontal width of the display region. When the scroll control unit determines that it is not possible to scroll the display region to the right only the horizontal width of the display region the scroll control unit controls the scroll to move to the right only a distance possible to be moved. Further in step S when the scroll control unit determines that it is not possible to scroll the display region to the right like the display region NO in step S then in step S the scroll control unit controls the scroll to move to the leftmost. In step S the scroll control unit determines whether it is possible to scroll the display region down. When the scroll control unit determines that it is possible to scroll the display region down YES in step S then in step S the scroll control unit controls the display region down only a vertical width of the display region . When the scroll control unit determines that it is not possible to scroll the display region down only a vertical width of the display unit the scroll control unit controls the display region to scroll down only a distance possible to be moved.

After the scroll movement then in step S the display region acquisition unit acquires again the display region after the scroll movement. In the example illustrated in as illustrated in the scroll control unit controls the display region to perform scroll movement to the right only a horizontal width of the display region and acquires a display region . Similarly to the display region since the display region contains a region a region overlapping the print region an EMF file corresponding to the display region is stored in the memory by the processing in steps S to S.

Then the processing proceeds to step S and the scroll control unit performs again scroll movement. A display region illustrated in is a region in which the scroll control unit controls the display region to perform scroll movement to the right in step S. However since the scroll control unit cannot perform scroll movement only the horizontal width of the display region the scroll control unit performs scroll movement only a distance possible to be moved in the web page. An overlapping region of the display region and the print region becomes a region of a region as illustrated in . However an EMF file corresponding to the region is already stored in the memory. Thus in step S the extraction unit determines that there is an already extracted and stored EMF file in a display region YES in step S and the processing proceeds to step S. In addition the extraction unit can perform the determination by determining whether an amount of scroll movement is smaller than the width of the display region. Further the extraction unit can acquire information indicating coordinates of the print region in the web page and perform the determination based on the coordinates of the print region and the size of the display region.

Further the intermediate file generation unit can generate an intermediate file containing information indicating coordinates of a corresponding region in the web page and store the intermediated file in the memory based on information indicating a display region in the web page which is acquired by the display region acquisition unit . When an intermediate file contains the information indicating coordinates of a corresponding region in the web page the extraction unit can compare coordinates in the web page of the intermediate file and perform the determination based on the information contained in the intermediate file stored in the memory. Thus various determination methods are possible.

In step S the extraction unit extracts an EMF file of the print region excluding an region corresponding to an EMF file already stored in the memory. In the display region a portion for extracting the EMF file can be determined by an amount of scroll movement or determined based on the coordinates of the print region and the size of the display region in the web page. Further a portion for extracting the EMF file can be determined based on coordinates of a region corresponding to an intermediate file in the web page in which the coordinates are indicated by the intermediate file stored in the memory.

Further in step S when the extracted region storage control unit stores the EMF file extracted in step S in the memory the processing proceeds to step S and scroll movement is performed again. As a display region illustrate in when the scroll control unit cannot perform scroll movement to the right then in step S the scroll control unit moves the scroll to the leftmost and controls the display region to be the display region . In step S the scroll control unit determines whether it is possible to perform scroll movement of the display region down. In step S when the scroll movement is possible the scroll control unit controls the display region to scroll down only the vertical width of the display region and moves to a display region .

Accordingly when processing in steps S to S is repeated the scroll control unit can move the display region to the regions to illustrated in . The scroll control unit performs rendering of each display region and can store an EMF file of an extracted region overlapping the print region in the memory. After the scroll control unit moves the display region to the region the scroll control unit controls the display region to perform scroll movement to the left up to a display region because it is impossible to perform scroll movement to the right. In this case the flowchart ends because it is impossible to move the scroll down in step S. In addition the scroll movement by the scroll control unit is not limited to the present embodiment. For example the scroll control unit can move the display region to a display region without moving from the display region to the display region at one time. Further the scroll control unit can move the display region from the display region to the display region .

In addition in step S the extracted region storage control unit does not perform extraction and storage of EMF files in a portion corresponding to the EMF files already stored in the memory in the display regions in the web page. Thus when the print control unit outputs an image based on a plurality of EMF files as illustrated in it is not necessary to consider an overlap of the corresponding regions in the web page in a plurality of EMF files.

However in step S the extracted region storage control unit can store in the memory an intermediate file corresponding to the whole display region in the web page. In such a case the extracted region storage control unit can store in the memory information indicating coordinates of a region corresponding to the intermediate file in the web page. When the intermediate file contains information indicating coordinates of the corresponding region in the web page the extracted region storage control unit can perform the determination by comparing the coordinates of the intermediate file in the web page based on the information contained in the intermediate file stored in the memory.

In addition an intermediate file in the present embodiment uses an EMF format but a portable document format PDF or an XML paper specification XPS can be used. A generation method of intermediate data by PDF and XPS can be generated by a conventional technique similar to EMF.

Further in the above description when the CPU stores an image corresponding to a print region the region displayed in web page is changed by performing scroll movement as illustrated in . However when the CPU executes processing of scroll movement for storing an intermediate file in the memory the CPU can control the scroll movement so as not to display the scroll movement on the display apparatus .

The display control unit stores in the memory such as the RAM information indicating a display region acquired by the display region acquisition unit when the structured document printing module is started. As for the timing for example it can be after the display region acquisition unit acquires a display region in step S in the flowchart illustrated in or after the region determination unit determines that the print region is not contained in the display region in step S i.e. after the region determination unit determines to perform scroll movement.

In steps S S S and S when the scroll control unit performs scroll movement the display control unit performs control so as not to change an image displayed on the browser . As for the method for example in data processed by the scroll control unit the display control unit can control data indicating a display region for displaying on the display apparatus so as not to be changed from the already stored data indicating the display region. In other ways the display control unit can perform control so as not to change display with respect to the browser until storing of an image corresponding to a print region ends.

Further when the scroll control unit performs such scroll movement the display control unit stores information indicating a region which is an acquired display region. Then even when the scroll movement is performed and the display region moves to the region the region is actually displayed.

Then the display region displayed in such steps is not changed and the same processing as that illustrated in is executed. More specifically while the image actually displayed on the display apparatus by the browser is fixed the scroll control unit performs scroll movement so as to display the print region of the web page which is not displayed on the screen changes the display region and generates an intermediate file.

Then when the processing illustrated in ends the scroll control unit moves the scroll position to the display region stored by the display control unit and cancels the control for fixing the display screen by the display control unit .

According to the present embodiment the print control unit can execute printing of the print region without a user being conscious of scroll.

In addition in the above described embodiment the image processing apparatus extracts a region overlapping a print region in a display region and stores the extracted region. However the method is not limited and for example the image processing apparatus can perform mask processing for storing an image in a display region and replacing a region not overlapping a print region with predetermined pixel values.

In addition in the above described embodiment a case in which processing is performed by the PC is described. However the present invention is not limited to this configuration. Processing can be performed by the printer . In such a case a control unit in the printer executes processing as an image processing apparatus according to an exemplary embodiment of the present invention and a printing unit in the printer becomes a printing apparatus for printing an image. Furthermore in the above described embodiment a web page downloaded from the server on the Internet is described. However the present invention is not limited to this configuration. The present invention can be applied to an application that cannot perform rendering of the whole of a generated page when a part of the page is displayed.

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU or MPU that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiment s and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiment s . For this purpose the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device e.g. computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all modifications equivalent structures and functions.

This application claims priority from Japanese Patent Application No. 2009 155311 filed Jun. 30 2009 which is hereby incorporated by reference herein in its entirety.

