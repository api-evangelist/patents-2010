---

title: Systems and methods of timing DTMF tones for telephony control
abstract: Control and status information between a mobile device and another device can be signaled over a voice channel using DTMF tones, e.g., a pre-defined sequence of DTMF tones can signal a desired message (more generally, a feature code). Tones sent are separated from each other by a time gap (Ttimer). If a receiving device does not receive a sequence of DTMF tones that can be matched to stored definitions of feature codes, then the receiving device generates a negative ACK. Also, if the sending device does not receive either negative or positive ACK, then sending device resends all tones of the feature code after a retry delay (Ttimer). Rather than having the Ttimer start when tones for a feature code start to be transmitted, the Ttimer is started after the Ttimer expires for the last tone of a feature code. Thus, only one timer is running (either Tor T), rather than having multiple timers running concurrently. Race conditions between the timers are avoided.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08391457&OS=08391457&RS=08391457
owner: Research In Motion Limited
number: 08391457
owner_city: Waterloo
owner_country: CA
publication_date: 20101104
---
This application claims priority from U.S. Provisional Pat. App. Ser. No. 61 328 110 filed on Apr. 26 2010 the contents of which are incorporated herein in their entirety for all purposes.

The present application relates to voice telephony and more particularly to control and status signaling over voice channels such as in third party call control scenarios.

Voice telephony remains a major application of interest for business and personal use. In an example corporate setting a telephony installation at a site can have a large number of users connected to a Private Branch Exchange PBX server which can interface those users to a smaller number of outside lines e.g. an E1 or T1 line a PBX can be implemented using a server with telephony cards for example . A PBX can interface with other servers and systems such as one or more application servers that can provide enhanced services to devices connected to the PBX such as mobile devices. For example a PBX can interface with an application server over an IP connection using SIP signaling. Services provided by an application server can include voice mail single number reachability call forwarding park and conferencing for example. PBX systems also can communicate with each other over trunk lines and packet networks depending on implementation.

A PBX can perform services for a voice call based on direction from an application server. For example a PBX can initiate an outgoing call to a number specified by an application server using SIP signaling to the PBX. A PBX also can provide information about incoming calls to an application server. For example a PBX can provide ANI information to an application server for a call incoming to the PBX which may be provided a service by the application server. An application server can provide what are known as third party call control services to voice devices. In third party call control an application server can control aspects of a call in which it is not a party. Such control can include controls such as transfer remote mute and so on. Where a data channel between the application server and a party to the call exists then such commands can be signaled and acknowledged over that data channel. In the absence of a data channel DTMF tones provided over the voice channel are used. Continuing to enhance a user experience even when using such DTMF tones is desirable.

In many cases modern mobile devices such as phones smartphones and other network enabled devices can access both a data network and a voice network depending on technology access of each network type may occur concurrently or interleaved . It is becoming increasingly desirable especially for corporate users to be able to use their mobile phones in a manner similar to their deskphones such as having similar functionality one number reachability and so on. Such capabilities can be provided to mobile devices through an application server that can send and receive status information and control commands over a data channel with the mobile device. If a data channel is not currently available DTMF tones can be sent over a voice channel for these purposes.

Although data networks such as those operating according to well known packet switching protocols have flow control and error recovery mechanism to establish reliable transport e.g. windowing sequence of ordering and buffering voice networks do not provide similar control and recovery mechanisms for DTMF tones.

In these disclosures DTMF tones can be used to indicate feature request and response codes for example. Those codes may contain at least one DTMF digit 0 9 A D each tone is sent individually with some time gap between digits. These tones cannot be sent like a UDP packet or TCP packet.

For example there is no sequencing to control the order of request and response codes and a receiving end cannot tell a sending side which feature code or response code or portion thereof has an error. Rather when the receiving end detects any error in or cannot process a feature code or response code it can only request the sending end to retransmit the last feature code or response.

Traditionally a PBX e.g. PBX provides telephony services for a closed group of private telephones for example within an enterprise or a hotel. However in many cases the services to the private telephone desirably could also be extended out to a mobile device that communicate via third party networks such as wide area cellular networks or through wireless local area networks. In these situations SMP server may be added as an adjunct to the PBX and can take an active role in providing services to mobile devices.

SMP server can be connected to PBX through a packet switched connection that can use the Internet Protocol IP .

PSTN can communicate with Public Land Mobile Network PLMN and by particular example with a switching control within PLMN . Such communication is for accepting calls from PLMN to be carried on PSTN and vice versa as an example. SS7 signaling can be employed between PSTN and PLMN . PSTN is depicted to have telephones and coupled thereto. Other implementations can include multiple gateways that translate between or among different signaling protocols.

PLMN communicates with a mobile device . Communication between PLMN and mobile device can take place using a wide variety of technologies some of which are capable of supporting only voice traffic either voice traffic and data traffic or simultaneous voice and data traffic to from mobile device . PLMN also can use Internet to receive send traffic to and from corporate network as indicated by communication link . Communication between network and PLMN also may be carried via a relay .

Mobile device includes one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN and optionally a WLAN. In various embodiments the PLMN and mobile device may be configured to operate in compliance with any one or more of a number of wireless protocols including GSM GPRS CDMA EDGE UMTS EvDO HSPA 3GPP or a variety of others. It will be appreciated that the mobile device may roam within PLMN as well as into other PLMNs i.e. that the depicted PLMN represents one or more such wireless access networks that operate according to what a person of ordinary skill would understand as broadband cellular access technologies .

For example in some instances a dual mode mobile device and or the enterprise network can be configured to facilitate roaming between the PLMN and a WLAN and are thus capable of seamlessly transferring sessions such as voice calls from a connection with a cellular interface of a dual mode device to a WLAN interface of such a dual mode device and vice versa.

GSM signaling can be implemented using the Fast Associated Control Channel FACCH . FACCH is a logical channel on a digital traffic channel that can be used to send urgent signaling control messages. The FACCH channel sends messages by replacing speech data with signaling data for short periods of time. In GSM two special reserved bits are used to inform the receiving device if the data in the current time slot is digitally coded subscriber traffic or alternatively a FACCH message. Switching control manages the conversion between GSM signaling and SS7 signaling for clarity a network of base stations operating within PLMN is not separately depicted and usually there is a connection between switching control and one or more base station elements where device can be connected to such base station elements. GSM signaling can be relayed through the base station to a termination point in switching control . 

In some embodiments PBX may be connected to one or more conventional analog telephones . The PBX is also connected to or part of the enterprise network and through it to telephone terminal devices such as digital telephone sets softphones operating on computers and so on. Within the enterprise network each individual may have an associated extension number sometimes referred to as a PNP private numbering plan or direct dial phone number. Calls outgoing from PBX to PSTN or incoming from PSTN to PBX can be circuit switched calls typically in the absence of gateway . Gateway also can be considered part of enterprise network and a boundary of such enterprise network depicted in is primarily for convenience. Within the enterprise e.g. between the PBX and terminal devices voice calls are increasingly packet switched calls for example Voice over IP VoIP calls.

SMP server can perform some aspects of messaging or session control like call control and advanced call processing features. SMP server may in some cases also perform some media handling. Collectively SMP server and PBX may be referred to as the enterprise communications platform server generally designated . It will be appreciated that the enterprise communications platform and in particular SMP server can be implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX and other network connections. Although SMP server may be implemented on a stand alone server it will be appreciated that it may be implemented into an existing control agent server as a software component comprising instructions configuring a processor operating with other software components to implement the functionality attributed to it. As will be described below SMP server may be implemented as a multi layer platform.

The enterprise communications platform implements the switching to connect session legs and may provide the conversion between for example a circuit switched call and a VoIP call or to connect legs of other media sessions. In some embodiments in the context of voice calls the enterprise communications platform provides a number of additional functions including automated attendant interactive voice response call forwarding voice mail etc. It may also implement certain usage restrictions on enterprise users such as blocking international calls or 1 900 calls. In many embodiments Session Initiation Protocol SIP may be used to set up manage and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform for example Web Services Computer Telephony Integration CTI protocol Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions SIMPLE and various custom Application Programming Interfaces APIs .

One of the functions of enterprise communications platform is to extend the features of enterprise telephony to the mobile devices . For example the enterprise communications platform cay allow mobile device to perform functions akin to those normally available on a standard office telephone such as the digital telephone set or analog telephone set . Example features may include direct extension dialing enterprise voice mail conferencing call transfer call park etc.

The depicted system may include a number of enterprise associated mobile devices device is depicted . Device can be a device equipped for cellular communication through the PLMN or a dual mode device capable of both cellular and WLAN communications.

Enterprise network typically includes a number of networked servers computers and other devices. For example enterprise network may connect one or more desktop or laptop computers one shown . The connection may be wired or wireless in some embodiments. The enterprise network may also connect to one or more digital telephone sets one shown .

Dashed boundary depicts that where there is no data channel these connections may be absent such that usage of a voice channel for status and control signaling would be used.

As depicted in these concurrently running timers can cause race conditions that need to be accounted for during tone transmission. Preferably rather than having such concurrently running timers in aspects according to this disclosure timers preferably run serially as described below.

In these examples it was shown that the Ttimer was started after sending the last digit determination . An alternative equivalent formulation is to run the Ttimer again and shorten the Ttimer by an appropriate amount again keeping their serialization.

Processing module communicates with mass storage which can be composed of a Random Access Memory and of non volatile memory . Non volatile memory can be implemented with one or more of Flash memory PROM EPROM and so on. Non volatile memory can be implemented as flash memory ferromagnetic phase change memory and other non volatile memory technologies. Non volatile memory also can store programs device state various user information one or more operating systems device configuration data and other data that may need to be accessed persistently.

User input interface can comprise a plurality of different sources of user input such as a camera a keyboard a touchscreen and a microphone which can provide input to speech recognition functionality .

Processing module also can use a variety of network communication protocols grouped for description purposes here into a communication module which can include a Bluetooth communication stack which comprises a L2CAP layer a baseband and a radio . Communications module also can comprise a Wireless Local Area Network interface which comprises a link layer with a MAC and a radio . Communications module also can comprise a cellular broadband data network interface which in turn comprises a link layer with MAC . Cellular interface also can comprise a radio for an appropriate frequency spectrum . Communications module also can comprise a USB interface to provide wired data communication capability. Other wireless and wired communication technologies also can be provided and this description is exemplary.

Referring to there is depicted an example of mobile device . Mobile device comprises a display and a cursor or view positioning device here depicted as a trackball which may serve as another input member and is both rotational to provide selection inputs and can also be pressed in a direction generally toward housing to provide another selection input. Trackball permits multi directional positioning of a selection cursor such that the selection cursor can be moved in an upward direction in a downward direction and if desired and or permitted in any diagonal direction. The trackball is in this example situated on a front face not separately numbered of a housing to enable a user to maneuver the trackball while holding mobile device in one hand. In other embodiments a trackpad or other navigational control device can be implemented as well.

The mobile device in also comprises a programmable convenience button to activate a selected application such as for example a calendar or calculator. Further mobile device can include an escape or cancel button a menu or option button and a keyboard . Menu or option button loads a menu or list of options on display when pressed. In this example the escape or cancel button menu option button and keyboard are disposed on the front face of the mobile device housing while the convenience button is disposed at the side of the housing. This button placement enables a user to operate these buttons while holding mobile device in one hand. The keyboard is in this example a standard QWERTY keyboard.

In the foregoing separate boxes or illustrated separation of functional elements of illustrated systems does not necessarily require physical separation of such functions as communications between such elements can occur by way of messaging function calls shared memory space and so on without any such physical separation. As such functions need not be implemented in physically or logically separated platforms although they are illustrated separately for ease of explanation herein.

For example different embodiments of devices can provide some functions in an operating system installation that are provided at an application layer or in a middle layer in other devices. Different devices can have different designs such that while some devices implement some functions in fixed function hardware other devices can implement such functions in a programmable processor with code obtained from a computer readable medium.

Further some aspects may be disclosed with respect to only certain examples. However such disclosures are not to be implied as requiring that such aspects be used only in embodiments according to such examples.

The above description occasionally describes relative timing of events signals actions and the like as occurring when another event signal action or the like happens. Such description is not to be construed as requiring a concurrency or any absolute timing unless otherwise indicated.

Certain adaptations and modifications of the described embodiments can be made. Aspects that can be applied to various embodiments may have been described with respect to only a portion of those embodiments for sake of clarity. However it is to be understood that these aspects can be provided in or applied to other embodiments as well. Therefore the above discussed embodiments are considered to be illustrative and not restrictive.

