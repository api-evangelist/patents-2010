---

title: Using DNS reflection to measure network performance
abstract: A top level domain name system (DNS) server receives a DNS query from a local DNS resolver, the DNS query requesting a network address corresponding to a domain name. The top level DNS server reflects the local DNS resolver to a reflector DNS server. The reflector DNS server reflects the local DNS resolver to a collector DNS server, which in turn returns the network address to the local DNS resolver. The reflector DNS server and collector DNS server are both in the same data center, and one or more network performance measurements for communications between the local DNS resolver and the data center are determined based on the communications between the local DNS resolver and both the reflector DNS server and the collector DNS server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08326980&OS=08326980&RS=08326980
owner: Microsoft Corporation
number: 08326980
owner_city: Redmond
owner_country: US
publication_date: 20100428
---
Networked services are available that provide various functionality to users throughout the world. These networked services are oftentimes provided by server computers in data centers that are located in different geographic areas. The workload of a networked service can be spread across the different data centers so that different users access different ones of these data centers. However it can be problematic to determine which of multiple data centers a particular user is to access.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

In accordance with one or more aspect a reflector domain name system DNS server and a collector DNS server are included in a data center. A first DNS request for a network address corresponding to a domain name is received at the reflector DNS server from a local DNS resolver. A first response is returned to the local DNS resolver the first response indicating to the local DNS resolver to obtain the network address from the collector DNS server. A second DNS request for the network address corresponding to the domain name is received at the collector DNS server from the local DNS resolver. A second response is returned to the local DNS resolver the second response including the network address corresponding to the domain name. Based on two or more of the first request the second request the first response and the second response one or more network performance measurements for communications between the local DNS resolver and the data center are determined.

Using DNS reflection to measure network performance is discussed herein. A domain name system DNS query is resolved by reflecting the query to multiple different DNS servers in a data center one of which provides a network address requested in the DNS query. One or more network performance measurements for communications between a local DNS resolver and the different DNS servers in the data center used in resolving the DNS query are determined during the resolution of the DNS query. These network performance measurements can include a round trip time indicating a communication delay between the local DNS resolver and the data center and or packet loss between the local DNS resolver and the data center. A record of the network performance measurements determined for different DNS queries is maintained and can be used to determine which data centers are to be accessed by which computing devices.

Each computing device can be a variety of different types of devices. For example a computing device can be a desktop computer a mobile station an entertainment appliance a set top box communicatively coupled to a display device a television a cellular or other wireless phone a game console an automotive computer and so forth. Thus computing device may range from a full resource device with substantial memory and processor resources e.g. personal computers game consoles to a low resource device with limited memory and or processing resources e.g. traditional set top boxes hand held game consoles . Different computing devices can be the same or alternatively different types of computing devices.

Each data center includes one or more DNS servers and one or more operation servers . Operation servers operate to provide one or more services to computing devices . For example operation severs can provide one or more of an information service e.g. hosting one or more Web pages a social networking service an email service a messaging service an image and or video sharing service a file storage service a gaming or other entertainment service and so forth. DNS servers operate to provide addresses of operation servers to computing devices allowing computing devices to access and use the services provided by operation servers .

Similar to the discussion of computing devices above DNS servers and operation servers can be a variety of different types of computing devices ranging from full resource devices with substantial memory and processor resources to low resource devices with limited memory and or processing resources. Each data center typically includes multiple servers e.g. on the order of tens hundreds or even more servers .

It should be noted that data centers can be located in various places throughout the world. Data centers are oftentimes physically located throughout the world in order to be geographically closer to different groups of users. However two or more data centers can be located in close geographic proximity to one another. The advantage of diversified geographic presence is to provide multiple choices of data centers for any particular end user and if done correctly the end user will be served from the optimal data center which yields the best perceived performance by the end user.

Operation servers across the multiple data centers operate collectively to provide one or more services to computing devices . Operation servers in different data centers can store duplicate data and or work together to provide the one or more services to computing devices . Although operation servers across multiple data centers operate collectively each computing device typically communicates with the operation servers of one data center . The using DNS reflection to measure network performance techniques discussed herein can be used to identify for a particular computing device which data center is to be accessed by that particular computing device .

The using DNS reflection to measure network performance techniques discussed herein makes use of a DNS system. A DNS system allows services to be identified using a domain name such as a Uniform Resource Locator URL that is typically more easily used and referred to by users than network addresses such as Internet Protocol IP v4 or v6 addresses . The operation servers in data centers have different network addresses but correspond to the same domain name. Similarly the multiple data centers operating collectively to provide one or more services to computing devices correspond to the same domain name. One or more DNS servers operate to map a particular domain name to a corresponding network address that can be used by a computing device to access a particular operation server. This mapping of a domain name to a corresponding network address is also referred to as DNS resolution.

Although many of the discussions herein refer to URLs and IP addresses it is to be appreciated that other domain names and or network addresses can be used with the using DNS reflection to measure network performance techniques discussed herein. Additionally the DNS system discussed herein refers to a system in compliance with the well known DNS protocol e.g. as discussed in Network Working Group Request for Comments 1035 November 1987 . However it is to be appreciated that the using DNS reflection to measure network performance techniques discussed herein can be used in conjunction with other systems that similar to the DNS protocol allow domain names to be mapped to particular network addresses.

Local DNS resolver receives DNS queries from computing devices that are requests for IP addresses for particular URLs. Local DNS resolver forwards these DNS queries to one or more DNS servers . When an IP address is returned to resolver in response to a DNS query the IP address is returned to the computing device from which the DNS query was received. Additionally local DNS resolver can optionally maintain a cache that maps URLs to IP addresses allowing local DNS resolver to return in response to a DNS query for a URL that is included in the cache an IP address for that URL. Local DNS resolver can be implemented in a variety of different devices such as in a server or other device of an Internet Service Provider ISP in a device on a local area network that includes computing devices and so forth. Although a single local DNS resolver is illustrated in it is to be appreciated that any number of local DNS resolvers can be included in system .

For example assume operation servers work collectively to provide an Internet search engine. This Internet search engine can be easily identified using a simple URL such as www.bing.com . In order to access the Internet search engine a computing device submits a DNS query to local DNS resolver requesting an IP address for the URL www.bing.com . Local DNS resolver in turn submits the DNS query to one or more DNS servers requesting an IP address for the URL www.bing.com . The particular DNS servers to which local DNS resolver submits the DNS query is discussed in more detail below. Eventually a DNS server returns to local DNS resolver an IP address for the URL www.bing.com . This IP address is the address of one of operation servers and the local DNS resolver returns this IP address to the computing device from which the DNS query was received. The particular operation server whose IP address is returned to local DNS resolver can be selected by one or more DNS servers in a variety of different manners. For example the particular operation sever can be selected as an operation server in a data center having a smallest communication delay between the computing device that submitted the DNS query and the data center an operation server in a data center having a smallest number of lost packets between the computing device that submitted the DNS query and the data center and so forth. The computing device can subsequently access the Internet search engine using the IP address it received in response to the DNS query to access one of operation servers .

One or more of DNS servers maintain a map of local DNS resolvers to IP addresses. This map indicates the particular IP address of an operation server that is to be returned in response to a DNS query from local DNS resolver . It should be noted that this map is typically a mapping of local DNS resolvers to operation server IP addresses although alternatively this map can be a mapping of computing devices to operation server IP addresses.

Situations can arise where a DNS server receives a DNS query but delegates responsibility for returning the particular IP address of an operation server in response to the DNS query to another DNS server. DNS reflection refers to a specific usage of delegation where one DNS server controls a delegation response in such a way that a querying local DNS resolver upon receiving the response will issue another DNS request to a second desirable DNS server.

During operation of system one or more network performance measurements for communications between local DNS resolver and one or more DNS servers of a data center are determined. These network performance measurements are determined as part of the process of returning an IP address for a URL submitted in a DNS query as discussed in more detail below. A record of these network performance measurements is maintained and can be used as a basis for updating the map of local DNS resolvers to IP addresses that is maintained by DNS servers .

Computing device submits a DNS query to local DNS resolver requesting an IP address for a particular URL. This particular URL can also be referred to as the query URL or query domain name. Local DNS resolver receives DNS query and submits that DNS query as DNS query to top level DNS server . Top level DNS server is an authoritative name server also referred to as a master name server for that particular URL and maintains a mapping of local DNS resolvers to IP addresses. Local DNS resolver can obtain the IP address of top level DNS server in a variety of different matters such as receiving an indication of the IP address from top level DNS server obtaining the IP address from another device e.g. accessed via a network such as network of in accordance with the DNS system and so forth.

In response to DNS query top level DNS server determines an IP address of an operation server in a data center to be returned to computing device . Top level DNS server determines this IP address by looking up local DNS resolver in map . This lookup can be based on the IP address of local DNS resolver which is included in DNS query a name or other identifier of local DNS resolver and so forth. Map includes a mapping of local DNS resolver to a particular IP address which is the IP address of an operation server in a data center to be returned to computing device .

Top level DNS server provides a response to local DNS resolver in response to DNS query . Response includes an identifier of reflector DNS server as well as an identifier of collector DNS server . Response includes an indication to local DNS resolver that top level DNS server has delegated the DNS resolution to reflector DNS server . Response also includes the IP address of the operation server to be returned to computing device however this IP address is included in response in such a manner that local DNS resolver does not understand that the IP address is included in response . Thus local DNS resolver requests the IP address from reflector DNS server as discussed in more detail below.

In one or more embodiments response includes a CNAME which is also referred to as an alias. The CNAME embeds IP addresses of reflector DNS server and collector DNS server and also a target IP address which is the IP address of an operation server in a data center to be returned to computing device as determined based on map . Reflector DNS server and collector DNS server can also be referred to as sub domains servers for top level DNS server because servers and can manage mapping local DNS resolvers to network addresses for portions of the domain for which top level DNS server is the authoritative name server. Response also includes a sub domain server name and a sub domain IP address indicating a server to which local DNS resolver is to send DNS query which are the name and IP address of reflector DNS server .

For example response can include a CNAME of rand.lax.reflector collector target.msrapollo.net. In the CNAME reflector is the IP address of reflector DNS server collector is the IP address of collector DNS server and target is the target IP address. Furthermore response can include a server name or NS of ns.reflector collector target.msrapollo.net. This server name is the name of reflector DNS server . Response can also include a server address or NS ADDRESS of reflector. This server address is the IP address of reflector DNS server .

Local DNS resolver receives response and determines based on the indication in response that the DNS resolution has been delegated to reflector DNS server . Although the target IP address is embedded in response local DNS resolver does not know how to interpret the embedded target IP address. Thus in response to receiving response local DNS resolver submits DNS query to reflector DNS server requesting the IP address for the particular URL. DNS query includes the IP address of the operation server to be returned to computing device and also an identifier of collector DNS server both of which were received by local DNS resolver in response e.g. embedded in the CNAME . Thus even though embedded within response is the IP address of the operation server to be returned to computing device local DNS resolver submits DNS query to reflector DNS server because local DNS resolver does not know how to interpret the embedded target IP address.

In one or more embodiments response includes the name and IP address of reflector DNS server informing local DNS resolver of the DNS server to which DNS query is to be submitted. Local DNS resolver includes in DNS query the CNAME received in response as the domain name for which a network address is requested.

Reflector DNS server receives DNS query and in response to DNS query generates a response that includes an indication that reflector DNS server has delegated the DNS resolution to collector DNS server . This is also referred to as reflecting the DNS query to collector DNS server . Response also includes the IP address of the operation server to be returned to computing device which was determined by top level DNS server and included in response as discussed above .

In one or more embodiments response includes the CNAME which was received in DNS query . Response also includes a sub domain server name and a sub domain IP address indicating a server to which local DNS resolver is to send DNS query which are the name and IP address of collector DNS server .

Local DNS resolver receives response and determines based on the indication in response that the DNS resolution has been delegated to collector DNS server . Although the target IP address is embedded in response local DNS resolver does not know how to interpret the embedded target IP address. Thus in response to receiving response local DNS resolver submits DNS query to collector DNS server requesting the IP address for the particular URL. DNS query includes the IP address of the operation server to be returned to computing device which was received by local DNS resolver in response e.g. embedded in the CNAME . Thus even though embedded within response is the IP address of the operation server to be returned to computing device local DNS resolver submits DNS query to collector DNS server because local DNS resolver does not know how to interpret the embedded target IP address.

In one or more embodiments response includes the name and IP address of collector DNS server informing local DNS resolver of the DNS server to which DNS query is to be submitted. Local DNS resolver includes in DNS query the CNAME received in response as the domain name for which a network address is requested.

Collector DNS server receives DNS query and in response to DNS query generates a response that includes the IP address of the operation server to be returned to computing device which was determined by top level DNS server and included in response and response as discussed above . Local DNS resolver receives response and in response generates response to send to computing device . Response includes the IP address of the operation server to be returned to computing device that was determined by top level DNS server as discussed above.

In one or more embodiments collector DNS server obtains the target IP address which is embedded in the CNAME received in DNS query from DNS query . Collector DNS server returns the target IP address to local DNS resolver as the IP address of an operation server in a data center to be returned to computing device as determined based on map .

In addition one or more network performance measurements for communications between local DNS resolver and data center are determined. These network performance measurements can be round trip times RTTs between local DNS resolver and data center and or packet loss measurements between local DNS resolver and data center . The network performance measurements for communications between local DNS resolver and data center are determined based on communications between local DNS resolver and servers and .

A round trip time for communications between local DNS resolver and data center can be determined by collector DNS server or alternatively by another module or device. This round trip time is determined as the amount of time that elapsed between the sending of response to local DNS resolver and the receiving of DNS query by collector DNS server . Alternatively this round trip time can be determined in other manners such as the amount of time elapsed between the receiving of DNS query by reflector DNS server and the receiving of DNS query by collector DNS server . It is to be appreciated that a variety of different factors can influence this round trip time such as the distance between local DNS resolver and data center a number and or type of devices in the network between local DNS resolver and data center the bandwidth of the network between local DNS resolver and data center an amount of traffic or congestion on the network between local DNS resolver and data center and so forth.

Packet loss measurements between local DNS resolver and data center can be determined in different manners. Communications between local DNS resolver and DNS servers e.g. servers and are carried out by communicating information in packets over a network e.g. network of . Situations can arise where one or more packets that are sent over the network do not arrive at their intended destination and thus are referred to as being lost packets. The loss of one or more packets can be identified in different manners.

In one or more embodiments the loss of a packet including a response from reflector DNS server to local DNS resolver can be identified. Local DNS resolver typically expects a response to DNS query within a particular amount of time oftentimes referred to as a timeout period of sending DNS query . If local DNS resolver does not receive a response within this timeout period resolver resends DNS query . Thus if reflector DNS server receives the same DNS query multiple times server knows that a response was not received by local DNS resolver . Reflector DNS server can assume that a packet including response was lost each time server receives a same DNS query that it previously received.

Additionally although different local DNS resolvers can implement different timeout periods these timeout periods are typically a fixed amount of time such as 0.5 seconds or 1 second. These timeout periods are typically much larger than round trip times between local DNS resolver and data center . Thus timeout periods can be readily distinguished from round trip times. Reflector DNS server can determine the timeout period used by local DNS resolver by not sending a response to a DNS query . As no response was sent local DNS resolver will resend the DNS query after the timeout period used by local DNS resolver elapses. Reflector DNS server can determine the time that elapses between the initially sent DNS query and the resent DNS query e.g. rounded to the closest half second as the timeout period used by local DNS resolver .

In one or more embodiments the loss of a packet including a DNS query from local DNS resolver to collector DNS server can be identified. Collector DNS server knows to expect DNS query after a response is sent by reflector DNS server . If the amount of time between sending a response and receiving DNS query exceeds a threshold amount collector DNS server can assume that a packet including DNS query was lost. This threshold amount of time can be based on the timeout period used by local DNS resolver which can be determined as discussed above. If the amount of time between sending a response and receiving DNS query exceeds the timeout period used by local DNS resolver then collector DNS server can assume that a packet including DNS query was lost.

In one or more embodiments the loss of a packet including a response from collector DNS server to local DNS resolver can be identified. Local DNS resolver typically expects a response to DNS query within a particular amount of time oftentimes referred to as a timeout period of sending DNS query . This timeout period can be the same timeout period used by local DNS resolver in expecting a response to DNS query or alternatively a different timeout period. If local DNS resolver does not receive a response within this timeout period resolver resends DNS query . Thus if collector DNS server receives the same DNS query multiple times server knows that a response was not received by local DNS resolver . Collector DNS server can assume that a packet including response was lost each time server receives a same DNS query that it previously received.

Similarly the loss of multiple packets can be determined. Timeout periods can be different for different lost packets. For example a first timeout of 1 second can be used after a first packet is lost a second timeout of 2 seconds can be used if the next packet is lost a third timeout of 3 seconds can be used if the next packet is lost and so forth. These different timeout periods can be identified as discussed above e.g. reflector DNS server can determine the timeout periods used by local DNS resolver by not sending response to the first three DNS queries received from local DNS resolver .

Alternatively local DNS resolver may include functionality to identify and maintain information regarding lost packets. In such situations local DNS resolver may also expose an interface such as an application programming interface API which can be invoked e.g. by reflector DNS sever and or collector DNS server to obtain the information regarding lost packets from local DNS resolver .

Various information regarding the loss of packets can be maintained. This information regarding the loss of packets can include for example a packet loss ratio or frequency with which packets are lost a packet loss pattern e.g. a number of packets that are lost consecutive packets being lost time of day of packet loss day of week of packet loss etc. and so forth.

The loss of one or more packets is typically identified by reflector DNS server and or collector DNS server although alternatively the loss of one or more packets can be identified by another module or device of data center . In addition to identifying the loss of one or more packets the direction in which such loss occurred can also be identified. That is the loss of packets sent from data center to local DNS resolver can be identified separately from the loss of packets sent from local DNS resolver to data center . Various information regarding the loss of packets in particular directions in which such losses occurred can be maintained.

Thus as part of the DNS resolution process network performance measurements for communications between the local DNS resolver and the data center are obtained. For each of multiple different local DNS resolvers network performance measurements can be obtained between the local DNS resolver and multiple different data centers. A record of these obtained network performance measurements is maintained. This record can be maintained in different manners such as one or more histograms. The network performance measurements between the local DNS resolvers and the data centers can be used to determine the mapping of a particular local DNS resolver to a particular operation server IP address of a data center as stored in resolver to address map .

The network performance measurements between the local DNS resolvers and the data centers can be used to determine the mapping of a particular local DNS resolver to a particular operation server IP address of a data center in a variety of different manners. For a particular local DNS resolver the obtained network performance measurements between that local DNS resolver and the different data centers can be compared or otherwise analyzed to select a data center. An IP address of an operation server in the selected data center is included in map . For example the data center for which the smallest round trip time measurement between the data center and the particular local DNS resolver is obtained can be selected. By way of another example the data center for which the smallest number of lost packets between the data center and the particular local DNS resolver is obtained or for which the smallest number of lost packets sent from the data center to the particular local DNS resolver is obtained can be selected. Alternatively the obtained round trip time measurements and or packet loss measurements can be used with a variety of other techniques or processes to select a data center.

In one or more embodiments resolver to address map includes an initial mapping for a particular local DNS resolver that can be updated over time based on the network performance measurements as discussed above. The initial mapping for a particular local DNS resolver can be obtained in a variety of different manners and based on a variety of different criteria such as geographic location the data centers to which other local DNS resolvers are mapped random selection other criteria or rules and so forth. For example top level DNS server can identify an initial mapping for local DNS resolver by analyzing prefixes in the network address of resolver and mapping an operation server address to resolver that is mapped to another local DNS resolver having the same prefixes. E.g. if local DNS resolver has a network address of aaa.bbb.ccc.ddd and another local DNS resolver in map has a network address of aaa.bbb.ccc.eee then these two local DNS resolvers have network addresses with the same prefix aaa.bbb.ccc and top level DNS server maps local DNS resolver to the same operation server address as the local DNS resolver that has network address aaa.bbb.ccc.eee is mapped.

In one or more embodiments local DNS resolver can be reflected to reflector DNS server and collector DNS server in response to each DNS query that local DNS resolver submits to top level DNS server . Alternatively top level DNS server can determine that local DNS resolver is to be reflected to servers and only for particular DNS queries. These particular DNS queries can be identified in a variety of different manners such as being based on a time interval based on a frequency with which DNS queries are received based on a number of DNS queries that have been previously reflected for a particular local DNS resolver and so forth. For example top level DNS server can determine that one DNS query per hour for each local DNS resolver is to be reflected to servers and . By way of another example top level DNS server can determine that each DNS query from a local DNS resolver is to be reflected to servers and until a threshold number of DNS queries have been reflected after which one DNS query per hour for the local DNS resolver is to be reflected to servers and . This threshold number can be a fixed number e.g. 50 DNS queries or alternatively a relative number e.g. twice the number of data centers corresponding to the domain name .

Alternatively other techniques can be used to obtain network performance measurements between data center and local DNS resolver and the using DNS reflection to measure network performance techniques discussed herein used when such other techniques are unsuccessful or alternatively to confirm network performance measurements obtained via such other techniques . For example a device in data center such as a device including reflector DNS server and collector DNS server can use a conventional ping request to obtain network performance measurements between data center and local DNS resolver . Round trip times and or lost packets when using ping request can be identified using similar techniques to those discussed above. The using DNS reflection to measure network performance techniques discussed herein can be used to confirm the network performance measurements obtained using ping requests or can be used in the event local DNS resolver does not respond to the ping request.

By way of another example a device in data center such as a device including reflector DNS server and collector DNS server can obtain network performance measurements by sending a DNS query to local DNS resolver . This DNS query can be a request to resolve a variety of different domain names such as simply . or .com . Round trip times and or lost packets when submitting such DNS queries can be identified using similar techniques to those discussed above. The using DNS reflection to measure network performance techniques discussed herein can be used to confirm the network performance measurements obtained when submitting such DNS queries or can be used in the event local DNS resolver does not respond when submitting such DNS queries.

Additionally it should be noted that local DNS resolver can be reflected to reflector DNS server and collector DNS server in response to DNS queries for one or more particular domains. When top level DNS server receives a DNS query for one of these one or more particular domains local DNS resolver is reflected to servers and as discussed above. However when top level DNS server receives a DNS query for a different domain server returns the requested network address from map without reflecting local DNS resolver .

Having top level DNS server reflect DNS queries only for one or more particular domains supports a variety of different usage scenarios. For example a Web page to be returned to computing device can have embedded therein a URL to a particular file. This particular file can be small in size and need not even be displayed as part of the Web page. The URL to this particular file however is one of the one or more particular domains for which DNS queries are reflected. Thus when the Web page is requested by computing device the URL for the Web page is resolved and the network address is returned by top level DNS server without reflecting the DNS query. The Web page can then be retrieved and displayed as computing device and as part of this retrieving and displaying the embedded URL to the particular file is identified. This embedded URL however is resolved by reflecting the DNS query that includes that URL to reflector DNS server and collector DNS server as discussed above.

In the example of one data center is illustrated. However multiple data centers correspond to a particular domain name as discussed above. Top level DNS server can determine the particular data center to which a local DNS resolver is reflected in a variety of different manners such as being based on a time interval based on a frequency with which DNS queries are reflected to particular data centers based on a number of DNS queries that have been previously reflected to each data center based on geographic locations of the data centers and so forth. For example top level DNS server can determine that one DNS query per hour for each local DNS resolver is to be reflected to each data center. By way of another example top level DNS server can maintain an ordered list of data centers and identify data centers in a round robin fashion so each time server determines that a DNS query is to be reflected to a particular data center the next data center identified in the ordered list of data centers is selected as the data center to which the DNS query is reflected.

By way of yet another example top level DNS server can determine that if the network performance measurements obtained for the current data center to which a particular local DNS resolver is mapped are above a threshold amount then that particular local DNS resolver need not be reflected to data centers that are not in close geographic proximity to that current data center. This threshold amount can be a fixed value e.g. a round trip time of less than 0.2 seconds or a relative value e.g. a round trip time that is less than at least 70 of the round trip times for the operation server addresses of the other mappings in map . The geographic proximity of data centers can be determined in different manners such as a linear distance in miles data centers located in the same city data centers located in the same continents and so forth. For example if top level DNS server determines that the network performance measurements obtained for the current data center to which a particular local DNS resolver is mapped are above a threshold amount and the current data center is located in North America then that particular local DNS resolver need not be reflected to data centers in Europe or Australia.

Reflector DNS server and collector DNS server have two different IP addresses and are viewed as two different servers by local DNS resolver . Nonetheless in one or more embodiments reflector DNS server and collector DNS server are both implemented on the same computing device e.g. having multiple network interfaces allowing the same clock to be used by both servers and . Allowing servers and to use the same clock simplifies obtaining the network performance measurements because clocks from two different devices need not be synchronized. Alternatively reflector DNS server and collector DNS server can be implemented on two different computing devices with the clocks on these two different computing devices being synchronized to one another.

It should be noted that the network performance measurements that are obtained using the techniques discussed herein are network performance measurements between a local DNS resolver and the data center. Similarly a resolver to address map is a mapping of local DNS resolvers to network addresses of operation servers in data centers. The network performance measurements obtained based on a DNS query from a particular computing device that is sent by the local DNS resolver are used for any additional computing devices could also use the same local DNS resolver. Thus the various computing devices that use the same local DNS resolver will have DNS queries resolved to the same network address. For example in addition to computing device multiple additional computing devices can use local DNS resolver to resolve DNS queries. Each of these multiple additional computing devices as well as computing device have the same DNS queries resolved to the same network addresses.

In the discussions above resolver to address map as discussed as being maintained by top level DNS server . Alternatively map can be maintained by other devices such as the reflector DNS servers the collector DNS servers or other devices in the various data centers. Depending on the manner in which map is maintained copies of the map can be synchronized across different devices. For example collector DNS servers in the various data centers can maintain map and each change made to map by a particular collector DNS server is communicated to the other collector DNS servers. In embodiments in which map is maintained by a device other than top level DNS server it is to be appreciated that the network address being requested in DNS query would not be determined by server and embedded in response returned by server . Rather the network address being requested in DNS query would be determined by another device. For example if map is maintained by the collector DNS servers in the various data centers then collector DNS server determines the network address being requested in DNS query and the network address is thus not included in DNS queries and .

Additionally in the discussions above a DNS query is discussed as being reflected to one reflector DNS server and one collector DNS server. However it is to be appreciated that the using DNS reflection to measure network performance techniques discussed herein can be used to reflect a DNS query to multiple different DNS servers of within a data center. For example rather than reflecting the local DNS resolver to collector DNS server the local DNS resolver can be reflected to multiple different reflector DNS servers within data center . Network performance measurements for these additional reflections can be obtained analogous to the discussion above regarding obtaining measurements. Furthermore it is to be appreciated that the using DNS reflection to measure network performance techniques discussed herein can be used to reflect a DNS query to multiple different reflector and collector DNS servers of multiple different data centers. For example rather than returning the requested network address collector DNS server can reflect DNS queries from local DNS resolver to the reflector DNS server of an additional data center corresponding to the domain name. Network performance measurements for this additional data center can be obtained analogous to the measurements obtained for data center as discussed above.

In the discussions of reflector DNS server and collector DNS server are discussed as being separate DNS servers. Local DNS resolver is typically configured so as to not resend a DNS query to the same DNS server after resolver has received a response from that DNS server. Accordingly two different DNS servers and are used in . If local DNS resolver were to support resending of a DNS query to the same DNS server after resolver has received a response from that DNS server then reflector DNS server and collector DNS server can be the same DNS servers.

In process a top level DNS server receives a DNS query for a network address corresponding to a domain name act . This DNS query is received from a local DNS resolver and the domain name is typically identified as a URL as discussed above. The requested network address can be an IP address or alternatively another address as discussed above.

The top level DNS server returns a response to the local DNS resolver that reflects the local DNS resolver to another server to obtain the network address act . This other server is a reflector DNS server included in a data center that is typically but need not be a different data center than the data center that includes the top level DNS server.

The reflector DNS server receives a DNS query for the network address corresponding to the domain name act . This DNS query in act is received from the local DNS resolver and the reflector DNS server that receives this DNS query in act is the reflector DNS server indicated by the top level DNS server in act .

The reflector DNS server returns a response to the local DNS resolver that reflects the local DNS resolver to yet another server to obtain the network address act . This other server to which the local DNS resolver is reflected is a collector DNS server included in the same data center as the reflector DNS server. Alternatively one or more reflector DNS servers can reflect the local DNS resolver to another reflector DNS server before a reflector DNS server eventually reflects the local DNS resolver to a collector DNS server.

The collector DNS server receives a DNS query for the network address corresponding to the domain name act . This DNS query in act is received from the local DNS resolver and the collector DNS server that receives this DNS query in act is the collector DNS server indicated by the reflector DNS server in act .

The collector DNS server returns to the local DNS resolver a response including the requested network address corresponding to the domain name act . The collector DNS server can identify the network address in different manners such as identifying the network address as embedded in the DNS query received by the collector DNS server by accessing a table or other record of network addresses and so forth as discussed above. As the response returned by the collector DNS server effectively terminates the DNS reflection operation the query received in act can also be referred to as the final DNS query and the response return in act can also be referred to as the final DNS response.

Additionally the communications between the local DNS resolver in both reflector DNS server and collector DNS server are used to determine network performance measurements act . These network performance measurements are measurements of network performance for communications between the local DNS resolver and the data center that includes both reflector DNS server and the collector DNS server. Different network performance measurements can be identified in act such as round trip times and packet loss information as discussed above.

Thus it can be seen that the using DNS reflection to measure network performance techniques discussed herein leverage the DNS system to obtain network performance measurements based on actual communications between local DNS resolvers and data centers. The reflecting of DNS queries to another server is supported by typical local DNS resolvers as part of their normal operation and thus no alteration to typical existing local DNS resolvers need be made to support the using DNS reflection to measure network performance techniques discussed herein. Furthermore the local DNS resolvers need not be configured to respond to additional requests such as ping requests to which they would not otherwise be configured to respond.

Furthermore the using DNS reflection to measure network performance techniques discussed herein is employed during the DNS resolution process. Requests for and or responses to requests for data maintained by an operation server of a data center are typically not affected. In other words the using DNS reflection to measure network performance techniques discussed herein affect which servers are accessed when resolving a DNS query not which servers are accessed in obtaining requested data from an operation server of a data center.

Computing device includes one or more processors or processing units one or more computer readable media which can include one or more memory and or storage components one or more input output I O devices and a bus that allows the various components and devices to communicate with one another. Computer readable media and or one or more I O devices can be included as part of or alternatively may be coupled to computing device . Bus represents one or more of several types of bus structures including a memory bus or memory controller a peripheral bus an accelerated graphics port a processor or local bus and so forth using a variety of different bus architectures. Bus can include wired and or wireless buses.

Memory storage component represents one or more computer storage media. Component can include volatile media such as random access memory RAM and or nonvolatile media such as read only memory ROM Flash memory optical disks magnetic disks and so forth . Component can include fixed media e.g. RAM ROM a fixed hard drive etc. as well as removable media e.g. a Flash memory drive a removable hard drive an optical disk and so forth .

The techniques discussed herein can be implemented in software with instructions being executed by one or more processing units . It is to be appreciated that different instructions can be stored in different components of computing device such as in a processing unit in various cache memories of a processing unit in other cache memories of device not shown on other computer readable media and so forth. Additionally it is to be appreciated that the location where instructions are stored in computing device can change over time.

One or more input output devices allow a user to enter commands and information to computing device and also allows information to be presented to the user and or other components or devices. Examples of input devices include a keyboard a cursor control device e.g. a mouse a microphone a scanner and so forth. Examples of output devices include a display device e.g. a monitor or projector speakers a printer a network card and so forth.

Various techniques may be described herein in the general context of software or program modules. Generally software includes routines programs objects components data structures and so forth that perform particular tasks or implement particular abstract data types. An implementation of these modules and techniques may be stored on or transmitted across some form of computer readable media. Computer readable media can be any available medium or media that can be accessed by a computing device. By way of example and not limitation computer readable media may comprise computer storage media and communications media. 

 Computer storage media include volatile and non volatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer storage media include but are not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by a computer.

 Communication media typically embody computer readable instructions data structures program modules or other data in a modulated data signal such as carrier wave or other transport mechanism. Communication media also include any information delivery media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example and not limitation communication media include wired media such as a wired network or direct wired connection and wireless media such as acoustic RF infrared and other wireless media. Combinations of any of the above are also included within the scope of computer readable media.

Generally any of the functions or techniques described herein can be implemented using software firmware hardware e.g. fixed logic circuitry manual processing or a combination of these implementations. The terms module and component as used herein generally represent software firmware hardware or combinations thereof. In the case of a software implementation the module or component represents program code that performs specified tasks when executed on a processor e.g. CPU or CPUs . The program code can be stored in one or more computer readable memory devices further description of which may be found with reference to . The features of the using DNS reflection to measure network performance techniques described herein are platform independent meaning that the techniques can be implemented on a variety of commercial computing platforms having a variety of processors.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

