---

title: Maintaining access times in storage systems employing power saving techniques
abstract: An apparatus, method, and computer program for maintaining access times in a data processing system, wherein the data processing system comprises a plurality of storage devices, the apparatus including: a receive component, for receiving a command or an availability message, wherein an availability message indicates whether the storage device is available; an evaluate component for evaluating a plurality of first relationships between the storage devices and a plurality of first values, wherein each of the first values indicates whether a related storage device is a redundant; a send component, for sending a power message to one or more of the storage devices; and an update component for updating a second relationship between the redundant storage device and a plurality of second values, wherein each of the second values indicates whether a related redundant storage device is available.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09619163&OS=09619163&RS=09619163
owner: International Business Machines Corporation
number: 09619163
owner_city: Armonk
owner_country: US
publication_date: 20100429
---
The invention relates to the field of storage systems. In particular the invention relates to an apparatus method and computer program for maintaining access times in storage systems employing power saving techniques.

Within a storage subsystem the usage pattern of the storage devices may vary. Some storage devices may be configured to hold on line data that must be available for immediate access such as databases file systems etc . Other storage devices might hold data that is rarely accessed for example archive data or data that is rarely used .

Modern storage systems employ various techniques to save power. One such technique is through the use of Massive Array of Idle Disks MAID methods. A MAID storage subsystem is one that offers the facility for disk storage devices to be spun down when not in use. Typically the only disk storage devices that are spun down are those not holding data that require immediate response to access requests. If data on a spun down disk needs to be accessed there is a delay in the access time that may be anywhere from 10 to 60 seconds typically 30 seconds as the disk storage device is restarted. Some MAID implementations spin down the storage device fully whereas some just park the heads so actual response time when accessing MAID data will vary. MAID is typically implemented within large storage subsystems that hold multiple storage devices.

Redundant Array of Inexpensive Disks RAID technology is pervasive in the storage industry. RAID provides a method whereby storage reliability performance capacity and availability may be built into a storage subsystem using low cost disks using disk arrays with inbuilt redundancy. RAID may come in many forms depending on the relative trade off requirements of reliability performance capacity and availability of data. In RAID arrays redundant data is created on portions stripes of each disk. The data on any failing disk may be recovered from the redundant data on other disks of the array.

In RAID 0 data is striped over a number n of disks. RAID 0 provides performance and availability advantages as the n disks may be accessed simultaneously. However if a disk fails all data is lost.

In RAID 1 data is duplicated across every disk in the array. RAID 1 provides reliability advantages as data may be recovered in the event of a disk failure. However overall capacity is reduced due to data duplication.

In a RAID 4 and in a RAID 5 array of n member storage device the first m bytes of the array data where m is the stripe length are held on a first storage device the second m bytes is held on the second storage device and so on up to and including the n 1 storage device. The n storage device holds the parity data that is the exclusive OR XOR of the stripe data held on the other storage devices of the array. If one storage device fails data may be reconstructed from the remaining storage devices using the parity data. Overall capacity is reduced due to the requirement to preserve storage device space for parity values. In a RAID 4 array parity data is stored on a dedicated parity storage device. In contrast in a RAID 5 array parity data is rotated around the storage devices that make up the array.

RAID 10 is a combination of RAID 0 and RAID 1. Data is striped over n storage devices of the array and that data is mirrored over a further n storage devices.

Therefore 2n storage devices make up an array. Loss of one or more storage devices is tolerated as the data may be recovered from the surviving mirror storage device. If two storage devices that are a mirrored pair are lost data access is lost. However overall capacity is reduced due to data duplication.

Typically MAID and RAID techniques are not combined as the delay in access times in a MAID subsystem conflict with availability requirements of RAID systems.

Viewed from a first aspect the present invention provides a storage management apparatus for maintaining access times in a data processing system wherein the data processing system comprises a plurality of storage devices the apparatus comprising a receive component for receiving a command an evaluate component responsive to receiving the command for evaluating a plurality of first relationships between the plurality of storage devices and a plurality of first values wherein each of the first values indicates whether a related storage device is a redundant storage device a send component for sending a power message to one or more of the plurality of storage devices in response to the evaluate component determining that one or more of the plurality of storage devices is a redundant storage device the receive component further receiving an availability message wherein the availability message indicates whether the redundant storage device is available and an update component in response to the receive component receiving the availability message for updating a second relationship between the redundant storage device and a plurality of second values wherein each of the second values indicates whether a related redundant storage device is available.

The present invention provides an apparatus method and computer program to achieve power savings of spinning down storage devices whilst maintaining access times in the event of access to those storage devices by using the redundancy and recovery procedures of Redundant Array of Inexpensive Disks RAID storage subsystems. One advantage of the solution over the current known solutions is that response times to data on storage devices that are spun down is in the order of milliseconds rather than in the order of seconds.

By combining the RAID redundancy techniques above and choosing to spin down selected storage devices depending on the RAID level power savings may still be achieved whilst still maintaining millisecond response times for reads and writes. Dependent on the type of RAID arrays a management apparatus may select which storage device may be powered down yet still enable access to the RAID data through use of the redundancy offered by the RAID array. In an embodiment the redundancy and the availability of a storage device is used to determine whether the storage device may be powered down or up.

In an embodiment the present invention provides an apparatus wherein the power message indicates a power down command. Alternatively in another embodiment the present invention provides an apparatus wherein the power message indicates a power up command.

In an embodiment the present invention provides an apparatus wherein the command comprises a read command wherein the evaluate component in response to the receive component receiving a read command evaluates a plurality of the second values associated with the plurality of storage devices and wherein the apparatus further comprises a read component in response to the evaluate component determining that one or more of the plurality of storage devices is not available for reading data from the plurality of storage devices and a reconstruct component for reconstructing data from the plurality of storage devices.

The present invention provides reads from a storage array without having to power up a storage device that has been powered down for power saving operations. In an embodiment the powered down storage device is powered up after a read so that subsequent reads may take place. If no subsequent read is performed the redundant storage device may be powered down.

In an embodiment the present invention provides an apparatus wherein the command comprises a write command wherein the evaluate component in response to the receive component receiving a write command determines a plurality of the second values associated with the plurality of storage devices and wherein the apparatus further comprises a write component in response to the evaluate component determining that one or more of the plurality of storage devices is not available for writing data to the plurality of storage devices. To this extent the present invention provides writes to a storage array without having to power up a storage device that has been powered down for power saving operations. In an embodiment the powered down storage device is powered up after a write so data may be written to a storage device that had been powered down and so that subsequent writes may take place. If no subsequent write is performed the redundant storage device may be powered down.

Viewed from a second aspect the present invention provides a method for maintaining access times in a data processing system wherein the data processing system comprises a plurality of storage devices the method comprising receiving a command evaluating a plurality of first relationships between the plurality of storage devices and a plurality of first values wherein each of the first values indicates whether a related storage device is a redundant storage device sending a power message to one or more of the plurality of storage devices in response to the evaluate component determining that one or more of the plurality of storage devices is a redundant storage device receiving an availability message wherein an availability message indicates whether the redundant storage device is available and in response to the receive component receiving the availability message updating a second relationship between the redundant storage device and a plurality of second values wherein each of the second values indicates whether a related redundant storage device is available.

In an embodiment the present invention provides a method wherein the power message indicates a power down command. Alternatively the present invention provides a method wherein the power message indicates a power up command.

In an embodiment the present invention provides a method wherein the command comprises a read command and wherein the method further comprises in response to the receive component receiving a read command evaluating a plurality of the second values associated with the plurality of storage devices in response to the evaluate component determining that one or more of the plurality of storage devices is not available reading data from the plurality of storage devices and reconstructing data from the plurality of storage devices.

In an embodiment the present invention provides a method wherein the command comprises a write command wherein the method further comprises in response to the receive component receiving a write command determining a plurality of the second values associated with the plurality of storage devices and in response to the evaluate component determining that one or more of the plurality of storage devices is not available writing data to the plurality of storage devices.

Viewed from a third aspect the present invention provides a computer program loadable into the internal memory of a digital computer comprising software code portions for performing when the program is run on a computer the present invention.

Redundant data may be held in different forms but for the purpose of explaining the present invention a RAID 4 array will be used as an example embodiment. However it will be appreciated that the invention is applicable to any RAID version including future versions which use a redundancy scheme similar to that described above.

The illustrated data processing system comprises a server node subsystem having a set of server nodes which are connectable through a network to a back end storage subsystem . The network typically comprises network devices for example switches and cabling that connect the server node subsystem to the hardware back end storage subsystem . The storage subsystem may comprise a variety of physical storage devices having for example a stand alone Just a Bunch of Disks JBOD device and a RAID array . The RAID array comprises a plurality of storage devices . The storage device may be used to store a parity value associated with data stored on the other storage devices in the RAID array . The parity storage device typically is not exclusively used to store a parity value as in industry standard RAID implementations parity is often rotated around the storage devices that comprise the RAID array . The storage devices may be presented to the server node subsystem as a set of physical or logical storage volumes not depicted . Typically the system is managed by a management subsystem comprising management servers connectable to the server node subsystem the storage subsystem and the network devices through the network or through a separate Local Area Network LAN . Typically a RAID Controller controls the functionality of the RAID array including data accesses and power controls to the individual storage devices . Read and write commands may be sent to the storage subsystem by a requester not depicted that may be an application program operable in the data processing system .

To illustrate a use of the table as an example array is depicted as a RAID 4 array comprising storage devices id id id and id and array is depicted as a RAID 1 array comprising storage devices id and id . Further in array storage devices id id id are used solely for data and storage devices id is always used for parity. In contrast in array as a RAID 5 array parity is rotated between writes. For example during one write storage devices id and id are used for data and storage device id used for parity but in a subsequent write id and id are used for data and id is used for parity. Storage devices id id and id are marked as D P to depict that the storage devices may be used for either data or parity. Typically for RAID 10 and RAID 4 parity is not rotated.

The term available as used herein throughout the description and claims is used to mean that the storage device is available for typical data access operations. An availability message as used herein throughout the description and claims is construed as meaning a message indicating the availability or non availability of a storage device .

It will be clear to one of ordinary skill in the art that the RAID table and the availability table are by way of example only and may comprise more or less information than that depicted. Alternatively the tables may be combined.

The method starts at step . At step the receive component either receives a command YES from one of the components in the data processing system or receives an availability message NO from a storage device . At step if the receive component receives an availability message from a storage device the update component updates the availability table to indicate whether the storage device is available or not available.

The receive component may receive an availability message from each storage device in the RAID array . A command may be a maintain command that indicates that the apparatus should instigate a maintenance method to power down the redundant storage device of the RAID array . Alternatively a command may be a read or a write command that indicates that a read or a write respectively should be carried out to the RAID array .

At step if the receive component receives a command the evaluate component evaluates the RAID table to determine whether the storage devices indicated in the command are members of a RAID array . If the storage devices are not members of a RAID array NO the method ends.

However if the storage devices are members of a RAID array YES at step the receive component determines whether the command is a maintain command. If the command is a maintain command YES the method continues at step to the maintain method of . However if the command is not a maintain command NO at step the receive component determines whether the command is a read command. If the command is a read command YES the method continues at step to the read method of . However if the command is not a read command NO at step the receive component determines whether the command is a write command. If the command is a write command YES the method continues at step to the write method of . At step if the command is not a write command NO the method ends.

The maintain method starts at step . In response to receiving a maintain command at step the evaluate component determines a storage device that may be maintained by powering down the storage device . The storage device to maintain is determined by the evaluate component evaluating usage patterns of the underlying RAID array . An example of a usage pattern which will be used to illustrate the method is that of selecting the parity storage device as being the redundant storage device in the RAID array . Alternatively if the storage device is used for either storing data or parity a scheme may be used to rotate power commands to the storage devices of the RAID array . The evaluate component also determines whether the storage devices of the RAID array indicated are data storage devices parity storage devices or either data or parity storage devices .

If no determined storage devices are redundant NO the maintain method ends at step . If the evaluate component determines that a redundant storage device does exist YES at step the evaluate component evaluates the availability table and at step determines whether the redundant storage device is available. If the redundant storage device is not available NO the method ends at step . If the evaluate component determines that the redundant storage device is available YES at step the send component sends a power off command to the redundant storage device . However if the evaluate component determines that redundancy of the array has already been lost either due to an earlier power off command or a storage device failure a further power off command is not sent. The maintain method ends at step . As a result of the maintain method a storage device may send an availability message to the management apparatus.

In an alternative embodiment if the RAID array has a plurality of parity storage devices a power down command may be sent to the plurality of redundant storage devices .

In an alternative embodiment if usage patterns change so that restoration of full redundancy is required the maintain method is also operable to power on redundant storage devices .

The power command is typically either a power down or a power up command. However the power command may also be one of a plurality of different power management commands associated with storage devices . One example is a command to park the heads of a disk storage device whereas another may spin the storage device down. Typically power control commands are initiated to appropriate storage devices through a predefined application programming interface API . Also typically a maintain command may be sent to the management apparatus from a storage management administration level of the data processing system .

Alternatively the maintain command may be generated internally to the management apparatus by the management apparatus assessing usage patterns and automatically powering down specific storage devices based on predefined thresholds of usage patterns set by a storage management administration level. Alternatively the maintain command may be generated automatically according to a predefined schedule.

Read access to the storage devices does not cause an unavailable or spun down storage device to be spun up as data that resides on the spun down storage device may be reconstructed by the remaining storage devices . Millisecond access times for reads may therefore be achieved.

The read method starts at step . A read command comprises the storage devices of the RAID array at which the read command is directed. In response to receiving a read command at step the evaluate component evaluates the RAID table to determines whether the specified storage devices of the specified RAID array are data storage devices parity storage devices or either data or parity storage devices .

If no specified storage devices are redundant NO at step data is read from the specified storage devices . If the evaluate component determines that a redundant storage device does exist YES at step the evaluate component evaluates the availability table and at step determines whether the storage devices are available. If all storage devices are available YES data is read from the specified storage devices .

If the evaluate component determines that at least one storage device is not available NO at step the read component reads data and parity from the available storage devices . At step the reconstruct component reconstructs the data from the read data and read parity. At step the reconstructed read data is returned to the requester of the data. At step a power on command is sent to the storage device that was not available so that if there is a subsequent read from the RAID array all storage devices will be available. The read method ends at step . As a result of the read method a storage device may send an availability message to the management apparatus. In an alternative embodiment step is eliminated.

For a RAID 10 or RAID 4 array where parity is not rotated data is accessible without the need to reconstruct. For a RAID 5 array if the storage device that stores parity is the storage device that is unavailable then data is accessible with the need to reconstruct.

A RAID array that has one storage device not available is called a degraded array . Typically for RAID 4 RAID 5 or RAID 10 arrays writes are not made to degraded arrays because those writes are not protected until writes are made to all storage devices . If a write is made to a degraded array there is an exposure to data loss if a further storage device is lost. However there are techniques that allow writes to proceed in RAID 5 systems such as component in doubt or write journaling that do allow writes to degraded arrays. These techniques are operable for temporary losses of storage devices . A bitmap or a journal of writes is stored so that the data may be written to the missing storage device when the lost storage device returns. However should the storage device not return the RAID array remains exposed to data loss.

For RAID arrays with a plurality of redundant storage devices for example in a RAID 6 array writes are allowed if only one storage device is unavailable as there is still a parity storage device . Therefore write access times may be guaranteed without data loss if a storage device has been spun down.

For writes various levels of access may be achieved depending on the strength of the underlying RAID algorithms.

The write method starts at step . A write command comprises the storage devices of the RAID array that the write command is directed at.

In response to receiving a write command at step the evaluate component evaluates the RAID table to determine whether the specified storage devices of the specified RAID array are data storage devices parity storage devices or either data or parity storage devices .

If no specified storage devices are redundant NO at step data is written to the specified storage devices . If the evaluate component determines that a redundant storage device does exist YES at step the evaluate component evaluates the availability table and at step determines whether the storage devices are available. If all storage devices are available YES data is written to the specified storage devices .

If the evaluate component determines that at least one storage device is not available NO at step the write component writes data and parity to the available storage devices . However as at least one of the storage devices is unavailable the write to the unavailable storage device is not completed successfully. The write component marks the stripe of data in persistent storage to indicate that the RAID array is degraded. In an alternative embodiment a known write journaling method can be used. At step the requester of the write command is sent a message to confirm that the write was completed. At step a power on command is sent to the unavailable storage device . The previously unavailable storage device may send an availability message to the management apparatus. Once the previously unavailable storage device is available again redundancy may be restored by writing data on the recently available storage device . The data written may have been stored in a write journal in the RAID controller write cache or the data may be reconstructed from the data and parity previously successfully written. Once the data has been successfully been written to the recently available storage device the data is unmarked to indicate that the RAID array is no longer degraded. Another advantage of powering up a storage device after a write command is that the storage device is made available for subsequent writes. If subsequent writes do not occur the maintain method may be followed to power down the storage device . The write method ends at step .

It will be clear to one of ordinary skill in the art that all or part of the method of the preferred embodiments of the present invention may suitably and usefully be embodied in a logic apparatus or a plurality of logic apparatus comprising logic elements arranged to perform the steps of the method and that such logic elements may comprise hardware components firmware components or a combination thereof.

It will be appreciated that the method and arrangement described above may also suitably be performed fully or partially in software running on one or more processors not depicted in the Figures and that the software may be provided in the form of one or more computer program elements carried on any suitable data carrier also not depicted in the Figures such as a magnetic or optical disk or the like.

For the avoidance of doubt the term comprising as used herein throughout the description and claims is not to be construed as meaning consisting only of .

