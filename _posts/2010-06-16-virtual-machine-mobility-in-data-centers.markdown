---

title: Virtual machine mobility in data centers
abstract: A data center management device determines that a virtual machine should be moved from a first physical system to a second physical system. The data center management device instructs a first service appliance at the first physical system to perform state synchronization with a second service appliance at the second physical system in order to continue providing the services offered prior to the move. The data center management device instructs the virtual machine to be instantiated at the second physical system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08775625&OS=08775625&RS=08775625
owner: Juniper Networks, Inc.
number: 08775625
owner_city: Sunnyvale
owner_country: US
publication_date: 20100616
---
Data centers include facilities that are used to house computer systems and associated components including telecommunications and storage systems. Data centers typically contain a set of routers and or switches that transport traffic between the computer systems and external networks. A data center typically runs applications which handle the business and data of an organization. Components of the applications are databases file servers application servers and other types of components.

Consolidation of data centers is one new approach being taken in the Information Technology IT industry. Consolidation of data centers involves the centralization of data centers in mega data centers. These mega data centers are changing the paradigm of computing from one of local computing to distant or cloud based computing e.g. cloud computing . Cloud computing involves the provision of dynamically scalable and possibly virtualized resources as a service over the Internet.

Along with the consolidation of data centers into mega data centers another trend in the IT industry is the virtualization of multi core Central Processing Units CPUs to run multiple independent virtual systems. Virtualized CPUs may implement multiple virtual machines. Each virtual machine includes a software implementation of a machine that executes programs like a physical machine. A virtual machine may include two different types of virtual machines a system virtual machine that provides a system platform that supports the execution of a complete operating system and a process virtual machine that is designed to run a single program. The software running in a virtual machine is limited to the resources and abstractions provided by the virtual machine.

In accordance with one embodiment a method may include determining at a data center management device that a virtual machine should be moved from a first physical system to a second physical system. The method may further include sending from the data center management device a first set of instructions to service appliances at the first and second physical systems to perform state synchronization with one another. The method may additionally include sending from the data center management device a second set of instructions to instantiate a copy of the virtual machine in the second physical system. The method may further include shutting down the virtual machine in the first physical system.

In another implementation a device may include a memory configured to store instructions. The device may further include a processor configured to execute the instructions to determine that a virtual machine should be moved from a first physical system to a second physical system instruct a first service appliance at the first physical system to perform state synchronization with a second service appliance at the second physical system where the first and second service appliances implement at least one of a firewall service an Internet Protocol Security IPSec service a Virtual Private Network VPN service a Wide Area Network WAN optimization service a load balancing service an Intrusion Detection and Prevention IDP service or a Unified Threat Management UTM service and cause a copy of the virtual machine at the first physical system to be instantiated at the second physical system.

In an additional implementation a data center may include at least one server configured to implement a virtual machine where the virtual machine handles a session at a first data center. The data center may further include a service appliance configured to execute a service related to the session where the service includes one of a firewall service an Internet Protocol Security IPSec service a Virtual Private Network VPN service a Wide Area Network WAN optimization service a load balancing service an Intrusion Detection and Prevention IDP service or a Unified Threat Management UTM service where the service appliance receives first instructions to perform on demand state synchronization for the virtual machine with another service appliance in a second data center and performs the state synchronization with the other service appliance based on the received first instructions and where the virtual machine receives second instructions to cause a copy of the virtual machine to be instantiated at a server at the second data center.

The following detailed description refers to the accompanying drawings. The same reference numbers may be used in different drawings to identify the same or similar elements. Also the following detailed description does not limit the invention. Instead the scope of the invention is defined by the appended claims and equivalents.

Virtualization has many benefits including the ability to move running virtual machines from one physical system to another. This movement of virtual machines is called virtual machine mobility. Within a data center virtual machines can be moved to better utilize underlying physical machines and in addition to save on power and cooling costs. Using inter data center mobility it is also possible to distribute load during peak hours and also to handle disaster recovery situations.

Service appliances play an important role in consolidated data centers. Service appliances provide various services in a data center including for example security services such as firewall services Virtual Private Network VPN services and or Intrusion Detection and Prevention IDP services or other services including for example Wide Area Network WAN optimization services Unified Threat Management UTM services and or server load balancing services. In order for the data center service appliances to be effective the data center service appliances need to handle virtual machine mobility between data centers. Almost all service appliances that operate within data centers are stateful in nature and require session and application state information to function properly. Embodiments described herein enable state synchronization between service appliances in separate data centers when a virtual machine moves between the data centers.

A data center management device not shown may determine that virtual machine should move to another data center and may instruct virtual machine to move to data center N. The data center management device may determine that virtual machine should move to another data center based on a number of different reasons. Such reasons may include but are not limited to distributing data center load during peak usage periods handling disaster recovery situations saving on power and cooling costs or to better utilize the underlying physical machines of the data centers. Upon receipt of instructions from the data center management device virtual machine may engage in VM motion to move to data center N. VM motion may include the exporting of files objects etc. from data center to data center N such that VM may be implemented at data center N.

Subsequent to movement of VM from data center to data center N VM may continue to handle session and may use service appliance N for executing the services related to the handling of session . Synchronization of state related to session between service appliance and service appliance N permits service appliance N to continue where service appliance left off in executing the services related to the handling of the session. The state information that may be synchronized may include but is not limited to policy information related to session a user account name of the user associated with session session state information an Internet Protocol IP address related to the session e.g. IP address of VM data center data center N .

Data centers through N may each include components such as for example racks of servers for implementing consolidated data centers. Each of data centers through N may though include any type of physical system or device that is capable of implementing one or more virtual machines.

Clients through P may include client entities that may engage in sessions with data center through N. Clients through P may include for example desktop laptop or palmtop computers a cellular radiotelephone a personal digital assistant PDA etc. The sessions may relate to a specific operation or function requested by the client to be performed by a data center . Data center management device may include a device e.g. a server device that may manage virtual machine mobility between data centers through N and may also manage service appliance state synchronization between data centers through N. In some implementations an entity other than data center management device may manage some aspects of the mobility between data centers through N. For example a network device other than data center management device may be responsible for managing the operation of service appliances while data center management device may be responsible for the overall operation of data centers . This additional network device and data center management device may communicate with one another through a predetermined application programming interface API . As a particular example of this implementation consider the situation in which a vendor specific control device is responsible for controlling service appliances manufactured by that vendor. Data center management device may notify the vendor specific control device which may in turn control the service appliances manufactured by that vendor.

Network may include any type of network such as a local area network LAN a wide area network WAN a telephone network e.g. the Public Switched Telephone Network PSTN or a cellular network an intranet the Internet or a combination of networks. Clients through P data center management device and data centers through N may connect to network via wired and or wireless connections.

The components of network depicted in are examples. Network may include fewer additional different and or differently arranged components than are shown in . Additionally or alternatively one or more of the components depicted in may perform one or more of the tasks described as being performed by one or more other components of .

Server racks through X may each include a rack of multiple servers which are interconnected with a respective TOR switch . Each one of servers may include a server entity that may implement one or more virtual machines.

TOR switches through X may each include a switch that switches traffic from servers of a respective server rack to switch es . Switch es may include one or more switches for switching traffic from server racks through X to service appliance e and or to network . Service appliance s may include one or more service appliances that may execute services related to handling sessions between data center and respective clients through P. Service appliance s may execute services such as for example firewall VPN IDP WAN optimization UTM and or server load balancing services. Interfaces through Z may include components for interfacing switch es with network . For example interfaces through Z may receive data from switch es and transmit the data to network and may further receive data from network and forward the data to switch es . TOR switches may also switch traffic between servers in a server rack .

The components of data center depicted in are examples. Data center may include fewer additional different and or differently arranged components than are shown in . Additionally or alternatively one or more of the components depicted in may perform one or more of the tasks described as being performed by one or more other components of .

Bus may include a path that permits communication among the components of data center management device . Processor may include a processor a microprocessor or processing logic e.g. an application specific integrated circuit ASIC or a field programmable gate array FPGA that may interpret and execute instructions. Main memory may include a random access memory RAM or another type of dynamic storage device that may store information and instructions for execution by processor . ROM may include a ROM device or another type of static storage device that may store static information and instructions for use by processor . Storage device may include a magnetic and or optical recording medium and its corresponding drive or a removable form of memory such as a flash memory.

Input device may include a mechanism that permits a user to input information to data center management device such as a keyboard a mouse a button a pen a touch screen voice recognition and or biometric mechanisms etc. Output device may include a mechanism that outputs information to the user including a display a light emitting diode LED a speaker etc. Communication interface may include any transceiver like mechanism that enables data center management device to communicate with other devices and or systems. For example communication interface may include mechanisms for communicating with another device or system via a network such as network .

As will be described in detail below data center management device may perform certain operations relating to controlling VM mobility at data centers through N. Data center management device may perform these operations in response to processor executing software instructions contained in a computer readable medium such as memory . A computer readable medium may be defined as a logical or physical memory device. A logical memory device may include a space within a single physical memory device or spread across multiple physical memory devices.

The software instructions may be read into memory from another computer readable medium such as storage device or from another device via communication interface . The software instructions contained in memory may cause processor to perform processes that will be described later. Alternatively hardwired circuitry may be used in place of or in combination with software instructions to implement processes described herein. Thus implementations described herein are not limited to any specific combination of hardware circuitry and software.

The components of data center management device depicted in are examples. Data center management device may include fewer additional different and or differently arranged components than are shown in . Additionally or alternatively one or more of the components depicted in may perform one or more of the tasks described as being performed by one or more other components of .

Additionally as previously discussed data center management device although shown as single entity in may be implemented by a number of different devices. For example data center management device may be implemented as a hierarchical set of devices which may be geographically distributed. Higher level management devices in the hierarchical set of devices may delegate control functions of a particular device in data center to a lower level management device that is assigned to the particular device in the data center e.g. vendor specific control devices may perform the control functions under the control of a higher level device in the hierarchical set of devices . As used herein data center management device may refer to one or more control devices.

VM motion determination unit of data center management device may determine whether virtual machines should be moved from one data center to another data center. VM motion determination unit may determine that a virtual machine should move to another data center based on a number of different reasons. Such reasons may include but are not limited to distributing data center load during peak usage periods handling disaster recovery situations saving on power and cooling costs or to better utilize the underlying physical machines of the data centers. The determination performed by VM motion determination unit may be performed automatically or in response to a manual command entered by an operator.

VM motion controlling unit may issue instructions via network based on the determination from VM motion determination unit to cause one or more virtual machines to move from one data center to another data center called a VM move operation. The VM move operation is illustrated in more detail with respect to the flow chart of . In general a VM move operation may include notifying the affected service appliances synchronizing the service appliance states and replicating the VM that is being moved at the new data center.

The functional components of data center management device depicted in are examples. Data center management device may include fewer additional different and or differently arranged functional components than are shown in . Additionally or alternatively one or more of the functional components depicted in may perform one or more of the functions described as being performed by one or more other functional components of .

The example process may include determining that a virtual machine should be moved from a first data center to a second data center block . For example VM motion determination unit of data center management device may determine that a virtual machine should move to another data center based on a number of different reasons. Such reasons may include for example distributing data center load during peak usage periods handling disaster recovery situations saving on power and cooling costs or to better utilize the underlying physical machines of the data centers. VM motion determination unit may make the VM move determination automatically or based on a manually entered user command.

VM motion determination unit may receive reports from respective data centers of the data center s current or projected loads the status of the respective data centers e.g. data center entering a hibernation or failure mode or a power or temperature status of the respective data centers. Additionally a lack of reports received at VM motion determination unit from respective data centers may be used in determining whether a virtual machine should be moved from a first data center to a second data center. For example if a certain status report for a given data center is received at data center management device for a specified period of time VM motion determination unit may determine that the data center has incurred some sort of failure indicating that the virtual machine should be moved to another data center. VM motion determination unit may thus have knowledge of the current or projected loads of multiple data centers the status of the multiple data centers and or a power or temperature status of the multiple data centers that may be used in determining whether a virtual machine should be moved from a first data center and to select an appropriate second data center to which the virtual machine should be moved.

Data center management device may notify the affected service appliances i.e. the service appliances responsible for the first VM and the service appliances that will be responsible for the second VM of the upcoming move block . In response to the notification the notified service appliances may synchronize the state of the virtual machine block . For instance the service appliance s associated with the virtual machine may transfer state information relating to the virtual machine to the second service appliance. In some implementations during state synchronization of the service appliances the session being handled by the virtual machine may be suspended until the movement is completed and until service appliance state synchronization is also completed.

The process may further include instantiating the virtual machine in the second data center block . Instantiating the virtual machine in the second data center may include transferring all the information necessary to reproduce the state of the virtual machine to the second data center and starting operation of the virtual machine at the second data center. When the virtual machine in the second data center begins operation the virtual machine may be placed in hot standby mode which may allow the virtual machine in the second data center to begin processing traffic as soon as the switchover occurs. Data center management device may control the instantiation of the virtual machine in the second data center. In one implementation a virtual machine hypervisor may control the instantiation of the virtual machine. A hypervisor also called a virtual machine monitor VMM may implement the control application through which multiple guest operating systems can execute at a host computer. In general the hypervisor may take an image of the memory of the virtual machine at the first data center and the counterpart hypervisor in the second data center may instantiate a clone of the memory image at the second data center.

The process may further include shutting down the virtual machine in the first data center block . Data center management device may for example control the first data center to remove or delete the virtual machine from the first data center.

As described herein a first service appliance at a first data center from which a virtual machine is being moved and a second service appliance at a second data center to which the virtual machine is being moved may perform on demand state synchronization related to a session being handled by the virtual machine upon movement of the virtual machine. The on demand state synchronization enables the second service appliance to continue executing a service related to handling of the session that was previously performed by the first service appliance. The on demand state synchronization described herein is scalable and eliminates the need for the brute force method of constant state synchronization. The service appliances involved in VM mobility may thus provide seamless service delivery for a session even when the session handling virtual machine moves between data centers.

The foregoing description of embodiments described herein provides illustration and description but is not intended to be exhaustive or to limit the embodiments described herein to the precise form disclosed. Modifications and variations are possible in light of the above teachings or may be acquired from practice of the invention.

While a series of blocks has been described in the order of the blocks may vary in other implementations. Also non dependent blocks may be performed in parallel. Even though particular combinations of features are recited in the claims and or disclosed in the specification these combinations are not intended to limit the invention. In fact many of these features may be combined in ways not specifically recited in the claims and or disclosed in the specification.

No element act or instruction used in the description of the present application should be construed as critical or essential to the invention unless explicitly described as such. Also as used herein the article a is intended to include one or more items. Where only one item is intended the term one or similar language is used. Further the phrase based on is intended to mean based at least in part on unless explicitly stated otherwise. The scope of the invention is defined by the claims and their equivalents.

