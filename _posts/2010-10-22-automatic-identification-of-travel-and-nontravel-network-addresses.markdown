---

title: Automatic identification of travel and non-travel network addresses
abstract: A system to automatically classify types of IP addresses associated with a user. Information, such as user names, machine information, IP address, etc., may be obtained from logs. For each user or host in the logs, home IP addresses are identified from IP addresses where the user or host shows a predetermined level of activity. Travel IP addresses are identified, which are IP addresses at locations greater than a predetermined distance from the home IP addresses, as determined from geolocation data. A pattern analysis may be performed to determine which of the home IP addresses are work IP addresses associated with the user or host. The system may thus provide a classification of a user's or host's associated IP addresses as being one of travel, home, and work IP addresses. From this classification, mobility patterns may be derived, as well as applications to enhance security, advertising, search and network management.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08615605&OS=08615605&RS=08615605
owner: Microsoft Corporation
number: 08615605
owner_city: Redmond
owner_country: US
publication_date: 20101022
---
Designers of Internet services increasingly seek to specialize their behavior and content to reflect contextual differences among their users to exploit location differences in connection bandwidth browser capabilities whether a user is known etc. Internet services increasingly are using geolocation to specialize their content and service provisioning for each user. Much of the location based information is derived from identifiers such as IP Internet Protocol addresses. For example a given user might access an Internet service from different locations such as a home a business location a hotel on a business trip or a cafe. While current geolocation tools can map each of these accesses to city level positions the context of these positions is unknown. In other words the location information does not provide any meaning to these locations with respect to the users.

A system automatically classifies groups of IP addresses associated with a user into location based categories particular to the user. For example the IP address categories may include home travel and work locations. For each user or host home IP address ranges may be identified from log files associated with activities of the user or host. Home IP address ranges are IP addresses that are regularly used by the user or host. Next travel IP addresses are identified which are IP addresses at locations greater than a predetermined distance from the home IP address ranges as determined from geolocation data. To avoid inconsistencies in the classification those addresses associated with proxies and virtual private networks VPN are pruned. An analysis may be performed to determine which of the home or travel IP addresses are actually work IP addresses associated with the user or host. From this location based information about the user s or host s IP addresses mobility patterns maybe derived as well as applications to enhance security advertising search and network management.

In accordance with some implementations a method for classifying network addresses includes collecting and analyzing user event data in logs in response to user activity and determining non travel network addresses as a first type of location information from the user event data. Travel network addresses may be determined as a second type of location information with respect to the non travel network addresses by applying a distance parameter to geolocation location information.

In accordance with other implementations a method for classifying network addresses associated with a user includes determining location information of the network addresses and identifying candidate first locations from the location information. Second locations may be determined from the candidate first locations using a geographic parameter with respect to the location information and based on patterns of use of the network addresses.

In accordance with yet other implementations a method for classifying network addresses includes determining location information of the network addresses and identifying candidate network addresses using the location information of the network addresses. Non travel network addresses and travel network addresses may be identified using the candidate network addresses and a distance parameter.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the detailed description. This summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

The present disclosure describes systems and methods for classifying a type of location a particular IP address represents with respect to a user or host. The type of location may be determined from mobility patterns of the users who operate at the locations. For example address ranges from which the same users appear consistently are more likely to be residences or workplaces home IP addresses or work IP addresses while address ranges that source a large number of distinct users who are not repeatedly seen are more likely to represent Internet infrastructure for transient users at e.g. airports cafes or hotels. A user who normally operates out of a home IP address but is later determined as sending requests from a different IP address range in a location that is e.g. hundreds of miles away can be inferred to be traveling and using a travel IP address.

Such classification of IP addresses provides information on the user population and the context of their communications. From the classification information user interests or intentions can be derived when the users access online services such as search or news portals. From a network utilization perspective decisions may be made regarding data caching and replication policies. From a security perspective different security policies may be implemented for travel IP addresses and home IP addresses as they show different security related properties. From an advertising perspective targeted advertising may be sent to travel IP addresses as travelers may be more interested in e.g. restaurants than plumbers etc.

Referring to there is illustrated is an exemplary networked computing environment in which processes of the present disclosure may be implemented. The networked computing environment may include one or more computing devices and one or more log s and a geolocation database that communicate over a communications network . The geolocation database may be connected to another computing device which is connected to the communications network . Each of the computing devices may make use of programs methods data stores programmable logic etc. to implement their associated functionalities. Each computing device and may also contain discrete functional program modules that might make use of an API application programming interface or other object software firmware and or hardware to request services of one or more of the other computing devices and log s and geolocation database . The computing devices and may span portions of the same or different devices and may comprise devices such as personal data assistants PDAs audio video devices MP3 players personal computers mobile connected devices servers data centers etc.

The communications network may support various infrastructures to enable network topologies such as client server peer to peer or hybrid architectures. The computing devices and may communicate with one another utilizing the functionality provided by protocol layer s . For example HyperText Transfer Protocol HTTP is a common protocol that is used in conjunction with the World Wide Web WWW or the Web. Typically a computer network address such as an Internet Protocol IP address or other reference such as a Universal Resource Locator URL can be used to identify the server or client computers to each other. The network address can be referred to as a URL address. Communication can be provided over a communications medium e.g. the computing devices and may be coupled to one another via wired or wireless TCP IP connection s .

For example any device connected to the communications network may contact another device such as computing device as part of an e mail service login process software update process etc. Information about the contacting device or user may be stored in the log s such as an IP address of the contacting computing device e.g. one of computing devices and device specific information a user identifier etc. Other details of the contacting computing device may be stored such as an operating system or version. As described below in further detail the information stored in the log s may be used to classify the locations from which the user or device connects to the communications network .

The geolocation database maintains geographic and network connection information about assigned and allocated IP addresses on the Internet. Querying the geolocation database by an IP address may return a location confidence assessment or network intelligence information. An example of the geolocation database may be products and services provided by Quova Corporation Mountain View Calif.

In accordance with some implementations to classify IP addresses for each user or host an IP address identification engine may categorize IP addresses using geolocation data provided by the geolocation database which provides a mapping of IP addresses to geolocation. Distances between events logged in the log s may be determined by calculating the geographic distance of the corresponding IP addresses. The IP address identification engine may infer IP addresses of home locations i.e. home IP addresses associated with the user or host without any prior knowledge of user travel activities. As described below this information may be used for the subsequent inference of IP addresses used at work places i.e. work IP addresses and those used at travel locations i.e. travel IP addresses .

In an implementation the process may begin by identifying home IP addresses which are those typically those associated with users in their general home city and or metropolitan area. Dynamic Host Configuration Protocol DHCP IP address allocation and local travel may result in home IP addresses changing frequently. However the IP address identification engine accounts for the differing IP addresses as they remain in approximately the same location both topologically and geographically.

For each IP address associated with a user or host a Border Gateway Protocol BGP prefix of the IP address as well as its geographic location city and state names are stored as a pair in an implementation. For example IP address range information could be derived from BGP tables or the whois database. The locations accessed by the user or host may be identified by counting a number of days a given pair appears in the log s . In some implementations a sliding window of e.g. 30 days may be advanced in increments of e.g. one week to determine if a predetermined number of active days at the IP address is observed. For example if at least 15 or other number active days are observed within such a window the particular pair may be defined as a candidate home location IP address. The threshold number of active days provides a level of confidence that a particular IP address is a candidate. The process may be repeated for all IP addresses associated with the user or host to identify the candidate home IP addresses for that particular user or host. Any sliding window size and increment size may be used depending on the implementation.

After obtaining the candidate home IP addresses the IP address identification engine identifies the travel IP addresses. For example for each event that occurred more than a predetermined distance from the user s or host s home location e.g. 250 miles the IP address identification engine considers the IP address associated with an event in the log s to be a candidate travel IP address for that user or host. The distance may be smaller or greater than 250 miles and is used as an amount where it is likely that events occurring outside this distance are related to travel activity.

With the candidate home IP addresses and travel IP addresses identified a filtering engine filters the addresses to remove proxy and or VPN IP addresses. Proxy and VPN IP addresses may introduce false geolocation information as the user may not be in the same geolocation as a proxy or VPN server associated with these IP addresses. For example social networking sites may automatically log users into email accounts. Such login events correspond to the IP addresses of the social networking site not the user. To identify these IP addresses a distance per time metric such as a miles per hour mph metric or a meters per second metric for example may be applied to two IP addresses that were used consecutively in time by a user or host. The mph metric is prefaced on an assumption that a user s physical travel speed has an upper bound e.g. 500 mph a typical commercial airplane speed . For example if a transition between the geolocation of a candidate home IP address and the next event associated with a travel IP address is faster than the upper bound then it is very likely that no physical travel is actually involved and the travel IP address is removed as it likely corresponds to a VPN or proxy server. In some implementations that same VPN or proxy server IP address may have been identified as a home IP address by a second host thus it is also removed from that set. Any travel IP address information obtained by that second host is also removed since the home IP address information may not be valid because of the differing classifications.

The filtering engine may also resolve inconsistencies between the candidate home IP address set and the travel IP address set. The inconsistencies may arise when different users result in the same IP address as being tagged into different categories. Such inconsistencies could arise for a variety of reasons. For example IP addresses can have inaccurate geolocation information and it may be inherently difficult to pinpoint their locations e.g. satellite IP addresses . In addition inferences based on individual user activities may create inaccuracies. For example the IP address identification engine may misclassify the home and travel addresses for a user who travels to a location for an extended period of time.

To increase the confidence level of the classification for each IP address the filtering engine examines the user population P associated with the IP address and examines the degree of consensus on its classification among P. In some implementations a decision process may examine if 1 at least two users in P consistently tag this IP address as a home or travel IP and if 2 more than half of its population P all tag this IP address in the same way. If so the initial classification is deemed to be accurate by the filtering engine . Otherwise the filtering engine may prune the IP address and the corresponding ranges from the BGP table from the final home or travel IP address set. The filtering engine may prune all such IP addresses and their entire ranges from the home IP set. Thus the output of the filtering engine is a final set of candidate home IP addresses and a set of travel IP addresses.

A pattern analysis engine may receive the final candidate home IP addresses and identify those addresses within the set that are actually home IP addresses and those that are work IP addresses. Thus the pattern analysis engine may differentiate IP addresses used at workplaces from those used at home residences. In some implementations to distinguish workplace IP addresses from those at home residences a diurnal analysis may be performed as work IP addresses tend to be used during only workdays while home addresses are mostly used at night and during weekends. The pattern analysis engine may utilize the patterns of use of the IP addresses as the patterns tend to be cyclical. The pattern analysis engine may for example distinguish a user s daily commute patterns by their request network access timestamps. Other types of analysis may be utilized that analyze the patterns of usage.

In some implementations to perform the analysis a selection of candidate home IP address pairs may be made that are 1 from different BGP ranges and 2 both accessed on a single day. For the corresponding IP address pairs if such daily access patterns repeat for more than one day for example then the pattern analysis engine may tag the address that has been active for at least 6 days out of a 7 day window as a home IP address. The pattern analysis engine may classify the other IP range as a work IP address. Thus from the candidate home IP addresses the pattern analysis engine outputs a set of actual home IP addresses and a set of work IP addresses.

Having derived the home work and travel IP address sets applications may be developed to use this information from the IP addresses and to perform operations based on the IP addresses. For example mobility patterns can be derived from the classifications by a mobility analysis engine . By determining home IP addresses a mobility analysis engine may determine a concept of a home location to examine long term mobility trends as users change their home locations over long time spans. An analysis of long term mobility can provide a global view of a user population for tasks such as resource provisioning and location based feature planning. The mobility analysis engine may develop short term user mobility trends that arise from when users travel and return to their home locations. Such short term travel patterns are useful for applications that would benefit from user population profiles e.g. targeted advertisement.

In accordance with implementations of the present disclosure because inferences are made at the IP address level application s can take advantage of this information to process requests from users or remote hosts. For example home and travel IP addresses may have different security properties where traveling hosts may be more vulnerable to attacks. For example empirical data shows that malicious login events are 20 times higher at travel IP addresses than those at home IP addresses suggesting access from travel IP addresses should operate under more stringent security policies. Moreover the larger percentage of malicious login events at travel locations also suggests there might exist other types of malicious activities on those hosts such as spreading attacks and compromising more computers. Thus machines at travel IP addresses may be more vulnerable than home computers. Because travel IP addresses are shared much more frequently directly blacklisting them may have higher false positive rates. On the other hand attackers may prefer choosing travel locations to launch their attacks because of the denser user population. Thus different defense strategies may be provided at travel locations.

Furthermore the different security properties of travel and home IP addresses suggest techniques for detecting the use of compromised accounts by attackers and other similar fraudulent activity. For example user login events from several new IP addresses within a few hours seem more likely to be benign if these addresses are at travel locations than if they are in residences. In the former case the user may simply be traveling in the latter case the events may be from bots that employ the user s account for sending spam.

The classification of home and travel IP addresses also provides an opportunity for online applications to understand user profiles. Based on the location categories of a user user interests or intentions may be inferred to customize search results and to target advertisement. For example travel related links may have higher rankings when the query comes from a travel IP address.

Data migration and caching policies can benefit from categorization of IP addresses. First user actions can be better predicted with IP address information. For example users typically spend just a few hours at the airport while they could spend days at hotels and years at new home locations. Based on the prediction certain ones of the application s can decide whether users data should be migrated permanently or cached in the travel places. Second caching strategies can be made based on IP properties. For example data can be cached on both home and work locations rather than migrating data back and forth. Thus the application s may provide many enhanced features because of the classification of the IP addresses.

At travel IP addresses are identified. The IP address identification engine may identify travel IP addresses after having obtained the home IP address and applying a geographic distance to the home IP address as it is likely that related events occurring outside the distance is related to travel activity. At proxy VPN addresses are filtered. The filtering engine may filter the IP addresses to remove proxy and or VPN IP addresses as these types of addresses introduce false IP address geolocation information to derive candidate sets.

At the candidate home IP addresses and the travel IP addresses are pruned. The filtering engine may also resolve inconsistencies between candidate home IP and travel IP addresses. For each IP address the filtering engine examines the user population associated with the IP address and examines the degree of consensus on its classification among the population. If there is no consensus regarding an IP address the filtering engine may prune all the IP addresses and their entire ranges from the home IP set to derive a set of home IP address candidates and a set of travel IP addresses.

At work IP addresses are determined. The pattern analysis engine may receive the home IP address candidates and then identify those addresses that are actually home IP addresses and those that are work IP addresses. The pattern analysis engine may differentiate IP addresses used at workplaces from those used at home residences by applying a diurnal analysis to the IP addresses. The pattern analysis engine outputs a set of actual home IP addresses and a set of work IP addresses.

Thus as described above systems and methods are provided to classify IP addresses based on user mobility patterns. From the patterns applications may be developed to enhance network planning security advertising etc.

Aspects of the subject matter may be implemented in the general context of computer executable instructions such as program modules being executed by a computer. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Aspects of the subject matter may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices.

Numerous other general purpose or special purpose computing system environments or configurations may be used. Examples of well known computing systems environments and or configurations that may be suitable for use include but are not limited to personal computers PCs server computers handheld or laptop devices multiprocessor systems microprocessor based systems network personal computers minicomputers mainframe computers embedded systems distributed computing environments that include any of the above systems or devices and the like.

Computer executable instructions such as program modules being executed by a computer may be used. Generally program modules include routines programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Distributed computing environments may be used where tasks are performed by remote processing devices that are linked through a communications network or other data transmission medium. In a distributed computing environment program modules and other data may be located in both local and remote computer storage media including memory storage devices.

With reference to an exemplary system for implementing aspects described herein includes a computing device such as computing device . In its most basic configuration computing device typically includes at least one processing unit and memory . Depending on the exact configuration and type of computing device memory may be volatile such as random access memory RAM non volatile such as read only memory ROM flash memory etc. or some combination of the two. This most basic configuration is illustrated in by dashed line .

Computing device may have additional features functionality. For example computing device may include additional storage removable and or non removable including but not limited to magnetic or optical disks or tape. Such additional storage is illustrated in by removable storage and non removable storage .

Computing device typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by device and includes both volatile and non volatile media removable and non removable media.

Computer storage media include volatile and non volatile and removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Memory removable storage and non removable storage are all examples of computer storage media. Computer storage media include but are not limited to RAM ROM electrically erasable program read only memory EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by computing device . Any such computer storage media may be part of computing device .

Computing device may contain communications connection s that allow the device to communicate with other devices. Computing device may also have input device s such as a keyboard mouse pen voice input device touch input device etc. Output device s such as a display speakers printer etc. may also be included. All these devices are well known in the art and need not be discussed at length here.

It should be understood that the various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the presently disclosed subject matter or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium where when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the presently disclosed subject matter.

Although exemplary implementations may refer to utilizing aspects of the presently disclosed subject matter in the context of one or more stand alone computer systems the subject matter is not so limited but rather may be implemented in connection with any computing environment such as a network or distributed computing environment. Still further aspects of the presently disclosed subject matter may be implemented in or across a plurality of processing chips or devices and storage may similarly be effected across a plurality of devices. Such devices might include personal computers network servers and handheld devices for example.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

