---

title: Guest access support for wired and wireless clients in distributed wireless controller system
abstract: Techniques are provided to enable a support for guest access of devices in a network. At a controller apparatus in a first mobility sub-domain of a network comprising a plurality of mobility sub-domains, a request message containing a request for guest network access for a device is received from a first access switch in the first mobility sub-domain. The controller apparatus forwards the request message to a guest controller. At a tunneling endpoint apparatus in the first mobility sub-domain, a tunnel is established to the guest controller to carry traffic between the device and the guest controller. Traffic for the device passes in a tunnel between the first access switch and the tunneling endpoint apparatus in the first mobility sub-domain, through the tunneling endpoint apparatus in the first mobility sub-domain and in the tunnel between the routing apparatus in the first mobility sub-domain and the guest controller.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08675601&OS=08675601&RS=08675601
owner: Cisco Technology, Inc.
number: 08675601
owner_city: San Jose
owner_country: US
publication_date: 20100517
---
The present application is related to the following co pending and commonly assigned U.S. patent applications 

U.S. patent application Ser. No. 12 773 360 entitled Maintaining Point Of Presence At Tunneling Endpoint For Roaming Clients In Distributed Wireless Controller System. 

U.S. patent application Ser. No. 12 773 355 entitled Routing To The Access Layer To Support Mobility Of Internet Protocol Devices. 

U.S. patent application Ser. No. 12 773 351 entitled Maintaining Point of Presence at Access Switch for Roaming Clients in Distributed Wireless Controller System. 

The present disclosure relates to networking techniques capable of supporting mobility of a network device.

Networked services to wired and wireless devices are supported by equipment that makes up what may be referred to as the infrastructure of the network. Examples of equipment in the network infrastructure include routers access switches and control computers or servers that are used to store data pertaining to the status of devices that connect to the network. Some access switches have routing capabilities and in this regard are also referred to as forwarders because they forward packets from one access switch to another.

A device with networking capability referred to herein as a client device or station may connect to the network at one access switch and then physically move i.e. roam such that it connects to a different access switch in the network. This roaming capability is prevalent with client devices that have wireless capabilities and can connect to a wired network at a different access switch by establishing a wireless connection such as a wireless local area network WLAN connection with a wireless access point AP device.

A device that is not permanently authorized to operate in the network is sometimes given limited access to the network. This is called guest access and occurs when for example a person is visiting a large enterprise network and needs to have access to the enterprise network for purposes working with other individuals in the network. However that access is limited only to certain data maintained by certain servers on the network called a demilitarized zone DMZ whereas other areas of the network are strictly prohibited to that guest user. In current network schemes wired guest access and wireless guest access work differently. Wired guest access involves use of virtual local area networks VLANs and virtual routing and forwarding VRF while wireless guest access uses a tunneling architecture to tunnel guest traffic to the guest controller in the DMZ.

Techniques are provided to enable a support for guest access of devices in a network. At a controller apparatus in a first mobility sub domain of a network comprising a plurality of mobility sub domains a request message containing a request for guest network access for a device is received from a first access switch in the first mobility sub domain. The controller apparatus forwards the request message to a guest controller that is configured to support guest network access for devices that are not authorized for native access to the network. The controller apparatus receives a response message from the guest controller the response message containing information to enable guest access for the device. At a tunneling endpoint apparatus in the first mobility sub domain a tunnel is established to the guest controller in which tunnel traffic from the device is sent to the guest controller. As a result traffic for the device passes in a tunnel between the first access switch and the tunneling endpoint apparatus in the first mobility sub domain through the tunneling endpoint apparatus in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller.

Reference is first made to . illustrates a diagram depicting a network infrastructure architecture that is configured to support mobility of wired and wireless client devices. The network architecture comprises a mobility domain shown at reference numeral . A mobility domain is a geographical region for which roaming services are to be provided. Contiguous coverage is intended to be provided in this geographical region by the network architecture . The network architecture provides better scaling properties over existing systems in that it breaks down the traditional mobility group into multiple mobility sub domains. Thus a mobility domain includes one or more mobility sub domains also referred to herein as mobility sub domains. For simplicity shows two sub domains and and labeled Mobility Sub Domain and Mobility Sub Domain respectively. For instance a mobility sub domain could consist of a single building within a campus. A sub domain is more of a representation of the network topology than the physical walls of a building so it is also possible for a sub domain to span multiple buildings in a campus for example.

The network architecture further comprises a mobility controller and a mobility oracle. In one form each mobility sub domain includes one or more mobility controllers MCs and mobility tunnel endpoint MTE pairs. While more than a single MC MTE pair may be present in a sub domain only one may be active at any given time. The presence of multiple pairs in a sub domain is for resilience and failure back up. In another form a single MC is provided for the entire mobility domain.

In the example architecture shown in the functions of the MTEs in each sub domain may be incorporated or integrated with other network equipment. For example in sub domain the MTEs and may be incorporated into a distribution switch and further connected to distribution core switches and respectively. The distribution core switches and are in turn connected to a core network that represents a Layer 3 or core portion of the network architecture . In mobility sub domain the MTEs and may be integrated into respective distribution core switches that are in turn connected to the core network . In this case there are distribution switches and connected to MTEs and in sub domain .

A mobility controller provides the mobility control plane operations facilitating handoff events that occur both within a mobility sub domain as well as across sub domains. To this end an entity called the mobility oracle is provided. The mobility oracle is a centralized database that includes information on each of the client devices in the network their home mobility sub domain and the current foreign sub domain providing service. The mobility oracle is consulted by the individual mobility controllers in order to facilitate inter sub domain mobility events. The mobility oracle is shown coupled to the core network but it may also be connected at the sub domain level to any of the mobility sub domains. As with the mobility sub domain s mobility controller more than one mobility oracle may be deployed for redundancy purposes although only one would be active at any given time for the mobility domain.

Within each mobility sub domain are access switches that provide the access layer connectivity to client devices operating in the mobility domain . For example mobility sub domain has access switches and mobility sub domain has access switches . Each access switch is capable of serving one or more IP subnets. An IP subnet comprises a plurality of IP addresses. An access switch assigns an IP address to a client device when it is determined that the client device is connected to the network for the first time. It is also possible that two or more access switches may serve the same IP subnet s . Access switches within a mobility sub domain may be grouped together in what is referred to herein as switch groups or peer groups. A switch peer group is statically configured by the MC based on static information or information that is dynamically learned. Within a switch peer group every switch has to have the same view of the membership of the group. A switch peer group does not span mobility sub domains or routing boundaries. A mobility sub domain may have one or more switch peer groups.

As explained hereinafter client devices associate to an access switch either by a wired network connection or a wireless network connection through a wireless access point device . shows wireless access point AP devices at reference numerals . The AP devices support the Control and Provisioning of Wireless Access Points CAPWAP protocol. As the CAPWAP architecture specifies the APs perform the physical PHY layer and real time IEEE 802.11 MAC functions which includes IEEE 802.11 encryption. The AP establishes a tunnel to the access switch to tunnel client devices wireless traffic.

The APs encrypt all CAPWAP control traffic using the Datagram Transport Layer Security DTLS protocol. If the AP supports Cisco TrustSec CTS or IEEE 802.1AE MacSec encryption then a link between the switch and the AP may be protected by Layer 2 CTS in which case both CAPWAP control messages and CAPWAP traffic will get encrypted. If CTS is not supported then the CAPWAP data traffic is unencrypted. In one possible form CAPWAP data traffic can also be DTLS encrypted as an option.

Each MTE provides mobility services on the data plane ensuring that a client device s point of presence on the Layer 3 network remains constant across mobility events. An MTE s involvement in a routing scenario for a client device is optional in that the functions of the MTE are only utilized when tunneling is employed.

Reference is now made to for a description of an example block diagram of an access switch. This diagram is meant to representative of a block diagram for any of the access switches and shown in and in general for any access switch in any mobility sub domain. The access switch comprises a processor a switch and router unit that may be in the form of an Application Specific Integrated Circuit ASIC a network interface unit a system bus and a memory . The switch and router unit provides the packet forwarding routing and switching functions that are well known for a network access switch. The network interface unit processes packets for transmission over the network and processes packets received from the network For example the network interface unit is an Ethernet card or similar device. The access switch is also referred to herein as a forwarder because it forwards packets to and from a client device. Instructions for access switch control logic are stored in the memory for execution by the processor .

The processor may be a programmable processor or a fixed logic processor. In the case of a programmable processor the memory is any type of tangible processor or computer readable memory e.g. random access read only etc. that is encoded with or stores instructions that when executed by the processor or any computer or general data processor cause the processor to perform a variety of functions including the functions of the access switch control logic described herein. Alternatively the processor may a fixed logic processing device such as an ASIC or digital signal processor or a network processor or a general purpose processor that is configured with firmware comprised of instructions that cause the processor s to perform the functions described herein. Thus instructions for the logic may take any of a variety of forms so as to be encoded in one or more tangible media for execution such as with fixed logic or programmable logic e.g. software computer instructions executed by a processor and the processor s may be a programmable processor programmable digital logic e.g. field programmable gate array or an ASIC that comprises fixed digital logic or a combination thereof.

Examples of functions of the access switch control logic as they pertain to the guest services support functions for a client device are described hereinafter in connection with . These functions include mobility agent functions and datapath functions. The mobility agent functions are responsible for handling mobility events on the access switch configuring the datapath elements on the switch for mobility and communicating with the MC. The datapath functions include terminating the CAPWAP tunnels which encapsulate IEEE 802.11 traffic sourced by wireless client devices allowing the access switch to treat wired and wireless traffic in a uniform fashion.

More specifically the functions of the mobility agent in the access switch are as follows. The mobility agent is responsible for responding in a timely manner to mobility control protocol messages sent by the various entities in the network ensuring that a roaming budget time period is maintained for client devices. If the wireless subnets are not available at the MC MTE then the mobility agent assumes the role of the point of presence for roamed client devices that were originally associated with it. When the network is configured in a Layer 2 mode the mobility agent is responsible for advertising reachability for the client devices connected to it. If tunneling is employed an Address Resolution Protocol ARP request would be transmitted on behalf of the client device through the tunnel which the point of presence MTE or access switch would bridge onto its uplink interface. The mobility agent is responsible for subscribing to multicast groups on behalf of a client device after a roaming event has occurred. This information is passed as part of the context to the new access switch to ensure that the multicast flows follow the client device as it roams. When the access switch is connected to a Layer 3 access network the mobility agent is responsible for injecting routes for the client devices that are associated with it for which tunneling is not provided. The mobility agent performs an 802.1X authenticator function for both wired and wireless client devices. Finally when a station successfully authenticates to the network the mobility agent forwards the Pairwise Master Key PMK to the MC and the MC is responsible for flooding the PMK to all of the access switches in the mobility sub domain.

Turning now to an example block diagram of an MC is now described. An MC is a control apparatus that may be embodied by a computing apparatus comprising a processor a network interface unit and a memory . Examples of specific embodiments of the processor and the network interface unit are described above in connection with . The memory stores MC control process logic that when executed by the processor cause the processor to perform the MC functions described herein. In addition the memory stores a stations database and a switch database .

The stations database maintains a database of all client devices that are being provided service within the local sub domain or the entire mobility domain if the MC is configured to serve the entire mobility domain . This database may not store full client device context and may only include information indicating whether the client device currently considers the local sub domain as its home and is in many ways very similar to the function provided by the mobility oracle although with a more limited scope i.e. only for client devices local to the sub domain. The database may include additional information such as the client device s credentials which could be in the form of the user s identity or a common name in a certificate as well as the IP Address assigned to the device if one has already been assigned to it by the network.

The switch database maintains a database of all access switches within the mobility sub domain and updates all of the access switches in real time as changes to the database occur e.g. addition or removal of a switch from the network .

Other functions of the MC are summarized as follows. The MC is responsible for responding in a timely manner to mobility control protocol messages from other entities to ensure that the system achieves the desired roaming budget. The MC acts as a gateway between the access switches and the mobility oracle. When the MC does not find a match in its local database it forwards the request to the mobility oracle which is responsible for the entire mobility domain. However there are deployment scenarios where the MC is responsible for the entire mobility domain. When tunneling is employed for a client device its point of presence on the network could be the MTE if the wireless subnets are available at the MTE. Therefore in these cases the MC will respond to any ARP requests received for the client devices it is responsible for. When the MC is connected to a Layer 3 network the it is responsible for injecting routes into the network for the client devices it provides service for via a tunnel. The MC is the control point for the access switches for all mobility management related requests. When a change in a client device s point of attachment occurs the MC is responsible for configuring the proper forwarding policy on the MTE which may be collocated with the MC. If the MC and the MTEs are physically separate the MC is responsible for initiating the signaling to the MTE to enforce changes in the client device s point of attachment in the network. The MC is capable of handling unsolicited commands from the Remote Authentication Dial in User Service RADIUS infrastructure. These messages can be received by an access switch and forwarded to the MC to clear out or update the client key cache entries. It is also the responsibility of the MC to forward these messages to other MCs in mobility domain if a message is received from access switch. The MC may optionally also act as an Network Time Server to the access switches to allow all access switches within a mobility sub domain to have their clocks synchronized. The MC in turn synchronizes its clock off the mobility oracle.

Turning to an example block diagram of an MTE is now described. The MTE is a computing apparatus that may also perform routing functions. The MTE comprises a processor a memory and a network interface unit . The MTE may be integrated into a distribution switch or router and to this end shows basic switching components including a switch and router unit and a system bus . Instructions are stored in the memory for MTE control logic . The processor executes the instructions for the MTE control logic to perform the various MTE functions described herein.

The MTE handles the mobility data plane. The role of the MTE is different depending on whether or not it is serving as the point of presence for client devices in the sub domain. If the wireless subnets are not available at the MTE then the point of presence for roamed client devices is at the home access switch. In this scenario the MTE serves as a tunnel switching entity that connects the foreign access switch point of attachment to another access switch point of presence that serves the IP subnet for the IP address of that device. If the wireless subnets are available at the MTE then the MTE serves as the point of presence.

The functions of the MTE are generally as follows. The MTE terminates mobility tunnels from the access switches in its mobility sub domain. Thus there are pre established tunnels between the MTE and each access switch in a given mobility sub domain. Traffic to and from the roamed client device is sent to the foreign access switch via the mobility tunnel. An MTE MTE tunnel is used to tunnel traffic between mobility sub domains. The MTE has an interface the MC uses to configure the MTEs forwarding tables to reflect mobility events. When the MC and MTE are collocated this is simply an API. If both functions are not collocated this is a protocol.

As explained herein the MC and MTE functions may be implemented by separate physical entities. In the case where they are implemented in a single entity the MTE does not actually act as a router and therefore does not inject routes into the network. The MC is responsible for advertising routes. However the interfaces on which the routes are injected are considered part of the MTE. In the unlikely event that the MTE is decoupled from the MC it is responsible for transmitting certain packets on behalf of the MC. For instance the MC will provide Proxy ARP and routing services yet these packets are transmitted on the MTEs interfaces. For networks that do not make use of tunneling the MTE is not a necessary function.

Reference is now made to for a description a block diagram of the mobility oracle . The mobility oracle contains a centralized database that includes information on each of the client devices in the network their home mobility sub domain and the current foreign sub domain providing service. The mobility oracle is a computing apparatus with network connectivity that oversees the entire mobility domain but it does not necessarily perform any routing or packet forwarding functions. The mobility oracle comprises a processor a network interface unit to provide network connectivity with the MCs and MTEs in the mobility domain and a memory that stores mobility oracle control logic and a station database . The station database maintains a database of all stations that are being provided service within the mobility domain. This station database is populated through interactions the mobility oracle has with all of the MCs in all of the mobility sub domains it supports. The station database includes each station s MAC address its current home mobility sub domain and if roaming its current foreign mobility sub domain. When the mobility oracle receives a request from an MC it is responsible for performing the station lookup and forwarding the request to the proper MC. The mobility oracle acts as an NTP server to the MCs to allow all of the controllers within the mobility domain to have their clocks synchronized. The functions of the mobility oracle control logic as they pertain to the guest support services are described hereinafter in connection with .

Foreign Mobility Controller The MC providing mobility management service for the client device in a foreign mobility sub domain. The foreign MC acts as a liaison between access switches in the foreign sub domain and the MC in the home sub domain.

Foreign Mobility Sub Domain The mobility sub domain controlled by an MC supporting a client device whose IP address is part of an IP subnet which is served by an access switch in another mobility sub domain.

Foreign Switch The access switch in the foreign mobility sub domain currently providing service to the client device.

Home Mobility Controller The MC providing the single point of control and mobility management service for client devices in their home mobility sub domain.

Home Mobility Sub Domain The mobility sub domain controlled by a MC for a client device where its IP address was assigned.

Home Switch The switch in the home mobility sub domain that last provided service to a client device.

Mobility Sub Domain The mobility sub domain is an autonomous component of the overall mobility domain network. A sub domain generally connects into the core network and includes one or more MC functions and optionally their associated MTEs. A mobility sub domain is the set of devices managed by the active Mobility Controller. A mobility sub domain comprises of a set of access switches and associated APs across which fast roaming is desired. A mobility sub domain is equivalent to an 802.11r key domain. The mobility sub domain may also be referred to as an IP Everywhere IPe sub domain. A mobility sub domain and an mobility sub domain are terms that are used interchangeably herein.

Point of Attachment A client device s point of attachment is where the client is currently associated to the wireless network. This could either be the access switch that is currently providing service to the AP where the client device is associated or the WLAN controller in the case of a legacy deployment. Thus a wireless client device may roam from one AP on a first access switch to another AP on a second access switch and thereby become attached at or on the second access switch.

Point of Presence A client device s point of presence is the place in the network where the client device is being advertised. For instance if a switch is advertising reachability to the client device via a routing protocol the interface on which the route is being advertised is considered the client device s point of presence.

Station A client device that connects to and requests service from the network. The device may have a wired wireless or both interfaces. The term station may be used interchangeably with the term client device.

Referring now to a block diagram is shown of a portion of the mobility domain shown in and further illustrating guest controllers and that are logically located behind a firewall . More than two guest controllers may be provided but for simplicity two are shown in as an example. The guest controllers and are provided to manage support for devices that are to have network services in the mobility domain as so called guest devices. A guest device or station is one that does not have the authority for native access to the network. For example a person may visit an enterprise campus facility and wish to have network services and to be able to roam in the mobility domain. The guest controllers are provided to store and execute access policies on behalf of guest devices whether the guest devices are wired or wired devices. The guest controllers and are standalone appliances that are located in a so called Demilitarized Zone DMZ behind the firewall and are configured to support guest network access for devices that are not authorized for native access to the network.

Described hereinafter in connection with are examples of control signaling that occur to establish the necessary tunnels at the MTE in a sub domain to support guest services to a station as that station roams in the mobility domain. The access switch builds a tunnel to the MC MTE in its sub domain and the MC MTE builds a tunnel to the guest controller in the DMZ. The guest controller inspects the guest traffic and applies policies to it. Since a guest station authentication and security policies are done by the guest controller the access switch has the following responsibilities. It identifies wired wireless guest stations and traffic. It tunnels the guest traffic to the guest controller via the MC MTE in its sub domain. The advantage of this configuration is that a unified support solution is provided for wired and wireless stations. This technique is highly scalable because the tunnels are set up by the MC MTE and the MC MTE can distribute traffic across multiple guest controllers based on their respective guest traffic loads. The guest tunnels between the MTEs and the guest controllers may use the same format as the mobility tunnels between the MTEs and the access switches in the mobility sub domains.

Turning now to a block diagram of a guest controller is described. The guest controller comprises a processor a network interface unit a switch and router unit if the guest controller is to have packet forwarding capabilities and a memory . The memory stores guest controller logic and a guest policy data . The operations of the guest controller logic are described hereinafter in connection with . There are several aspects to guest access support security management of guests and policy application to guest devices.

As explained herein traffic is tunneled from MTEs to the guest controller in the DMZ and the guest controller serves as the anchor for the station. The guest controller logic uses the guest policy data to authenticate a guest station or a guest device can be allowed to pass traffic without any authentication. The guest controller logic also applies security policies for guest traffic whereas service policies such as Quality of Service QoS policies can be applied at point of attachment e.g. Foreign controller . In other words the guest controller logic applies policies to support access to the network for devices that are not authorized for native network services in the network.

The guest controllers are configured on the MCs as mobility members like any other MC. Upon configuration of a guest controller the MC starts a Keep Alive mechanism between it and the guest controllers to maintain reachability status. The access switch sends a list of guest controllers configured on the guest WLAN to the MC and the MC selects the guest controller with the least load. The guest controller supports both CAPWAP and Ethernet over IP EOIP tunnels. The guest controllers will send in response to keep alive messages from the MC status information indicating their current load conditions. This enables the MC to be aware of the relatively load conditions of the guest controllers so it can select a guest controller with relatively low load conditions at the time that the MC receives an Export Anchor Request message from an access switch.

Reference is now made to for a description of a scenario when a guest station associates with the network and guest services are established for the station by way of a guest controller in the DMZ. Reference is also made to for the description of the control signal flow in . At the access switch e.g. access switch in mobility sub domain upon detecting the station completes Layer 2 authentication of the station such as by Wi Fi Protected Access WPA or WPA shared authentication techniques. The access switch can distinguish wireless guest traffic from wired guest traffic based on a Guest Service Set Identifier SSID configuration which is information that is associated only with wireless guest client devices. Next at the access switch generates a mobile announce message and sends it to the MC MTE in its sub domain in order to determine whether the station has previously associated at any other access switch in the mobility domain. In this example it is assumed that this is the instance that the station has associated with any access switch in the mobility domain. At the MC MTE in sub domain sends the mobile announcement message to the mobility oracle . The mobility oracle compares the MAC address of the station against its stored data station database and determines that the station has not previously associated with an access switch in the mobility domain. At the mobility oracle sends a non acknowledge NACK message to the since this is the initial association of the station. The MC MTE sends the NACK to the access switch at . The Mobile Announce message is not necessary for wired stations.

At the access switch sends an Export Anchor Request message to the MC MTE . The Export Anchor Request message is a message that contains client payload IP address of the access switch where the station is associated and MAC address of the station and guest profile information and serves to request guest network access for the station. For a wireless station the guest profile is a WLAN Service Set Identifier SSID and for a wired station the guest profile is information identifying guest privileges for the particular wired station. The guest controller uses the guest profile information to apply specific guest access policies. In addition the Export Anchor Request message includes a list of guest controllers that are configured for guest support services.

Upon receiving the Export Anchor Request message the MC selects one of the guest controllers in the list based on load conditions that the MC is aware of from status messages received from the guest controllers. At the MC forwards Export Anchor Request message to the guest controller with the lowest load conditions which in this example is guest controller . In another form the MC may select the guest controller to use in a round robin fashion among the multiple guest controllers identified in the Export Anchor Request message. When the guest controller receives the Export Anchor Request message it creates a mobile entry and determines the guest policies configured for the WLAN from which the station associated and obtains an IP address for the station. If a Dynamic Host Configuration Protocol DHCP server is configured on the guest controller then the DHCP server can assign the IP address or a DHCP server is not configured on the guest controller the guest controller communicates with an external DHCP server that allocates the IP address. The guest controller relays or bridges the DHCP packets to the wireless client. That is the guest controller stores policies for different types of stations and based on the guest profile received in an Export Anchor Request the guest controller applies those policies to the guest profile. Again the SSID for a station may be used as guest profile and the guest controller maps that SSID to a corresponding guest policy. A guest policy may comprise information as to the access privileges granted to a guest station bandwidth access conditions for the guest station etc. The guest controller sends an Export Anchor Response message at . The Export Anchor Response message comprises information to enable guest access for the device i.e. client payload anchor payload containing guest controller MAC address and IP address obtained for the station by the guest controller and status payload success or failure . It is to be understood that Layer 3 authentication Web authentication is performed at the guest controller.

The MC receives the Export Anchor Response message and creates a client context or updates a client context entry if one exists for that station. The client context entry comprises all information about that station that was learned by the MC from the Export Anchor Request message and the Export Anchor Response message. The MC generates a command to configure the MTE associated with the MC to establish a CAPWAP tunnel to the guest controller in which tunnel all traffic from the station to the guest controller . Thus the MTE associated with the MC is controlled by the MC to serve as a border or edge tunneling endpoint apparatus to tunnel all traffic from the guest station to the guest controller.

At the MC forwards the Export Anchor Response message to the access switch. When the access switches receives the Export Anchor Response message and determines that it contains a status success it then plumbs rules to the fast path to allocate the appropriate routing path to start CAPWAP tunneling traffic from the station to the guest controller via the MTE . Otherwise if the status payload of the Export Anchor Response message is failure then the access switch will de authorize the station so that it can try to associate and seek guest support services at a later time.

Assuming the Export Anchor Response message contained a success status payload then the access switch sends a Handoff Complete message to all switches in its switch group as a broadcast message and as a unicast message to the MC . The MC in turn forwards the Handoff Complete message to the guest controller at and to the mobility oracle at . The Handoff Complete message contains anchor payload for peer group switches other mobility controllers or the mobility oracle and other information for the guest controller that notifies the guest controller to which MC MTE to set up a tunnel and start tunneling traffic for the station. The guest controller upon receiving this message determines the sub domain of the station where the station is located and configures the tunnel to point to the MTE of that sub domain e.g. MTE for tunneling traffic to the station. Thus traffic for the station is sent in a tunnel between the access switch and the MTE in the first mobility sub domain mobility sub domain and in the tunnel between the MTE in the mobility sub domain and the guest controller . A similar process would be performed if the MC selected the second guest controller shown in .

The flow of may be summarized as follows. At a controller apparatus in a first mobility sub domain of a network comprising a plurality of mobility sub domains a request message containing a request for guest network access for a device is received from a first access switch in the first mobility sub domain. The controller apparatus forwards the request message to a guest controller that is configured to support guest network access for devices that are not authorized for native access to the network. The controller apparatus receives a response message from the guest controller the response message containing information to enable guest access for the device. At a tunneling endpoint apparatus in the first mobility sub domain a tunnel is established to the guest controller in which tunnel traffic from the device is sent to the guest controller. As a result traffic for the device passes in a tunnel between the first access switch and the tunneling endpoint apparatus in the first mobility sub domain through the tunneling endpoint in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller.

Turning to a flow diagram for control signals exchanged when a guest station roams from one access switch to another access switch is now described. This diagram depicts the scenario where the point of attachment for the station is at a first access switch e.g. and the station roams to a second access switch that is in the same switch group and also within the same mobility sub domain as the first access switch . At upon the station associating with the second access switch the second access switch sends a unicast Mobile Announce message to the first access switch . The second access switch knows that the station was previously anchored at the first access switch from a previous Handoff Complete message received from the first access switch . At the first access switch sends a Handoff message to the second access switch . Normally for a guest station the context information contained in the Handoff message IP address assigned to the station etc. is not important. Sometimes the context may include session keys or Authentication Authorization and Accounting AAA override parameters associated with policy parameters passed by a Remote Authentication Dial In User Service RADIUS server during an authentication stage. At the second access switch sends a Handoff Notification message to the switches in the switch group of the first and second access switches thus the first access switch receives this message as shown in and at sends a Handoff Complete message to the MC . Upon receiving the Handoff Notification message the first access switch cleans up the context information for the station deleting its association at the first access switch . Upon receiving the Handoff Complete message the MC configures the MTE to tunnel traffic for the station to the second access switch no longer to the first access switch between it and the guest controller that was serving that station e.g. guest controller in the scenario depicted in . At the MC sends an ACK to the second access switch confirming that it will tunnel traffic for that station to the second access switch .

Turning now to with reference to a flow diagram is described for the scenario where the station roams from a first access switch in a first mobility sub domain to a second access switch in a second mobility sub domain. For example the station roams from the access switch in the first mobility sub domain to the second access switch via AP in the second mobility sub domain . When the station associates with access switch at the second access switch in the second mobility sub domain sends a Mobile Announce message to the MC in the second sub domain. At the MC sends the Mobile Announce message to the mobility oracle . The mobility oracle compares the information contained in the Mobile Announce message against its station database and determines that the station had previously been associated with access switch in the first mobility sub domain. At the mobility oracle sends the Mobile Announce message to the MC in the first mobility sub domain. At the MC sends the Mobile Announce message to the first access switch . The first access switch then sends a Handoff message at to the access switch in the second mobility sub domain. At the access switch sends the Handoff message to other switches in its switch group. At the access switch sends a Handoff Notification message to switches in the switch group of access switch in the second mobility sub domain and at sends a Handoff Complete message to the MC in the second mobility sub domain. The Handoff Complete message contains the IP address of the guest controller that is handling guest traffic for the station. The MC sends an ACK at At the MC sends a Handoff Complete message to the mobility oracle which updates its station database to indicate the new location of the station and sends the Handoff Complete message at to the MC in the first mobility sub domain. The mobility oracle responds to the Handoff Complete message with an ACK at .

Recall from earlier descriptions that the MTE in each mobility sub domain has pre established CAPWAP tunnels with each access switch in its mobility sub domain. Upon receiving the Handoff Complete message from the access switch the MC generates a command to configure the MTE to tunnel traffic to the guest controller identified in the Handoff Complete message. Now that the MC has information indicating the IP address of the guest controller responsible for the station e.g. guest controller the MC sends a Handoff Complete message to the guest controller at . Upon receiving the Handoff Complete message the guest controller switches or points tunneling of traffic for the station from MTE to MTE and responds with an ACK message at to confirm the change. The MC responds with an ACK at to confirm the change to the MC . Traffic from the guest station is sent in the tunnel between the second access switch and the MTE in the second IP domain and in the tunnel from the MTE to the guest controller .

Thus illustrates the scenario where a guest station roams from a first access switch in a first mobility sub domain to a second access switch in a second mobility sub domain. To summarize the flow of the MC in the second mobility sub domain receives a Mobile Announce message from the second access switch in the second mobility sub domain where the Mobile Announce message indicates that the guest station has roamed to and associated with the second access switch in the second mobility sub domain. The MC in the second mobility sub domain receives a Handoff Complete message from the second access switch in the second mobility sub domain where the Handoff Complete message contains information for the IP address of the guest controller that is serving the guest station for guest access to the network. The MC in the second mobility sub domain generates a command to cause the MTE in the second mobility sub domain to establish a tunnel with the guest controller whose IP address is contained in the Handoff Complete message. The MC in the second mobility sub domain sends the Handoff Complete message to the mobility oracle main controller for the mobility domain to the MC in the first mobility sub domain and to the guest controller thereby causing the guest controller to point tunneling of traffic for the guest station to the MTE in the second mobility sub domain. Traffic for the guest station is thereafter sent in a tunnel between the second access switch and the MTE in the second mobility sub domain such that traffic for the guest station passes in the tunnel between the second access switch and the MTE in the second mobility sub domain through the MTE in the second mobility sub domain and in the tunnel between the MTE in the second mobility sub domain and the guest controller.

The guest access support techniques described herein does not require configuring of guest VLANs on the switch. Traffic from the wired and wireless clients terminates on the access switch. Since the guest VLAN is not present on the access switch the traffic is tunneled to the MTE over the existing mobility tunnel and then via a guest tunnel to the guest controller in the DMZ.

Again the advantage of this approach is that all guest traffic passes through the MTE before being tunneled to the guest controller in the DMZ. This aggregation of guest traffic at the MTE results in a more scalable solution because fewer tunnels need to be created at the guest controller. The guest controller only needs to support tunnels between itself and all the MTEs in the system. If encryption is desired on the guest traffic then both the access switch to MTE tunnel and the MTE to guest controller tunnel need to be encrypted. This innovation handles both wired and wireless guest traffic in a very similar manner. Guest traffic both wired and wireless is tunneled to the guest controller in the DMZ by first tunneling from the switch to the MTE and then from the MTE to the guest controller. The same solution supports wired and wireless guest traffic. There is no need to two completely different solutions for wired and wireless guest traffic. Moreover the tunneling based approach requires minimal configuration on the switches in the access and distribution thus removing the complex configuration requirements for deploying wired guest solutions.

Accordingly an apparatus mobility controller is provided that comprises a network interface unit configured to enable communications over a network and a processor configured to be coupled to the network interface. The processor is configured to receive from a first access switch in a first mobility sub domain a request message containing a request for guest network access for a device wherein the first mobility sub domain is one of a plurality of mobility sub domains in the network forward the request message to a guest controller that is configured to support guest network access for devices that are not authorized for native access to the network receiving a response message from the guest controller the response message containing information to enable guest access for the device generate a command for a tunneling endpoint apparatus in the first mobility sub domain to establish a tunnel to the guest controller over which tunnel all traffic from the device is to be sent to the guest controller such that traffic for the device passes in a tunnel between the first access switch and the tunneling endpoint apparatus in the first mobility sub domain through the tunneling endpoint apparatus in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller.

Each MC is configured to handle an in bound roam of a guest station to its mobility sub domain. For example the MC in the first mobility sub domain or in general the MC in any mobility sub domain is configured to receive from an access switch in the first mobility sub domain a Mobile Announce message that a guest station has roamed to and associated with an access switch in the first mobility sub domain from another mobility sub domain. The MC receives a Handoff Complete message from the access switch to which the guest station from the other mobility sub domain has associated. The Handoff Complete message contains information for the IP address of a guest controller that serves the guest station from the other mobility sub domain for guest access to the network. The MC in the first mobility sub domain generates a command to configure the MTE in the first mobility sub domain to establish a tunnel to the guest controller whose IP address is contained in the Handoff Complete message so that traffic for the device from the other mobility sub domain is sent in a tunnel between the access switch and the MTE in the first mobility sub domain through the MTE in the first mobility sub domain and in the tunnel between the MTE in the first mobility sub domain and the guest controller that is identified in the Handoff Complete message.

When the MC and MTE are integrated into a single unit the tunnel to the guest controller is established by configuring a switching unit e.g. switch and router shown in in the single integrated unit to direct traffic for the device in the tunnel to the guest controller.

Further still a system is provided comprising a plurality of access switches in each of a plurality of mobility sub domains of a network and each access switch configured to associate with a device for connectivity over the network and an MC controller apparatus in each of the plurality of mobility sub domains and configured to communicate with the access switches in its respective mobility sub domain and with the controller apparatus in each of the other mobility sub domains a tunneling endpoint apparatus in each of the plurality of mobility sub domains that is configured to communicate with the controller apparatus in its respective mobility sub domain and to forward and receive traffic over pre established tunnels with the access switches in its respective mobility sub domain. The controller apparatus in any given mobility sub domain e.g. the first mobility sub domain is configured to receive from a first access switch in the first mobility sub domain a request message containing a request for guest access to the network for a device forward the request message to a guest controller that is configured to support guest access for devices that are not authorized for native access to the network receive a response message from the guest controller the response message containing information to enable guest access for the device and configure the tunneling endpoint apparatus in the first mobility sub domain to cause the tunneling endpoint apparatus to establish a tunnel to the guest controller in which traffic from the device is to be sent to the guest controller. The tunneling endpoint apparatus is configured to forward traffic for the device in the tunnel between the first access switch in the first mobility sub domain where the device is attached and in the tunnel between the tunneling endpoint apparatus and the guest controller. The controller apparatus is configured to receive from a second access switch in the first mobility sub domain a handoff complete message indicating that the device has roamed from the first access switch to the second access switch and to configure the tunneling endpoint apparatus in the first mobility sub domain to tunnel traffic for the device to the second access switch. Furthermore the controller apparatus is configured to receive from an access switch in the first mobility sub domain a mobile announce message indicating that a device from another mobility sub domain has roamed to and associated with the access switch in the first sub domain receive a handoff complete message from the access switch to which the device from the other mobility sub domain has associated the handoff complete message containing information for the IP address of a guest controller that is serving the device from the other mobility sub domain for guest access to the network generate a command to configure the tunneling endpoint apparatus in the first mobility sub domain to establish a tunnel to the guest controller whose IP address is contained in the handoff complete message so that traffic for the device from the other mobility sub domain is sent in a tunnel between the access switch and the tunneling endpoint apparatus in the first mobility sub domain such that traffic for the other device passes in the tunnel between the access switch and the tunneling endpoint apparatus in the first mobility sub domain through the tunneling endpoint apparatus in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller that is identified in the handoff complete message.

Further still a processor or computer readable medium encoded with instructions that when executed by a processor cause the processor to at a controller apparatus in a first mobility sub domain of a network comprising a plurality of mobility sub domains receive from a first access switch in the first mobility sub domain a request message containing a request for guest network access for a device forward the request message to a guest controller that is configured to support guest network access for devices that are not authorized for native access to the network receive a response message from the guest controller the response message containing context information for the device to enable guest access for the device and generate a command to configure a tunneling endpoint apparatus in the first mobility sub domain to establish a tunnel to the guest controller in which traffic from the device is sent to the guest controller so that traffic for the device is sent in a tunnel between the first access switch and the tunneling endpoint apparatus through the tunneling endpoint apparatus in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller. Additional instructions are provided that when executed by the processor cause the processor to receive from a second access switch in the first mobility sub domain a handoff complete message indicating that the device has roamed from the first access switch to the second access switch and generate a command to configure the tunneling endpoint apparatus to tunnel traffic for the device from the tunneling endpoint apparatus to the second access switch. Further additional instructions are provided that when executed by the processor cause the processor to receive from an access switch in the first mobility sub domain a mobile announce message indicating that the device from another mobility sub domain has roamed to and associated with the access switch in the first mobility sub domain receive a handoff complete message from the access switch to which the device from the other mobility sub domain has associated the handoff complete message containing information for the IP address of a guest controller that is serving the device for guest access to the network generate a command that causes the tunneling endpoint apparatus in the first mobility sub domain to establish a tunnel to the guest controller whose IP address is contained in the handoff complete message so that traffic for the device is sent over a tunnel between the access switch and the tunneling endpoint apparatus in the first mobility sub domain through the tunneling endpoint apparatus in the first mobility sub domain and in the tunnel between the tunneling endpoint apparatus in the first mobility sub domain and the guest controller that is identified in the handoff complete message.

