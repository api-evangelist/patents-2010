---

title: Systems and methods of synchronizing ring tone cycles and delivery of DTMF tones
abstract: Mobile devices use a PBX and application servers associated with the PBX to access voice services. Some mobile devices can support simultaneous data and voice channels, with the PBX and application server respectively. Where a data channel is unavailable, a control and status updating mechanism is needed. One approach is to signal over the voice channel with DTMF tones. DTMF tones should be timed to cause the tones to arrive at the mobile device during a pause period of a ring cycle. However, it also is desirable to avoid unnaturally long silence periods or other pauses during system usage. Aspects relate to enhancing a user experience in these situations and successful transmission/reception of control and status information over a voice channel using DTMF tones.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08180406&OS=08180406&RS=08180406
owner: Research In Motion Limited
number: 08180406
owner_city: Waterloo
owner_country: CA
publication_date: 20101013
---
This application claims priority benefit of U.S. provisional application No. 61 328 146 filed on Apr. 26 2010. U.S. provisional application No. 61 328 146 is fully incorporated by reference herein.

The present application relates to voice telephony and more particularly to control and status signaling to and from mobile devices over voice channels such as in third party call control.

Voice telephony remains a major application of interest for business and personal use. In an example corporate setting a telephony installation at a site can have a large number of users connected to a Private Branch Exchange PBX server which can interface those users to a smaller number of outside lines e.g. an E1 or T1 line a PBX can be implemented using a server with telephony cards for example . A PBX can interface with other servers and systems such as one or more application servers that can provide enhanced services to devices connected to the PBX such as mobile devices. For example a PBX can interface with an application server over an IP connection using SIP signaling. Services provided by an application server can include voice mail single number reachability call forwarding park and conferencing for example. PBX systems also can communicate with each other over trunk lines and packet networks depending on implementation.

A PBX can perform services for a voice call based on direction from an application server. For example a PBX can initiate an outgoing call to a number specified by an application server using SIP signaling to the PBX and bridge a mobile device that requested such call. Continuing this example it would be desirable to provide status information to the requesting mobile device. Such status information would include information such as whether the remote party phone has started to ring or not. Still further initiating commands such as call transfer and sending status information during progress of such commands also desirably is available. In absence of a data channel that can be maintained concurrently with a voice channel this information can be communicated using DTMF tones. However a number of considerations desirably should be addressed if using DTMF tones for such purposes and aspects herein relate to alleviating some of these concerns.

In many cases modern mobile devices such as phones smartphones and other network enabled devices can access both a data network and a voice network depending on technology access of each network type may occur concurrently or interleaved . It is becoming increasingly desirable especially for corporate users to be able to use their mobile phones in a manner similar to their deskphones such as having similar functionality one number reachability and so on. Such capabilities can be provided to mobile devices through an application server that can send and receive status information and control commands over a data channel with the mobile device. If a data channel is not currently available DTMF tones can be sent over a voice channel for these purposes.

Some mobile devices have trouble detecting DTMF tones during a ring portion of a ring tone cycle that the device is locally generating. So it is desirable to have the mobile device to receive any such tones during a pause period of such a ring tone.

A variety of approaches can be implemented directed such timing and examples of some preferred approaches are described herein. Another consideration is to avoid having a user of the mobile device hear tones being sent for such control and status purposes.

Traditionally a PBX e.g. PBX provides telephony services for a closed group of private telephones for example within an enterprise or a hotel. However in many cases the services to the private telephone desirably could also be extended out to a mobile device that communicate via third party networks such as wide area cellular networks or through wireless local area networks. In these situations SMP server may be added as an adjunct to the PBX and can take an active role in providing services to mobile devices.

SMP server can be connected to PBX through a packet switched connection that can use the Internet Protocol IP .

PSTN can communicate with Public Land Mobile Network PLMN and by particular example with a switching control within PLMN . Such communication is for accepting calls from PLMN to be carried on PSTN and vice versa as an example. SS7 signalling can be employed between PSTN and PLMN . PSTN is depicted to have telephones and coupled thereto. Other implementations can include multiple gateways that translate between or among different signaling protocols.

PLMN communicates with a mobile device . Communication between PLMN and mobile device can take place using a wide variety of technologies some of which are capable of supporting only voice traffic either voice traffic and data traffic or simultaneous voice and data traffic to from mobile device . PLMN also can use Internet to receive send traffic to and from corporate network as indicated by communication link . Communication between network and PLMN also may be carried via a relay .

Mobile device includes one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN and optionally a WLAN. In various embodiments the PLMN and mobile device may be configured to operate in compliance with any one or more of a number of wireless protocols including GSM GPRS CDMA EDGE UMTS EvDO HSPA 3GPP or a variety of others. It will be appreciated that the mobile device may roam within PLMN as well as into other PLMNs i.e. that the depicted PLMN represents one or more such wireless access networks that operate according to what a person of ordinary skill would understand as broadband cellular access technologies .

For example in some instances a dual mode mobile device and or the enterprise network can be configured to facilitate roaming between the PLMN and a WLAN and are thus capable of seamlessly transferring sessions such as voice calls from a connection with a cellular interface of a dual mode device to a WLAN interface of such a dual mode device and vice versa.

GSM signaling can be implemented using the Fast Associated Control Channel FACCH . FACCH is a logical channel on a digital traffic channel that can be used to send urgent signaling control messages. The FACCH channel sends messages by replacing speech data with signaling data for short periods of time. In GSM two special reserved bits are used to inform the receiving device if the data in the current time slot is digitally coded subscriber traffic or alternatively a FACCH message. Switching control manages the conversion between GSM signaling and SS7 signaling for clarity a network of base stations operating within PLMN is not separately depicted and usually there is a connection between switching control and one or more base station elements where device can be connected to such base station elements. GSM signaling can be relayed through the base station to a termination point in switching control . 

In some embodiments PBX may be connected to one or more conventional analog telephones . The PBX is also connected to or part of the enterprise network and through it to telephone terminal devices such as digital telephone sets softphones operating on computers and so on. Within the enterprise network each individual may have an associated extension number sometimes referred to as a PNP private numbering plan or direct dial phone number. Calls outgoing from PBX to PSTN or incoming from PSTN to PBX can be circuit switched calls typically in the absence of gateway . Gateway also can be considered part of enterprise network and a boundary of such enterprise network depicted in is primarily for convenience. Within the enterprise e.g. between the PBX and terminal devices voice calls are increasingly packet switched calls for example Voice over IP VoIP calls.

SMP server can perform some aspects of messaging or session control like call control and advanced call processing features. SMP server may in some cases also perform some media handling. Collectively SMP server and PBX may be referred to as the enterprise communications platform server generally designated . It will be appreciated that the enterprise communications platform and in particular SMP server can be implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX and other network connections. Although SMP server may be implemented on a stand alone server it will be appreciated that it may be implemented into an existing control agent server as a software component comprising instructions configuring a processor operating with other software components to implement the functionality attributed to it. As will be described below SMP server may be implemented as a multi layer platform.

The enterprise communications platform implements the switching to connect session legs and may provide the conversion between for example a circuit switched call and a VoIP call or to connect legs of other media sessions. In some embodiments in the context of voice calls the enterprise communications platform provides a number of additional functions including automated attendant interactive voice response call forwarding voice mail etc. It may also implement certain usage restrictions on enterprise users such as blocking international calls or 1 900 calls. In many embodiments Session Initiation Protocol SIP may be used to set up manage and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform for example Web Services Computer Telephony Integration CTI protocol Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions SIMPLE and various custom Application Programming Interfaces APIs .

One of the functions of enterprise communications platform is to extend the features of enterprise telephony to the mobile devices . For example the enterprise communications platform cay allow mobile device to perform functions akin to those normally available on a standard office telephone such as the digital telephone set or analog telephone set . Example features may include direct extension dialing enterprise voice mail conferencing call transfer call park etc.

The depicted system may include a number of enterprise associated mobile devices device is depicted . Device can be a device equipped for cellular communication through the PLMN or a dual mode device capable of both cellular and WLAN communications.

Enterprise network typically includes a number of networked servers computers and other devices. For example enterprise network may connect one or more desktop or laptop computers one shown . The connection may be wired or wireless in some embodiments. The enterprise network may also connect to one or more digital telephone sets one shown .

One approach is estimate start of a local ring tone on a mobile device based on a time stamp in a message received at a server from the mobile device through a data channel. However message propagation delay is difficult to determine from such a time stamp. For example if there is significant delay on the voice channel and that delay is different from a data channel delay then the timestamp may not be especially helpful. For example where a WiFi connection is used for the data channel a delay on the voice channel quite likely would be different. Therefore in preferred aspects herein one or more DTMF tones sent from the mobile device to the PBX server are used by the server to estimate delay on the voice channel and consequently when to send a given tone to the mobile device.

In a first example mobile device initiates a call such as by sending a notification or invite over a data channel received by server . In this situation mobile device sends verification tone s after the cellular portion of the voice channel is established. Where synchronization of ringing is to occur mobile device also restarts a local ring tone ringback tone that is audible on mobile device . Thus server when receiving the verification tone or if tones then preferably the first tone received serves as a marker for when mobile device restarted the ring cycle. Using this basis for determining the start of the ring cycle server then times sending of the DTMF tones indicative of status or control information to arrive at mobile device during ring off periods.

The verification tone s may need to be sent repeatedly. In one preferred example when repeatedly sending verification tones different tones can be used for each or a cycle of verification tones can be used. In this way server also is provided with information about when mobile device restarted its ring cycle. An example of such a preferred approach is that a first set of verification tones to be sent are DTMF tones for the numerals 2 3 4 6 and 0. Three seconds after sending theses initial tones tones for numerals 1 7 8 9 and 0 are sent. If the verification tone continues to need to be repeated then 3 seconds later the original tones for numerals 2 3 4 and 6 are again transmitted and so on with the second set of digits sent if necessary. This example is more appropriate for situations where a ring cycle has a time period roughly modulo . In this way server can determine based on which digits are received a modulo value representative of when mobile device restarted its ring cycle.

Upon having an estimate as to the timing of a ring cycle occurring on device server also can further select a time within the pause period to target. In many typical cases the pause period is 4 seconds. In one preferred case where the verification sequence is received by server tones for numerals 2 3 4 6 in the above example a guard time after an estimated start of the pause cycle and before an estimated end of the pause cycle is around 50 ms. For a second verification tone sequence 1 7 8 9 in the above example a guard time can be selected as 100 ms. Guard times can be selected based on network and device specific measurements and feedback from users.

In other call situations mobile device may receive a trigger tone indicating whether or not an authentication code previously provided to mobile device should be sent on the voice channel or not. Even if mobile device is not to respond with the full authentication code it still will respond with an acknowledgement tone s . Using the example of sending the authentication code mobile device preferably sends tones for the numerals 0 1 and the authentication code. Mobile device also generally concurrently with sending these tones also restarts the local ring tone. Server uses these tones when received as an indication when mobile device restarted its ring tone and bases timing decisions for tones to be sent to mobile device from this estimated ring cycle restart time.

In these situations there is some delay on the voice channel which preferably is determined empirically and can vary depending on how mobile device is constructed and the network or networks that it uses.

In the situation where there is a trigger tone being sent from server to mobile device there is no synchronization strategy in place when that trigger tone is to be sent to mobile device . However it also is preferably that a user of mobile device does not hear the trigger tone. As such preferably mobile device stops its local ring tone cycle when the cellular leg to the device is connected so that it can detect the trigger tone but stays muted so that the user will not actually hear this tone. So similar to the previous example mobile device can send an invite on the data channel wait a period of time e.g. 1.5 seconds and then begin generating a local ring tone. Upon connection of the cellular leg of the voice channel mobile device would stop the local ring tone. After getting a trigger tone and responding mobile device would restart the local ring. Preferably mobile device also introduces a delay of another 100 ms to avoid allowing the user to hear a tail portion of the trigger tone.

However if the trigger tone is not received timely a long period of silence would transpire while the trigger tone is resent retried from server . In one example the ring cycle is 4 seconds off 2 seconds on.

Situations where retried trigger tones may be heard include where a first trigger tone or the response to that first trigger tone was lost. If the first trigger tone was lost then mobile device would not have restarted ringing but if the response was lost then the device would have restarted ringing but server would not have received the response and would not be able to confirm a start time of such ringing.

Under these circumstances server will assume that the trigger tone did reach device and that ringing was restarted. Server will estimate when the ringing started based on when it sent the trigger tone plus a processing delay. Based on a known pattern of the ring tone it will schedule further tones with a goal to make the tones arrive at what it estimates to be a pause period. A timeout or numerical limit to retry the trigger tone can be enforced such as 3 times .

The above description applies to initiating a first voice connection with a given mobile device e.g. device if device wants to make another call then the authentication verification procedure can be dispensed since the existing voice channel has served that end. Thus for subsequent services the following aspects can be implemented for synchronizing tones with ring cycles. A subsequent call can be signaled via DTMF or via a data channel if available.

In DTMF case device sends 2nd outgoing call command digits to server one digit at a time. Once device completes sending the last digit of the 2nd outgoing call feature command it stops a local ring tone and waits for arrival of a remote ring tone status update. Server sends this status update when ring synchronizing is required. Device restarts its local ringing cycle when it receives the remote ring status message. Server can estimate when device restarted or started its local ring based on when it sent the remote ring status message. A timestamp for when it sent the message can be recorded and estimates of network delay and processing time can be added to that time in order to estimate when the local ring at device started.

Device may not always detect or receive the remote ring status message. Device however can restart ringing after a delay selected based on an expected delay to receive the remote ringing status message. The device thus should restart ringing based on an estimate of a typical delay to receive such status message. For example device can wait for X seconds where X can be selected at 5 seconds for example. Selecting this time involves a tradeoff between avoiding having the user hear undesirable tones and having a long silence that can make a user wonder what the call status is.

Preferably after receiving remote ring status message device restarts the local ring with a delay to avoid user hearing a tail portion of the trigger tone s and to avoid a user hearing an answered status tone when early media is present. For example when calling into a conference service early media may connect quickly. One example difference is with a call transfer case where device will not start ringing unless it receives the remote ring status message.

An example of such an approach is found with respect to in which information about a further party to be called can be received and a call to that party can be made. When the call to the further party begins to ring a remote ring notification can be sent to the source of the information received . When further information is to be sent to that device the local ring cycle on that device initiated responsive to remote ring notification is estimated in order to time delivery of such information such as by DTMF tones to arrive during pause periods of the local ring cycle.

The term synchronization has been used to refer to estimating timing of DTMF tone delivery to coordinate with a ring cycle on a mobile device e.g. in order to increase a likelihood that a tone sent would arrive during a pause or ring off period of the tone cycle . The usage of synchronization does not imply or require any absolute timing relationship or that there is a guarantee that tones will be delivered during an off period but rather more generally refers to approaches that heuristically attempt to increase the likelihood of causing tones to arrive at appropriate times at a mobile device for example.

Processing module communicates with mass storage which can be composed of a Random Access Memory and of non volatile memory . Non volatile memory can be implemented with one or more of Flash memory PROM EPROM and so on. Non volatile memory can be implemented as flash memory ferromagnetic phase change memory and other non volatile memory technologies. Non volatile memory also can store programs device state various user information one or more operating systems device configuration data and other data that may need to be accessed persistently.

User input interface can comprise a plurality of different sources of user input such as a camera a keyboard a touchscreen and a microphone which can provide input to speech recognition functionality .

Processing module also can use a variety of network communication protocols grouped for description purposes here into a communication module which can include a Bluetooth communication stack which comprises a LCAP layer a baseband and a radio . Communications module also can comprise a Wireless Local Area Network interface which comprises a link layer with a MAC and a radio . Communications module also can comprise a cellular broadband data network interface which in turn comprises a link layer with MAC . Cellular interface also can comprise a radio for an appropriate frequency spectrum . Communications module also can comprise a USB interface to provide wired data communication capability. Other wireless and wired communication technologies also can be provided and this description is exemplary.

Referring to there is depicted an example of mobile device . Mobile device comprises a display and a cursor or view positioning device here depicted as a trackball which may serve as another input member and is both rotational to provide selection inputs and can also be pressed in a direction generally toward housing to provide another selection input. Trackball permits multi directional positioning of a selection cursor such that the selection cursor can be moved in an upward direction in a downward direction and if desired and or permitted in any diagonal direction. The trackball is in this example situated on a front face not separately numbered of a housing to enable a user to maneuver the trackball while holding mobile device in one hand. In other embodiments a trackpad or other navigational control device can be implemented as well.

The mobile device in also comprises a programmable convenience button to activate a selected application such as for example a calendar or calculator. Further mobile device can include an escape or cancel button a menu or option button and a keyboard . Menu or option button loads a menu or list of options on display when pressed. In this example the escape or cancel button menu option button and keyboard are disposed on the front face of the mobile device housing while the convenience button is disposed at the side of the housing. This button placement enables a user to operate these buttons while holding mobile device in one hand. The keyboard is in this example a standard QWERTY keyboard.

In the foregoing separate boxes or illustrated separation of functional elements of illustrated systems does not necessarily require physical separation of such functions as communications between such elements can occur by way of messaging function calls shared memory space and so on without any such physical separation. As such functions need not be implemented in physically or logically separated platforms although they are illustrated separately for ease of explanation herein.

For example different embodiments of devices can provide some functions in an operating system installation that are provided at an application layer or in a middle layer in other devices. Different devices can have different designs such that while some devices implement some functions in fixed function hardware other devices can implement such functions in a programmable processor with code obtained from a computer readable medium.

Further some aspects may be disclosed with respect to only certain examples. However such disclosures are not to be implied as requiring that such aspects be used only in embodiments according to such examples.

The above description occasionally describes relative timing of events signals actions and the like as occurring when another event signal action or the like happens. Such description is not to be construed as requiring a concurrency or any absolute timing unless otherwise indicated.

Certain adaptations and modifications of the described embodiments can be made. Aspects that can be applied to various embodiments may have been described with respect to only a portion of those embodiments for sake of clarity. However it is to be understood that these aspects can be provided in or applied to other embodiments as well. Therefore the above discussed embodiments are considered to be illustrative and not restrictive.

