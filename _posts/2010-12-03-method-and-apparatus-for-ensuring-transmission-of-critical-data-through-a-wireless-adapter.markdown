---

title: Method and apparatus for ensuring transmission of critical data through a wireless adapter
abstract: In embodiments a host reserves capacity of a wireless adapter for critical data transmission. Critical data is injected into a transport interface of the host, which passes the critical data to the wireless adapter for wireless transmission to a destination device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08787256&OS=08787256&RS=08787256
owner: Motorola Solutions, Inc.
number: 08787256
owner_city: Schaumburg
owner_country: US
publication_date: 20101203
---
The invention relates generally to wireless adapters and more particularly to the transmission of critical data from a host device to a destination device.

Wireless interfaces are increasing being used between devices as a means of transmitting data from one device to another. Many such wireless interfaces use radio transmission techniques. For example the Institute of Electrical and Electronic Engineers IEEE has set forth several standards defining local and personal area wireless protocols and specifications. Some examples of these standards are known commonly by names such as WiFi and by trade names such as Bluetooth.

Personal area networking such as that substantially conforming to the IEEE 802.15.1 standard is being increasingly used between devices meant to be used by the same person cooperatively. Examples of which include interfaces between cellular phones and earpieces speakerphone devices and automobile audio systems interfaces between personal computers and wireless keyboards and other input devices and so on. In some of these applications there can be a critical need to transmit data from one device to another where latency must be minimized.

One example of such a critical application is in the link between a two way radio and an associated remote microphone device as is common in public safety applications. Two way radios provide push to talk PTT operation where the user can press a button on the device and commence speaking almost instantly where the two way radio commences transmitting the voice data as the user commences speaking. This kind of operation differs from other communication systems such as for example cellular telephony where a call circuit must be set up and the called party must answer a call at their end before the caller can commence speaking. In PTT systems when the user presses the talk button the radio begins transmitting and radios receiving the transmission audibly reproduce the user s voice without requiring interaction from a user at the receiving radio.

Since the near instant communication aspect of PTT operation is crucial it is desirable to avoid any latency. However conventional personal area networking protocols can introduce latency in several ways. For example data sent to the personal area network protocol stack must be processed through the protocol stack. There are several layers of processing before the data is passed to the wireless adapter for transmission and these layers of processing while of adequate speed for most applications can introduce an undesirable amount of latency in PTT applications. Furthermore since PTT data may not be the only data being exchanged between a remote accessory and the two way radio device the protocol stack can subject PTT data to flow control procedures which introduce undesirable latency into the communication. Accordingly there is a need for a means by which personal area networking techniques can be implemented in applications with critical latency considerations.

While the specification concludes with claims defining features of the invention that are regarded as novel it is believed that the invention will be better understood from a consideration of the description in conjunction with the drawings. As required detailed embodiments of the present invention are disclosed herein however it is to be understood that the disclosed embodiments are merely exemplary of the invention which can be embodied in various forms. Therefore specific structural and functional details disclosed herein are not to be interpreted as limiting but merely as a basis for the claims and as a representative basis for teaching one skilled in the art to variously employ the present invention in virtually any appropriately detailed structure. Further the terms and phrases used herein are not intended to be limiting but rather to provide an understandable description of the invention.

Referring to there is shown a block schematic diagram of a host device including a personal area network module in accordance with an embodiment. The device represented by the present figure is only meant to be an example and those skilled in the art will recognize that numerous embodiments exist to which the teachings discussed herein can be applied. in the present embodiment the host device includes a controller which can be a microcontroller or microprocessor capable of processing data receive input and provide output responsive to instruction code executed by the controller. The present embodiment further includes an audio processor which converts digital audio signals to analog signals to be played over a speaker and which receives analog signals from a microphone and converts them to digital audio signals that can be processed by the controller. The audio processor can be responsive to a push to talk PTT button which upon being pushed or otherwise actuated indicates a user of the device will be speaking Accordingly an analog audio signal will be received at the microphone from the user as the user speaks and the audio data is to be transmitted from the host device by a personal area network PAN module . The PAN module represents a type of wireless adapter and those skilled in the art will appreciate that other types of wireless adapters exist which can be used substantially interchangeably in accordance with the present teachings. The PAN module can be for example a wireless adapter operating in accordance with the IEEE 802.15.1 standard. An example of which is known in the industry by the trade name Bluetooth. The PAN module include a wireless transceiver for transmitting and receiving radio signals. An antenna can be used to facilitate radio operation. The host device can contain other user interface elements such as for example a graphic display keypad camera and so on.

The controller operates according to instruction code which can be stored in memory . Memory as shown represents an aggregate memory and can include read only memory ROM random access memory RAM re programmable memory and so on. The memory is a tangible non transitory machine readable storage medium and can store instruction code that when executed by the controller performs functions in accordance with the teachings herein. The host device can be for example a remote audio accessory that wirelessly interface via the PAN module with a two way radio. Both the remote audio accessory and two way radio can both be worn on a user s body and wirelessly interact with each other. For example the user can press the PTT button and the host device can commence sending audio data to the two way radio for transmission to other radios operating in a radio network or directly to other radios. The host device instruction code includes instruction code for instantiation a protocol stack for interfacing with the PAN module.

The host layers include at the highest level of the present abstraction an application layer . The application layer is a layer at which applications operate and is supported by lower layers. Among the applications is a critical application . The critical application when invoked can have critical data to be transmitted by the wireless adapter layers . When non critical applications need to have data transmitted by the wireless adapter they pass the non critical data to a protocol stack via an operating system to hardware interface which can be for example a device driver for a personal area network module which can include one or more dynamic link libraries DLLs . The protocol stack process the non critical data and prepares it for transmission down through other layers and finally passes the non critical data to a host controller interface HCI . The HCI provides a command interface to a baseband controller and link manager for the wireless adapter and access to hardware status and control registers of the wireless adapter. The HCI passes data to the HCI transport interface or simply transport interface which interfaces with the physical hardware communication to the wireless adapter . For example the communication can be a conventional three wire universal asynchronous receiver transmitter UART for a RS232 link to the wireless adapter . The communication hardware of the host communicates with communication hardware of the wireless adapter . The wireless adapter communication passes data to the wireless adapter hardware which operates according to instruction code stored therein and can include firmware for a host controller interface layer corresponding to the HCI layer that can respond to messaging from the HCI . The wireless adapter hardware contains a transceiver for transmitting and receiving radio signal and transmits the data to a destination using either a synchronous link or an asynchronous link.

In one embodiment a determination of the maximum capacity value can be performed by a capacity query which can come from the protocol stack upon initialization of the host . In embodiments using Bluetooth protocols the capacity query can be a HCI READ BUFFER SIZE command. The capacity query requests the wireless adapter to indicate its capacity for transmitting data. A response to the capacity query indicating the maximum capacity value is intercepted by the transport interface . The transport interface reduces or decrements the maximum capacity value to produce a reduced or decremented capacity value which is returned to the protocol stack or other entity which issued the capacity query. For example if the wireless adapter contains ten buffers the response the capacity query will indicate that there are ten buffers. The transport interface will decrement this by at least one and return a result to the higher layers indicating that there is not more than nine buffers available thus the tenth buffer will never be used for non critical data because the higher layers will not know of the tenth buffer s existence.

The amount that the maximum capacity value is reduced by can be set by the critical application by user preference or other means. Furthermore while the process occurs upon initialization it is contemplated that the host can re initialize the stack to change the reserved capacity value and provide the transport interface with a new or different value by which to reduce or decrement the maximum capacity value upon re initialization. The new value by which the maximum capacity value is decremented can be selected by the critical application or upon instantiation of an additional critical application. Once the desired capacity has been reserved critical applications can use the reserved capacity for transmitting critical data with minimal latency.

Conversely when the critical application needs to transmit critical data the critical application can invoke a command to pass the critical data directly to the transport interface . Since the critical application is bypassing the protocol stack and other layers the critical data can be said to be injected in the transport interface by the critical application. The command allows the critical application direct access to the transport interface . The transport interface can then format the critical data for format the critical data for transport to a destination device. The critical data can be handled by a Logical Link Control and Adaptation Protocol L2CAP function of the host which packetizes data for applications and provides connection oriented and connectionless data services to upper layer protocols with protocol multiplexing capability segmentation and reassembly operation and group abstractions. In Bluetooth specific embodiments the L2CAP permits higher level protocols and applications to transmit and receive L2CAP data packets up 64 Kilobytes in length.

Typical packetizing includes providing certain data fields in packet headers. When critical data is included in a packet one or more fields can indicate such. For example one or more header fields can include a value that has been pre selected to identify critical data packets. In other embodiments the value of a given field can be set to an illegal or undefined value to indicate the inclusion of critical data. For example a channel identifier field can be set to an illegal or undefined value such as 0x0000 . Once formatted the transport interface passes the critical data appropriately packetized to the wireless adapter which buffers the packet for transmission. Since the protocol stack operates as if there is at least one less buffer than is actually available there will be at least one buffer in the wireless adapter available for the critical data. The critical data can then be transmitted in a timely manner to the destination device using for example an asynchronous link between the host and the destination device.

Accordingly those skilled it the art will realize that embodiments of the present teachings include a method for ensuring transmission of critical data from a host device which commences by determining a maximum capacity value of a data transmission capacity of a wireless adapter associated with the host device which is performed at a transport interface of the host device and wherein the transport interface interfaces with the wireless adapter. The method further commences by decrementing the maximum capacity value producing a decremented capacity value at the transport interface wherein a reserved capacity value is the difference between the maximum capacity value and the decremented capacity value. The method further commences allowing non critical data to be transmitted according to the decremented capacity value through a non critical interface to the transport interface and transmitting critical data using a reserved capacity of the wireless adapter corresponding to the reserved capacity value wherein the critical data is injected into the transport interface at a critical interface of the transport interface.

Other embodiments can include a computer program product for a host device embodied in a machine readable storage medium the host device having a processor the computer program product having stored therein instruction code which when executed by the processor determines a maximum capacity value of a data transmission capacity of a wireless adapter associated with the device performed at a transport interface of the host device wherein the transport interface interfaces with the wireless adapter. The computer program product further including instruction code which when executed by the processor decrements the maximum capacity value producing a decremented capacity value at the transport interface wherein a reserved capacity value is the difference between the full capacity value and the decremented capacity value. The computer program product further including instruction code which when executed by the processor allows non critical data to be transmitted according to the decremented capacity value through a non critical interface to the transport interface. The computer program product further including instruction code which when executed by the processor transmits critical data using a reserved capacity of the wireless adapter corresponding to the reserved capacity value wherein the critical data is injected into the transport interface at a critical interface of the transport interface.

Additional embodiments can include a method for handling critical data at a destination device commenced by receiving a data packet from a remote device at a wireless adapter of the destination device. The method further commencing by passing the data packet to a transport interface of the destination device. The method further commencing by determining at the destination device that a header field of the data packet indicates the packet contains critical data. The method further commencing by passing the critical data directly to a corresponding critical application instantiation of the host device wherein the critical data does not pass through a protocol stack associated with the wireless adapter.

This invention can be embodied in other forms without departing from the spirit or essential attributes thereof. Accordingly reference should be made to the following claims rather than to the foregoing specification as indicating the scope of the invention.

