---

title: Graphic processing unit (GPU) with configurable filtering module and operation method thereof
abstract: A graphic processing unit (GPU) with a configurable filtering module (CFU) and an operation method thereof are presented. The graphic processing unit comprises a memory module and a configurable filtering module. The memory module stores at least one texture image. The configurable filtering module, connected to the memory module, comprises a plurality of filter equations, from which a filter equation is selected. A plurality of pixel points are sampled from the texture image. Each sampled pixel point is set with a weight value respectively. Each sampled pixel point with a weight value corresponding thereto is substituted into the selected filter equation to perform an operational process to acquire an operated value. Thereby, the user can decide the operation method of the GPU by selecting an appropriate filter equation and setting adjustable parameters in the filter equation.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08610737&OS=08610737&RS=08610737
owner: National Taiwan University
number: 08610737
owner_city: Taipei
owner_country: TW
publication_date: 20100527
---
The present invention generally relates to a graphic processing unit GPU with a configurable filtering module and an operation method thereof and more particularly to a graphic processing unit and an operation method thereof which can be operated by the user by selecting an appropriate filter equation and setting adjustable parameters in the filter equation.

The conventional 3D GPU with mapping functions is able to display 3D images on the screen of a computer system.

When the GPU operates for 3D graphic process the programmable shading module depicts a 3D object in a 3D screen space as shown in or and delivers coordinates P U V D representing the 3D object to the fixed filtering module in the meantime. The fixed filtering module extracts at least one texture image from the memory module and stores the texture image in the cache memory . Afterwards the texture filter in the fixed filtering module maps the coordinates P delivered from the programmable shading module onto the texture images in the texture space. Then at least one texel point adjacent to each of the coordinates P is acquired from the cache memory so that the texture filter is able to perform a weighted operation on these adjacent texel points to acquire pixel values of the coordinates P. Later the fixed filtering module transmits the pixel values of the coordinates P to the programmable shading module to map the pixel values of the coordinates P onto the surface of the 3D object so that the object can be texturized.

Moreover the cache memory stores texture image levels with respective resolutions corresponding to each texture image . The size of each texture image level is half the size of a previous level. For example if the image size of Level 0 is 256 256 the image size of Level 1 would be 128 128 and the image size can be similarly reduced to 1 1. Bi linear texture filtering is adopted in the fixed filtering module to calculate the pixel values of the coordinates P representing the 3D object by use of a texture image level with an appropriate resolution for example the highest resolution . Alternatively tri linear texture filtering can be adopted to calculate the pixel values of the coordinates P representing the 3D object by use of two texture image levels with different resolutions.

Please refer to which shows conventional bi linear texture filtering. In bi linear texture filtering is applied on a single texture image level on which texel points a b c d around a coordinate P are sampled by a window having 2 2 texels to calculate pixel values of the coordinate P. Moreover bi linear texture filtering can be implemented by a finite impulse response FIR filter equation as expressed in Equation 1 

Furthermore please refer to which shows conventional tri linear texture filtering. In tri linear texture filtering is applied on two texture image levels for example Level 0 and Level 1 with different resolutions based on the size of the 3D object . The coordinate P corresponds to the two texture image levels on which texel points a b c d and e f g h around a coordinate P are sampled by a window having 2 2 texels to calculate pixel values of the coordinate P. Moreover tri linear texture filtering can be implemented by a finite impulse response FIR filter equation as expressed in Equation 1 where I k represents the texel points k a b c d e f g h and C k represents the weight values of the texels k a b c d e f g h .

Even though the modern GPU has achieved improved 3D graphics based operations there are still some problems to be overcome.

For example since the GPU is used for 3D graphics the filter equation adopted by the texture filter in the fixed filtering module is designed to achieve 3D graphics functions. Accordingly the option for the filter equation is limited by 3D graphics based operations. However if the GPU is to be used in other applications such as image identification and machine learning algorithm the fixed filtering module is unable to perform an operational process without the assistance of the programmable shading module . As a result the operational loading of the programmable shading module would be heavier. Moreover some of the functions of the fixed filtering module are disabled which leads to poor efficiency of hardware.

Accordingly if the GPU is to be used in other type of image processing bi linear tri linear texture filtering adopted in the fixed filtering module would fail to access multiple texels in one process which results in only one texel accessed by the fixed filtering module during each operation clock. As a result the efficiency of the GPU would be lowered and the bandwidth of hardware would be underused.

Furthermore the user can only adopt the filter equation for example the FIR linear filter equation pre determined by the fixed filtering module and fails to flexibly adjust the sample count for example fixed as four sampled points the size of sampling window for example fixed as a window with 2 2 texels the weight value C k of the sampled points or the offset Coffset while calculating the pixel values of the coordinates P corresponding to the 3D object by the use of the pre determined filter equation.

It is one object of the present invention to provide a graphic processing unit GPU with a configurable filtering module and an operation method thereof wherein the configurable filtering module provides a plurality of filter equations so that the user can select one from the filter equations when the GPU operates and decides parameters in the filter equation such as the size of the sampling window the sample count the weight values of the sampled points and or the offset for calculation.

It is another object of the present invention to provide a graphic processing unit GPU with a configurable filtering module and an operation method thereof wherein the configurable filtering module can be used not only in 3D graphics but also in bio computing or science based computing by use of a variety of filter equations.

It is still another object of the present invention to provide a graphic processing unit GPU with a configurable filtering module and an operation method thereof wherein the user can select an appropriate filter equation and decides adjustable parameters of the filter equation by use of an application programming interface.

In order to achieve the foregoing objects the present invention provides a graphic processing unit GPU with a configurable filtering module comprising a memory module for storing at least one texture image and a configurable filtering module connected to the memory module comprising a plurality of filter equations from which a filter equation is selected wherein a plurality of pixel points are sampled from the texture image each sampled pixel point is set with a weight value respectively and each sampled pixel point with a weight value corresponding thereto is substituted into the selected filter equation to perform an operational process to acquire an operated value.

The present invention further provides an operation method of a graphic processing unit GPU with a configurable filtering module comprising steps of storing at least one texture image selecting one from a plurality of filter equations sampling a plurality of pixel points from the texture image deciding a weight value corresponding to each of the sampled pixel points and substituting the sampled pixel points and the weight values into the selected filter equation to perform an operational process to acquire an operated value.

Please refer to which is a schematic block diagram of a graphic processing unit GPU according to one preferred embodiment of the present invention. In the graphic processing unit GPU comprises a memory module and a configurable filtering module CFU . The configurable filtering module is connected to the memory module .

Wherein the memory module stores a plurality of texture images and the configurable filtering module comprises a plurality of filter equations. For example the filter equation comprises at least one of a finite impulse response FIR filter equation a maximum morphological filter equation and a minimum morphological filter equation. When the GPU performs a data operation on the texture image the user can select one from the filter equations and decide the size of the window for example 3 3 so as to sample a plurality of pixel points I k k a b c d e f g h I from the texture image as shown in . Afterwards each of the sampled pixel points I k are provided with a corresponding weight value C k . Each of the sampled pixel points I k with the corresponding weight value C k is substituted into the selected filter equation to perform an operational process to acquire an operated value.

Accordingly the user can select an appropriate filter equation from the configurable filtering module in the graphic processing unit GPU and adjust the parameters for calculation by use of the filter equation so that the GPU can operate according to the instruction of the user.

Moreover the configurable filtering module comprises a cache memory a configurable filtering unit and an application programming interface API . The cache memory is capable of storing the texture image . The configurable filtering unit comprises the filter equations and is connected to the cache memory to access the pixel points in the texture image . The application programming interface API selects one from the filter equations decides the size of the window to decide the position and the number of the sampled pixel points I k as well as the weight values C k corresponding to the sampled pixel points I k .

The configurable filtering unit accesses the sampled pixel points I k from the cache memory according to the size of the window decided by the application programming interface . The selected filter equation performs the operational process to acquire the operated value according to the sampled pixel points I k accessed by the configurable filtering unit and the weight values C k decided by the application programming interface .

Moreover referring to and the graphic processing unit GPU of the present invention further comprises a programmable shading module . When the graphic processing unit GPU is to be used for 3D graphics the programmable shading module is capable of depicting a 3D object in a 3D screen space and delivering coordinates P U V D representing the 3D object to the configurable filtering module . The configurable filtering module maps the coordinates P onto the texture image in a 2D texture space and samples the pixel points I k from the texture image by use of a window with 3 3 texels to acquire the operated value according to the sampled pixel points I k and the weight values C k . Meanwhile the operated value is transmitted back to the programmable shading module and is used as a pixel value of one of the coordinates P representing the 3D object . Thereby the 3D object is texturized.

The cache memory stores texture image levels with respective resolutions corresponding to each texture image . For example the size of the texture image levels can be 256 256 128 128 . . . 4 4 2 2 1 1. In bi linear texture filtering is adopted in the configurable filtering module to calculate the pixel values of the coordinates P representing the 3D object by use of a texture image level with an appropriate resolution for example the highest resolution . Alternatively tri linear texture filtering can be adopted to calculate the pixel values of the coordinates P representing the 3D object by use of two texture image levels with different resolutions.

Moreover in in addition to the window with 3 3 texels as shown in for sampling the pixel points I k from a single texture image level other windows with 2 2 4 1 1 4 1 8 or 8 1 texels as shown in or can also be used to sample the pixel points I k from a single texture image level . Alternatively as shown in a window with 2 2 texels can also be used to sample pixel points I k from two texture image levels with different resolutions.

Accordingly the configurable filtering unit of the present invention can adopt the finite impulse response FIR filter equation the maximum morphological filter equation or the minimum morphological filter equation as can be expressed as follows 

In Equation 2 the sampled pixel points I k and corresponding weight values C k are multiplied to acquire a plurality of product values. These product values are summed with an offset Coffset so as to obtain the operated value P.

In Equation 3 the sampled pixel points I k and corresponding weight values C k are multiplied to acquire a plurality of product values. These product values are compared to acquire a maximum product value as the operated value P.

In Equation 4 the sampled pixel points I k and corresponding weight values C k are multiplied to acquire a plurality of product values. These product values are compared to acquire a minimum product value as the operated value P.

Please further refer to which is a schematic circuit diagram of a configurable filtering unit according to one preferred embodiment of the present invention. In the present invention configurable filtering unit comprises a plurality of multipliers and a multilayered operator unit . The sampled pixel points I k a b c d e f g h i are multiplied with corresponding weight values C k a b c d e f g h i by the multipliers to acquire a plurality of product values such as A B C D E F G H I.

The multilayered operator unit is a composed of a plurality of operators to construct a hierarchical structure for example 4 layers. Each of the operators receives an operation selection signal to perform the operational process to acquire the operated value P by use of the filter equation according to the operation selection signal.

Please refer to which is a schematic circuit diagram of an operator according to one preferred embodiment of the present invention. In the product value A and the product value B are exemplified to describe the operator in the present embodiment. The operator comprises a first selector an adder a second selector and a sign indicator .

The first selector receives the product value A the inverting product value A and an operation selection signal. Thereby first selector decides to output the product value A or the product value A according to the operation selection signal. When the operation selection signal indicates that the FIR linear filter equation is adopted the first selector outputs the product value A when the operation selection signal indicates that the maximum morphological filter equation or the minimum morphological filter equation the first selector outputs product value A .

The adder receives the product value A the product value A or the product value B so that the product value B is summed with one of the product value A and the product value A so as to calculate a summed value A B B A .

The sign indicator receives the sum value A B B A to generate a flag signal which indicates weather the sum value A B B A is positive or negative.

The second selector receives the product value A the product value B the sum value A B B A the operation selection signal and the flag signal and outputs the product value A the product value B or the sum value A B according to the operation selection signal and the flag signal. When the operation selection signal indicates that the operational process is performed by use of the finite impulse response filter equation and the flag signal is positive the second selector outputs the sum value A B . When the operation selection signal indicates that the operational process is performed by use of the maximum morphological filter equation the second selector outputs the product value B if the flag signal is positive B A 0 otherwise the second selector outputs the product value A if the flag signal is negative B A0 otherwise the second selector outputs the product value B if flag signal is negative B A

Moreover the operator of the present invention further comprises an inverter for inverting the product value A to acquire the product value A .

In addition the operational processes of the product values C D E F G H I performed by the operators are similar to those of the product values A and B and thus descriptions thereof are not presented herein.

After the product values A B C D E F G H I are processed by each layer of operators the last layer layer 3 of operator outputs a summed sum value a maximum product value or a minimum product value as the operated value P.

Moreover when the configurable filtering unit adopts the FIR linear filter equation to perform the operational process one operator of the multilayered operator unit receives an offset so as to add the offset to the summed sum value.

Furthermore the operator in the present embodiment is exemplified by a window with 3 3 texels. The windows having other sizes can also be used. Moreover as being used with a window with 1 4 4 1 or 2 2 texels for sampling from a single level the operator can be divided into an upper and a bottom circuits. The upper operator is in charge of the pixel points sampled using a window with one size so that the last layer layer 2 of operator outputs an operated value P while the bottom operator is in charge of the pixel points sampled using a window with another size so that the last layer layer 2 of another operator outputs an operated value P. Thereby the pixel points sampled using the two windows are processed in parallel so that the efficiency of the configurable filtering unit is enhanced.

Furthermore shows an example that the configurable filtering module performs an operational process by the use of a variety of filter equations according to the present invention. In the present embodiment a window with 3 3 texels are used to sample pixel points from the texture image . In the present embodiment the sampled pixel points comprise 9 points for example a b c d e f g h i with peak values I k being Ia 4 Ib 3 Ic 3 Id 7 Ie 5 If 2 Ig 3 Ih 6 and Ii 3 and the decided weight values C k are Ca 0.75 Cb 0.75 Cc 0.5 Cd 0.75 Ce 0.75 Cf 0.5 Cg 0.5 Ch 0.5 and Ci 0.25.

When the configurable filtering unit adopts the FIR linear filter equation to perform the operational process the pixel values I k and the weight values C k are substituted into Equation 2 with the offset Coffset being set as 1. By calculating product value A 4 0.75 3 product value B 3 0.75 2.25 product value C 3 0.5 1.5 product value D 7 0.75 5.25 product value E 5 0.75 3.75 product value F 2 0.5 1 product value G 3 0.5 1.5 product value H 6 0.5 3 product value I 3 0.25 0.75 offset 1 23 we obtain a summed sum value being 23 as the operated value P.

When the configurable filtering unit adopts the maximum morphological filter equation to perform the operational process the pixel values I k and the weight values C k are substituted into Equation 3 . By comparing the product value A 3 the product value B 2.25 the product value C 1.5 the product value D 5.25 the product value E 3.75 the product value F 1 the product value G 1.5 the product value H 3 the product value I 0.75 we obtain a maximum product value D 5.25 as the operated value P.

When the configurable filtering unit adopts the minimum morphological filter equation to perform the operational process the pixel values I k and the weight values C k are substituted into Equation 4 . By comparing the product value A 3 the product value B 2.25 the product value C 1.5 the product value D 5.25 the product value E 3.75 the product value F 1 the product value G 1.5 the product value H 3 the product value I 0.75 we obtain a minimum product value I 0.75 as the operated value P.

Please refer to which shows an example of adjusting the number of sampled points according to one preferred embodiment of the present invention. In present embodiment the number of sampled points can be adjusted by the use of the maximum minimum morphological filter equation.

Taking a window with 3 3 texels for example when the user is to adjust the number of sampled points the weight values corresponding to the pixel points sampled using the window with 3 3 texels are set as zero. In the present embodiment the user can set the weight values corresponding to the a c g i pixel points as zero so that the products of pixel values multiplied with the weight values are zero no matter how large the pixel values of a c g i pixel points are when the maximum morphological filter equation is used to perform the operational process. As a result a c g i pixel points are no longer sampled.

On the contrary when the minimum morphological filter equation is used to perform the operational process the user can set the weight value corresponding to at least one pixel point as zero. Accordingly the minimum morphological filter equation results in an operated value as zero for the following process. For example the zero operated value will be mapped onto the 3D object.

Please refer to which is a schematic block diagram of an application programming interface according to one preferred embodiment of the present invention. In application programming interface in the present invention comprises a plurality of set pixel windows .

In the present embodiment when the graphic processing unit GPU is to be used for 3D graphics process the programmable shading module decides the scale of the depicted 3D object according to the distance of the object lens.

When the 3D object is relatively smaller the configurable filtering unit accesses at least one texture image level with lower resolution from the cache memory . Meanwhile the user decides a window size in the set pixel windows corresponding to the TEXTURE MIN FLITER. For example bi linear texture filtering is adopted with a single point sampled using windows with 2 2 4 1 1 4 1 8 3 3 or 8 1 texels. Alternatively tri linear texture filtering is adopted using a window with 2 2 texels to sample pixel points I k from a texture image level with lower resolution.

When the 3D object is relatively larger the configurable filtering unit accesses at least one texture image level with higher resolution from the cache memory . Meanwhile the user decides a window size in the set pixel windows corresponding to the TEXTURE MAG FLITER. For example bi linear texture filtering is adopted with a single point sampled using windows with 2 2 4 1 1 4 1 8 3 3 or 8 1 texels. Alternatively tri linear texture filtering is adopted using a window with 2 2 texels to sample pixel points I k from a texture image level with higher resolution.

The user selects one from the filter equations for example FIR MAX or MIN filter equations in the set filter type corresponding to the TEXTURE FLITER TYPE.

The user sets the weight values C k of the sampled pixel points I k in the set coefficients corresponding to the TEXTURE FLITER COEF The number of the weight values C k is identical to the number of the sampled pixel points I k . The weight values C k can be a float and not limited to any number.

Moreover if the user selects the FIR filter equation to perform the operational process in the set filter type corresponding to the TEXTURE FLITER TYPE the user still has to set the offset Coffset in the set Coffset corresponding to the TEXTURE FLITER COFFSET in the application programming interface . The offset Coffset is a parameter being a constant for calculation by use of the FIR filter equation.

Even though the graphic processing unit GPU of the present invention is exemplified using the foregoing drawings for 3D graphics the GPU can also be used in image processing bio computing or science based computing such as image identification and machine learning algorithm. Moreover a variety of filter equations can be embedded into the configurable filtering module to obtain the operated value for various applications.

Please refer to which shows an example of storing texture images in the cache memory according to one preferred embodiment of the present invention. In the cache memory comprises a plurality of banks such as 8 banks B B . Each bank is capable of transmitting an array of 2 2 texels to the configurable filtering unit during each operation clock.

The cache memory divides the texture image into a plurality of texture segments. Each texture segment comprises 8 rows of coordinate sites. Each of coordinate sites represents a single pixel point. The pixel points on the first row coordinate sites and the second row segment sites of the texture segment are sequentially and circulatingly stored in a first bank B a second bank B a third bank B and a fourth bank B. The pixel points on the third row coordinate sites and the fourth row segment sites of the texture segment are sequentially and circulatingly stored in a fifth bank B a sixth bank B a seventh bank B and an eighth bank B. The pixel points on the fifth row coordinate sites and the sixth row segment sites of the texture segment are sequentially and circulatingly stored in the third bank B the fourth bank B the first bank B and the second bank B. The pixel points on the seventh row coordinate sites and the eighth row segment sites of the texture segment are sequentially and circulatingly stored in the seventh bank B the eighth bank B the fifth bank B and the sixth bank B.

The cache memory stores the pixel points of the texture image . When the configurable filtering unit samples the pixel points from the texture image according to window size the configurable filtering unit can only access at most 4 pixel points from each bank during each operation clock. Therefore if the number of sampled pixel points stored in one bank exceeds 4 it takes the configurable filtering unit at least two operation clocks to finish accessing the sampled pixel points which leads to lowered efficiency of the graphic processing unit GPU .

Please refer to which is a flowchart of an operation method of a graphic processing unit GPU according to one preferred embodiment of the present invention. In Step S the graphic processing unit GPU stores at least one texture image .

In Step S the configurable filtering module of the graphic processing unit GPU comprises at least one of a plurality of filter equations such as the finite impulse response filter equation the maximum morphological filter equation and the minimum morphological filter equation. The user can select one from the filter equations for operational processed by the use of an application programming interface .

In Step S the user samples a plurality of pixel points from the texture image according to the size of a window by use of the application programming interface .

In Step S the user decides a weight value C k corresponding to each of the sampled pixel points I k by the use of the application programming interface .

In Step S the sampled pixel points I k with the weight values C k corresponding thereto are substituted into the selected filter equation to perform an operational process to acquire an operated value P.

Moreover the operation method of the graphic processing unit GPU in the present invention further comprises Step S. In Step S when the user selects the FIR filter equation to perform an operational process the user still has to determine an offset Coffset so as to substitute the offset into the FIR filter equation. Afterwards the FIR filter equation performs the operational process on the sampled pixel points I k the weight values C k and the offset Coffset to obtain the operated value P.

Although this invention has been disclosed and illustrated with reference to particular embodiments the principles involved are susceptible for use in numerous other embodiments that will be apparent to persons skilled in the art. This invention is therefore to be limited only as indicated by the scope of the appended claims.

