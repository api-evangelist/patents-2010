---

title: Packet flow processing in a communication system
abstract: Method and apparatus for processing packet flows in a communication system. In one embodiment, a resource reservation message includes packet flow parameter information used to determine flow treatment of the associated packet flow. The packet flow mapping is based on the quality of service of the associated packet flow. In another embodiment, a bearer connection is established and monitored for information relating to flow treatment.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08942168&OS=08942168&RS=08942168
owner: QUALCOMM Incorporated
number: 08942168
owner_city: San Diego
owner_country: US
publication_date: 20100720
---
The present Application for Patent is a Continuation of and claims priority to patent application Ser. No. 11 482 452 entitled Packet Flow Processing in a Communication System filed Jul. 7 2006 which is a Divisional of and claims priority to patent application Ser. No. 10 227 074 entitled PACKET FLOW PROCESSING IN A COMMUNICATION SYSTEM filed Aug. 23 2002 now abandoned which is a Continuation in Part and claims priority to patent application Ser. No. 10 170 059 entitled PACKET FLOW PROCESSING IN A COMMUNICATION SYSTEM filed Jun. 10 2002 now U.S. Pat. No. 7 277 455 and all assigned to the assignee hereof and all hereby expressly incorporated by reference herein.

The present invention relates to packet flow processing in a communication system and more specifically to packet flow mapping and treatment to support multiple service instances in a communication system having an Internet Protocol IP component.

Communication systems supporting data communications often include an Internet Protocol IP component or portion wherein data is communicated in an IP format. Similarly a communication system may be in communication with an IP system or may participate in a communication with an IP node. For such communications data is transported in packets a sequence of packets is referred to as a packet flow. In order to process the packet flow the infrastructure element s of a communication system require certain information. For example the infrastructure element s may need header compression and or mapping information so that the infrastructure element s can direct the packet flows to appropriate link layer connections.

There is therefore a need in the art to provide packet flow information to the infrastructure elements requiring such information. Similarly there is a need for an efficient method for mapping and treatment of packet flows in a communication system.

The word exemplary is used herein to mean serving as an example instance or illustration. Any embodiment described herein as exemplary is not necessarily to be construed as preferred or advantageous over other embodiments.

The MS supports data communications wherein several A10 connections and Service Option SO connections are illustrated. A SO connection is used for communication of a selected Service Option such as packet data services. An A10 connection then provides a link for sending Internet Protocol IP packets between the PDSN and BS . The SO connection provides a link for sending IP packets between the MS and BS . There is a one to one mapping between the SO connection MS BS and A10 connection BS PDSN . Multiple A10 SO connection pairs are illustrated in as the MS supports multiple simultaneous connections. In other words the MS is able to process multiple packet flows in parallel. Each packet flow is assigned to an A10 connection or link. The assignment of a packet flow to an A10 link is referred to as packet flow mapping and is determined by the PDSN. There are a variety of criteria and algorithms for such mapping that are applicable in the system of .

As discussed hereinabove each SO connection or link between the MS and BS has a corresponding A10 connection or link between the BS and the PDSN . The correspondence is illustrated by the dashed lines through BS . SO A10 connections may be used for a bi directional or interactive communication such as a Voice over IP VoIP communication or may be used for a uni directional communication such as to download data or for the streaming of information from an Internet source. As the number of type of data communications increases SO A10 connections may be implemented for more and more of these communications. Note that multiple SO connections a.k.a. service instances are needed to support different QoS requirements of packet flows. For example the MS may have two active SO connections. The first SO connection having retransmission mechanisms to provide reliable transport over the air at the cost of transmission latency and therefore is used for transporting data that requires reliable transmission. The second SO connection may not have retransmission mechanisms and is used for transporting data that requires expedited transmission.

The PDSN further includes the Authentication Accounting and Authorization AAA . The AAA serves to authenticate connections and keep track of the accounting for billing etc. by the carrier or service provider. The PDSN receives packet flows from a Corresponding Node CN as well as from other sources . The CN may be a node on the Internet a service provider a terminal etc. In other words the CN is a source of information or a participant to a communication. Note that the PDSN may receive multiple f packet flows from multiple sources wherein said packet flows are destined for multiple participants such as MS . Each packet flow is mapped to a corresponding SO A10 connection and is processed according to the parameters negotiated by the participants.

The flow mapping and treatment of each packet flow is particularly important when multiple service instances are set up to a given user such as MS . If the MS has multiple active service instances and the MS uses multiple header compression algorithms the PDSN will desire information for processing the packet flows associated with each service instance. Information includes but is not limited to the specific header compression algorithms used for each packet flow and the mapping of each packet flow to each A10 connection.

The embodiment described herein below is one method that provides flow treatment information via an RSVP message that contains a new object called the flow treatment. The RSVP message is a resource reservation setup protocol designed for integrated services on the Internet and is described in RFC 2205 entitled Resource ReSerVation Protocol RSVP by R. Branden et al. The RSVP protocol is used by a host to request specific qualities of service from the network for particular application data streams or flows. RSVP is also used by routers to deliver Quality of Service QoS requests to all nodes along the path s of the flows and to establish and maintain state to provide the requested service. RSVP requests will generally result in resources being reserved in each node along the data path. The RSVP message provides packet filters for bi directional packet flows e.g. interactive VoIP session or uni directional packet flows e.g. streaming session . Packet filters are used by a node to recognize a particular packet flow.

RSVP defines a session to be a data flow with a particular destination and transport layer protocol. RSVP treats each session independently. An RSVP session is defined by the triple DestAddress ProtocolId DstPort . Here DestAddress the IP destination address of the data packets may be a unicast or multicast address. ProtocolId is the IP protocol ID. The optional DstPort parameter is a generalized destination port i.e. some further demultiplexing point in the transport or application protocol layer. DstPort could be defined by a User Datagram Protocol Transmission Control Protocol UDP TCP destination port field by an equivalent field in another transport protocol or by some application specific information.

Upon establishment of a main service instance when the MS decides to setup an auxiliary service instance the MS sends an RSVP PATH and RESV Messages to request Quality of Service QoS resources. In the RSVP RESV Message the MS will characterize the packet flow via IP addresses and port numbers and conveys the codec type and header compression type. Upon receiving the RSVP RESV Message the PDSN will examine the information and request a new A10 connection to BS and associate the newly established A10 connection with the packet flow characterized by the Filter Spec and optionally the Session Class defined hereinbelow with respect to the RSVP type protocols . details the format of an RSVP message consistent with RFC 2205. The RSVP message is illustrated as an example of a message that may be used for transmission of the information needed by the PDSN for packet flow treatment and or mapping. Alternate embodiments may implement other messages to provide the same or similar information.

Note that throughout the discussion of RSVP type protocols directional terms are defined according to the direction of the flow of data. RSVP messages carrying reservation requests originate at receivers and are passed upstream towards the sender s . Specifically the directional terms upstream vs. downstream previous hop vs. next hop and incoming interface vs. outgoing interface are defined with respect to the direction of data flow.

Continuing with the router includes similar units as in the host however the configuration may be implemented in a slightly different manner. The router includes routing unit RSVP process unit policy control unit admission control unit packet scheduler classifier all in communication via communication bus . Note that RSVP process unit communicates RSVP messages to and from RSVP process unit .

Within system Quality of service is implemented for a particular data flow by mechanisms collectively called traffic control . These mechanisms include 1 a packet classifier classifier 2 admission control admission control and 3 a packet scheduler packet scheduler or some other link layer dependent mechanism to determine when particular packets are forwarded. The packet classifier mechanism or classifier determines the QoS class and perhaps the route for each packet. For each outgoing interface the packet scheduler or other link layer dependent mechanism achieves the promised QoS. Traffic control implements QoS service models defined by the Integrated

During reservation setup an RSVP QoS request is passed to two local decision modules admission control admission control and policy control . Admission control determines whether the node has sufficient available resources to supply the requested QoS. Policy control determines whether the user has administrative permission to make the reservation. If both checks succeed parameters are set in the packet classifier and in the link layer interface e.g. in the packet scheduler to obtain the desired QoS. If either check fails the RSVP program returns an error notification to the application process that originated the request.

RSVP protocol mechanisms provide a general facility for creating and maintaining distributed reservation state across a mesh of multicast or unicast delivery paths. RSVP itself transfers and manipulates QoS and policy control parameters as opaque data passing them to the appropriate traffic control and policy control modules for interpretation. Since the membership of a large multicast group and the resulting multicast tree topology are likely to change with time the RSVP design assumes that state for RSVP and traffic control state is to be built and destroyed incrementally in routers and hosts. For this purpose RSVP establishes soft state that is RSVP sends periodic refresh messages to maintain the state along the reserved path s . In the absence of refresh messages the state automatically times out and is deleted. In summary RSVP has the following attributes 

An elementary RSVP reservation request consists of a flowspec together with a filter spec the pair is called a flow descriptor . The flowspec specifies a desired QoS. The filter spec together with a session specification defines the set of data packets the flow to receive the QoS defined by the flowspec. The flowspec is used to set parameters in the node s packet scheduler or other link layer mechanism while the filter spec is used to set parameters in the packet classifier. Data packets that are addressed to a particular session but do not match any of the filter specs for that session are handled as best effort traffic.

The flowspec in a reservation request will generally include a service class and two sets of numeric parameters 1 an Rspec R for reserve that defines the desired QoS and 2 a Tspec T for traffic that describes the data flow. The formats and contents of Tspecs and Rspecs are determined by the system and are generally opaque to RSVP.

The exact format of a filter spec depends upon which IP version is in use. Current versions consider IPv4 or IPv6. According to one approach filter specs may select arbitrary subsets of the packets in a given session. Such subsets might be defined in terms of senders i.e. sender IP address and generalized source port in terms of a higher level protocol or generally in terms of any fields in any protocol headers in the packet. For example filter specs might be used to select different subflows of a hierarchically encoded video stream by selecting on fields in an application layer header. In the interest of simplicity and to minimize layer violation the basic filter spec format defined in the current RSVP specification has a very restricted form sender IP address and optionally the UDP TCP port number SrcPort.

The RSVP process passes the request to admission control and policy control. If either test fails the reservation is rejected and the RSVP process returns an error message to the appropriate receiver s . If both succeed the node sets the packet classifier to select the data packets defined by the filter spec and it interacts with the appropriate link layer to obtain the desired QoS defined by the flowspec.

The detailed rules for satisfying an RSVP QoS request depend upon the particular link layer technology in use on each interface. For a simple leased line the desired QoS will be obtained from the packet scheduler in the link layer driver for example. If the link layer technology implements its own QoS management capability then RSVP negotiates with the link layer to obtain the requested QoS. Note that the action to control QoS occurs at the place where the data enters the link layer medium i.e. at the upstream end of the logical or physical link although an RSVP reservation request originates from receiver s downstream.

A reservation request is propagated upstream towards the appropriate senders. The set of sender hosts to which a given reservation request is propagated is called the scope of that request.

The reservation request that a node forwards upstream may differ from the request that it received from downstream for two reasons. The traffic control mechanism may modify the flowspec hop by hop. More importantly reservations from different downstream branches of the multicast tree s from the same sender or set of senders must be merged as reservations travel upstream.

When a receiver originates a reservation request it can also request a confirmation message to indicate that its request was probably installed in the network. A successful reservation request propagates upstream along the multicast tree until it reaches a point where an existing reservation is equal or greater than that being requested. At that point the arriving request is merged with the reservation in place and need not be forwarded further the node may then send a reservation confirmation message back to the receiver.

There are two fundamental RSVP message types RESV and PATH. Each receiver host sends RSVP reservation request RESV messages upstream towards the senders. These messages must follow exactly the reverse of the path s the data packets will use upstream to all the sender hosts included in the sender selection. The RESV message results in creation and maintenance of a reservation state in each node along the path s . RESV messages are finally delivered to the sender hosts themselves so that the hosts can set up appropriate traffic control parameters for the first hop along the path.

Each RSVP sender host transmits RSVP PATH messages downstream along the uni multicast routes provided by the routing protocol s following the paths of the data. These RSVP PATH messages store a path state in each node along the way. This path state includes at least the unicast IP address of the previous hop node which is used to route the RESV messages hop by hop in the reverse direction. Note that future designs may implement routing protocols that supply reverse path forwarding information directly replacing the reverse routing function of path state.

A PATH message is required to carry a Sender Template which describes the format of data packets that the sender will originate. This template is in the form of a filter spec that could be used to select this sender s packets from others in the same session on the same link. Sender Templates have exactly the same expressive power and format as filter specs that appear in Resv messages. Therefore a Sender Template may specify only the sender IP address and optionally the UDP TCP sender port and assuming the protocol Id specified for the session.

A PATH message is required to carry a Sender Tspec which defines the traffic characteristics of the data flow that the sender will generate. This Tspec is used by traffic control to prevent over reservation and perhaps unnecessary Admission Control failures.

A Path message may carry a package of OPWA advertising information known as an Adspec . An Adspec received in a PATH message is passed to the local traffic control which returns an updated Adspec the updated version is then forwarded in PATH messages sent downstream. PATH messages are sent with the same source and destination addresses as the data so that they will be routed correctly through non RSVP cloud. On the other hand RESV messages are sent hop by hop each RSVP speaking node forwards a RESV message to the unicast address of a previous RSVP hop.

At a step before the mobile can send Session Initiation Protocol SIP signaling triggered by applications the MS establishes a Service Option SO such as for packet data services SO 33. In the example illustrated the Radio Link Protocol RLP retransmissions enabled. This provides a mechanism for the SIP messages to be transported reliably over the air. Note that SIP is detailed in SIP Session Initiation Protocol by J. Rosenberg et al. published by the Internet Engineering Task Force having document no. draft ietf sip rfc2543bis 08.ps dated Feb. 21 2002 and also in SIP Session Initiation Protocol by M. Handley et al. published by the Network Working Group having document no. RFC 2543 dated March 1999.

The Session Initiation Protocol SIP is an application layer control signaling protocol for creating modifying and terminating sessions with one or more participants. These sessions include Internet telephone calls multimedia distribution and multimedia conferences. SIP invitations used to create sessions carry session descriptions that allow participants to agree on a set of compatible media types. SIP makes use of elements called proxy servers to help route requests to the user s current location authenticate and authorize users for services implement provider call routing policies and provide features to users. SIP also provides a registration function that allows users to upload their current locations for use by proxy servers. SIP runs on top of several different transport protocols.

At step the MS establishes a Point to Point PPP session with PDSN. This provides the bearer connection for the link layer allowing establishment of connections for packet flows. Note that PPP is detailed in The Point to Point Protocol PPP by W. Simpson published by Network Working Group as RFC 1661 dated July 1994.

At step the PDSN sends an Access Request to the AAA containing the MS Network Access Identifier NAI and a credential. The NAI is a unique identifier for the MS. The credential is an authenticator computed by the MS in response to a Challenge Handshake Authentication Protocol. CHAP if Simple IP is used or a Foreign Agent Challenge if Mobile IP is used .

At step if the mobile is authenticated successfully the AAA sends an Access Accept containing the user subscription profile. The profile consists of two parts an Over The Air OTA component and an IP component.

At step the PDSN receives and caches the user IP subscription profile and forwards the user OTA subscription profile to the BS

At step the mobile sends SIP signaling via PPP SO33. The SIP signaling serves to set up a virtual bearer connection with the CN. This is an IP bearer connection through which the packet flow will be transported.

At step triggered by the SIP signaling e.g. 183 Session Progress the CN sends an RSVP PATH message toward the MS. In the RSVP Path Message the CN includes the standard RSVP objects Sender Template and Sender Traffic Spec Tspec that characterize the packet flow that will be generated by the CN. At step the PDSN forwards the RSVP PATH message to the MS. At step upon receiving the RSVP PATH message the MS uses the information contained in the message to calculate the desired QoS parameters i.e. bandwidth and delay for receiving the packet flow. The mobile then sends an RSVP RESV message to reserve resource along the path to the CN. The RSVP RESV message contains the flowspec filter spec and the treatment spec which is a new RSVP object specific to systems supporting the standard offered by a consortium named 3rd Generation Partnership Project 2 referred to herein as 3GPP2 and TR 45.5 referred to herein as the cdma2000 standard.

The flowspec specifies a desired QoS. The flowspec is used to set parameters in the node s packet scheduler or other link layer mechanism. The flowspec in a reservation request will generally include a service class and two sets of numeric parameters 1 an Rspec R for reserve that defines the desired QoS and 2 a Tspec T for traffic that describes the data flow. The formats and contents of Tspecs and Rspecs are determined by the integrated service models and are generally opaque to RSVP.

The filter spec defines the packet filters for the packet flow whose QoS is defined by the flowspec. The filter spec is used to set parameters in the packet classifier. Data packets that are addressed to a particular session but do not match any of the filter specs for that session are handled as best effort traffic.

The treatment spec which is a new RSVP object conveys the header compression type that should be used on the packet flow.

Upon receiving the RSVP RESV message the PDSN performs authorization based on the PDSN loading and local policy mobile reachability and user s IP subscription profile. If the PDSN rejects the RSVP RESV message the PDSN sends an RSVPTear message toward the CN and a PATHTear message toward the MS. Else if the RSVP RESV is authorized the PDSN examines the treatment spec of the RSVP RESV message. The treatment spec contains the header compression type that the MS wants to use on the packet flow. The PDSN determines whether or not a new A10 connection is needed. If needed the PDSN sends an A11 Registration Update RUP Message to BS to request for a new A10 connection in step .

For example If the header compression type is LLAROHC the PDSN provides notification via A11 to the BS to establish a new A10 connection and initiate the establishment of the selected service option instance such as SO 61 with the MS.

If the header compression type is ROHC the PDSN sends notification via A11 to the BS to establish a new A10 connection and initiate the establishment of auxiliary service option instance such as SO 33 without RLP retransmissions with the MS.

The association between header compression type and SO can be done in PDSN or BS. If the association is done in the PDSN then the A11 RUP message will contain the SO number and the BS uses it to initiate the service negotiation with the MS. If the association is done in the BS then the A11 RUP message will contain the header compression type and the BS will associate it with a SO number and uses it to initiate the service negotiation with the MS.

At step the BS responds with A11 Registration Acknowledgement RACK Message. At step the BS attempts to connect the SO specified in A11 signaling message to the MS via Call Assignment Message CLAM . At step the BS connects the SO selected. At step the BS sends an A11 RRQ Registration Request to establish an A10 connection. At step the PDSN responds with an A11 RRP Registration Reply .

At step upon successful establishment of the new A10 connection the PDSN associates the newly established A10 connection with the packet filters obtained from the filter spec of the RSVP RESV message in step . This allows the PDSN to perform flow mapping on the packet flow that fits the description of the packet filters. The PDSN removes the treatment spec from the RSVP RESV message and sends it toward the CN. If for some reason s the new A10 connection is not established after a timeout the PDSN sends PATHTear message toward the MS.

From this point the packet flow is processed from the CN to the MS via the PDSN. The PDSN performs the appropriate header compression on the packet flow and forward the packet flow to the appropriate A10 connection.

Note that illustrates an uni directional communication from the CN to MS. For interactive bi directional communication between the CN and MS both the MS and the CN are sources and destinations. Therefore in addition to the steps illustrated in and detailed hereinabove symmetrical steps are initiated from the MS. For example the MS also sends an RSVP Path message. Similarly the PDSN forwards the RSVP Path message to the CN. The CN provides an RSVP RESV message and the PDSN forwards the RSVP RESV message to the MS. The RSVP RESV message from the CN will not necessarily trigger the PDSN to request A10 connection establishment as in step .

For the situation of an existing A10 connection for an auxiliary SO 33 with no RLP retransmission enabled one embodiment utilizes the existing connection. According to an alternate embodiment the BS establishes another auxiliary SO 33 with the MS. In this case if the MS refuses then the existing auxiliary SO 33 is used to also transport the new codec.

The embodiment described herein below is another method that provides flow treatment and flow mapping information via an RSVP message. The flow treatment and mapping information can be derived from the standard RSVP objects conveyed in the RSVP RESV message and no new RSVP object needs to be defined as in the previous method.

The call flow is the same as in . One difference is that in step the RSVP RESV message only contains the flowspec and filter spec. There is no treatment spec that explicitly tells the PDSN what header compression type should be used on the packet flow. Instead the PDSN uses the flowspec to determine the header compression type implicitly.

The flowspec includes the Reservation Spec Rspec and Traffic Spec Tspec . The Rspec describes the service rate and the Tspec describes the token bucket parameters bucket rate peak rate bucket dept maximum packet size to characterize the traffic that the CN will generate. The Rspec and Tspec together characterize a CDMA voice codec e.g. 13 kbps PureVoice 8 kbps EVRC 8 kbps SMV or 4 kbps SMV that outputs a voice frame every 20 ms. The PDSN is configured to recognize CDMA voice codec based on the parameter values in the flowspec. If there is a match and the MS is capable of LLAROHC the PDSN requests the BS to establish a new A10 connection and the BS establishes SO 61 with the MS. If there is no match then the PDSN concludes that the packet flow carries a real time codec other than CDMA voice codecs in this case if the MS is capable of ROHC and currently has no auxiliary SO 33 then the PDSN requests the BS to establish a new A10 connection and the BS establishes an auxiliary SO 33 RLP retransmission disabled with the MS.

It is possible that a different codec might have the same Rspec and Tspec description as a CDMA codec. For example codec X is characterized as service rate 8 kbps 20 ms constant inter packet interval and maximum packet size of 171 bits plus header overhead which is same as the EVRC characterization. This contribution recommends that 0 byte header compression is applied to the packet flow carrying codec X as if it was EVRC. Although the lower rate frame sizes of codec X might be different from that of EVRC each lower rate frame can be padded and fitted into a CDMA physical layer frame full or .

The embodiment illustrated in provides an alternate method to determine flow treatment and flow mapping information wherein such determination is based on the PDSN sniffing Session Initiation Protocol SIP messages. This method relies on the PDSN to sniff SIP messages to determine the IP addresses port numbers and codec of a new packet flow that will be generated by the CN. This provides sufficient information for the PDSN to determine flow treatment and flow mapping. The PDSN also determines whether or not a new A10 connection is needed to transport the packet flow. If needed the PDSN requests the BS to establish the A10 connection and the BS initiates the establishment of a new service instance with the MS.

Sniffing SIP messages requires the PDSN to recognize that an IP packet is carrying a SIP message and pick out the essential information from the SIP message. The PDSN examines the destination port number of a packet. If it is equal to 5060 then the transport payload is carrying a SIP message. Note that there are many SIP messages and fields. The PDSN pays attention to the SIP INVITE and SIP 200 OK messages and may choose to ignore the other SIP messages. Note that SIP defines a variety of messages. The SIP INVITE message indicates that a user or service is being invited to participate in a session. An SIP 200 OK message indicates that a request has succeeded. Within the SIP INVITE and SIP 200 OK messages the PDSN pays attention to the connection field that conveys the IP address information the media field that conveys the port number information and the attribute field that conveys the codec type. Based on the codec type the PDSN determines which header compression type should be used on the packet flow. For example if the codec type indicates a CDMA codec e.g. PureVoice EVRC or SMV Link Layer Assisted Robust Header Compression LLAROHC will be used if the codec type indicates a codec other than a CDMA codec Robust Header Compression ROHC will be used. Alternate systems may support any of a number of codec types and the specific details provided herein serve as an example.

After the PDSN determines the header compression type the PDSN determines whether or not a new A10 connection is needed for the new packet flow. If needed the PDSN requests the BS to establish the A10 connection and the BS initiates the establishment of a new service instance with the MS. Upon successful establishment of the A10 connection the PDSN associates the A10 connection with the packet filters obtained from sniffing the SIP messages i.e. the connection field and media field of the SIP INVITE and SIP 200 OK messages.

The present invention provides a flexible method for communicating packet flow parameters in RSVP messages without depending on Differentiated Service Code Point DSCP which is conveyed in a field of the IP header protocol types and well known port numbers. The use of a message such as the RSVP message may be used for both bi directional and uni directional packet flows.

The use of existing messages to provide the packet flow information accomplishes an efficient air resource allocation and use criteria. In one embodiment the new bearer connection for the communication i.e. new A10 connection is not established until the RSVP reservation is authorized. This avoids requiring termination of the bearer connection i.e. auxiliary SO A8 A10 connections on refusal.

In an alternate embodiment additional service instance setup may be initiated as illustrated in . The call flow diagram of illustrates the additional service instance setup procedure when the MS is already active with a main service instance established. The procedure is as follows 

At the point a the PDSN decides to establish the additional service instance the PDSN sends an A11 Registration Update to the PCF. The A11 Registration Update message allows the PDSN to indicate the applied header compression algorithm. The PDSN starts the timer associated with the Registration Update message referred to as the timer T regupd. 

At point b the PCF sends an A9 BS Service Request message to the BS in order to request an additional service instance and starts timer referred to as timer T. The mapping between the header compression algorithm and the service option may be performed in the PCF or the BS. According to one embodiment the determination is made by TSG A Technical Specification Group . If the mapping is performed by the PCF no change is made to the existing A9 BS Service Request message. If the mapping is performed in the BS the PCF will indicate the applied header compression algorithm to the BS in the A9 BS Service Request message. For example the mapping table may be specified as follows 

At step c the BS sends an Additional Service Request message to the MSC and starts the timer referred to as timer T to reconnect the additional service instance.

At step d the MSC sends an Assignment Request message to the BS to request assignment of radio resources and the A8 e.g. User Traffic connection between the BS and the PCF. The MSC then starts the timer referred to as timer T. Upon receipt of the Assignment Request message from the MSC the BS stops timer T.

At step e the BS responds with an A9 BS Service Response. The PCF stops the timer Tupon receipt of the A9 BS Service Response message.

At step f upon receiving the successful A9 BS Service Response message from the BS the PCF responds with an A11 Registration Acknowledgement. The PDSN stops the timer T regupd.

At step g the BS may send a Call Assignment Message over the traffic channel of the radio interface to initiate the establishment of a CC state machine Call Control state machine .

At step h the BS sends one of i the Service Connect Message ii General Handoff Direction Message or iii Universal Handoff Direction Message to the MS to invoke the additional service option connection.

At step i the service negotiation may be performed between the MS and the BS. At step j the MS responds with a Service Connect Completion Message upon the completion of the service negotiation procedure.

At step k the BS sends an A9 Setup A8 message to the PCF to establish A8 i.e. User Traffic connection between the BS and the PCF for the additional service instance over the A9 e.g. Signaling connection. The BS then starts the timer referred to as timer T. 

At step l the PCF recognizes there is an A10 connection associated with this mobile and that an additional A10 connection needs to be setup. The PCF sends an A11 Registration Request message to the corresponding PDSN. The PCF starts the timer referred to as timer T regreq. 

At step m the PDSN accepts the connection by returning an A11 Registration Reply message with an accept indication.

At step n the PCF responds with an A9 Connect A8 message to complete the setup of A8 e.g. User Traffic connection for this packet service request. Upon receipt of the A9 Connect A8 message from the PCF the BS stops timer T.

At step o after the radio service connection and the A10 connection have been established the BS sends an Assignment Complete message to the MSC. The MSC then stops timer Twhen the MSG sends an Assignment Request Message see step d .

Note that The PDSN may initiate a request for addition of a new A10 connection by using the messages as supported by the system. The PDSN sends the A11 Registration Update message to the PCF to request addition of a new A10 connection. The PDSN sends the A11 Registration Update message with the Code field in the message set to Add New Connection to request PCF establishing a new A10 connection. The PDSN then starts the timer associated with the registration update referred to as T regupd after sending the A11 Registration Update message and waits for an A11 Registration Ack message from the PCF.

If timer T regupd expires the PDSN may resend the A11 Registration Update message to the PCF a configurable number of times. After a configurable number of retransmissions without a response from the PCF the session establishment procedure may be considered as a fail however the existing A10 connection s will remain connected.

The PCF sends the A11 Registration Acknowledge message to the PDSN to acknowledge the requested A10 connection is accepted if the requested operation can be successfully supported by the BS PCF and MSC.

Upon receipt of an A11 Registration Update message with the Code field of the message set to Add New Connection if the PCF supports the requested A10 connection the PCF will send an A9 BS Service Request message to the BS. If the MSC and BS support the new connection the PCF will so indicate by setting the Status field in the message to New Connection Accepted . Upon receipt of the message the PDSN will stop the timer T regupd when A11 Registration Update message is sent and stops when A11 Ack is received.

Upon receipt of an A11 Registration Update message with the Code field of the message set to Add New Connection if the PCF does not support the requested A10 connection or the requested connection is denied by A9 BS Service Response message received from the BS the PCF will so indicate by setting the Status field in the message to New Connection Denied . Upon receipt of the message the PDSN stops the timer T regupd.

If the PDSN fails to receive an A11 Registration Acknowledge message from the PCF the PDSN may resend A11 Registration Update message a configurable number of times before considering the new establishment failed.

Each of the messages described hereinabove may include any number of fields and codes as defined by the system. For example as proposed for design in 3GPP2 the A11 Registration Update message includes a Code. The Code information element is included when the message requests an additional connection or requests an update to the existing connection. The Code element identifies the result of processing an A11 Registration Request message. For example the Code decimal indicates Add New Connection. 

Similarly The A11 Registration Update message has an associated Status element that identifies the result of processing an A11 Registration Update message. For example the Status decimal indicates New Connection Accepted and the Status decimal indicates New Connection Declined. 

Further a Normal Vendor Organization Specific Extension NVSE Application Type of hex value 0AH indicates the Header Compression Algorithm. Application subtypes are then used to identify the specific algorithm. For example hex value 01H identifies Robust Header Compression ROHC while hex value 02H identifies Link Layer Assisted ROHC LLAROHC . An MN Session Reference ID field is used to uniquely identify a packet data service instance in the mobile. The MN Session Reference ID is passed to the PCF from the mobile. For Application Type 0AH Header Compression Algorithm the MN Session Reference ID field contains the header compression algorithm in octet .

The Multi Channel Flow Treatment Protocol MCFTP is defined as a new PPP protocol type. MCFTP carries information about the binding between packet flows and SRfor 0 byte header compression such as how flows should be mapped onto underlying service instance connections between the MS and PDSN. The MCFTP also carries the IR Static information from the MS to the PDSN if header removal mode is used between the MS and PDSN. The information elements of MCFTP are designed along Type Length Value TLV principles that allow easy expansion of the protocol when needed.

Before any MCFTP packets may be communicated PPP will reach the Network Layer Protocol Phase. An MCFTP packet is illustrated in . More than one MCFTP packet may be encapsulated in the PPP Information Fields wherein the protocol number indicates protocol x0289 MCFTP . MCFTP uses three basic message formats 

An MCFTP Response Message is sent in response to a MCFTP Request Message that was successfully received and processed. It is simply an MCFTP packet with either an empty body or IR Static information included. MCFTP Response Message format is sent with the code equal to 2 and contains the fields illustrated in Table 2.

An MCFTP Reject message is sent in response to an MCFTP Request message that could not be processed such as when the receiver was unable to identify a received option or sub option. The MCFTP Reject packet format is sent with code equal to 7 and contains the fields illustrated in Table 3.

According to one embodiment a method for flow mapping a simplified MCFTP method is combined with a localized RSVP method. Specifically the simplified MCFTP is only used for 0 byte header compression for establishing a binding between SR ID Service Reference Identification and IP flow because no Context ID CID in 0 byte header compression NHP packet. The simplified MCFTP runs over PPP instead of UDP as MCFTP contains link layer parameters such as SR ID binding and IR Static for 0 byte header compression removal mode. The localized RSVP is used to trigger the PDSN sending MCFTP request to the mobile node. This method uses standard localized. RSVP messages and objects. Existing RSVP objects convey sufficient information for the PDSN to determine the codec characteristics and hence which header compression method should be used on the packet flow. No 3GPP2 specific RSVP objects are required. The PDSN also determines whether or not a new A10 connection is needed to transport the IP flow. If needed the PDSN requests RN to establish the A10 connection and the RN initiates the establishment of a new service instance with the MS and service negotiation may be performed between the MS and RN. After the new service instance is established the PDSN will send MCFTP over PPP to indicate the binding between IP flow and SR ID. If header removal mode is used the MS will send IR Static parameters to the PDSN by using MCFTP over PPP.

The PDSN uses the Flow Spec to determine which header compression method should be used on the packet flow. The Flow Spec includes the Reservation Spec Rspec and Traffic Spec Tspec . The Rspec describes the service rate and the Tspec describes the token bucket parameters bucket rate peak rate bucket dept maximum packet size to characterize the traffic that the CN will generate. The Rspec and Tspec together can characterize a CDMA voice codec 13 kbps PureVoice 8 kbps EVRC 8 kbps SMV or 4 kbps SMV that outputs a voice frame every 20 ms. Note that alternate codecs may have a same Rspec and Tspec description. For example codec X is characterized as service rate 8 kbps 20 ms constant inter packet interval and maximum packet size of 171 bits plus header overhead which is same as the. EVRC characterization. A 0 byte header compression may be applied to the packet flow carrying codec X as if it was EVRC. Although the lower rate frame sizes of codec X might be different from that of EVRC each lower rate frame can be padded and fit into a CDMA physical layer frame full or .

The PDSN is configured to recognize the CDMA voice codec based on the parameter values in the Flow Spec. If there is a match and the MS is capable of LLAROHC the PDSN requests the RN to establish a new A10 connection and the RN establishes SO 61 with the MS. If there is no match then the PDSN concludes that the IP flow carries a realtime codec other than CDMA voice codecs in this case if the MS is capable of ROHC and currently has no auxiliary data service option SO 33 then the PDSN requests the RN to establish a new A10 connection and the RN establishes an auxiliary SO 33 RLP retransmission disabled with the MS.

The PDSN uses the Filter Spec for flow mapping. The Filter Spec conveys the source address and port number of a packet flow that will be generated by the CN. If the PDSN requests a new A10 connection the PDSN associates the new connection with the packet flow described in the Filter Spec.

The call flow of flow mapping and treatment for ROHC is similar as LLAROHC except MCFTP is not needed as the Context ID CID is included in each ROHC packet so that the receiving side can distinguish the IP flow via the CID.

For LLA ROHC MCFTP provides several advantages. The PDSN uses MCFTP to convey the binding of the packet filter and the SR ID to MS. The need for MCFTP is illustrated in the following TE MT Terminal Equipment Mobile Terminal example. For some reasons the TE e.g. laptop may desire to establish two Voice over IP VoIP sessions simultaneously each using EVRC. Although the MT e.g. network model handset can sniff the RSVP messages that contain packet filter information for both VoIP flows the MT does not know the binding between the packet filter and the SR ID unless the PDSN uses MCFTP to notify the MT about the binding. Note In this example the RSVP parameters for both VoIP sessions that use EVRC would look exactly the same to the MT.

In the case of header removal mode the MS needs to use MCFTP to convey full header information to the PDSN. Note that LLA ROHC is a link layer assisted header compression. In addition the header removal mode is 3GPP2 specific mode therefore it is not a problem to create a 3GPP2 specific link protocol simplified MCFTP to assist the operation.

For ROHC MCFTP is not needed even when the TE wants to establish two real time sessions simultaneously. For example using non COMA codecs that cannot take the advantage of 0 byte header compression. Based on the RSVP parameters the MT that sniffs the RSVP messages would know whether or not the two real time sessions require similar over the air QoS. This example further considers the following two cases 

The PPP frame instead of the UDP datagram is recommended for MCFTP is based on the layering principle. The use of MCFTP conveys i the binding between the packet filters and the SR ID and ii the full header information when the LLA ROHC header removal mode is used. As the MCFTP is used for conveying link layer related information MCFTP should be transported at the link layer e.g. PPP . Using UDP to transport MCFTP strictly speaking is a layer violation and as such is not recommended. The method described herein relies on the existing RSVP parameters Flow Spec and Filter Spec to establish the packet filter in the PDSN. One example for setting token bucket parameters for an EVRC codec is listed as follows 

Those of skill in the art would understand that information and signals may be represented using any of a variety of different technologies and techniques. For example data instructions commands information signals bits symbols and chips that may be referenced throughout the above description may be represented by voltages currents electromagnetic waves magnetic fields or particles optical fields or particles or any combination thereof.

Those of skill would further appreciate that the various illustrative logical blocks modules circuits and algorithm steps described in connection with the embodiments disclosed herein may be implemented as electronic hardware computer software or combinations of both. To clearly illustrate this interchangeability of hardware and software various illustrative components blocks modules circuits and steps have been described above generally in terms of their functionality. Whether such functionality is implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system Skilled artisans may implement the described functionality in varying ways for each particular application but such implementation decisions should not be interpreted as causing a departure from the scope of the present invention.

The various illustrative logical blocks modules and circuits described in connection with the embodiments disclosed herein may be implemented or performed with a general purpose processor a digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components or any combination thereof designed to perform the functions described herein. A general purpose processor may be a microprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. A processor may also be implemented as a combination of computing devices e.g. a combination of a DSP and a microprocessor a plurality of microprocessors one or more microprocessors in conjunction with a DSP core or any other such configuration.

The steps of a method or algorithm described in connection with the embodiments disclosed herein may be embodied directly in hardware in a software module executed by a processor or in a combination of the two. A software module may reside in RAM memory flash memory ROM memory EPROM memory EEPROM memory registers hard disk a removable disk a CD ROM or any other form of storage medium known in the art. An exemplary storage medium is coupled to the processor such the processor can read information from and write information to the storage medium. In the alternative the storage medium may be integral to the processor. The processor and the storage medium may reside in an ASIC. The ASIC may reside in a user terminal. In the alternative the processor and the storage medium may reside as discrete components in a user terminal.

The previous description of the disclosed embodiments is provided to enable any person skilled in the art to make or use the present invention. Various modifications to these embodiments will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other embodiments without departing from the spirit or scope of the invention. Thus the present invention is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

