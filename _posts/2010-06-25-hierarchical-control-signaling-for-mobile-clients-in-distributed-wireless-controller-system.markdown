---

title: Hierarchical control signaling for mobile clients in distributed wireless controller system
abstract: A system and method for a hierarchical distributed control architecture to support roaming wireless client devices. Access switches serve one or more Internet Protocol (IP) subnets that include plural IP addresses. The access switches are arranged in switch peer groups and store information about other access switches in that switch peer group and about locations of wireless client devices that are associated with any access switch in the switch peer group. The access switches are further grouped into a corresponding mobility sub-domain each including plural switch peer groups. Plural controller devices control access switches in a corresponding mobility sub-domain. Each controller device stores information about the access switches and about locations of wireless client devices within its mobility sub-domain. A central controller device communicates with the controller devices for the respective mobility sub-domains. The central controller device stores information about locations of wireless client devices in the mobility sub-domains.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08428006&OS=08428006&RS=08428006
owner: Cisco Technology, Inc.
number: 08428006
owner_city: San Jose
owner_country: US
publication_date: 20100625
---
This application is a continuation in part of U.S. patent application Ser. No. 12 773 351 filed on May 4 2010 the entirety of which is incorporated herein by reference.

This application is also related to the following commonly assigned co pending U.S. patent applications filed on May 4 2010 

U.S. patent application Ser. No. 12 773 360 entitled Maintaining Point Of Presence At Tunneling Endpoint For Roaming Clients In Distributed Wireless Controller System. 

U.S. patent application Ser. No. 12 773 355 entitled Routing To The Access Layer To Support Mobility Of Internet Protocol Devices. 

The present disclosure relates to networking techniques capable of supporting mobility of a network device.

Networked services to wired and wireless devices are supported by equipment that makes up what may be referred to as the infrastructure of the network. Examples of equipment in the network infrastructure include routers access switches and control computers or servers that are used to store data pertaining to the status of devices that connect to the network. Some access switches have routing capabilities and in this regard are also referred to as forwarders because they forward packets from one access switch to another.

A device with networking capability referred to herein as a client device or station may connect to the network at one access switch and then physically move i.e. roam such that it connects to a different access switch in the network. This roaming capability is prevalent with client devices that have wireless capabilities and can connect to a wired network at a different access switch by establishing a wireless connection such as a wireless local area network WLAN connection with a wireless access point AP device.

Wireless is one of the many services being integrated within an access switch. The wireless service ensures that the access layer terminates the data plane to facilitate the delivery of a converged architecture. Convergence implies that regardless of whether the traffic originates from a wired or wireless station the same set of features can be applied. There will be unification at the management and configuration level for the end customer and wired and wireless will become an access method into the organization. Unification implies that mobility services are provided to both wireless and wired stations.

A system and method are provided for a hierarchical distributed control architecture to support roaming of wireless devices. A plurality of access switches are provided and configured to serve one or more Internet Protocol IP subnets that comprises a plurality of IP addresses. The plurality of access switches are arranged in switch peer groups such that each access switch within a given switch peer group is configured to store information about other access switches in that switch peer group and about locations of wireless client devices that are associated with any wireless access point on any access switch in the switch peer group. The plurality of access switches are further grouped into a corresponding one of a plurality of mobility sub domains each comprising a plurality of switch peer groups. A plurality of controller devices are provided each configured to control access switches in a corresponding mobility sub domain. Each controller device stores information about the plurality of access switches within its mobility sub domain and about locations of wireless client devices at access switches in its mobility sub domain. A central controller device is provided and configured to communicate with the plurality of controller devices for the respective mobility sub domains. The central controller device is configured to store information about locations of wireless client devices in the mobility sub domains.

In order to provide topology transparency to stations devices as they roam within the network the network infrastructure equipment needs to provide for seamless roaming. From the station s perspective any mobility event should not change its IP address its default router or Dynamic Host Configuration Protocol DHCP server. This means that as stations roam they send an Address Resolution Protocol ARP request to their default router or transmit a DHCP request to the server that had previously assigned its address. A hierarchical mobility architecture is provided that supports seamless mobility in networks where wireless services are terminated at the access switch. The point of presence of the roamed station stays at an access switch that serves the IP subnet for the station after it has roam to another access switch.

Reference is first made to . illustrates a diagram depicting a network infrastructure architecture that is configured to support mobility of wireless client devices. The network architecture comprises a mobility domain shown at reference numeral . A mobility domain is a geographical region for which roaming services are to be provided. Contiguous coverage is intended to be provided in this geographical region by the network architecture . The network architecture provides better scaling properties over existing systems in that it breaks down the traditional mobility group into multiple mobility sub domains. Thus a mobility domain includes one or more mobility sub domains. For simplicity shows two sub domains and and labeled Mobility Sub Domain and Mobility Sub Domain respectively. For instance a mobility sub domain could consist of a single building within a campus. A sub domain is more of a representation of the network topology than the physical walls of a building so it is also possible for a mobility sub domain to span multiple buildings in a campus for example.

The network architecture further comprises a mobility controller and a mobility oracle. In one form each mobility sub domain includes one or more mobility controllers MCs and mobility tunnel endpoint MTE pairs. While more than a single MC MTE pair may be present in a sub domain only one may be active at any given time. The provision of multiple pairs in a sub domain is for resilience and failure back up. In another form a single MC is provided for the entire mobility domain. Said another way for networks that consist of more than a single mobility sub domain the mobility oracle is provided. The mobility oracle is a centralized database that includes information on each of the stations in the mobility domain the home mobility sub domain for each station and the current foreign sub domain providing service to each station. The mobility oracle is consulted by the individual MCs in order to facilitate inter mobility sub domain mobility events.

In the example architecture shown in the functions of the MTEs in each sub domain may be incorporated or integrated with other network equipment. For example in sub domain the MTEs and may be incorporated into a distribution switch and further connected to distribution core switches and respectively. The distribution core switches and are in turn connected to a core network that represents a Layer 3 or core portion of the network architecture . In mobility sub domain the MTEs and may be integrated into respective distribution core switches that are in turn connected to the core network . In this case there are distribution switches and connected to MTEs and in sub domain .

A mobility controller provides the mobility control plane operations facilitating mobility events that occur both within a mobility sub domain as well as across sub domains. To this end an entity called the mobility oracle is provided. The mobility oracle is a centralized control apparatus that comprises database that includes information on each of the client devices in the mobility domain their home mobility sub domain and the current foreign sub domain providing service. The mobility oracle is consulted by the individual mobility controllers in order to facilitate inter sub domain mobility events. The mobility oracle is shown coupled to the core network but it may also be connected at the sub domain level to any of the mobility sub domains. As with the mobility sub domain s mobility controller more than one mobility oracle may be deployed for redundancy purposes although only one would be active at any given time for the mobility domain.

Within each mobility sub domain are access switches that provide the access layer connectivity to client devices operating in the mobility domain . For example mobility sub domain has access switches and mobility sub domain has access switches . Each access switch is capable of serving one or more IP subnets. An IP subnet comprises a plurality of IP addresses. An IP address for a client device can be assigned by a DHCP server it can be statically configured on the client device or the client device can auto generate the IP address from a subnet served by its home access switch. It is possible that two or more access switches may serve the same IP subnet s .

A client device obtains an IP address the first time it connects to the network but it may also obtain another IP address thereafter. For example an IPv6 client device can obtain a new IP address at any time and thus can have multiple IP addresses. In general the client device determines when to obtain an IP address.

Access switches within a mobility sub domain may be grouped together in what is referred to herein as switch peer group. A switch peer group is statically configured by the MC based on static information or information that is dynamically learned. Within a switch peer group every switch has to have the same view of the membership of the group. A switch peer group does not span across mobility sub domains or routing boundaries. A mobility sub domain may have one or more switch peer groups. A purpose of the switch peer group is to allow access switches between which client devices roam to interact directly during handoff events. This permits a network to scale by eliminating the need for the MC to be involved in each and every handoff within a mobility sub domain. Tunnels optionally directly connect the access switches in a switch peer group. If present these tunnels allow data traffic to be directly sent from one access switch to another in the same switch peer group without involving the MTE. Each MC for a mobility sub domain is configured to generate data used to arrange access switches in its mobility sub domain into switch peer groups and to send information to the access switches in its mobility sub domain in order to inform each access switch about the other access switches in its switch peer group.

As explained hereinafter client devices associate to an access switch either by a wired network connection or a wireless network connection through a wireless access point device . shows wireless access point AP devices at reference numerals . The AP devices support the Control and Provisioning of Wireless Access Points CAPWAP protocol. As the CAPWAP architecture specifies the APs perform the physical PHY layer and real time IEEE 802.11 MAC functions which includes IEEE 802.11 encryption. The AP establishes a tunnel to the access switch to tunnel client devices wireless traffic. Thus an AP is said to be on an access switch when it is configured to tunnel traffic for a wireless device to the access switch.

The APs encrypt all CAPWAP control traffic using the Datagram Transport Layer Security DTLS protocol. If the AP supports Cisco TrustSec CTS or IEEE 802.1AE MacSec encryption then a link between the switch and the AP may be protected by Layer 2 CTS in which case both CAPWAP control messages and CAPWAP traffic will get encrypted. If CTS is not supported then the CAPWAP data traffic is unencrypted. In one possible form CAPWAP data traffic can also be DTLS encrypted as an option.

Each MTE provides mobility services on the data plane ensuring that a client device s point of presence on the Layer 3 network remains constant across mobility events. An MTE s involvement in a routing scenario for a client device is optional in that the functions of the MTE are only utilized when tunneling is employed.

Reference is now made to . shows the mobility domain in greater detail. In this example the mobility domain comprises three mobility sub domains and . Each mobility sub domain comprises a plurality of access switches AS s arranged in switch peer groups. For example mobility sub domain comprises MC access switches in switch peer group access switches 1 in switch peer group and access switches 1 in switch peer group . Similarly mobility sub domain comprises MC access switches in switch peer group access switches 1 in switch peer group and access switches 1 in switch peer group . Mobility sub domain comprises MC access switches in switch peer group access switches 1 in switch peer group and access switches 1 in switch peer group . Each of the MCs and communicate with the access switches in their respective mobility sub domains. Moreover the MCs and communicate with the mobility oracle .

At the control messages are shown for an inter switch peer group intra mobility sub domain roaming event. In this case a station roams from an access switch in one switch peer group to an access switch in another switch peer group but within the same mobility sub domain. As shown at the control messages flow in and out from the respective switches in the two switch peer groups to and from the MC in mobility sub domain . The MC for that mobility sub domain becomes involved in handling the mobility event but the mobility oracle is not involved nor are the MCs for any other mobility sub domain.

At the control messages are shown for an inter mobility sub domain roaming event where a station roams from an access switch in one mobility sub domain to an access switch in another mobility sub domain. For example a station roams from an access switch in mobility sub domain to an access switch in mobility sub domain and in particular to access switch 1 . In this case control messages will flow across mobility sub domains between the mobility controllers of the two mobility sub domains involved. In addition the mobility oracle will receive and send control messages to handle the mobility event.

Thus as shown in the control messages are not sent to all entities all access switches MCs and mobility oracle in the mobility domain. The control messages are bound or contained within a group of entities according to the nature of the mobility event. Higher level control elements such as mobility controllers and the mobility oracle do not become involved unless the mobility event involves a station roaming across mobility sub domains. This helps to keep control message traffic at a minimum and thus reduce control plane overload.

Reference is now made to for a description of an example block diagram of an access switch. This diagram is meant to representative of a block diagram for any of the access switches and shown in and in general for any access switch in any mobility sub domain. The access switch comprises a processor a switch and router unit that may be in the form of an Application Specific Integrated Circuit ASIC a network interface unit a system bus and a memory . The switch and router unit provides the packet forwarding routing and switching functions that are well known for a network access switch. The network interface unit processes packets for transmission over the network and processes packets received from the network For example the network interface unit is an Ethernet card or similar device. The access switch is also referred to herein as a forwarder because it forwards packets to and from a client device. Instructions for access switch control logic are stored in the memory for execution by the processor . As explained above an access switch is configured to serve IP addresses in one or more IP subnets.

The processor may be a programmable processor or a fixed logic processor. In the case of a programmable processor the memory is any type of tangible processor readable memory e.g. random access read only etc. that is encoded with or stores instructions that when executed by the processor cause the processor to perform a variety of functions including the functions of the access switch control logic described herein. Alternatively the processor may a fixed logic processing device such as an ASIC or digital signal processor or a network processor or a general purpose processor that is configured with firmware comprised of instructions that cause the processor s to perform the functions described herein. Thus instructions for the logic may take any of a variety of forms so as to be encoded in one or more tangible media for execution such as with fixed logic or programmable logic e.g. software computer instructions executed by a processor and the processor s may be a programmable processor programmable digital logic e.g. field programmable gate array or an ASIC that comprises fixed digital logic or a combination thereof.

Examples of functions of the access switch control logic are described hereinafter in connection with . These functions include mobility agent functions and datapath functions. The mobility agent functions are responsible for handling mobility events on the access switch configuring the datapath elements on the switch for mobility and communicating with the MC. The datapath functions include terminating the CAPWAP tunnels which encapsulate IEEE 802.11 traffic sourced by wireless client devices allowing the access switch to treat wired and wireless traffic in a uniform fashion.

More specifically the functions of the mobility agent in the access switch are as follows. The mobility agent is responsible for responding in a timely manner to mobility control protocol messages sent by the various entities in the network ensuring that a roaming budget time period is maintained for client devices. If the wireless subnets are not available at the MC MTE then the mobility agent assumes the role of the point of presence for roamed client devices that were originally associated with it. When the network is configured in a Layer 2 mode the mobility agent is responsible for advertising reachability for the client devices connected to it. If tunneling is employed an Address Resolution Protocol ARP request would be transmitted on behalf of the client device through the tunnel which the point of presence access switch would bridge onto its uplink interface. The mobility agent is responsible for subscribing to multicast groups on behalf of a client device after a roaming event has occurred. This information is passed as part of the context to the new access switch to ensure that the multicast flows follow the client device as it roams. When the access switch is connected to a Layer 3 access network the mobility agent is responsible for injecting routes for the client devices that are associated with it for which tunneling is not provided. The mobility agent performs an 802.1X authenticator function for both wired and wireless client devices. Finally when a station successfully authenticates to the network the mobility agent forwards the Pairwise Master Key PMK to the MC and the MC is responsible for flooding the PMK to all of the access switches in the mobility sub domain.

Turning now to an example block diagram of an MC is now described. An MC is a control apparatus that may be embodied by a computing apparatus comprising a processor a network interface unit and a memory . Examples of specific embodiments of the processor and the network interface unit are described above in connection with . The memory stores MC control process logic that when executed by the processor cause the processor to perform the MC functions described herein. In addition the memory stores a stations database and a switch database .

The stations database maintains a database of all wireless client devices that are being served within the local sub domain or the entire mobility domain if the MC is configured to serve the entire mobility domain . This database may not store full client device context and may only include information indicating whether the client device currently considers the local sub domain as its home and is in many ways very similar to the function provided by the mobility oracle although with a more limited scope i.e. only for client devices local to the sub domain. The database may include additional information such as the client device s credentials which could be in the form of the user s identity or a common name in a certificate as well as the IP Address assigned to the device if one has already been assigned to it by the network.

The switch database maintains a database of all access switches within the mobility sub domain and updates all of the access switches in real time as changes to the database occur e.g. addition or removal of a switch from the network .

Other functions of the MC are summarized as follows. The MC is responsible for responding in a timely manner to mobility control protocol messages from other entities to ensure that the system achieves the desired roaming budget. The MC acts as a gateway between the access switches and the mobility oracle. When the MC does not find a match in its local database it forwards the request to the mobility oracle which is responsible for the entire mobility domain. However there are deployment scenarios where the MC is responsible for the entire mobility domain. When tunneling is employed for a client device its point of presence on the network could be the MTE if the wireless subnets are available at the MTE. Therefore in these cases the MC will respond to any ARP requests received for the client devices it is responsible for. When the MC is connected to a Layer 3 network it is responsible for injecting routes into the network for the client devices it provides service for via a tunnel. The MC is the control point for the access switches for all mobility management related requests. When a change in a client device s point of attachment occurs the MC is responsible for configuring the proper forwarding policy on the MTE which may be co located with the MC. If the MC and the MTEs are physically separate the MC is responsible for initiating the signaling to the MTE to enforce changes in the client device s point of attachment in the network. The MC is capable of handling unsolicited commands from the Remote Authentication Dial in User Service RADIUS infrastructure. These messages can be received by an access switch and forwarded to the MC to clear out or update the client key cache entries. It is also the responsibility of the MC to forward these messages to other MCs in mobility domain if a message is received from access switch. Finally the MC optionally acts as an Network Time Server to the access switches to allow all access switches within a mobility sub domain to have their clocks synchronized. The MC in turn synchronizes its clock off the mobility oracle.

Turning to an example block diagram of an MTE is now described. The MTE is a routing apparatus that may also have processing functions. The MTE comprises a processor a memory and a network interface unit . The MTE may be integrated into a distribution switch or router and to this end shows basic switching components including a switch and router unit and a system bus . Instructions are stored in the memory for MTE control logic . The processor executes the instructions for the MTE control logic to perform the various MTE functions described herein.

The MTE handles the mobility data plane. The role of the MTE is different depending on whether or not it is serving as the point of presence for client devices in the sub domain. If the wireless subnets are not available at the MTE then the point of presence for roamed client devices is at the home access switch. In this scenario the MTE serves as a tunnel switching entity that connects the foreign access switch point of attachment to the home access switch point of presence . If the wireless subnets are available at the MTE then the MTE serves as the point of presence.

The functions of the MTE are generally as follows. The MTE terminates mobility tunnels from the access switches in its mobility sub domain. Thus there are pre established tunnels between the MTE and each access switch in a given mobility sub domain. Traffic to and from the roamed client device is sent to the foreign access switch via the mobility tunnel. An MTE MTE tunnel is used to tunnel traffic between mobility sub domains. The MTE has an interface the MC uses to configure the MTEs forwarding tables to reflect mobility events. When the MC and MTE are collocated this is simply an API. If both functions are not collocated this is a protocol.

As explained herein the MC and MTE functions may be implemented by separate physical entities. In the case where they are implemented in a single entity the MTE does not actually act as a router and therefore does not inject routes into the network. The MC is responsible for advertising routes. However the interfaces on which the routes are injected are considered part of the MTE. In the unlikely event that the MTE is decoupled from the MC it is responsible for transmitting certain packets on behalf of the MC. For instance the MC will provide Proxy ARP and routing services yet these packets are transmitted on the MTEs interfaces. For networks that do not make use of tunneling the MTE is not a necessary function.

Reference is now made to for a description a block diagram of the mobility oracle . The mobility oracle is a central controller for the mobility domain and contains a centralized database that includes information on each of the client devices in the network their home mobility sub domain and the current foreign sub domain providing service. The mobility oracle is a computing apparatus with network connectivity that oversees the entire mobility domain but it does not necessarily perform any routing or packet forwarding functions. The mobility oracle comprises a processor a network interface unit to provide network connectivity with the MCs and MTEs in the mobility domain and a memory that stores mobility oracle control logic and a station database . The station database maintains a database of all stations that are being provided service within the mobility domain. This station database is populated through interactions the mobility oracle has with all of the MCs in all of the mobility sub domains it supports. The station database includes each station s MAC address its current home mobility sub domain and if roaming its current foreign mobility sub domain. When the mobility oracle receives a request from an MC it is responsible for performing the station lookup and forwarding the request to the proper MC. The mobility oracle acts as a Network Time Protocol NTP server to the MCs to allow all of the controllers within the mobility domain to have their clocks synchronized. The functions of the mobility oracle control logic are described hereinafter in connection with .

Foreign Mobility Controller The MC providing mobility management service for the client device in a foreign mobility sub domain. The foreign MC acts as a liaison between access switches in the foreign sub domain and the MC in the home sub domain.

Foreign Mobility Sub Domain The mobility sub domain controlled by a MC supporting a client device which is anchored in its IP address is part of an IP subnet of another mobility sub domain.

Foreign Switch The access switch in the foreign mobility sub domain currently providing service to the client device.

Home Mobility Controller The MC providing the single point of control and mobility management service for client devices in their home mobility sub domain.

Home Mobility Sub Domain The mobility sub domain controlled by a MC for a client device where its IP address was assigned.

Home Access Switch The access switch in the home mobility sub domain that serves the IP subnet that includes the IP address of the client device and that last provided service to that client device. The Home Access Switch may not be the access switch where the wireless device initially joined the mobility domain.

Mobility Sub Domain The mobility sub domain is an autonomous component of the overall mobility domain network. A sub domain generally connects into the core network and includes one or more MC functions and optionally their associated MTEs. A mobility sub domain is the set of devices managed by the active Mobility Controller. A mobility sub domain comprises of a set of access switches and associated APs across which fast roaming is desired. A mobility sub domain is equivalent to an 802.11r key domain. The mobility sub domain may also be referred to as an IP Everywhere IPe sub domain. A mobility sub domain and an mobility sub domain are terms that are used interchangeably herein.

Point of Attachment A client device s point of attachment is where the client is currently associated to the wireless network. This could either be the access switch that is currently providing service to the AP where the client device is associated or the WLAN controller in the case of a legacy deployment. Thus a wireless client device may roam from one AP on a first access switch to another AP on a second access switch and thereby become attached at or on the second access switch.

Point of Presence A client device s point of presence is the place in the network where the client device is being advertised. For instance if an access switch is advertising reachability to the client device via a routing protocol the interface on which the route is being advertised is considered the client device s point of presence.

Station A client device that connects to and requests service from the network. The device may have a wired wireless or both interfaces. The term station may be used interchangeably with the term client device.

The MTE can have two different roles depending on the availability of the subnets for the roamed station at the MTE. If the subnet of the roamed station is available at the MTE the MTE could become the point of presence other it functions as a tunnel switching entity that connects the roamed station to the point of presence which could be an access switch. In the following examples the tunneling architecture is used and the wireless subnets are not available at the MTE.

When the wireless VLANs or IP subnets are not available at the MTE then the point of presence for an Layer 3 roamed station is maintained on the original or anchor access switch the access switch to which the station initially for the first joined associated in the network. In this case the MC MTE becomes the tunnel switch point where the MTE serves as a tunneling endpoint apparatus and switches the traffic from the tunnel from the foreign access switch to another tunnel to an anchor access switch and vice versa. This scenario can happen if the MC MTE is not located at the distribution layer but is deeper in the network at the core. In fact this is a very likely scenario during the transition from an overlay WLAN controller architecture to the architecture disclosed herein since the WLAN controller which will serve as the controller for legacy switches and MC MTE for the access switches is often at the core of the network.

In the scenarios described hereinafter in connection with a wireless station roams from one access switch to another access switch by associating with an AP on a different access switch. For simplicity a wireless station is said to roam from access switch to access switch but it is understood that this involves the wireless station leaving the service of one AP and associating to an AP on a different access switch. In reference numerals in the 100 s refer to operations of an access switch reference numerals in the 200 s refer to operations of an MC reference numerals in the 300 s refer to operations of an MTE and reference numerals in the 400 s refer to operations of the mobility oracle.

Referring now to a block diagram is shown of a portion of the mobility domain shown in and in particular access switches within a single mobility sub domain e.g. sub domain . Access switches of mobility sub domain are shown where access switches and are part of the same switch peer group and access switches and are part of a different switch peer group . A wireless station is shown that initially joins the network by associating to an AP that is on access switch and is an example of a particular wireless client device that roams within the mobility domain. Accordingly the station is given an IP address from a subnet available on or served by the access switch . Therefore while the station is associated to an AP on access switch its point of presence and point of attachment are the same access switch .

When station roams to an access switch in the same switch peer group e.g. to access switch in switch peer group no handoff is necessary because all of the access switches in the same switch peer group share context information about the stations attached to them. This relatively simple scenario is shown in the ladder flow diagram of . At the access switch in the same switch peer group to which a station roams e.g. access switch detects attachment of the station recognizes it as roaming from a switch peer group member and obtains its context IP address information for the station from information that it stores. In general whenever an access switch detects association of a station at AP that it serves the access switch is configured to compare an identifier of the station with the information stored at the access switch to determine whether the station was previously located on another access switch in the switch peer group of which that access switch is a part. Thus each access switch stores context and client policy information about all stations connected to any access switch in its switch peer group.

At when a particular access switch determines that the station was previously located on another access switch in the same switch peer group the particular access switch to which the station roams sends an update to all other access switches that are members of that switch peer group so that they can update their store information to reflect the current location of the station in the switch peer group. Thus all access switches in the switch peer group will know that the station is currently attached to another access switch e.g. access switch in the switch peer group . The MC is not notified of this roaming event nor is any of the access switches in other switch peer groups.

Referring back to another type of roaming event occurs when the station roams from an access switch in one switch peer group to an access switch in another switch peer group. For example the station roams from the AP on access switch in switch peer group to AP on access switch in switch peer group . illustrates the control signal flow for this type of roaming event.

An access switch is configured to send a Mobile Announce message to the MC of its mobility sub domain in which the access switch resides when the access switch determines based on a comparison of an identifier e.g. MAC address of the station with its stored information that the station was not previously located at another access switch within the switch peer group in which that access switch is a part. Accordingly when an access switch to which the station roams detects the association of the station by way of an AP on that access switch and after the station is authenticated it sends a Mobile Announce message to the mobility controller for that mobility sub domain. This is shown at reference numeral . The Mobile Announce message comprises information identifying the roamed station e.g. MAC address of the roamed station of the roamed station and an identifier of the access switch to which the station has roamed.

The mobility controller for that mobility sub domain receives the Mobile Announce message and does a look up in its station database to determine the access switch where the station was previously located i.e. where it was last attached where its IP subnet is available which may but not in all cases be the access switch where the station initially joined to the network which in the scenario of is in the same particular mobility sub domain as the particular access switch to which the station has roamed but in a different switch peer group than the particular access switch. After making this determination the mobility controller at sends the Mobile Announce message to the access switch where the station was previously attached and also serves the IP subnet for the IP address of that station. The access switch that receives the Mobile Announce message obtains the identity of the original source of the Mobile Announce message the access switch where the station has roamed and the identity of the station that has roamed and at sends a Handoff message to the access switch to which the station has roamed. The Handoff message contains context information about the station that is information identifying the station including the IP address of the station and MAC address of the station and any policies associated with the station.

The access switch where the station is currently attached receives the Handoff message and generates a Handoff Complete message that it sends at to the mobility controller for the mobility sub domain. The Handoff Complete message confirms that the station is connected at that access switch and also contains the identity of that access switch. In response to the mobility controller receiving and processing the Handoff Complete message it updates its stored information for the locations of stations as shown at . At the access switch where the station is currently attached sends a Handoff Notification message to other access switches in its switch peer group to update the location of the station among the switches in its switch peer group thereby informing the switch peer group member access switches that the station is now attached to an access switch in that switch peer group.

At the mobility controller sends to the access switch where the station is currently attached an acknowledgment ACK message for the Handoff Complete message. At the access switch from which the station has roamed sends out a message to its switch peer group members to notify them that the station has left the switch peer group.

Turning now to an example of an inter mobility sub domain roaming event is shown. In this example the station is currently associated with an AP on access switch in mobility sub domain . The station roams to and associates with AP on access switch in mobility sub domain . For simplicity the access switches in the same and other switch peer groups are not shown in for mobility sub domains and .

Reference is now made to for a description for the control signal flow for the mobility event shown in . In mobility sub domain is the mobility sub domain from which the station has roamed and mobility sub domain is the mobility sub domain to which the station has roamed. Again when an access switch detects attachment of a station that it determines not to have been previously attached to a switch in its switch peer group then the access switch sends a Mobile Announce message at to the mobility controller for its mobility sub domain mobility sub domain .

The mobility controller for the foreign mobility sub domain mobility sub domain also may not know the station if it is the first time that the station is moving to this mobility sub domain. The mobility controller in each mobility sub domain is configured to forward the Mobile Announce message it receives from an access switch within its mobility sub domain to the mobility oracle also referred to herein as a central controller device when the mobility controller determines from its station database that the station was not previously attached to an access switch within its mobility sub domain and does not otherwise have stored information about the station i.e. where the station was previously attached its IP address etc. Therefore at the mobility controller forwards the Mobile Announce message to the mobility oracle.

The mobility oracle determines from its stations database the mobility controller for the home mobility sub domain for station based on information contained in the Mobile Announce message that identifies the station . In other words the mobility oracle determines the mobility sub domain where the wireless client device had been previously located and forwards the Mobile Announce message to the mobility controller for that mobility sub domain. The station may have roamed to several mobility sub domains before reaching an access switch for the current mobility sub domain. The mobility controller for the mobility sub domain where the station was previously located in most cases has the context information for the station. Using this information at the mobility oracle forwards the Mobile Announce message to the mobility controller for the mobility sub domain which in this example is the mobility sub domain where the station was previously located.

The mobility controller for mobility sub domain upon receiving the Mobile Announce message determines based on its stored information the access switch where the station was previously attached. At the mobility controller in mobility sub domain forwards the Mobile Announce message to the access switch where it determines that the station was previously located in mobility sub domain . This access switch in response to receiving the Mobile Announce message learns that the station has roamed to a particular access switch in mobility sub domain from the content of the Mobile Announce message and in response at sends a Handoff message to the access switch in mobility sub domain where the station is currently attached. The Handoff message contains the context for the station e.g. IP address MAC address etc. and other client policies associated with the station.

At the access switch in mobility sub domain sends a message to other switches in its switch peer group to notify those access switches that the station has left the switch peer group. In other words in response to receiving the Mobile Announce message each access switch is configured to generate and send a message to other access switches in its switch peer group the message indicating that a station that was previously attached to it has roamed outside the switch peer group.

At in response to receiving the Handoff message and after receiving and processing it the access switch in mobility sub domain where the station is currently attached sends a Handoff Complete message to the mobility controller in mobility sub domain . In response to receiving the Handoff Complete message from the access switch where the station is currently attached the mobility controller in mobility sub domain updates its station database accordingly at to reflect the current location of the station based on the Handoff Complete message. Also at the mobility controller in mobility sub domain sends or forwards the Handoff Complete message to the mobility oracle. The mobility oracle updates its database at to indicate the location of the station in mobility sub domain .

At the access switch where the station is currently attached sends a Handoff Notification message to other access switches in its switch peer group in mobility sub domain so that the access switches in this switch peer group know about the location of the station in the switch peer group.

At the mobility controller in mobility sub domain sends a Handoff Complete message to the mobility controller in mobility sub domain . At the mobility controller in mobility sub domain updates its database to reflect the fact that the station is no longer in mobility sub domain .

It is possible for a station to move prior to the Handoff Complete notification being sent to a mobility controller. Individual access switch and network congestion could cause the Handoff Complete messages to be processed in the wrong order which would cause traffic for the station to be delivered to the wrong access switch. A timestamp or sequence number ensures that Handoff and Handoff Complete messages are treated in the proper order. This could be achieved through the use of NTP with each mobility controller serving as the NTP source time synchronization information for all switches within its mobility sub domain. Although ideal it is not necessary for the time on the mobility controller be correct as long as all of the access switches are synchronized. Proper time may be useful for other purposes which includes the synchronization of system log events across multiple network devices.

In sum a system is provided comprising a plurality of access switches configured to serve one or more Internet Protocol IP subnets that comprises a plurality of IP addresses. The plurality of access switches are arranged in switch peer groups such that each access switch within a given switch peer group is configured to store information about other access switches in that switch peer group and about locations of wireless client devices that are associated with any wireless access point on any access switch in the switch peer group. The plurality of access switches are further grouped into a corresponding one of a plurality of mobility sub domains each comprising a plurality of switch peer groups. A plurality of controller devices are provided each configured to control access switches in a corresponding mobility sub domain. Each controller device stores information about the plurality of access switches within its mobility sub domain and about locations of wireless client devices at access switches in its mobility sub domain. A central controller device is provided and configured to communicate with the plurality of controller devices for the respective mobility sub domains. The central controller device is configured to store information about locations of wireless client devices in the mobility sub domains.

Similarly a method is provided comprising for a plurality of access switches each configured to serve one or more Internet Protocol IP subnets that comprises a plurality of IP addresses arranging the plurality of access switches arranged in switch peer groups each access switch within a given switch peer group storing information about other access switches in that switch peer group and about locations of wireless client devices that are associated with any wireless access point on any access switch in the switch peer group grouping the plurality of access switches into a corresponding one of a plurality of mobility sub domains each comprising a plurality of switch peer groups at each access switch storing information about the locations of wireless client devices at access switches within the same switch peer group at a mobility controller dedicated to a respective mobility sub domain storing information about the locations of wireless client devices at access switches within the respective mobility sub domain and at a central controller that communicates with the mobility controllers for all of the mobility sub domains storing information about locations of wireless client devices in the mobility sub domains.

The terms first and second when referring to the mobility sub domains for example are arbitrary and used for purposes of explaining the techniques described herein. The first mobility sub domain may be the sub domain where a particular wireless client device is current located and the second mobility sub domain may be the sub domain where the particular wireless client device was previously located.

The techniques described herein have several advantages. First both wired and wireless clients can be present on the same IP subnet allowing for uniform handling of wired and wireless clients uniform policy application and uniform management of the clients. Second this hierarchical architecture allows the network to scale much better and support more APs and clients compared to current architectures. This is achieved primarily by controlling the cost of handoffs on the control path and by distributing the data path to the access switches. Third by configuring the point of presence for a station to be on access switch that serves the IP subnet for that station the access switch that the station was mostly recently attached to that served its IP subnet a flexible deployment of the MCs MTEs may be made. Customers who have their current WLAN controllers in the core past the first routing boundary can easily migrate to this architecture while existing WLAN controllers can continue to operate in the network as MCs MTEs.

