---

title: Distribution of network communications based on server power consumption
abstract: A network device is described that load-balances network traffic among a set of network servers based on electrical power consumption of the network servers. The network device may measure electrical power consumption in a variety of ways, and may generate and maintain a power consumption profile for each of the network server. The power consumption profile may describe the respective server power consumption in increasing granularity. For instance, each power consumption profile may specify electrical power consumption according to watts consumed by a server per average transaction, watts consumed per transaction for a specific type of software application, watts consumed per transaction for a software application for individual network resources, and so on. Furthermore, the profiles may be maintained for individual servers or aggregated for groups or sequences of servers.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08261116&OS=08261116&RS=08261116
owner: Juniper Networks, Inc.
number: 08261116
owner_city: Sunnnyvale
owner_country: US
publication_date: 20101124
---
This application is a continuation of U.S. patent application Ser. No. 11 625 629 filed Jan. 22 2007 which claims the benefit of U.S. Provisional Application No. 60 868 970 filed Dec. 7 2006 the entire content of each of which are incorporated herein by reference.

A data center is a specialized facility that houses network servers provides data services. In its most simple form a data center may consist of a single facility that hosts all of the infrastructure equipment. A more sophisticated data center can be an organization spread throughout the world with subscriber support equipment located in various physical hosting facilities. Data centers allow enterprises to provide a number of different types of services including e commerce services to customers extranets and secure VPNs to employees and customers firewall protection and Network Address Translation NAT services web caching as well as many others. These services can all be provided at an off site facility in the data center without requiring the enterprise to maintain the facility itself.

Each of the network servers within a data center requires electrical power to operate. Moreover a data center that houses network servers must include a heating ventilating and air conditioning HVAC system to regulate the temperature of the network servers. The HVAC system also requires electrical power to operate. Typically a regional electricity grid supplies this electrical power. However under certain circumstances the data center may be unable to receive sufficient electrical power from this electricity grid. For example the data center s connection to the electricity grid may be severed or brownout conditions may occur. To avoid a shutdown of the data center when the data center is unable to receive sufficient electrical power from the electricity grid the data center may include one or more local electrical generators that supply electrical power to the data center when the data center is unable to receive sufficient electrical power from the electricity grid.

Local electrical generators may be expensive to purchase install and operate. Minimization or optimization of the power consumption of the network servers may reduce the costs associated with the purchase installation and operation such electrical generators. Furthermore minimization or optimization of the power consumption of the network servers may reduce the costs associated with the purchase of electrical power from the electricity grid.

In general the invention is directed to techniques of load balancing network traffic among a set of network servers based on electrical power consumption of the network servers. Example embodiments of the invention may define rates of electrical power consumption in a plurality of ways. For instance the embodiments may define rates of electrical power consumption according to watts consumed by a server per average transaction watts consumed by a server per transaction for a specific type of software application watts consumed by a server per request to a specific network resource e.g. by way of a particular universal resource locator URL and so on. Furthermore embodiments of the invention may define rates of electrical power consumption for groups or sequences of servers.

The techniques make use of one or more intermediate load balancers which are network devices that distribute network traffic among the plurality of network servers. By application of the techniques described herein a system that distributes network traffic among a set of network servers based on rates of electrical power consumption may consumes less overall power as compared to a similar system that distributes network traffic among network servers without regard to electrical power consumption. Because such a system may consume less electrical power overall costs related to the purchase and or generation of electrical power may be reduced. Furthermore the techniques described herein may allow an administrator to more easily anticipate and manage rates of power consumption.

In one embodiment a method comprises receiving with an intermediate network device a network communication from a computer network. The intermediate network device is located between a client device and a plurality of servers. The method also comprises determining a network application associated with the network communication. In addition the method comprises identifying a set of the plurality of servers able to process network communication. In addition the method comprises selecting a server in the set of servers as a function of a power consumption rate for each of the servers wherein the power consumption rate specifies an amount of power consumed by the respective server when processing network communications associated with the network application. Furthermore the method comprises forwarding the network communication to the selected server.

In another embodiment a network device located on a computer network between a client device and a plurality of servers. The network device comprises an interface to receive a network communication from the computer network. The network device also comprises a server selection module to determine a network application associated with the network communication to identify a set of the plurality of servers able to process the network communication and to select a server in the set of servers as a function of a power consumption rate for each of the servers wherein the power consumption rate specifies an amount of power consumed by the respective server when processing network communications associated with the network application and to forward the network communication to the selected server.

In another embodiment a system comprises a client device a plurality of network servers a network load balancing device and a network to facilitate communication between the servers and the network load balancing device. The network device comprises an interface to receive a network communication from the client device. The network device also comprises a server selection module to determine a network application associated with the network communication to identify a set of the plurality of servers able to process the network communication and to select a server in the set of servers as a function of a power consumption rate for each of the servers wherein the power consumption rate specifies an amount of power consumed by the respective server when processing network communications associated with the network application and to forward the network communication to the selected server.

In another embodiment a computer readable medium comprises instructions. The instructions cause a programmable processor to receive with an intermediate network device a network communication from a computer network. The intermediate network device is located between a client device and a plurality of servers. The medium also includes instructions that cause the processor to determine a network application associated with the network communication and to identify a set of the plurality of servers able to process the network communication. In addition the instructions cause the processor to select a server in the set of network servers as a function of a power consumption as a power consumption rate for each of the servers. The power consumption rate specifies an amount of power consumed by the respective server when processing network communications associated with the network application. The instructions also cause the processor to forward the network communication to the selected server.

The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features objects and advantages of the invention will be apparent from the description and drawings and from the claims.

Client devices A through N collectively client devices may be personal computers intermediate network devices network telephones network gaming platforms cellular telephones network televisions television set top boxes and so on. Moreover each of client devices may be a different kind of network device. For instance client device A may be a personal computer while client device B may be an intermediate network device.

Servers A through N collectively servers may be any of several types of server that provide one or more resources or network services. For example servers may be web servers that provide web pages media servers that provide streaming audio and or video content file servers that provide one or more files application servers that provide an application and so on. Furthermore servers may be logically grouped so as to constitute a server farm or group of servers.

To access resources provided by servers client devices may send network communications through a public network to load balancer which typically may be located behind a firewall and within a local network . Public network may be a wide area network such as the Internet. In other exemplary embodiments a private network such as a local area network a wireless network or other type of network may be substituted for public network . Furthermore client devices may send the network communications through a virtual private network over public network to load balancer .

When load balancer receives a communication from one of client devices load balancer forwards the network communication to one of servers via a private network based at least in part on the relative power consumption rates of servers . Local network may be a local area network or otherwise. For example local network may be an Ethernet network that facilitates communication among network devices in a data center.

Alternatively load balancer may receive a Domain Name System DNS request to resolve a domain name of a resource provided by servers . In response to the DNS request load balancer may send a DNS response that lists network addresses of servers sorted in an order based on the relative power consumption rates of servers . While the remainder of this specification describes techniques of forwarding and processing network communications the techniques described herein are generally applicable to this DNS based approach.

Prior to distributing network traffic from client devices among servers load balancer may obtain corresponding power consumption rates for servers or for logical groups of servers. Power consumption rates may be defined and obtained in a variety of ways. Accordingly load balancer may apply different techniques to obtain such power consumption rates for servers .

As one example load balancer may define power consumption rates for servers as the average amounts of power each of the servers consumes over a defined period e.g. per hour when operating normally. In this case load balancer may compute the power consumption rates by first sending requests to servers for listings of hardware components in respective ones of servers . For example these requests may be Simple Network Management Protocol SNMP requests to Management Information Bases MIBs on servers . After receiving a listing of hardware components for one of servers load balancer may automatically access one or more data sources such as vendors web sites or databases to obtain power consumption rates for the listed components. Load balancer may for example accomplish this by way of an automated invocation of an application programming interface API presented by a vendor s data source. Load balancer may then compute an overall power consumption rate for each of the servers by summing the power consumption rates of the constituent components of each of the servers.

In another example power consumption rates for servers may be defined in terms of the power consumed when processing differing types of network communications likely to be received from client devices . That is the power consumption rates may be defined with respect to the different types of communication protocols. For instance servers may provide one or more a web sites e.g. by hosting one or more web servers and optionally application servers and database servers that support the web sites. Accordingly network communications from client devices are likely to include HyperText Transfer Protocol HTTP communications such as HTTP GET requests for web pages provided by servers . In this example load balancer may perform techniques to quantify specific power consumption rates for each of servers when each of servers process particular types of HTTP communications such as HTTP GET requests. To quantify power consumption rates for each of servers with this increased level of granularity load balancer may send probe HTTP GET requests to each of servers and obtain measurements of the rates of power consumption while the servers process the requests. As one example load balancer may obtain measurements of the rates of power consumption by receiving power measurements from electrical sensors on servers and correlating the power measurements with time periods during which the servers were processing the requests.

As another example load balancer may obtain power consumption rates for each of servers with respect to particular individual network resources identified individual resources identified by universal resource locators URL . Similarly load balancer may obtain power consumption rates for each of servers with respect to individual network applications executing on servers . In this way load balancer may store multiple power consumption rates with a variety of granularities for each of servers e.g. server level granularity application level granularity and resource level granularity.

After obtaining power consumption rates for servers load balancer may categorize servers into classes based on the power consumption rates of servers . Each of the classes may be associated with a different rate of power consumption and or a different level of power consumption granularity. In this way load balancer may construct and maintain a power consumption profile for each of servers or group of servers . For example a first class may be associated with a power consumption rate of 40 watts per hour and a second class may be associated with a power consumption of 60 watts per hour. Additional classes may be used to categorize servers based on rates of power consumption when the servers process request for specific types of network application e.g. HTTP FTP NAT DNS encryption decryption etc. . Furthermore classes may be used to categorize servers based on rates of power consumption when servers process requests for specific network resources or services provided by specific types of network applications e.g. HTTP in combination with a particular URL or DNS request for a particular network prefix . Subsequently load balancer may use these classes when distributing network traffic from client devices among servers .

To distribute network traffic from client devices among servers load balancer may first for each network communication identify the type of the network communication received from the client device. Load balancer may then identify and select one of servers based on the power consumption profile of the server. For example when load balancer receives a network communication load balancer may identify a class of servers associated with the lowest rate of power consumption when processing that particular type of network communication. Load balancer may further narrow the selection to a reduced class of servers by identifying individual resources or services being requested.

Load balancer may then forward the network communication to a server in this class of servers unless load balancer determines that a current utilization rate of the server is above a threshold for the class of the server. A utilization rate may for example represent the percentage of resources e.g. processor capacity random access memory usage bandwidth usage etc. currently being utilized by a server. For example when a processor of the server is operating at or above a certain threshold of capacity e.g. 90 load balancer may consider a current utilization rate of the server to be above the utilization threshold set for the class of the server.

When load balancer determines that current utilization rates of servers in this class are above a certain class utilization threshold load balancer may identify a class of servers associated with a rate of power consumption that is higher than that of the previous class of servers but lower than rates of power consumption associated with other classes of servers . If load balancer determines that utilization rates of servers in this class are above a utilization threshold for this class load balancer may identify a class of servers associated with a next lowest rate of power consumption after this class and so on. Eventually load balancer may identify a class of servers whose servers have current utilization rates that are not above a utilization threshold for the class and whose servers consume less electrical power to process network communications of the identified type of the network communication than other ones of the servers whose current utilization rates are not above their utilization thresholds for their respective classes. Load balancer may then select one of the servers in the identified class.

In addition to a power consumption classification load balancer may also use a current performance characteristic of servers as a factor in identifying a class of servers . A performance characteristic is a measure of how quickly an individual server generates a response after receiving a request. For example a performance characteristic may be computed based on response times of the servers e.g. response times to requests dropped packets counts of packets already forwarded to the servers etc. Servers in a class associated with low power consumption rates may respond to requests more slowly than servers in a class associated with higher power consumption rates. To optimize or otherwise improve both power consumption and the performance characteristic load balancer may apply a static or dynamic weighting scheme. As one example in identifying a class of servers load balancer may use a weighting scheme in which responsiveness is always weighted twice as heavily as power consumption. In an alternative example load balancer may use a weighting scheme in which a weight associated with responsiveness is rises or falls when overall power consumption of servers decreases or increases. In this way load balancer may identify a class of servers in which overall power consumption rates may be managed while still utilizing ones of servers that are most responsive.

Load balancer automatically issue communications to instruct servers in particular classes to enter a low power consumption mode i.e. a sleep mode or a hibernation mode . When one of servers is in hibernation mode the server consumes a minimal amount of power. For example if server N is in a class of servers associated with relatively high power consumption rates and the overall number of requests to servers is low servers in classes associated with lower power consumption rates may be able to process all of the requests. In this situation load balancer may instruct server N to enter hibernation mode. Later when the overall number of requests to servers is higher or the utilization of the servers in lower power consumption classes reaches defined thresholds load balancer may automatically instruct server N to exit hibernation mode in order to be ready to process requests.

Each of servers may operate a plurality of virtual machines that provide operating environments for one or more software applications. For example each of servers may operate production test and development virtual machines that provide operating environments for production test and development applications. Load balancer may distribute requests among the virtual machines as though the virtual machines were separate sets of physical machines according to the techniques described herein.

Furthermore load balancer may redistribute the virtual machines among servers to reduce overall power consumption rate of the servers. For example load balancer may track the utilization rates and power consumption rates of each of servers . Each of the virtual machines may be associated with a priority. For example the production virtual machine may have a higher priority than the development virtual machine. Lower priority virtual machines may be virtual machines that handle fewer requests than higher priority virtual machines. When a utilization rate of one of servers approaches a given threshold load balancer may send instructions to the server to terminate a lower priority virtual machine or otherwise limit the resources available to the lower priority virtual machine. This may make more resources available to the higher priority virtual machine. In addition load balancer may send instructions to a second one of servers associated with a higher power consumption rate to increase the resources available to a virtual machine that is equivalent to the lower priority virtual machine on the second server. In this way load balancer may reduce the overall power consumption of servers .

Load balancer includes a server power estimation module SPEM to estimate power consumption rates of servers based on power consumption rates of hardware components included in servers . To estimate how much power each of servers consume SPEM may initially send an SNMP request to each of servers for catalogs of hardware components associated with respective ones of servers . In response to such an SNMP request one of servers may send an SNMP response to SPEM to provide a listing of the hardware components of the server. For example server A may send a response that provides a listing that specifies that server A includes an Intel Pentium processor a hard disk drive from manufacturer X and a hard disk drive from manufacturer Y. Continuing this example server N may send a response that provides a listing that specifies that server B includes an Advanced Micro Devices Athlon processor and a hard disk drive from Seagate. Records of hardware components of the server may be stored in a Management Information Base in the server a configuration management database or a central asset tracking system.

After receiving the listings of hardware components associated with servers SPEM may determine a power consumption rate associated with each of the listed hardware components. To determine a power consumption rate for a hardware component SPEM may access one or more data sources that store a power consumption rate for the hardware component. Such data sources may be available from the vendor e.g. the manufacturer retailer etc. of the hardware component. For example a power consumption rate may be posted on a manufacturer s web site. Alternatively load balancer may include such databases. After determining a power consumption rate associated with each of the hardware components in the listing for one of servers SPEM may sum the power consumption rates associated with the listed hardware components to derive an overall power consumption rate for the server. Once SPEM derives an overall power consumption rate for the server SPEM may store the overall power consumption rate for the server in server power database .

In an alternative example SPEM invokes scripts on servers to determine the power consumption rates associated with each of servers . For example SPEM may use a technique such as ActiveX or Java to invoke scripts or other programs that execute locally on servers . A script executing on one of servers may generate a listing of hardware components of the server and send this listing to SPEM . SPEM may then use a data source to determine a power consumption rate associated with each of the listed components. Alternatively the script may access the data source directly and send to SPEM an overall power consumption rate associated with the server.

SPEM may also determine an aggregate power consumption rate associated with groups of servers . For example servers A and B may collaborate to provide a resource. In this case SPEM may receive listings of hardware components from servers A and B and obtain power consumption rates associated with the components of servers A and B. SPEM may then add together all of the power consumption rates of components of servers A and B to obtain an overall power consumption rate for the combination of servers A and B. In this way SPEM may obtain power consumption rate at varying degrees of granularity. Administrator may define which ones of servers SPEM regards as groups.

Furthermore SPEM may identify classes of servers based on power consumption rates of servers . For example SPEM may categorize all servers having power consumption rates below 50 watts in a first class and all server having power consumption rates of 50 watts or higher in a second class. SPEM may record these classes in server power database .

Load balancer may also include a request power estimation module RPEM to estimate power consumption rates of servers when processing one or more types of network communications referred to generally as requests . In order to estimate power consumption rates of servers when processing a particular type of request RPEM may first access a request power database . Request power database contains records each of which associate a type of request with one of servers and a power consumption rate. For example request power database may contain a record that indicates that server A consumes 50 watts to process a request for streaming media.

If RPEM determines that request power database does not contain a record that associates the type of request with one of servers RPEM may generate a probe communication that includes a request of this type. RPEM may then forward this communication to the server. At the same time RPEM may monitor the average power consumption of the server while the server is processing the communication. RPEM may use one or more SNMP requests to the server to monitor the average power consumption of the server while the server is processing the communication. Alternatively RPEM may receive power consumption information from a baseboard management controller BMC that monitors sensors in server. The sensors may include temperature sensors analog to digital converters to measure current and voltage on various power supplies in the server and so on. In either case RPEM may determine a power consumption rate by correlating the received power consumption information with the specific period starting after the probe communication was sent and a response was received. After determining a power consumption rate for the server for the type of request RPEM may update request power database to include a record that associates the request type server and measured power consumption rate. RPEM may repeat this process until request power database includes a record for each server for each request type.

Furthermore RPEM may identify classes of servers for various types of requests. For example RPEM may identify records in request power database having a common request type. RPEM may then identify classes of servers by determining which of the records having approximately equivalent power consumption rates. For example RPEM may order all of the identified records by power consumption rating. RPEM may then identify the first third of the servers specified by the ordered identified records as being in a first class the second third of servers specified by the ordered identified records as being in a second class and so on. RPEM may repeat this process for each type of request specified in the records of request power database . In this way RPEM may identify classes of servers for each request type.

When interface receives a network communication from public network interface forwards the communication to a server selection module SSM . Upon receiving the network communication from interface SSM may access power consumption profiles for servers and determine a rate of electrical power consumption for the servers using the power consumption profiles of the servers. SSM may then identify one of servers based at least in part on power consumption rates of servers . After identifying one of servers SSM provides the network communication to interface . Interface may then forward the communication to the one of servers identified by SSM .

As illustrated in the example of SSM includes a server classification module . Server classification module uses estimates of power consumption rates of servers based on power consumption rates of hardware components included in servers to identify one of servers that would consume the least power to process the communication given the utilization of server . To identify one of servers that would most efficiently process the communication server classification module may access server power database to obtain classifications of servers . Server classification module may then access a server utilization module . Server utilization module provides current utilization rates of servers . Based on the records from server power database and the current utilization rates from server utilization module server classification module may identify a class of servers that is not over utilized and that consumes the least power. Server classification module may determine a class of servers is over utilized when the average utilization rate of the servers in the class exceeds a given utilization threshold. For example a class of servers may be over utilized when the average server in the class is operating at 85 of capacity.

Server classification module identify one of servers that is not over utilized that is capable of processing the communication with a combined level of power consumption and response time to the network communication that is less than combined levels of power consumption to process the communication and response time to the network communication of other ones of the servers that are not over utilized. For example server classification module may calculate a combined level of power consumption and response time for a server by multiplying a first weight by a performance characteristic for the server plus a second weight multiplied by a power consumption rate for the server. Server classification module may then compare combined levels of power consumption and response time for each of the servers that is not over utilized to identify one of servers that has the lowest overall combined level of power consumption and response time.

SSM also includes a request classification module . Request classification module identifies a type of request associated with a received communication and identifies one of servers that would most efficiently process a member of the identified type of request given current utilization rates of servers . After request classification module has identified a type of request for the network communication request classification module may obtain records from request power database for the identified type of request. Request classification module may then access server utilization module to obtain current server utilization data. Then using the current server utilization data request classification module may identify a class of servers that are not over utilized and that are associated with the lowest power consumption ratings to process requests in the identified type of request. Request classification module may then forward the communication to one of servers in the identified class of servers.

Load balancer also includes a hibernation module . Hibernation module sends instructions to one of servers to enter a low power consumption mode e.g. a hibernation mode or a standby mode when the server consumes more power than other ones of servers and when the server is unlikely to be utilized for a given period of time. For example server N may be in a class of servers that is associated with high power consumption rates. During times when utilization of servers is relatively low e.g. on nights or weekends and ones of servers in classes associated with lower power consumption rates are sufficient to process all requests to servers hibernation module may send instructions to server N to enter a hibernation mode. To determine which ones of servers are in which classes and to determine the utilization of servers hibernation module may access server power database and server utilization module . When server N receives the instructions to enter a hibernation mode server N may store the content of its volatile memory e.g. Random Access Memory to a persistent storage medium shut down disk drives cooling systems and other systems of server N that consume power. However server N may continue to operate a process that waits for instructions to reenter a normal power consumption mode.

Subsequently when utilization of servers is higher and ones of servers in classes associated with lower power consumption are not sufficient to process all requests to servers hibernation module may send instructions to server N to reenter a normal power consumption mode. For example hibernation module may send instructions to server N to reenter a normal power consumption mode when ones of servers in a class associated with lower power consumption ratings are operating at 75 of capacity. In another example hibernation module may send instructions to server N to reenter a normal power consumption mode when hibernation module determines that it is time of day associated with high utilization. Upon receiving the instructions to reenter a normal power consumption mode server N may restore its volatile memory from the persistent storage medium power up disk drives and cooling systems and so on. When server N reenters the normal power consumption mode server N may begin processing requests.

Load balancer may also include a virtual machine configuration module VMCM to redistribute the virtual machines among servers to reduce overall power consumption of servers . For example VMCM may maintain records of which virtual machines are operating on which ones of servers . For instance VMCM may maintain records indicating that server A is operating a development virtual machine and a production virtual machine. The development virtual machine may provide an operating environment for applications that are currently under development within an enterprise. The production virtual machine may provide an operating environment for applications that are currently used by clients of the enterprise. For example the production virtual machine may provide an operating environment for a web server that provides an e commerce web page to clients. Because it may be more important to provide clients with a minimum response time than to provide developers with access to development applications the production virtual machine may have higher priority than the development virtual machine.

VMCM may access server utilization module to obtain utilization rates for each of servers and access server power database to obtain power consumption rates for each of servers . VMCM may then use the utilization rates and power consumption rates to determine whether to redistribute virtual machines on servers among servers such that response times to the clients are the shortest and the overall power consumption of servers is the lowest. For example administrator may define thresholds for network traffic server load and server response times. If any of these thresholds are surpassed on one of servers VMCM may instruct a lower priority virtual machine operating on the server to cease operating or to transfer operations to another one of servers . For example VMCM may send a request to a virtual server management platform such as IBM WebSphere to terminate the lower priority virtual machine. In another example VMCM may send the request directly to a virtualization software layer executing on the server. By terminating the lower priority virtual machine on the server the server may have more resources to devote to requests for the higher priority virtual machine. This may result in a decrease in overall power consumption because servers associated with higher power consumption ratings are less likely to process requests associated with the higher priority virtual machine.

If server classification module determines that the utilization rate of the servers in the current class does not exceed the threshold NO of server classification module forwards the network communication to one of the servers in the current class of servers . On the other hand if server classification module determines that the utilization rate of the servers in the current class exceeds the utilization threshold YES of server classification module determines whether there are any remaining classes of servers associated with power consumption rates immediately higher than the power consumption rates associated with servers in the current class and capable of servicing the received request . If server classification module determines that there is not a remaining class of servers associated with next higher power consumption rates that are capable of servicing the received request NO of server classification module may forward the network communication to one of the servers in the current class of servers . However if server classification module determines that there is a remaining class of servers associated with a next higher rate of power consumption YES of server classification module may set the label current class to indicate this class of servers . Server classification module may then determine whether the usage of the servers in the new current class exceeds a utilization threshold and so on.

Request classification module may perform a similar operation as that described in the example of . However request classification may first identify a type of request included in the network communication and then access request power database to retrieve classes of servers for the identified type of request.

Each entry in a second column of table represents a general rate of power consumption for a server. For instance a server in table with server ID 1 has a general rate of power consumption of 0.1 watts per time period. Entries in the second column of table may represent a first level of granularity that specifies an average power consumption rate for a server.

Each entry in a third fourth and fifth column of table represents a rate of power consumption of a server when the server processes for a network communication associated with a particular network application. For instance each entry in the third column represents a rate of power consumption for a server when the server processes a network communication associated with an HTTP application. Similarly each entry in the fourth and fifth columns represent rates of power consumption of a server when the server processes network communications associated with the FTP and DNS applications respectively. For example a server in table with server ID 1 has a rate of power consumption of 0.11 watts per time period when processing network communications associated with the HTTP application. Because entries in the third fourth and fifth columns of table represent rates of power consumption for a server when the server is processing a network communication associated with a network application entries in these columns describe rates of power consumption at a lower level of granularity than entries in the second column of table . Thus the third fourth and fifth columns may represent a second level of granularity that specifies power consumption rates for the server with respect to a plurality of different types of network applications.

Each entry in a sixth seventh and eighth column of table represents a rate of power consumption of a server when the server is processing a network communication for request for a resource associated with a particular network application. For instance each entry in the sixth column represents a rate of power consumption of a server when the server processes a network communication for a resource named File 1 which is associated with the HTTP service. As illustrated in the example of the server having server ID 1 has a rate of power consumption of 0.13 when the server is processing a network communication for the resource File 1 which is associated with the HTTP network application. Although not shown in table may include columns for resources that include pre generated files dynamically generated files streaming media responses to network protocol requests e.g. a DNS response and so on. Because entries in the sixth seventh and eighth columns of table represents rates of power consumption for a server when the server is processing a network communication for a specific resource with a particular network application entries in these columns describe rates at a lower level of granularity than entries in the third fourth and fifth columns. Thus the sixth seventh and eighth columns may represent a third level of granularity that specifies power consumption rates for a server with respect to a plurality of individual network resources for different types of network applications.

In system client devices A through N collectively client devices send requests to load balancer . Load balancer distributes the requests among servers A through N collectively servers . To process the requests servers may send requests to access a resource provided by a set of servers A through N collectively servers . A second level load balancer distributes the requests from servers among servers . Furthermore to process the requests from servers servers may send requests to access a resource provided by a set of servers A through N collectively servers . A third level load balancer distributes the requests from servers among servers .

Because one of servers one of servers and one of servers may process a request the power consumed to process the request may be the sum of the power consumed to process the request by the one of servers the one of servers and the one of servers . However because second level load balancer distributes requests among servers load balancer may not be able to accurately predict which one of servers processes a request. Similarly because third level load balancer distributes requests among servers load balancer may not be able to accurately predict which one of servers processes the request. Consequently load balancer may not be able to determine in the manner described above how much power is consumed to process a request.

To estimate an amount of power consumed to process a request a heuristic analysis module in load balancer may generate a probe communication that includes the request. Heuristic analysis module determines whether a sufficient number of communications of the request type have been sent to each of servers to determine how much power servers servers and servers likely consume to process the request. If heuristic analysis module determines that a sufficient number of communications of the request type have been sent to each of servers to determine how much power the servers are likely to consume to process the request heuristic analysis module may have completed an estimation of the amount of power system is likely to consume when load balancer forward network communications containing a request type to each of servers . Subsequently load balancer may use these estimates to distribute network traffic among servers .

On the other hand if heuristic analysis module determines that an insufficient number of communications of the request type have been sent to one of servers to determine how much power the servers are likely to consume to process the request if the request was sent to the one of servers heuristic analysis module forwards the request to the one of servers . Heuristic analysis module then monitors the power consumption of the one of servers each of servers and each of servers . Heuristic analysis module may then calculate an overall power consumption rate for the request by adding the power consumption for the one of servers the one of servers that processed the request and the one of servers that processed the request. Heuristic analysis module may then average this overall power consumption rate with other overall power rates obtained when heuristic analysis module forwarded the request to the one of servers . By repeating this process a sufficient number of times heuristic analysis module may obtain a relatively accurate overall power consumption rate of system when a request of the request type is forwarded to the one of servers . Furthermore by repeating this process a sufficient number of times on each of servers heuristic analysis module may obtain relatively accurate overall power consumption rates of system when requests of the request type are forwarded to each of servers .

Alternatively heuristic analysis module may use a Bayesian algorithm to determine overall power consumption ratings of system when requests are forwarded to each of servers . For example heuristic analysis module may include an internal model in which each of servers and are nodes in a Bayesian network. In this model servers are the parent nodes of servers and servers are the parent nodes of servers . Heuristic analysis module may then send a probe communication to one of servers in order to discover the probability of one of servers processing a request associated with the probe communication. Furthermore heuristic analysis module may forward communications one of servers in order to discover the probability of one of servers processing a request associated with the request. By discovering such probabilities for each of servers heuristic analysis module may estimate which ones of servers and are likely be active in responding to the request. Then by discovering average rates of power consumption of each of servers and heuristic analysis module may determine how much power is likely to be consumed by servers of system when heuristic analysis module forwards a network communication of a certain request type to each of servers . Load balancer may then use this information to forward network communications.

If heuristic analysis module does not have sufficient confidence in one of the power consumption estimates of system when a network communication of the identified request type is forwarded to one of servers NO of heuristic analysis module selects the server . Heuristic analysis module may then generate a probe communication that includes a request of the request type and forwards the probe communication to the selected server . After forwarding the probe communication to the selected server heuristic analysis module monitors the power consumption of the selected server and each of servers and . Heuristic analysis module then sums the observed power consumption of the selected servers together with the observed power consumption of servers and to when processing the probe communication . Next heuristic analysis module may average this sum with an existing estimate of the power consumption of system when a network communication of the identified request type is forwarded to the selected server . This average is now the new estimate of the power consumption of system when a network communication of the identified request type is forwarded to the selected server. After averaging this sum with an existing estimate of the power consumption heuristic analysis module may increment a confidence indicator of the power consumption estimate . Next heuristic analysis module may again determine whether heuristic analysis module has sufficient confidence in power consumption estimates of system when heuristic analysis module sends probe communications of the identified request type to each of servers . If heuristic analysis module has sufficient confidence YES of testing may be complete .

Various embodiments of the invention have been described. These and other embodiments are within the scope of the following claims.

