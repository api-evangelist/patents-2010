---

title: Techniques for density mapping
abstract: Techniques in a data processor for drawing a density surface on a map in a manner that more accurately accounts for projection distortion in the map. According to one embodiment, data is maintained that represents a geotagged event. A map plane is divided into a plurality of cells and an origin cell corresponding to the geotagged event is identified. Density values are allocated to cells surrounding the origin cell based on geodetic distances between geographic coordinates corresponding to surrounding cells and the geographic coordinate of the geotagged event. A density surface based on the cell allocations is then displayed on a map. By allocating density values to cells based on geodetic distances, the resulting density surface displayed on the map more accurately accounts for projection distortions in the area of the map on which density surface is displayed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08564596&OS=08564596&RS=08564596
owner: Palantir Technologies, Inc.
number: 08564596
owner_city: Palo Alto
owner_country: US
publication_date: 20100112
---
The invention is related to computer based mapping and more particularly to techniques in a data processor for density mapping.

A portion of the disclosure of this patent document contains material which is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure as it appears in the Patent and Trademark Office patent file or records but otherwise reserves all copyright rights whatsoever. Copyright 2009 Palantir Technologies Inc.

Computer based geospatial applications typically allow a user to associate an event with a discrete geographic location on the surface of a planetary body such as the Earth. This process of associating events with geographic locations is commonly referred to as geotagging . For example a series of crime incidents may be each be associated with a geographic coordinate to indicate where the crime incidents occurred. As another example the population count of a town may be associated with a geographic coordinate to indicate the population at a particular geographic location.

In addition to functionality for geotagging geospatial applications may also include functionality for density mapping. Very generally density mapping includes distributing a geotagged event over a geographic area and displaying a surface density surface on a two dimensional planar map to give a visual indication of the density of the geotagged event as distributed over the geographic area. For example a geospatial application may generate a heat map to indicate a density of crime incidents in a city. The areas of conceptually hotter colors on the heat map represent areas of high event density e.g. areas of higher incidences of criminal activity while areas of conceptually cooler colors represent areas of lower event density e.g. areas of lower incidences of criminal activity .

Various approaches may be used to display a density surface on a planar map. For example according to a planar distance based approach distances in a two dimensional planar coordinate system are used to determine how density is distributed over a geographic area displayed on the map. One problem with the planar distance based approach is that it does not account for projection distortions in the map on which the density surface is displayed. Projection distortions result from flattening the curved surface of a planetary body into a plane to be displayed as a map. Projection distortions include distortions of one or more of shape area distance and direction. Projection distortions are generally more pronounced over large geographic areas such as for example in maps of the whole Earth.

As an example of distortions caused by flattening a curved surface into a plane a Mercator map projection which is commonly used to create a map of the surface of the Earth produces a map in which both area and distance are distorted with the greatest distortions near the North and South Poles. For example in a Mercator map of the whole Earth Greenland is presented as having roughly the same geographic surface area as the continent of Africa. However in actuality Africa s surface area is many times the size of Greenland s surface area.

With the planar distance based approach density surfaces are generated irrespective of the projection distortions of the map on which the density surfaces are displayed. For example if there are two density surfaces one near the North Pole and the other near the Equator using the planar distance based approach on a Mercator projected map would result in two identical appearing density surfaces i.e. same area shape size and falloff being displayed on the map even though geographic areas near the North Pole would have greater projection distortions than the area near the Equator. Thus the planar distance based approach may produce a density surface with a significantly inaccurate representation of the geographic area covered by the density surface and a significantly inaccurate representation of density falloff over the covered geographic area.

As users of geospatial applications become more sophisticated the need for greater accuracy in density mapping has increased. Consequently there is a need to be able to more accurately present the geographic area covered by a density surface when the density surface is displayed on a map especially when the density surface is displayed on a map that represents a large geographic area such as a map of the whole Earth. Similarly there is a need to be able to more accurately represent density falloff over the covered geographic area.

The approaches described in this section are approaches that could be pursued but not necessarily approaches that have been previously conceived or pursued. Therefore unless otherwise indicated it should not be assumed that any of the approaches described in this section qualify as prior art merely by virtue of their inclusion in this section.

In the following description for the purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be apparent however that the invention may be practiced without these specific details. In other instances well known structures and devices are shown in block diagram form in order to avoid unnecessarily obscuring the invention.

Embodiments include a computer or system providing or implementing methods for displaying a density surface on a planar map on a computer data display device to give a visual indication of density of a geotagged event distributed over a geographic area. In particular the techniques described herein allow a geospatial application to draw a density surface on a map on a computer display device in a manner that more accurately accounts for projection distortions in the map. With the techniques described herein a geospatial application can draw a density surface that more accurately portrays the geographic area covered by the density surface and more accurately portrays density falloff over the covered geographic area. A specific example of a computer or system capable of implementing the techniques described herein is illustrated in .

Referring to it illustrates a density mapping system DMS coupled to display device and data storage . DMS comprises one or more processors memory density surface generation logic and density surface display driving logic . For the purpose of illustration it shall be assumed that DMS is a computer such as the computer system of . Thus density surface generation logic and density surface display driving logic may be implemented in a special purpose computer or in other hardware or software or some combination thereof. When the term system is used in this disclosure the term includes a special purpose computer or a general purpose computer loaded with hosting or executing one or more computer programs which when executed implement the techniques herein.

A density mapping request to DMS may indicate a geotagged event for which a density surface is to be generated and displayed. As used herein the term geotagged event broadly refers to an association between an event value and a geographic coordinate. The event value may be any numeric value associated with a discrete geographic location identified by a geographic coordinate. The meaning of an event value may vary depending on what the event value represents. For example an event value may represent a number of persons residing in a town a number of traffic accidents at an intersection a number of crime incidents in a city etc. In certain embodiments an event value is treated as a numeric value associated with a particular geographic location through a geographic coordinate. Thus embodiments are not limited to any particular type of event value and not limited by what event values represent.

The geographic coordinate of a geotagged event may be specified using virtually any geographic coordinate system suitable for identifying a discrete location on the surface of a planetary body. For example a location on the surface of the Earth may be identified by a latitude and longitude pair according to a reference datum such as for example the World Geodetic System 1984 WGS84 reference datum. As another example a location on the surface of the Earth may be identified according to other geographic coordinate systems such as the Universal Transversal Mercator UTM coordinate system or the Military Grid Reference System MGRS coordinate system. Thus specification of geographic coordinates is not limited to latitude and longitude pairs or any particular geographic coordinate system.

DMS may maintain geotagged event data that represents event values geographic coordinates and their associations in a computer readable storage medium such as memory or data storage . Geotagged event data may be provided to DMS in virtually any manner suitable for providing data to a computer system such as by a user through a user interface such as for example a command line interface or a graphical user interface or by a computing process through a configuration file a middleware messaging layer a programmatic interface such as an Application Programming Interface API a remote procedure call and the like.

Memory is configured to store geotagged event data representing one or more associations between one or more event values and one or more geographic coordinates. For example DMS may read geotagged event data from data storage and store geotagged event data in memory in response to a request to draw one or more density surfaces on a map. Data for displaying a map may also be stored in memory as well as data storage . Such data may include aerial photographic imagery satellite imagery computer graphics or other data suitable for creating a visual representation of the map on a computer display unit with the aid of display driving logic of DMS .

Density surface generation logic is coupled to memory and configured to transform a state of memory by generating one or more density surfaces for one or more geotagged events to be displayed on a map. Techniques for generating a density surface are described in greater detail elsewhere in this document.

Density surface display driving logic is coupled to memory and configured to cause display on a display device such as display device a density surface generated by density surface generation logic . Techniques for causing display of a density surface on a display device are described in greater detail elsewhere in this document.

Computer display unit may be virtually any computer monitor or display such as for example a Liquid Crystal Display LCD or Cathode Ray Tube CRT . Display unit may be a component of DMS . Alternatively display unit may be a component of a separate computer system not shown coupled to DMS through a communication mechanism such as a data network. For example display device may be a component of a desktop computer system or a mobile computing device such as a cell phone a personal data assistant PDA or a Global Positioning Satellite GPS receiver communicatively coupled to DMS through a data network such as the Internet a wireless network a Local Area Network LAN a Wide Area Network WAN and the like.

A density surface is a surface displayed on a map that represents density of an event value over a geographic area including fall off of density over the area. According to one embodiment the density surface is a heat map surface. A heat map surface represents density is a screen shot from a computer display device illustrating a heat map containing two example heat map surfaces generated and displayed according to an embodiment.

Referring to a map includes two example heat map surfaces and . For the purpose of explanation it shall be assumed that heat map surfaces and are based on identical event values distributed identically over the same amount of geographic area. Map is a Mercator map of a large portion of the surface of the Earth and having no projection distortions along the Equator and increasing projection distortions moving away from the Equator toward the Poles.

As shown in each heat map surface and has a series of colored bands. The varying colors of the bands in a heat map surface represent a fall off of density of the corresponding event value over the geographic area covered by the heat map surface. The fall off of density over a geographic area may be calculated using a kernel density function as described in greater detail elsewhere in this document.

As shown in heat map surface has a different shape size and density fall off than heat map surface despite the two surfaces representing identical event values distributed identically over the same amount of geographic area. In particular the overall shape of heat map surface is bounded by complex curves that make it roughly oval shaped while the overall shape of heat map surface is more circular. Similarly each colored band representing fall off of density in heat map surface is a roughly oval shaped complex curve while each colored band of heat map surface is closer to a circular ring. Thus heat map surface as generated and displayed according to an embodiment of the invention accounts for the relatively severe projection distortions that occur in a Mercator map of a large portion of the surface of the Earth near the Poles such as in map of .

Heat map surface more accurately represents the geographic area over which the corresponding event value is distributed and more accurately represents the fall off of density over the covered geographic area when compared to heat map surfaces generated using conventional density mapping approaches. For example a conventional approach might generate and display a heat map surface that appears like heat map surface in terms of size shape and density fall off but at the position of heat map surface . Thus such conventional approaches generate heat map surfaces that are not as visually accurate as the heat map surfaces generated according to embodiments.

Conceptually a map plane is a two dimensional plane into which some of or the entire curved surface of a planetary body is projected as a two dimensional map. The portion of the curved surface of the planetary body that is projected as a map is referred to herein as the mapped geographic surface area .

The boundaries of the map plane and a coordinate system for referencing points in the map plane are defined according to a map projection used to project the mapped geographic surface area as a map. Generally a map projection is any mathematical formula for representing a mapped geographic surface area as a planar map. For example the Mercator map projection function may be used to create map of .

A map projection typically includes a mathematical formula for transforming a geographic coordinate that identifies a point on the surface of the mapped geographic surface area into a corresponding planar coordinate in the map plane. The planar coordinate identifies a point on the map that corresponds to the point on the surface of the mapped geographic surface area. This type of mathematical formula for transforming a geographic coordinate into a planar coordinate is referred to herein as a forward map projection function .

A map projection also typically includes a mathematical formula for performing the reverse operation of transforming a planar coordinate in the map plane into the corresponding geographic coordinate. This type of mathematical formula for transforming a planar coordinate into a corresponding geographic coordinate is referred to herein as an inverse map projection function .

While map projection examples described herein involve a Mercator map projection which is one type of map projection in the class of cylindrical map projections embodiments are not limited to any particular map projection or class of map projections.

A kernel density function is a distribution of density of a geotagged event as a function of distance from an origin point. For example to reflect an uncertainty in the precise geographic location of a geotagged event a kernel density function may be used to model a probability that the event occurred at locations surrounding an identified geographic location. According to one embodiment a kernel density function is used that approximates a Gaussian distribution of density as a function of distance from the origin point. The kernel density function accepts as input a specified distance from the origin point and a fall off distance from the origin point at which density is zero. Given these inputs the kernel density function outputs a density factor corresponding to the specified distance from the origin point. The specified distance and the fall off distance may be specified according to any unit for measuring distance such as miles meters feet yards etc.

According to one embodiment the following kernel density function is used to calculate a density factor for a specified distance from an origin point d and a specified fall off distance R 

While embodiments may use the above example kernel density function embodiments are not limited to any particular kernel density function and any function that models a distribution of density as a function of distance may be used in alternative embodiments.

At step data is maintained that represents a geotagged event. The data may include an event value and an associated geographic coordinate. The geographic coordinate associated with the event value as part of the geotagged event is referred to herein as the origin geographic coordinate . In an embodiment step involves storing geotagged events in data storage coupled to a computer system.

At step a map plane is divided into a plurality of cells. In one embodiment each cell is uniformly sized. Generally the greater number of cells the map plane is divided into increases the representational accuracy of a density surface generated based on the cells at the expense of computational efficiency in generating the density surface. Conversely the fewer number of cells the map plane is divided into decreases the representational accuracy of a density surface generated based on the cells but the density surface can be generated more efficiently in terms of number of computations required to generate the density surface. In an embodiment step involves performing computer operations on data stored in memory and representing the map plane and the cells. For example data representing the map plane and the cells may be marked tagged or associated with other data values to result in the dividing.

According to one embodiment the size or number of cells may be tied to a user configurable parameter. For example in a request to generate and display a density surface the request may specify a cell size or some other parameter that is used to calculate cell size.

At step one of the cells is identified based on the geotagged coordinate. This identified cell is referred to herein as the origin cell . In one embodiment the origin cell is identified by transforming the origin geographic coordinate into a planar coordinate in the map plane using a forward map projection function and then determining which cell that planar coordinate is contained within. Identifying in step may involve the density surface generation logic reading memory and performing comparison operations and transformation operations.

Once the origin cell is identified density values are allocated to the origin cell and cells surrounding the origin cell at step . According to one embodiment cells surrounding the origin cell are visited according to a spiral out pattern and density values are allocated to each visited cell based on providing a geodetic distance between each visited cell and the origin cell to a kernel density function. The geodetic distance between a visited cell and the origin cell is measured along the surface of a reference ellipsoid used to model the curved surface of a planetary body. In one embodiment the reference ellipsoid is a sphere and the geodetic distance between a visited cell and the origin cell is measured along an arc of a great circle connecting two points on the surface of the reference sphere identified by geographic coordinates. In an embodiment density surface generation logic performs the allocation by reading memory and performing reading comparison decision and writing operations.

By allocating density values to cells surrounding the origin cell based on geodetic distances instead of planar distances a density surface can be generated based on the cell allocations that more accurately accounts for projection distortions in the area of the map on which the density surface will be displayed. In contrast an approach that allocates density values to cells based on planar distances may not accurately reflect the true geodetic distance between cells.

According to one embodiment the density value allocated to a target cell is calculated by multiplying the event value for which a density surface is being generated by a density factor for the target cell. As mentioned above the density factor for a target cell is obtained by providing a geodetic distance between a geographic coordinate that corresponds to the target cell and a geographic coordinate that corresponds to the origin cell to the kernel density function.

In one embodiment the geographic coordinate that corresponds to the target cell is identified by determining the planar coordinate in the map plane that corresponds to the center of the target cell. This planar coordinate is then transformed into a geographic coordinate using an inverse map projection function.

In one embodiment the geographic coordinate that corresponds to the origin cell is the origin geographic coordinate. In another embodiment the geographic coordinate that corresponds to the origin cell is identified by determining the planar coordinate in the map plane that corresponds to the center of the origin cell. This planar coordinate is then transformed into a geographic coordinate using an inverse map projection function.

Once a geographic coordinate corresponding to the target cell and a geographic coordinate corresponding to the origin cell have been identified a geodetic distance between the two geographic coordinates is calculated. As mentioned above according to one embodiment a geodetic distance between the two geographic coordinates is calculated as the shortest distance along the curved surface of a reference ellipsoid used to model a planetary body. For example if the two geographic coordinates identify locations on the surface of the Earth a geodetic distance between the two geographic coordinates may be calculated as the shortest great circle distance between the two geographic coordinates along the surface of a reference sphere that models the surface of the Earth.

Once a geodetic distance between a geographic coordinate corresponding to the target cell and a geographic coordinate corresponding to the origin cell has been calculated the geodetic distance is provided as input to a kernel density function. The kernel density function provides as output a density factor as a function of the inputted geodetic distance. The event value of the geotagged event for which a density surface is being generated is then multiplied by the outputted density factor and the result is allocated to the target cell.

This process of allocating density values to target cells based on geodetic distances is performed for the origin cell and cells surrounding the origin cell. According to one embodiment cells surrounding the origin cell are visited in spiral out pattern until threshold criteria is met. illustrates cells of a map plane.

In an origin cell has been identified for example according to the process of step described above. The origin cell is set as the target cell and a density value is allocated to the target cell. In the case where the origin cell is the target cell the geodetic distance provided as input to the kernel density function may be zero.

According to one embodiment cells surrounding the origin cell are visited in a spiral out pattern and density values are allocated to each visited cell. For example cells include numbered cells surrounding the origin cell. The number in each cell indicates the order of visitation of the numbered cells according to an embodiment. In the embodiment depicted in the spiral out pattern proceeds clockwise around the origin cell. However in another embodiment the spiral out pattern proceeds counterclockwise. Further the order of visitation of cells surrounding the origin cell is not limited to a spiral out pattern and other visitation patterns may be used. Thus the spiral out visitation patterns described herein are but some of the many possible visitation patterns that may be used.

As mentioned above as cells surrounding the origin cell are visited according to a visitation pattern a density value is allocated to each visited cell. Density values are allocated to surrounding cells according to the visitation pattern until a threshold criterion is met. In one embodiment the threshold criterion is met when the density value to be allocated to a visited cell is zero or falls below a specified threshold value. In another embodiment the threshold criterion is met when the density values allocated to a threshold number of consecutively visited cells are each zero or each fall below a specified threshold value.

At step once density values have been allocated to the origin cell and cells surrounding the origin cell a density surface is caused to be displayed on a display device based on the density value allocations. For example a heat map surface can be displayed in which ranges of density values allocated to cells are assigned to different colors.

Each cell corresponds to a certain number of pixels of the display device. For example each cell may correspond to an area of 16 square pixels of the display device. The number of pixels that correspond to a cell may vary depending on variety of factors including the number of cells into which the map plane was divided into at step . Each group of pixels corresponding to a cell is then colored according to the range into which the density value allocated to the cell falls into.

As described previously with respect to a density surface generated according to the approaches described herein may be displayed on a map that accounts for the projections distortions in the area of the map on which the density surface is displayed. Displaying may involve density surface display driving logic reading values from memory rendering a display using display memory and rendering logic or hardware and driving display device with pixel values or other data sufficient to cause the display device to display a heat map as described.

In some cases the origin geographic coordinates and fall off distances of two or more density surfaces may be such that the surfaces overlap. In such a case multiple density values may be allocated to the same cell one density value for each of the density surfaces that overlap the cell. According to one embodiment the density value allocated to a cell that multiple density surfaces overlap is a mathematical combination of the individual density values allocated to the cell. For example the density value allocated to a cell may be the sum of the individual density values allocated to the cell.

According to one embodiment the techniques described herein are implemented by one or more special purpose computing devices. The special purpose computing devices may be hard wired to perform the techniques or may include digital electronic devices such as one or more application specific integrated circuits ASICs or field programmable gate arrays FPGAs that are persistently programmed to perform the techniques or may include one or more general purpose hardware processors programmed to perform the techniques pursuant to program instructions in firmware memory other storage or a combination. Such special purpose computing devices may also combine custom hard wired logic ASICs or FPGAs with custom programming to accomplish the techniques. The special purpose computing devices may be desktop computer systems portable computer systems handheld devices networking devices or any other device that incorporates hard wired and or program logic to implement the techniques.

For example is a block diagram that illustrates a computer system upon which an embodiment of the invention may be implemented. Computer system includes a bus or other communication mechanism for communicating information and a hardware processor coupled with bus for processing information. Hardware processor may be for example a general purpose microprocessor.

Computer system also includes a main memory such as a random access memory RAM or other dynamic storage device coupled to bus for storing information and instructions to be executed by processor . Main memory also may be used for storing temporary variables or other intermediate information during execution of instructions to be executed by processor . Such instructions when stored in storage media accessible to processor render computer system into a special purpose machine that is customized to perform the operations specified in the instructions.

Computer system further includes a read only memory ROM or other static storage device coupled to bus for storing static information and instructions for processor . A storage device such as a magnetic disk or optical disk is provided and coupled to bus for storing information and instructions.

Computer system may be coupled via bus to a display such as a cathode ray tube CRT for displaying information to a computer user. An input device including alphanumeric and other keys is coupled to bus for communicating information and command selections to processor . Another type of user input device is cursor control such as a mouse a trackball or cursor direction keys for communicating direction information and command selections to processor and for controlling cursor movement on display . This input device typically has two degrees of freedom in two axes a first axis e.g. x and a second axis e.g. y that allows the device to specify positions in a plane.

Computer system may implement the techniques described herein using customized hard wired logic one or more ASICs or FPGAs firmware and or program logic which in combination with the computer system causes or programs computer system to be a special purpose machine. According to one embodiment the techniques herein are performed by computer system in response to processor executing one or more sequences of one or more instructions contained in main memory . Such instructions may be read into main memory from another storage medium such as storage device . Execution of the sequences of instructions contained in main memory causes processor to perform the process steps described herein. In alternative embodiments hard wired circuitry may be used in place of or in combination with software instructions.

The term storage media as used herein refers to any media that store data and or instructions that cause a machine to operation in a specific fashion. Such storage media may comprise non volatile media and or volatile media. Non volatile media includes for example optical or magnetic disks such as storage device . Volatile media includes dynamic memory such as main memory . Common forms of storage media include for example a floppy disk a flexible disk hard disk solid state drive magnetic tape or any other magnetic data storage medium a CD ROM any other optical data storage medium any physical medium with patterns of holes a RAM a PROM and EPROM a FLASH EPROM NVRAM any other memory chip or cartridge.

Storage media is distinct from but may be used in conjunction with transmission media. Transmission media participates in transferring information between storage media. For example transmission media includes coaxial cables copper wire and fiber optics including the wires that comprise bus . Transmission media can also take the form of acoustic or light waves such as those generated during radio wave and infra red data communications.

Various forms of media may be involved in carrying one or more sequences of one or more instructions to processor for execution. For example the instructions may initially be carried on a magnetic disk or solid state drive of a remote computer. The remote computer can load the instructions into its dynamic memory and send the instructions over a telephone line using a modem. A modem local to computer system can receive the data on the telephone line and use an infra red transmitter to convert the data to an infra red signal. An infra red detector can receive the data carried in the infra red signal and appropriate circuitry can place the data on bus . Bus carries the data to main memory from which processor retrieves and executes the instructions. The instructions received by main memory may optionally be stored on storage device either before or after execution by processor .

Computer system also includes a communication interface coupled to bus . Communication interface provides a two way data communication coupling to a network link that is connected to a local network . For example communication interface may be an integrated services digital network ISDN card cable modem satellite modem or a modem to provide a data communication connection to a corresponding type of telephone line. As another example communication interface may be a local area network LAN card to provide a data communication connection to a compatible LAN. Wireless links may also be implemented. In any such implementation communication interface sends and receives electrical electromagnetic or optical signals that carry digital data streams representing various types of information.

Network link typically provides data communication through one or more networks to other data devices. For example network link may provide a connection through local network to a host computer or to data equipment operated by an Internet Service Provider ISP . ISP in turn provides data communication services through the world wide packet data communication network now commonly referred to as the Internet . Local network and Internet both use electrical electromagnetic or optical signals that carry digital data streams. The signals through the various networks and the signals on network link and through communication interface which carry the digital data to and from computer system are example forms of transmission media.

Computer system can send messages and receive data including program code through the network s network link and communication interface . In the Internet example a server might transmit a requested code for an application program through Internet ISP local network and communication interface .

The received code may be executed by processor as it is received and or stored in storage device or other non volatile storage for later execution.

In the foregoing specification embodiments of the invention have been described with reference to numerous specific details that may vary from implementation to implementation. For example certain embodiments have been described with respect to geo tagging locations on the Earth but other embodiments may be applied to geo tagging other kinds of locations or other planetary bodies. Thus the sole and exclusive indicator of what is the invention and is intended by the applicants to be the invention is the set of claims that issue from this application in the specific form in which such claims issue including any subsequent correction. Any definitions expressly set forth herein for terms contained in such claims shall govern the meaning of such terms as used in the claims. Hence no limitation element property feature advantage or attribute that is not expressly recited in a claim should limit the scope of such claim in any way. The specification and drawings are accordingly to be regarded in an illustrative rather than a restrictive sense.

