---

title: Outputting selective elements of a structured document
abstract: By this, an appropriate element can be selected and output from among the plurality of elements included in the structured document.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09141324&OS=09141324&RS=09141324
owner: Canon Kabushiki Kaisha
number: 09141324
owner_city: Tokyo
owner_country: JP
publication_date: 20101018
---
This application is a Continuation of International Application No. PCT JP2010 059716 filed Jun. 8 2010 which claims the benefit of Japanese Patent Application No. 2009 138398 filed Jun. 9 2009 both of which are hereby incorporated by reference herein in their entirety.

The present invention relates to an image processing apparatus which outputs an element included in a structured document.

In recent years people can access servers through the Internet and obtain various information from displayed web pages. The web pages are represented by structured documents described by a structured language markup language such as an HTML Hyper Text Markup Language or an XHTML Extensible Hyper Text Markup Language . Then the structured documents are analyzed by software referred to as a browser and the browser performs display in accordance with analysis results whereby the web pages can be displayed.

Furthermore when such a web page is to be printed a certain region of a web page selected by a user may be printed. For example Japanese Patent No. 03588337 discloses a technique of copying an element included in a structured document such as text or an image corresponding to a portion of a web page selected in response to a selection of a certain rectangle portion included in the web page performed by a user using a pointing device such as a mouse so that a new structured document is generated. Furthermore Japanese Patent No. 03588337 discloses a method for displaying only text or an image selected by the user in accordance with the newly generated structured document.

However in the method disclosed in Patent Literature 1 the user has to specify a region in a web page so as to select an element included in a structured document. Therefore a technique which facilitates an operation performed by the user to select an element included in a structured document has been demanded.

Accordingly the present invention provides an image processing apparatus which selects an appropriate element from among a plurality of elements included in a structured document and which outputs the appropriate element.

An image processing apparatus includes an obtaining unit configured to obtain information representing content of a plurality of elements which are included in a structured document defined as a layer structure a selecting unit configured to selecting one of the elements included in the structured document for each layer in accordance with the content of the elements which are included in the structured document the content being represented by the information obtained by the obtaining unit and an outputting unit configured to output an element selected from one of the layers by the selecting unit separately from the other elements.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Hereinafter preferred embodiments of the present invention will be described in detail with reference to the accompanying drawings. Note that embodiments below do not limit the present invention according to claims and it is not necessarily the case that all combinations of characteristics described in the embodiments are required for solving means of the present invention.

A USB interface is connected to an USB cable and used for data communication with the printer . Note that the communication with the printer may be performed by a SCSI or wireless communication instead of the USB cable.

A display device is constituted by a CRT or a liquid crystal display and a graphic controller and displays a web page downloaded from the www server a print preview image or a graphic user interface GUI . An input device including a mouse and a keyboard is used by a user to issue various instructions to the PC . A system bus is used for data communication among the CPU the RAM the ROM and the hard disk .

A LAN interface is connected to a LAN cable and performs data communication with the external www server through a rooter not shown or the Internet . Note that this data communication may be performed by wireless communication using an interface which supports the wireless communication for example.

Furthermore shows a case where a so called laptop PC which is configured such that the PC integrally includes the display device the input device and a control unit including the CPU the RAM and the like is used. However the present invention is not limited to this and a so called desktop PC in which a display device and an input device are separated from a control unit may be employed.

In a structured document print module is plug in software called by the browser . When the user issues an instruction for automatically extracting an element to the browser the structured document print module is executed. Note that the automatic extraction of an element corresponds to a process of extracting an element serving as a main element of information included in a web page and determining the element as a print target region. The process will be described in detail hereinafter.

In the structured document print module an automatic element extraction unit analyzes elements included in a structured document and stores layer structure data of the elements which is referred to a DOM Document Object Model tree in the temporary storage region such as the RAM .

In the DOM tree of the structured document includes a document node as a root node representing the entire document and a head node and an html node as child nodes. Furthermore the html node includes a body node as a child node. Moreover each of element nodes has data such as a pointer pointing a parent element node a pointer pointing a brother element node a pointer pointing a child element node list attribute information and text information. Furthermore display states of the elements and layout information are defined in a CSS file and the information is stored in the temporary storage region as information on the element nodes of the DOM tree. The information on the element nodes includes a font type a font size a text color and a display position for example.

Furthermore in accordance with the DOM tree the automatic element extraction unit refers to areas occupied by the respective elements in the web page a text amount text ratios relative to areas occupied by the elements a tag type and a tag attribute so as to specify one or more elements serving as main portions of the information included in the web page. Hereinafter elements serving as the main portions of the information included in the web page are referred to as a main element group and one of the main portions included in the main element group which is the most important element is referred to as a main element. In this embodiment the main element and the main element group are preferentially selectable as print target candidates. Specifically when a certain region of the web page is to be printed it is highly possible that the user desires to print one of the main elements of the web page. Therefore the main elements included in the web page are preferentially selected.

Note that the text amounts herein represent data amounts of text information actually displayed in the browser among the text information included in the elements. Furthermore the text ratios represent ratios of the text amounts relative to entire tag sizes of the elements. For example when an element represents an advertisement included in the web page it is highly possible that a link to another web page is included. In this case since the text information of the element includes a large amount of information assigned to the link such as a URL a ratio of the text information displayed in the browser relative to an entire tag size of the element is low. Therefore a result of a determination as to whether the target element is an advertisement can be estimated in accordance with the text ratio described above. Accordingly it can be determined whether it is highly possible that the user desires to print the target element.

An element selection unit provides a display effect for specifying one or more main element group or one or more main elements which are included in the web site and which are extracted by the automatic element extraction unit in the GUI screen displayed in the display device . In this embodiment an element which has been subjected to the display effect corresponds to a print target and therefore the main element and the main element group correspond to print targets. The user may change an element to be subjected to the effect in the GUI screen using the input device such as the mouse or the keyboard so as to change an element serving as the print target.

Then when an instruction for determining an element serving as a print target is supplied from the input device to the element selection unit the element selection unit supplies information used to specify an element serving as a print target to a print layout unit in accordance with the received instruction.

The print layout unit determines layout of the element which is included in the main element group and which is specified as the print target on a sheet in accordance with the main element extracted by the automatic element extraction unit or the information supplied from the element selection unit . The layout is determined in accordance with a print setting. The print setting includes information on a sheet size a resolution and a printable region relative to the sheet size and the like. Note that information representing the print setting is obtained from a printer driver through an OS .

A print preview unit displays an image in which an element is arranged in accordance with the layout determined by the print layout unit as a print preview image in the display device . When receiving a print starting instruction a print processor causes a printer driver to perform a rendering process through the OS in accordance with element arrangement information obtained from the print layout unit .

The OS provides an API Application Programming Interface used to perform transmission and reception of print setting data between the structured document print module and the printer driver and an API used to perform the rendering process. Furthermore although the OS includes various control software such as a spooler system which manages print jobs and a port monitor which outputs printer commands to ports detailed descriptions thereof are omitted.

The printer driver generates print data in accordance with the rendering process executed by the print processor and converts the print data into a printer command. Then the printer driver supplies the printer command obtained through the conversion to the printer through the OS so that printing is performed on a sheet.

Referring now to and a GUI screen used to select a print target to be displayed under display control of the element selection unit will be described. is a diagram illustrating a GUI screen. The browser includes a back button a forward button and an address input region which are used to change a web page to be displayed. The browser further includes a print button a print preview button and an automatic extraction button . The automatic extraction button is used to execute a function of automatically extracting a main element group included in the structured document. When the user presses the automatic extraction button the browser calls the structured document print module using a structured document file of a web page being displayed as a parameter. The structured document print module extracts a main element group and a main element from the specified structured document file to be displayed in the browser . The process of extracting the main element and the main element group will be described in detail with reference to hereinafter.

Furthermore the GUI screen shown in includes a print button used to print the main element serving as a print target and a print preview button used to start print preview. In addition a cancel button used to stop display of the main element is displayed at the same time. When the cancel button is selected a state of the GUI screen is back to the state shown in . Furthermore a size and a position of the region of the main element shown in can be manually controlled by dragging the mouse in the browser .

Note that the GUI screen shown in and the GUI screen shown in may be displayed in combination. Specifically in a GUI screen a region representing the print target element in the web page shown in and a region including the thumbnail images of the web page which includes the print target element and which can be selected by the user are included. Then when one of the thumbnail images is selected content of the web page represented by the selected thumbnail image is reflected to a region in which the web page is displayed. By this the user can easily select the print target element using the thumbnail and can check content of the print target element in the web page.

Note that instead of the display of the region serving as the print target by effectively changing a color of a portion of the web page as shown in B and elements other than the print target may be deleted so that only the print target element is displayed. Furthermore as described above instead of the operation of selecting a candidate of a print target region performed by the user an operation of automatically selecting a print region may be employed. Moreover the print target element is distinctively displayed so that the user can check a region to be printed in advance. However the display may be omitted and printing may be immediately performed after the element is automatically extracted. By this the region which is automatically selected can be printed when the user clicks a predetermined button only once.

First in step S when the automatic extraction button of the browser is selected so that an automatic extraction instruction is issued the structured document print module is activated and the automatic element extraction unit starts performing the process. In step S the automatic element extraction unit sets an initial value of a target element Ri among elements included in a structured document read through the browser . Note that the target element Ri corresponds to a candidate of a main element the variable i represents a number of a layer lower than a layer of a body element of the DOM tree corresponding to the structured document. The larger a value of the layer number is the lower the layer is. In step S the body node included in the DOM tree is determined as an initial target element R of the target element Ri i is a natural number .

Next in step S to step S the automatic element extraction unit extracts a target element from each of the layers starting from the uppermost layer to the lowermost layer of the DOM tree. First in step S widths and heights a unit of pixel in the web page of all sub elements assigned to lower layers under the target element Ri are obtained and areas in the web page of all the sub elements assigned to the lower layers under the target element Ri are obtained in accordance with the widths and the heights. Furthermore in step S text amounts and XHTML tag sizes of all the sub elements of the target element Ri are obtained and text ratios of all the sub elements assigned to the lower layers under the target element Ri are obtained in accordance with the text amounts and the XHTML tag sizes.

In step S in accordance with the information obtained in step S and step S among the sub elements of the target element Ri an element Rc which has a text ratio equal to or larger than a predetermined threshold value and which has the largest area is determined to be a target element candidate. Then in step S a rate of the area of the element Rc to the area of the element Ri is obtained and it is determined whether the area rate is equal to or larger than a predetermined threshold value. When the area rate is equal to or larger than the threshold value the process proceeds to step S where the element Rc is determined to be a target element R i 1 . Then the process proceeds to step S where the layer number i is incremented in order to extract a target element in a further lower layer. By repeatedly performing step S to step S elements R to Rn are determined. Note that the threshold values used in the processes performed in step S and step S are changeable by the user.

Furthermore when it is determined that the area rate is smaller than the threshold value in step S the process proceeds to step S where a main element group and a main element are extracted. Specifically the extracted target elements R to Rn are determined to be included in the main element group and especially the element Rn is determined to be a main element. Since it is considered that the main element Rn has the smallest area in the main element group in which regions unnecessary for the user are eliminated as much as possible the element Rn is determined as a main element. Furthermore the main element group becomes a print target candidate when the user specifies large area as an element serving as a print target and is extracted when an extraction conditions of the process shown in is eased.

By performing the processing procedure described above the automatic element extraction unit analyzes the DOM tree of the structured document on a layer by layer basis so as to extract a main element and a main element group. The main element and the main element group extracted in accordance with the processing procedure have the largest areas among the elements and have high text ratios.

Note that in the extracted main element group elements assigned to the lower layer correspond to more remarkable elements in the web page and therefore it is highly possible that the user determines the elements as print targets. Therefore when a display effect is used to display a print target element in the web page elements assigned to lower layers such as the main elements may be preferentially displayed. Furthermore when thumbnail images representing a page are displayed to be selected as described above an element assigned to the lowest layer in the main element group may be preferentially selected.

Note that in the foregoing process an element can be selected from any one of the layers defined in the structured document. However the present invention is not limited to this and an element may be selected from some particular layers defined by the structured document. The specified layers may be predetermined or may be specified by the user.

Furthermore although the area of the element and the text ratio of the element are used to extract the main element in the above process a tag type a tag attribute and a style of the element may be used to extract the main element. For example a background of a region corresponding to an element included in a web page or a text size of text included in a text element is obtained in accordance with the tag type and the tag attribute of the element to extract a main element in accordance with the obtained background and the obtained text size.

Moreover in the foregoing process the main element is determined by setting the sub element of the target element as a next target element. Specifically in the web page the main element is determined by only using regions corresponding to sub elements included in a region corresponding to the target element. However the present invention is not limited to this and an element which does not correspond to a sub element of the target element and which is assigned to a layer lower than that of the target element may be determined as a next target element. That is in a web page a main element may be determined using a region other than the region corresponding to the target element as a region corresponding to a next target element.

Furthermore although one target element is extracted from each of the layers of the DOM tree starting from the uppermost layer in the foregoing process a plurality of target elements may be extracted. In addition the target element and the main element may be extracted by analyzing all the elements instead of use of the DOM tree.

Furthermore in the foregoing description an element automatically extracted is displayed. However the present invention is not limited to this and an element which has been automatically extracted may be arranged for printing without displaying the element.

Note that in the embodiment described above the main element is extracted from the lower element of the target element. However in addition to the main element another element assigned to a layer the same as that of the target element may be extracted as another main element. Specifically an element included in a region different from that of the target element may be extracted as a main element in addition to the main element extracted from the target element. In this case a plurality of main elements are extracted from different regions of the web page. That is a plurality of regions included in the web page serve as print targets. Furthermore the plurality of main elements serving as print targets may be assigned to different layers.

As described above in this embodiment an element desired by the user can be automatically extracted and printed as an output target of a structured document. Furthermore thumbnail images corresponding to a main element group which has been automatically extracted may be displayed as a list as output candidates and the user may select a desired one of the output candidates. Accordingly the user can select a desired region to be output in the web page by a simple operation so that the region is output. Moreover since a region of a selected main element can be controlled a region to be output can be specified in detail for extraction.

Furthermore the present invention may be realized by performing the following processing. That is software program which realizes the functions of the foregoing embodiment is supplied to a system or an apparatus through a network or any storage medium and a computer or a CPU an MPU or the like included in the system or the apparatus reads and executes the program. Furthermore the present invention may be realized by executing processes by a plurality of processors such as a CPU MPU and the like in combination.

The present invention is not limited to the foregoing embodiment and various changes and modifications may be made without departing from the spirit and the scope of the present invention. Therefore the following claims are attached in order to publicize the scope of the present invention.

According to the present invention an appropriate element can be selected and output from among a plurality of elements included in a structured document.

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

